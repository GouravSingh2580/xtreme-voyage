<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Globe</title>
    <style>
     /**************************************************************************************************
 * At-Rules
 **************************************************************************************************/

@font-face {
  font-family: mplus-2p-light-sub;
  src: url("/styles/mplus-2p-light-sub.ttf?v6");
}

@font-face {
  font-family: monosocialiconsfont-sub;
  src: url("/styles/monosocialiconsfont-sub.ttf?v1");
}

/**************************************************************************************************
* Styling Reset
**************************************************************************************************/

html,
body,
div,
span,
h1,
h2,
h3,
h4,
h5,
h6,
p,
a,
svg,
canvas {
  margin: 0;
  padding: 0;
  border: 0;
  font: 1em mplus-2p-light-sub, Helvetica, arial, freesans, clean, sans-serif;
  -webkit-font-smoothing: subpixel-antialiased; /* safari disables subpixel antialiasing for some reason */
}

@media (max-width: 825px), (max-height: 700px) {
  html,
  body,
  div,
  span,
  h1,
  h2,
  h3,
  h4,
  h5,
  h6,
  p,
  a,
  svg,
  canvas {
    font-size: 0.8em;
  }
}

/**************************************************************************************************
* Page Styling
**************************************************************************************************/

a,
.text-button {
  color: #888888;
}

.text-button.highlighted {
  color: #e2b42e;
}

.text-button.disabled {
  color: #444444;
}

a,
.text-button-waypoints {
  color: #888888;
}

.text-button-waypoints.highlighted {
  color: #e2b42e;
}

.text-button-waypoints.disabled {
  color: #444444;
}
.text-button-waypoints:hover,
.no-touch .text-button-waypoints:focus
.text-button-waypoints:active {
  color: #ffffff;
  cursor: pointer;
  transition: color 125ms ease-in;
  -webkit-transition: color 125ms ease-in;
}

a:hover,
a:focus,
.no-touch .text-button:hover,
.no-touch .text-button:focus,
.text-button:active {
  color: #ffffff;
  cursor: pointer;
  transition: color 125ms ease-in;
  -webkit-transition: color 125ms ease-in;
}









p.invisible,
span.invisible,
#sponsor.invisible {
  display: none;
}



svg {
  overflow: hidden; /* Do not let IE draw outside the bounds of the svg element. */
}

body {
  color: #eeeeee;
  background: #000005;
}

#warn {
  font-size: 2em;
  position: absolute;
  top: 10%;
  left: 2%;
}

#display {
  cursor: default;
  
}
#dangerdot{
  height:45px;
  width:45px;
  background-color: red;
  border-radius: 50%;
  display: inline-block;
  
}

#dangerdot:hover{
  background-color:orange;
}
#dangerdottext{
  margin-top: 10px;
  margin-left:15px;
  font-size:20px;
}

#map,
#animation,
#overlay,
#foreground {
  position: absolute;
  top: 0;
  left: 0;
  will-change: transform;
  height: 100vh;
  width: 100vw;
}

#sponsor {
  position: absolute;
  text-align: right;
  bottom: 3%;
  right: 2%;
  background-color: rgba(0, 0, 5, 0.6);
  border-radius: 0.5rem/0.5rem;
  padding: 0.5rem 1rem 0.5rem 1rem;
  font-size: 1rem;
}

#sponsor:hover #sponsor-hide {
  display: inline;
}

#sponsor a {
  text-decoration: none;
}

#details {
  height: 100%;
  width: 90%;
  position: absolute;
  /* bottom:5%; */
  left: 1%;

  pointer-events: none; /* This div is just a container--do not let it interfere with operation of the map. */
}

#earth {
  font-size:2.0rem;
}

#status,
#location,
#menu {
  font-size: 1.5rem;
  
}

#status,
#location,
#earth {
  background-color: rgba(0, 0, 5, 0.6);
  border-radius: 0.5rem/0.5rem;
  display: table;
  margin-top:0.5rem;
  padding: 0 1rem 0 1rem;
  pointer-events: all;
}

#menu {
  background-color: rgba(57, 44, 110,0.6);
  border-radius: 0.5rem/0.5rem;
  overflow-y: scroll;
  pointer-events: all;
  width: max-content;

  margin-top: -1.5rem;
  padding: 0.5rem 1rem 0.5rem 1rem;
  opacity: 1;
  max-height: 80%;
  margin-bottom:10px;
  transition: opacity 500ms ease, width 500ms ease, margin-top 500ms ease;
  -webkit-transition: opacity 500ms ease, width 500ms ease,
    margin-top 250ms ease;
}

#details{
  height: 70%;

}

#menu.invisible {
  margin-top: 0;
  padding: 0 1rem 0 1rem;
  opacity: 0;
  /* max-height: 0; */
  width: 0;
  transition: opacity 500ms ease, width 500ms ease, margin-top 500ms ease;
  -webkit-transition: opacity 500ms ease, width 500ms ease,
    margin-top 500ms ease;
}
.other-options{
  display: flex;
  flex-direction: column;
  justify-content: space-around;
}

#progress {
  padding-left: 1rem;
}

#nav-now {
  padding-right: 1rem;
}

#nav-backward,
#nav-backward-more,
#nav-forward,
#nav-forward-more,
#option-show-grid {
  padding-left: 1rem;
  padding-right: 1rem;
}

#show-location {
  padding-left: 0.25rem;
  padding-right: 0.25rem;
}

#lang {
  font-size: 1.25rem;
  float: right;
  padding-top: 0.5rem;
}

.social-icon {
  font-size: 2.25rem;
  font-family: monosocialiconsfont-sub, sans-serif;
  padding-left: 0.25rem;
  text-decoration: none;
  position: relative;
  top: 0.1rem;
}

.internal-link {
  text-decoration: none;
}

.sup {
  position: relative;
  bottom: 0.3em;
  font-size: 0.6em;
}

.sub {
  position: relative;
  top: 0.3em;
  font-size: 0.6em;
}

#coordinates-table-body {
  display: block;
}

/**************************************************************************************************
* SVG Element Styling
**************************************************************************************************/

.coastline,
.lakes {
  stroke: #ffffff;
  stroke-width: 1.25;
  fill: none;
}

.firefox .coastline,
.firefox .lakes {
  stroke-width: 1;
}

.graticule {
  stroke: #505050;
  stroke-width: 1;
  fill: none;
}

.hemisphere {
  stroke: #707070;
  stroke-width: 1.25;
  fill: none;
}

.background-sphere {
  stroke: none;
  fill: #303030;
}

.foreground-sphere {
  stroke: #000005;
  stroke-width: 4;
  fill: none;
  -moz-user-select: none; /* Oddly, Win FF sometimes selects this SVG element. Disable. */
  user-select: none;
}


.location-mark {
  stroke: #d32f2f;
  fill: #d32f2f;
}

.ship {
  fill: yellow;
}

.text-mark {
  fill: white;
  font-size: small;
  font-weight: bold;
}

.location-line {
  stroke: white;
  stroke-width: 4;
}

.dropbtn {
  background-color: rgba(0, 0, 5, 0.6);
  border-radius: 0.5rem/0.5rem;
  display: table;
  margin-top:0.5rem;
  color: white;
  padding: 7px 15px;
  border: none;
  cursor: pointer;
  opacity: 0.9;
  position: fixed;
  top:30px;
  right: 28px;
  font-weight: 600;
  font-size:20px;
}
#fullscreenmode
{

  bottom: 20px;
  right: 28px;
  display: flex;
  flex-direction: column;
  position: fixed;
  z-index: 2;
  padding: 1px;
}

/* The container <div> - needed to position the dropdown content */
.dropdown {
  position: relative;
  display: inline-block;
  background-color: rgba(0, 0, 5, 0.6);
  border-radius: 0.5rem/0.5rem;
  display: table;
  margin-top: 1rem;
  padding: 0 1rem 0 1rem;
  pointer-events: all;
  /* transform: translate(624%,-100%); */
}

/* Dropdown Content (Hidden by Default) */
.dropdown-content {
  display: none;
  position: absolute;
  background-color: #f1f1f1;
  min-width: 160px;
  top: 13px;
  left: 740px;

  box-shadow: 0px 8px 16px 0px rgba(0, 0, 0, 0.2);
  z-index: 2;
}

/* Links inside the dropdown */
.dropdown-content a {
  color: black;
  padding: 6px 6px;
  text-decoration: none;
  display: block;
}

/* Change color of dropdown links on hover */
/* .dropdown-content a:hover {background-color: #ddd;} */

/* Show the dropdown menu on hover */
.dropdown:hover .dropdown-content {
  display: block;
}

/* Change the background color of the dropdown button when the dropdown content is shown */
.dropdown:hover .dropbtn {
  background-color: #305c31;
}
/**************************************************************************************************
* About Page
**************************************************************************************************/

#about {
  font-size: 1.5rem;
}

#about h1 {
  font-size: 2.4rem;
  text-align: center;
  padding-top: 2rem;
}

#about div {
  clear: both;
}

#about .blurb {
  padding-top: 2rem;
  padding-bottom: 2rem;
}

#about .blurb img {
  padding-top: 2rem;
}

#about img {
  display: block;
  margin: auto;
}

#about:first-child {
  padding-top: 3rem;
}

#cover {
  border: 1px solid #eeeeee;
}

#about .left {
  width: 50%;
  float: left;
  text-align: right;
}

#about .right {
  width: 50%;
  float: right;
}

#about .center {
  text-align: center;
}

#about .pad {
  visibility: hidden;
}

#closing {
  padding-bottom: 2.5rem;
}

.abc {
  position: relative;
  z-index: 2;
  padding: 1px;
}
.navigation {
  display: flex;
  flex-direction: column;
  position: fixed;
  z-index: 2;
  padding: 1px;
}

.nvgBtn {
  width: 3.5rem;
  height: 3.5rem;
  margin: 0.5rem;
  border-radius: 50%;
  font-weight: 800;
  cursor: pointer;
  font-size: 1rem;
  background-color: #1e70e9;
  color: white;
  border: none;
}

#insertPointBtn {
  padding: 7px;
  height: auto;
  border-radius: 5%;
  width: auto;
  cursor: pointer;
  font-weight: bold;
}

#insertPointBtn:hover {
  background-color: #000;
  color: white;
}

#SourceBtn:hover {
  background-color: #000;
  color: white;
}
#NextBtn:hover {
  background-color: #000;
  color: white;
}
#PrevBtn:hover {
  background-color: #000;
  color: white;
}

#DestBtn:hover {
  background-color: #000;
  color: white;
}

#downloadCSV:hover {
  background-color: #000;
  color: white;
}
#uploadBtn:hover {
  background-color: #000;
  color: white;
}

.files {
  margin: auto;
}

table,
tr,
td {
  border: 0.1px solid #ffffff;
  border-collapse: collapse;
  padding: 0.5 rem;
  text-decoration: rgb(39, 1, 39);
}
tr,
td {
  padding: 1px 1px 1px 1px;
  border-radius: 4px;
  border: 0.5px solid rgba(39, 27, 4, 0.856);
}
/* 
th, td, tr{
  background-color: #078292c0;
  padding: 0.5rem;
  font-size: large;
}  */

.container {
  padding: 2.5rem;
  height: fit-content;
}

.btnContainer {
  width: 150%;
  margin-top: 1rem;
}

.backBtn {
  width: fit-content;
  padding: 0.5rem;
  margin: 0.5rem;
}

.abc {
  display: flex;
  float: left;
}

/* The popup form - hidden by default */

/* Add styles to the form container */

/* When the inputs get focus, do something */

.overlay1 {
  position: absolute;
  top: 133px;
  left: 8px;
  width: auto;
  font-size: 32px;
}
#change {
  border-radius: 5px;
}
#change:hover {
  background-color: #f1c43b;
}
.overlay::after,
.overlay1::before {
  position: absolute;
  top: -3px;
  bottom: -3px;
  right: 0;
  content: "";
}
.name:hover {
  text-decoration: underline;
}
.modal {
  margin-top:10%;
  margin-right: 2%;
  display: none; /* Hidden by default */
  position: fixed; /* Stay in place */
  z-index: 4; /*Sit on top*/
  padding-top:50px; /* Location of the box */
  right: -30px;
  top:5px;
  border-radius: 3px;
  width: auto; /* Full width */
  height: 50%; /* Full height */
  overflow: visible; /* Enable scroll if needed */
  background-color: rgba(0, 0, 0, 0); /* Fallback color */
  background-color: rgba(37, 4, 39, 0); /* Black w/ opacity */

  font-size: large;

  padding: 0;

  -webkit-animation-name: animatetop;
  -webkit-animation-duration: 0.6s;
  animation-name: animatetop;
  animation-duration: 0.6s;
  padding: 0.5rem;
  font-size: large;
}

/* Modal Content */
.modal-content {
  height: 100%;
  width: 100%;
  margin-top:-8rem;
}

/* Add Animation */
@-webkit-keyframes animatetop {
  from {
    top: 300px;
    opacity: 0;
  }
  to {
    top: 0;
    opacity: 1;
  }
}

@keyframes animatetop {
  from {
    top: 300px;
    opacity: 0;
  }
  to {
    top: 0;
    opacity: 1;
  }
}

/* The Close Button */
.close {
  color: white;
  float: none;
  font-size: 18px;
  font-weight: bold;
  z-index: 4;
}
.cancel{
  border-radius:25px;
  margin-left:0px;
 background-color: red;
}

.close:hover,
.close:focus {
  color: #000;
  text-decoration: none;
  cursor: pointer;
}

.modal-header {
  padding: 2px 16px;
  background-color: #5cb85c;
  color: white;
}

.modal-body {
  padding: 2px 16px;
}

.modal-footer {
  padding: 2px 6px;
  background-color: #5cb85c;
  color: white;
}
#mybtn {
  z-index: 99;
  padding: 0px;
  
}
#overlay1 {
  z-index: 3;
  position: absolute;
  display: flow-root;
  top: 100px;
  font-size: 35px;
}
.add {
  color: azure;
}
.add:hover {
  text-decoration: underline;
}

#add1 {
  color: beige;
}
#add1:hover {
  color: coral;
}

#coordinates-table {
  border: white solid 2px;
  margin-top: auto;
  background-color: #000;
  position: relative;
}

#sticky-header {
  width: 100%;
  padding: 7px;
  background-color: #000;
  position: sticky;
  top: 0;
}
.headcells {
  padding: 7px;
  background-color: #000005;
  height: auto;
  width: auto;
  color: #c3f0f0bf;
  font-weight: 600;
}

.blank {
  width: 20px;
}

.condition_col {
  font-size: 1.1rem;
  font-weight: 600;
}

.cell1 {
  outline: none;
  font-size: small;
  font-weight: bold;
  /* padding: 2%; */
  background-color: #d32f2f;
  border: none;
  border-radius: 50%;
  width: 22px;
  height: 22px;
  font-style: oblique;
  color: white;
  text-align: center;
  margin: 0;
}

#latLong {
  padding: 2%;
  width: auto;
}

.cell2 {
  padding: 2%;
  background-color: #000005;
  width: auto;
  height: fit-content;
  font-style: oblique;
  color: #c3f0f0bf;
  font-size: 1.1rem;
  text-align: center;
}

#latTxt,
#longTxt {
  background-color: #000;
  font-size: 1.1rem;
  font-style: oblique;
  color: #c3f0f0bf;
  text-align: center;
}


#velocity
{
  padding: 2%;
  background-color: #000005;
  width: 100%;
  font-style: oblique;
  color: #c3f0f0bf;
  font-size: 1.1rem;
  text-align: center;

}

.cell3 {
  padding: 2%;
  background-color: #000005;
  width: 95%;
  font-style: oblique;
  color: #c3f0f0bf;
  font-size: 1.1rem;
  text-align: center;
}
.cell4{
  padding: 2%;
  background-color: #000005;
  width: 95%;
  font-style: oblique;
  color: #c3f0f0bf;
  font-size: 1.1rem;
  text-align: center;
}

.disposable {
  width: auto;
  padding: 2px;
}

.line-hovered {
  stroke: white;
  stroke-width: 5;
  cursor: pointer;
}

.cross-mark {
  opacity: 0;
}

#CSVModal {
  width: 200px;
  height: 80px;
  align-self: center;
  padding: 8px;
  background: #2196f3;
  opacity: 0.6;
}

.modalContent {
  margin: 3px;
}

/*drop down css*/
/* The container <div> - needed to position the dropdown content */
.dropdown {
  position: relative;
  display: inline-block;
}

/* Dropdown Content (Hidden by Default) */
.dropdown_content {
  width: 300px;
  height: 120px;
  align-self: center;
  padding: 8px;
  background: rgba(73, 172, 134, 0.6);
  font-size: small;
}

/* Links inside the dropdown */
.dropdown_content a {
  color: white;
  padding: 12px 16px;
  text-decoration: none;
  display: block;
}

.goBtn {
  width: 50px;
  height: 30px;
  padding: 10px;
  background: white;
  color: black;
  margin: auto;
}

.zoom {
  width: 3.5rem;
  height: 3.5rem;
  font-size: 2.5rem;
  border-radius: 50%;
  float: right;

  border-radius: 50%;
  position: relative;
  background-color: #1e70e9;
  border: none;
  color: white;
}
.zoom:hover {
  background-color: #000;
  color: white;
}

.zoom:hover {
  cursor: pointer;
}

#zoom_btn_container {
  width: fit-content;
  display: flex;
  flex-direction: column;
  float: right;
}
.switch {
  position: relative;
  display: inline-block;
  width: 60px;
  height: 25px;
}

.switch input {
  opacity: 0;
  width: 0;
  height: 0;
}

.slider {
  position: absolute;
  cursor: pointer;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background-color: #ccc;
  -webkit-transition: 0.4s;
  transition: 0.4s;
}

.slider:before {
  position: absolute;
  content: "";
  height: 20px;
  width: 20px;
  left: 4px;
  bottom: 4px;
  background-color: white;
  -webkit-transition: 0.4s;
  transition: 0.4s;
}

input:checked + .slider {
  background-color: #2196f3;
}

input:focus + .slider {
  box-shadow: 0 0 1px #2196f3;
}

input:checked + .slider:before {
  -webkit-transform: translateX(26px);
  -ms-transform: translateX(26px);
  transform: translateX(26px);
}

/* Rounded sliders */
.slider.round {
  border-radius: 4rem;
}

.slider.round:before {
  border-radius: 50%;
}
.resetBtn {
  width: auto;
  height: 3.5rem;
  border-radius: 6%;
  position: relative;
  background-color: #1e70e9;
  border: none;
  color: white;
}

.resetBtn:hover {
  cursor: pointer;
  background-color: #000;
}

#ocean-mode-enable {
  color: #e2b42e;
}
#ocean-mode-enable:hover {
  color: white;
}

.navigationContainer {
  width: 20vw;
  display: flex;
  flex-direction: row;
  flex-wrap: wrap;
  justify-content: center;
}

.nvgBtn:hover {
  background-color: #000;
  color: white;
}

#new_circle_ship_0 {
  fill: white;
}

.new_circle_ship_rings {
  stroke: white;
  stroke-width: 4;
  fill: none;
  display: block;
}

@keyframes anim1 {
  0% {
    stroke-width: 4;
    transition: 0.5s;
  }
  20% {
    stroke-width: 0;
    transition: 0.5s;
  }
  40% {
    stroke-width: 0;
    transition: 0.5s;
  }
  60% {
    stroke-width: 0;
    transition: 0.5s;
  }
  80% {
    stroke-width: 0;
    transition: 0.5s;
  }
  100% {
    stroke-width: 0;
    transition: 0.5s;
  }
}

@keyframes anim2 {
  0% {
    stroke-width: 0;
    transition: 0.5s;
  }
  20% {
    stroke-width: 4;
    transition: 0.5s;
  }
  40% {
    stroke-width: 0;
    transition: 0.5s;
  }
  60% {
    stroke-width: 0;
    transition: 0.5s;
  }
  80% {
    stroke-width: 0;
    transition: 0.5s;
  }
  100% {
    stroke-width: 0;
    transition: 0.5s;
  }
}

@keyframes anim3 {
  0% {
    stroke-width: 0;
    transition: 0.5s;
  }
  20% {
    stroke-width: 0;
    transition: 0.5s;
  }
  40% {
    stroke-width: 4;
    transition: 0.5s;
  }
  60% {
    stroke-width: 0;
    transition: 0.5s;
  }
  80% {
    stroke-width: 0;
    transition: 0.5s;
  }
  100% {
    stroke-width: 0;
    transition: 0.5s;
  }
}

@keyframes anim4 {
  0% {
    stroke-width: 0;
    transition: 0.5s;
  }
  20% {
    stroke-width: 0;
    transition: 0.5s;
  }
  40% {
    stroke-width: 0;
    transition: 0.5s;
  }
  60% {
    stroke-width: 4;
    transition: 0.5s;
  }
  80% {
    stroke-width: 0;
    transition: 0.5s;
  }
  100% {
    stroke-width: 0;
    transition: 0.5s;
  }
}

@keyframes anim5 {
  0% {
    stroke-width: 0;
    transition: 0.5s;
  }
  20% {
    stroke-width: 0;
    transition: 0.5s;
  }
  40% {
    stroke-width: 0;
    transition: 0.5s;
  }
  60% {
    stroke-width: 0;
    transition: 0.5s;
  }
  80% {
    stroke-width: 4;
    transition: 0.5s;
  }
  100% {
    stroke-width: 0;
    transition: 0.5s;
  }
}

@keyframes anim6 {
  0% {
    stroke-width: 0;
    transition: 0.5s;
  }
  20% {
    stroke-width: 0;
    transition: 0.5s;
  }
  40% {
    stroke-width: 0;
    transition: 0.5s;
  }
  60% {
    stroke-width: 0;
    transition: 0.5s;
  }
  80% {
    stroke-width: 0;
    transition: 0.5s;
  }
  100% {
    stroke-width: 4;
    transition: 0.5s;
  }
}

#new_circle_ship_1 {
  animation-name: anim1;
  animation-duration: 1s;
  animation-iteration-count: infinite;
}

#new_circle_ship_2 {
  animation-name: anim2;
  animation-duration: 1s;
  animation-iteration-count: infinite;
}

#new_circle_ship_3 {
  animation-name: anim3;
  animation-duration: 1s;
  animation-iteration-count: infinite;
}

#new_circle_ship_4 {
  animation-name: anim4;
  animation-duration: 1s;
  animation-iteration-count: infinite;
}

#new_circle_ship_5 {
  animation-name: anim5;
  animation-duration: 1s;
  animation-iteration-count: infinite;
}

#new_circle_ship_6 {
  animation-name: anim6;
  animation-duration: 1s;
  animation-iteration-count: infinite;
}
.distance {
  fill: white;
  font-size: small;
  font-weight: bold;
  transform: rotateZ(90);
}


.functionality_table {
  width: 100%;
  margin: 1em;
  border-radius: 8px;
  background-color: white;
  padding: 1em;
  padding-top: 0px;
  opacity: 1;
  max-height: 12rem;
  overflow-y: scroll;
  margin-left:-12px;
 
  transition: opacity 250ms ease, max-height 250ms ease, margin-top 250ms ease;
  -webkit-transition: opacity 250ms ease, max-height 250ms ease,
  margin-top 250ms ease;
  pointer-events: all;
}

.functionality_table.invisible {
   margin-top: 0; 
  padding: 0 1rem 0 1rem;
  opacity: 0;
  width: 0;
  max-height: 0;
  transition: opacity 300ms ease, max-height 300ms ease, margin-top 300ms ease;
  -webkit-transition: opacity 300ms ease, max-height 300ms ease,

    margin-top 250ms ease;
  pointer-events: all;
}

.slider_distance {
  -webkit-appearance: none;
  width: 100%;
  height: 25px;
  background: #d3d3d3;
  outline: none;
  opacity: 0.7;
  -webkit-transition: 0.2s;
  transition: opacity 0.2s;
}

.slider_distance:hover {
  opacity: 1;
}

.slider_distance::-webkit-slider-thumb {
  -webkit-appearance: none;
  appearance: none;
  width: 25px;
  height: 25px;
  background: #04aa6d;
  cursor: pointer;
}

.slider_distance::-moz-range-thumb {
  width: 25px;
  height: 25px;
  background: #04aa6d;
  cursor: pointer;
}

#dist_meter {
  color: black;
  font-weight: bold;
  font-size: 1rem;
}

#total_dis {
  color: black;
  font-weight: bold;
  font-size: 1rem;
}
#data_points_text{
  color: black;
  font-weight: bold;
  font-size: 1rem;
}
.iso-mark {
  stroke: #fffbfb;
  fill: #f6f6f7;
  opacity: 1.6;
}
#table_distance_meter {
  display: flex;
  flex-direction: row;
  width: 100%;
  justify-content: space-between;
}

#table_distance_marker_meter {
  display: flex;
  flex-direction: row;
  width: 100%;
  justify-content: space-between;
  margin-top:-6px;
}
.distance_marker_table {
  display: flex;
  flex-direction: column;
  margin-top: 0px;
  color: black;
  justify-content: center;
  align-items: flex-start;
  margin: 10px;
  margin-left: 0px;
  margin-top: 0px;
  font-size: 12px;
}

.distance_marker_txt_table {
  display: flex;
  flex-direction: column;
  margin-top: 0px;
  color: black;
  justify-content: center;
  align-items: center;
  margin: 10px;
  margin-left: 0px;
  margin-top: 0px;
  font-size: 12px;
}

#data_btns_row {
  display: flex;
  flex-direction: row;
  flex-wrap: wrap;
  padding: 10px;
  align-items: center;
}

#data_btns_row > p {
  color: black;
}

.data_btns {
  background-color: lightgrey;
  border: none;
  border-radius: 5px;
  margin: 5px;
  color: black;
}

.data_btn_selected {
  background-color: lightgreen;
  color: white;
}
p{
  margin-top:5px;
}









/* 
.wrapper {
  position: relative;
  background-color: #ffffff;
  border-radius: 10px;
} */

.dsl-container {
  position: relative;
  width: 100%;
  height: 13px;
  margin-top: 15px;
}

.dateslider {
  -webkit-appearance: none;
  -moz-appearance: none;
  appearance: none;
  width: 100%;
  outline: none;
  position: absolute;
  margin: auto;
  top: 0;
  bottom: 0;
  background-color: transparent;
  pointer-events: none;
}

.slider-track {
  width: 100%;
  height: 5px;
  position: absolute;
  /* margin: auto; */
  /* top: 0;
  bottom: 0; */
  border-radius: 5px;
}


.dateslider::-webkit-slider-runnable-track {
  -webkit-appearance: none;
  height: 5px;
}

.dateslider::-moz-range-track {
  -moz-appearance: none;
  height: 5px;
}

.dateslider::-ms-track {
  appearance: none;
  height: 5px;
}

.dateslider::-webkit-slider-thumb {
  -webkit-appearance: none;
  height: 1.7em;
  width: 1.7em;
  background-color: rgb(241, 0, 0);
  cursor: pointer;
  margin-top: -9px;
  pointer-events: auto;
  border-radius: 50%;
}

.dateslider::-moz-range-thumb {
  -webkit-appearance: none;
  height: 1.7em;
  width: 1.7em;
  cursor: pointer;
  border-radius: 50%;
  background-color: rgb(241, 0, 0);
  pointer-events: auto;
}

.dateslider::-ms-thumb {
  appearance: none;
  height: 1.7em;
  width: 1.7em;
  cursor: pointer;
  border-radius: 50%;
  background-color: rgb(241, 0, 0);
  pointer-events: auto;
}

.dateslider:active::-webkit-slider-thumb {
  background-color: #ffffff;
  /* border: 3px solid #3264fe; */
}

.values {
  background-color: #3264fe;
  width: 50%;
  position: relative;
  margin: auto;
  border-radius: 5px;
  text-align: center;
  font-weight: 500;
  font-size: 15px;
  color: #ffffff;
}

.values:before {
  content: "";
  position: absolute;
  height: 0;
  width: 0;
  border-top: 15px solid #3264fe;
  border-left: 15px solid transparent;
  border-right: 15px solid transparent;
  margin: auto;
  bottom: -14px;
  left: 0;
  right: 0;
}
</style>
	
   
  </head>
<body>
    
    <div id="display" >
		<svg id="map" class="fill-screen" xmlns="http://www.w3.org/2000/svg" version="1.1" ></svg>
        <canvas id="animation" class="fill-screen"></canvas>
        <canvas id="overlay" class="fill-screen"></canvas>
        <svg id="foreground" class="fill-screen" xmlns="http://www.w3.org/2000/svg" version="1.1"  ></svg>
    </div>
    
        

    <button id="myBtn" class="dropbtn">
        <span class="text-button-waypoints" title="WayPoints">
        WayPoints
        </span>
    </button>
  
   

    

    <div id="myModal" class="modal" >
    
    
        <div class="modal-content" style="overflow-y:auto;">
          
          
            <table id="coordinates-table" >
                <tr id="sticky-header">
                    <th id="insert_point_blank" class="headcells blank" style="display: none;"></th>
                    <th class="headcells">S. No.</th>
                    <th class="headcells">Coordinates</th>
                    <th id="dynamic-condition-col" class="headcells">
                        <span class="condition_col" id="condition-column">Weather Condition</span>
                        (<span id="location-wind-units" class="text-button"></span>)
                    </th>
                    <th class="headcells">
                        Velocity(m/s)
                    </th>
                </tr>

                <button class="cancel"><span class="close">&times;</span></button>
                  
                <tfoot>
                    <tr>
                      <button style="width: 30%;" id="insertPointBtn" class="nvgBtn insertbtn calculateVelocity">calculate</button>
                    </tr>
                </tfoot>

                
                    
                
                
              </table>


             
              
            
      </div>
      </div>

      
  
      <div class="container">
         
         

        
        
         
            <div id="details">
        
          
          <p id="status"></p>
          
         
          
  
          
  
        <div id="menu" class="invisible">
           
            <p>
                 Options:  <br/>
                <div class="other-options">
                    <div class="other-options-sub">
                      
                        <span>
                            <button id="isobar" class="nvgBtn resetBtn"> Isobar </button>
                        </span>
                        <span>
                            <button id="table_btn" class="nvgBtn resetBtn"> Panel </button>
                        </span>
                    </div>
                    <br>
                </div>
            </p>




              <p>Date | <span
                  id="data-date" class="local"></span> <span
                  id="toggle-zone" class="text-button"></span>
              </p>
              <span>
                  
              </span>
              <p>Data | <span id="data-layer"></span></p>
              <p><span id="scale-label">Scale | </span><canvas id="scale"></canvas></p>
              <p>Source | <span id="data-center"></span></p>
               <p>Control | <span
                class="text-button" id="nav-now" title="Current Conditions">Now</span><span
                class="text-button" id="nav-backward-more"> « </span>  <span
                class="text-button" id="nav-backward"> ‹ </span>  <span
                class="text-button" id="nav-forward"> › </span>  <span
                class="text-button" id="nav-forward-more"> » </span><span
                class="text-button" id="show-location" title="Current Position">〖◯〗</span><span
                class="text-button" id="option-show-grid" title="Toggle Grid">Grid</span>
            </p>
              <p>Mode |<span
                  class="text-button" id="ocean-mode-enable">Ocean</span>
              </p>
           
              <p class="wind-mode">Animate | <span
                class="text-button" id="animate-winds-back" title="Wind">Wind</span> - <span
                class="text-button" id="animate-waves-back" title="Wave">Wave</span> - <span
                class="text-button" id="animate-currents-back" title="Current">Current</span> 
                 </p>
              <p class="wind-mode invisible">Overlay |  <span
                  class="text-button" id="overlay-off">None</span> – <span
                  class="text-button" id="overlay-wind" title="Wind Speed">Wind</span>
               
              </p>
             
              <p class="ocean-mode invisible">Animate |  <span
                class="text-button" id="animate-winds" title="Wind">Wind</span> - <span
                class="text-button" id="animate-waves" title="Wave">Wave</span> - <span
                class="text-button" id="animate-currents" title="Current">Current</span>

            </p>
              <p class="ocean-mode invisible">Overlay | <span
                  class="text-button" id="overlay-ocean-off" title="None">None</span> – <span
                  class="text-button" id="overlay-currents" title="Currents">Currents</span>
              </p>
           

              


              <p>Projection |
                 <span
                  class="proj text-button" id="equirectangular" title="Mercator">M</span> - <span
                  class="proj text-button" id="orthographic" title="Orthographic">O</span>
               
              </p>
              
              <p>Routes |
                <span
                class="proj text-button" id="rl-route" title="RhumbLine">RL</span>
               
                  
              </p>
            
            
          </div>

          <p id="earth">
              <span id="show-menu" class="text-button" title="menu">Xtreme Technologies</span>
          </p>

          <!-- <div class="wrapper"> -->
            
              
          <!-- </div> -->
          <span class="time_slider invisible">
              <div class="values">
                  <span style="float: left;" id="range1">
                      0
                  </span>
                  <span id="diff-slid">
                     100
                  </span>
                  <span style="float: right;" id="range2">
                      2400
                  </span>
              </div>
              <div class="dsl-container">
                  <div class="slider-track"></div>
                  <input class='dateslider' type="range" min="0" max="2400" value="0" id="slider-1">
                  <input class='dateslider' type="range" min="0" max="2400" value="0" id="slider-2">
              </div>
          </span>
          
          <div class="functionality_table invisible"  id="functionality_table">
              <button class="cancel"><span class="close">&times;</span></button>
            <hr>
              <div id="table_distance_marker_meter" >
                
              </div>
              <div id="table_distance_meter" ></div>
            <p id="total_dis">Total Distance:<span id="totaldistance"></span></p>
            <p id="dist_meter">Distance Covered: <span id="demo"></span></p>
            
          
               
          </div>
      </div>
      

      




        <script>
         
            var modal = document.getElementById("myModal");
            
            
            var btn = document.getElementById("myBtn");
            
          
            var span = document.getElementsByClassName("close")[0];
            var span1=document.getElementsByClassName("close")[1];

       
          
            btn.onclick = function() {
              modal.style.display = "block";
            }
            
         
            span.onclick = function() {
              modal.style.display = "none";
            }

            span1.onclick = function() {
                d3.select(".functionality_table").classed(
        "invisible",
        !d3.select(".functionality_table").classed("invisible")
      );
              
            }


           
            window.onclick = function(event) {
              if (event.target == modal) {
                modal.style.display = "none";
              }
            }
          
   
      
          
            </script>


            <script >
//     Underscore.js 1.6.0
//     http://underscorejs.org
//     (c) 2009-2014 Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
//     Underscore may be freely distributed under the MIT license.
(function(){var n=this,t=n._,r={},e=Array.prototype,u=Object.prototype,i=Function.prototype,a=e.push,o=e.slice,c=e.concat,l=u.toString,f=u.hasOwnProperty,s=e.forEach,p=e.map,h=e.reduce,v=e.reduceRight,g=e.filter,d=e.every,m=e.some,y=e.indexOf,b=e.lastIndexOf,x=Array.isArray,w=Object.keys,_=i.bind,j=function(n){return n instanceof j?n:this instanceof j?void(this._wrapped=n):new j(n)};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=j),exports._=j):n._=j,j.VERSION="1.6.0";var A=j.each=j.forEach=function(n,t,e){if(null==n)return n;if(s&&n.forEach===s)n.forEach(t,e);else if(n.length===+n.length){for(var u=0,i=n.length;i>u;u++)if(t.call(e,n[u],u,n)===r)return}else for(var a=j.keys(n),u=0,i=a.length;i>u;u++)if(t.call(e,n[a[u]],a[u],n)===r)return;return n};j.map=j.collect=function(n,t,r){var e=[];return null==n?e:p&&n.map===p?n.map(t,r):(A(n,function(n,u,i){e.push(t.call(r,n,u,i))}),e)};var O="Reduce of empty array with no initial value";j.reduce=j.foldl=j.inject=function(n,t,r,e){var u=arguments.length>2;if(null==n&&(n=[]),h&&n.reduce===h)return e&&(t=j.bind(t,e)),u?n.reduce(t,r):n.reduce(t);if(A(n,function(n,i,a){u?r=t.call(e,r,n,i,a):(r=n,u=!0)}),!u)throw new TypeError(O);return r},j.reduceRight=j.foldr=function(n,t,r,e){var u=arguments.length>2;if(null==n&&(n=[]),v&&n.reduceRight===v)return e&&(t=j.bind(t,e)),u?n.reduceRight(t,r):n.reduceRight(t);var i=n.length;if(i!==+i){var a=j.keys(n);i=a.length}if(A(n,function(o,c,l){c=a?a[--i]:--i,u?r=t.call(e,r,n[c],c,l):(r=n[c],u=!0)}),!u)throw new TypeError(O);return r},j.find=j.detect=function(n,t,r){var e;return k(n,function(n,u,i){return t.call(r,n,u,i)?(e=n,!0):void 0}),e},j.filter=j.select=function(n,t,r){var e=[];return null==n?e:g&&n.filter===g?n.filter(t,r):(A(n,function(n,u,i){t.call(r,n,u,i)&&e.push(n)}),e)},j.reject=function(n,t,r){return j.filter(n,function(n,e,u){return!t.call(r,n,e,u)},r)},j.every=j.all=function(n,t,e){t||(t=j.identity);var u=!0;return null==n?u:d&&n.every===d?n.every(t,e):(A(n,function(n,i,a){return(u=u&&t.call(e,n,i,a))?void 0:r}),!!u)};var k=j.some=j.any=function(n,t,e){t||(t=j.identity);var u=!1;return null==n?u:m&&n.some===m?n.some(t,e):(A(n,function(n,i,a){return u||(u=t.call(e,n,i,a))?r:void 0}),!!u)};j.contains=j.include=function(n,t){return null==n?!1:y&&n.indexOf===y?n.indexOf(t)!=-1:k(n,function(n){return n===t})},j.invoke=function(n,t){var r=o.call(arguments,2),e=j.isFunction(t);return j.map(n,function(n){return(e?t:n[t]).apply(n,r)})},j.pluck=function(n,t){return j.map(n,j.property(t))},j.where=function(n,t){return j.filter(n,j.matches(t))},j.findWhere=function(n,t){return j.find(n,j.matches(t))},j.max=function(n,t,r){if(!t&&j.isArray(n)&&n[0]===+n[0]&&n.length<65535)return Math.max.apply(Math,n);var e=-1/0,u=-1/0;return A(n,function(n,i,a){var o=t?t.call(r,n,i,a):n;o>u&&(e=n,u=o)}),e},j.min=function(n,t,r){if(!t&&j.isArray(n)&&n[0]===+n[0]&&n.length<65535)return Math.min.apply(Math,n);var e=1/0,u=1/0;return A(n,function(n,i,a){var o=t?t.call(r,n,i,a):n;u>o&&(e=n,u=o)}),e},j.shuffle=function(n){var t,r=0,e=[];return A(n,function(n){t=j.random(r++),e[r-1]=e[t],e[t]=n}),e},j.sample=function(n,t,r){return null==t||r?(n.length!==+n.length&&(n=j.values(n)),n[j.random(n.length-1)]):j.shuffle(n).slice(0,Math.max(0,t))};var E=function(n){return null==n?j.identity:j.isFunction(n)?n:j.property(n)};j.sortBy=function(n,t,r){return t=E(t),j.pluck(j.map(n,function(n,e,u){return{value:n,index:e,criteria:t.call(r,n,e,u)}}).sort(function(n,t){var r=n.criteria,e=t.criteria;if(r!==e){if(r>e||r===void 0)return 1;if(e>r||e===void 0)return-1}return n.index-t.index}),"value")};var F=function(n){return function(t,r,e){var u={};return r=E(r),A(t,function(i,a){var o=r.call(e,i,a,t);n(u,o,i)}),u}};j.groupBy=F(function(n,t,r){j.has(n,t)?n[t].push(r):n[t]=[r]}),j.indexBy=F(function(n,t,r){n[t]=r}),j.countBy=F(function(n,t){j.has(n,t)?n[t]++:n[t]=1}),j.sortedIndex=function(n,t,r,e){r=E(r);for(var u=r.call(e,t),i=0,a=n.length;a>i;){var o=i+a>>>1;r.call(e,n[o])<u?i=o+1:a=o}return i},j.toArray=function(n){return n?j.isArray(n)?o.call(n):n.length===+n.length?j.map(n,j.identity):j.values(n):[]},j.size=function(n){return null==n?0:n.length===+n.length?n.length:j.keys(n).length},j.first=j.head=j.take=function(n,t,r){return null==n?void 0:null==t||r?n[0]:0>t?[]:o.call(n,0,t)},j.initial=function(n,t,r){return o.call(n,0,n.length-(null==t||r?1:t))},j.last=function(n,t,r){return null==n?void 0:null==t||r?n[n.length-1]:o.call(n,Math.max(n.length-t,0))},j.rest=j.tail=j.drop=function(n,t,r){return o.call(n,null==t||r?1:t)},j.compact=function(n){return j.filter(n,j.identity)};var M=function(n,t,r){return t&&j.every(n,j.isArray)?c.apply(r,n):(A(n,function(n){j.isArray(n)||j.isArguments(n)?t?a.apply(r,n):M(n,t,r):r.push(n)}),r)};j.flatten=function(n,t){return M(n,t,[])},j.without=function(n){return j.difference(n,o.call(arguments,1))},j.partition=function(n,t){var r=[],e=[];return A(n,function(n){(t(n)?r:e).push(n)}),[r,e]},j.uniq=j.unique=function(n,t,r,e){j.isFunction(t)&&(e=r,r=t,t=!1);var u=r?j.map(n,r,e):n,i=[],a=[];return A(u,function(r,e){(t?e&&a[a.length-1]===r:j.contains(a,r))||(a.push(r),i.push(n[e]))}),i},j.union=function(){return j.uniq(j.flatten(arguments,!0))},j.intersection=function(n){var t=o.call(arguments,1);return j.filter(j.uniq(n),function(n){return j.every(t,function(t){return j.contains(t,n)})})},j.difference=function(n){var t=c.apply(e,o.call(arguments,1));return j.filter(n,function(n){return!j.contains(t,n)})},j.zip=function(){for(var n=j.max(j.pluck(arguments,"length").concat(0)),t=new Array(n),r=0;n>r;r++)t[r]=j.pluck(arguments,""+r);return t},j.object=function(n,t){if(null==n)return{};for(var r={},e=0,u=n.length;u>e;e++)t?r[n[e]]=t[e]:r[n[e][0]]=n[e][1];return r},j.indexOf=function(n,t,r){if(null==n)return-1;var e=0,u=n.length;if(r){if("number"!=typeof r)return e=j.sortedIndex(n,t),n[e]===t?e:-1;e=0>r?Math.max(0,u+r):r}if(y&&n.indexOf===y)return n.indexOf(t,r);for(;u>e;e++)if(n[e]===t)return e;return-1},j.lastIndexOf=function(n,t,r){if(null==n)return-1;var e=null!=r;if(b&&n.lastIndexOf===b)return e?n.lastIndexOf(t,r):n.lastIndexOf(t);for(var u=e?r:n.length;u--;)if(n[u]===t)return u;return-1},j.range=function(n,t,r){arguments.length<=1&&(t=n||0,n=0),r=arguments[2]||1;for(var e=Math.max(Math.ceil((t-n)/r),0),u=0,i=new Array(e);e>u;)i[u++]=n,n+=r;return i};var R=function(){};j.bind=function(n,t){var r,e;if(_&&n.bind===_)return _.apply(n,o.call(arguments,1));if(!j.isFunction(n))throw new TypeError;return r=o.call(arguments,2),e=function(){if(!(this instanceof e))return n.apply(t,r.concat(o.call(arguments)));R.prototype=n.prototype;var u=new R;R.prototype=null;var i=n.apply(u,r.concat(o.call(arguments)));return Object(i)===i?i:u}},j.partial=function(n){var t=o.call(arguments,1);return function(){for(var r=0,e=t.slice(),u=0,i=e.length;i>u;u++)e[u]===j&&(e[u]=arguments[r++]);for(;r<arguments.length;)e.push(arguments[r++]);return n.apply(this,e)}},j.bindAll=function(n){var t=o.call(arguments,1);if(0===t.length)throw new Error("bindAll must be passed function names");return A(t,function(t){n[t]=j.bind(n[t],n)}),n},j.memoize=function(n,t){var r={};return t||(t=j.identity),function(){var e=t.apply(this,arguments);return j.has(r,e)?r[e]:r[e]=n.apply(this,arguments)}},j.delay=function(n,t){var r=o.call(arguments,2);return setTimeout(function(){return n.apply(null,r)},t)},j.defer=function(n){return j.delay.apply(j,[n,1].concat(o.call(arguments,1)))},j.throttle=function(n,t,r){var e,u,i,a=null,o=0;r||(r={});var c=function(){o=r.leading===!1?0:j.now(),a=null,i=n.apply(e,u),e=u=null};return function(){var l=j.now();o||r.leading!==!1||(o=l);var f=t-(l-o);return e=this,u=arguments,0>=f?(clearTimeout(a),a=null,o=l,i=n.apply(e,u),e=u=null):a||r.trailing===!1||(a=setTimeout(c,f)),i}},j.debounce=function(n,t,r){var e,u,i,a,o,c=function(){var l=j.now()-a;t>l?e=setTimeout(c,t-l):(e=null,r||(o=n.apply(i,u),i=u=null))};return function(){i=this,u=arguments,a=j.now();var l=r&&!e;return e||(e=setTimeout(c,t)),l&&(o=n.apply(i,u),i=u=null),o}},j.once=function(n){var t,r=!1;return function(){return r?t:(r=!0,t=n.apply(this,arguments),n=null,t)}},j.wrap=function(n,t){return j.partial(t,n)},j.compose=function(){var n=arguments;return function(){for(var t=arguments,r=n.length-1;r>=0;r--)t=[n[r].apply(this,t)];return t[0]}},j.after=function(n,t){return function(){return--n<1?t.apply(this,arguments):void 0}},j.keys=function(n){if(!j.isObject(n))return[];if(w)return w(n);var t=[];for(var r in n)j.has(n,r)&&t.push(r);return t},j.values=function(n){for(var t=j.keys(n),r=t.length,e=new Array(r),u=0;r>u;u++)e[u]=n[t[u]];return e},j.pairs=function(n){for(var t=j.keys(n),r=t.length,e=new Array(r),u=0;r>u;u++)e[u]=[t[u],n[t[u]]];return e},j.invert=function(n){for(var t={},r=j.keys(n),e=0,u=r.length;u>e;e++)t[n[r[e]]]=r[e];return t},j.functions=j.methods=function(n){var t=[];for(var r in n)j.isFunction(n[r])&&t.push(r);return t.sort()},j.extend=function(n){return A(o.call(arguments,1),function(t){if(t)for(var r in t)n[r]=t[r]}),n},j.pick=function(n){var t={},r=c.apply(e,o.call(arguments,1));return A(r,function(r){r in n&&(t[r]=n[r])}),t},j.omit=function(n){var t={},r=c.apply(e,o.call(arguments,1));for(var u in n)j.contains(r,u)||(t[u]=n[u]);return t},j.defaults=function(n){return A(o.call(arguments,1),function(t){if(t)for(var r in t)n[r]===void 0&&(n[r]=t[r])}),n},j.clone=function(n){return j.isObject(n)?j.isArray(n)?n.slice():j.extend({},n):n},j.tap=function(n,t){return t(n),n};var S=function(n,t,r,e){if(n===t)return 0!==n||1/n==1/t;if(null==n||null==t)return n===t;n instanceof j&&(n=n._wrapped),t instanceof j&&(t=t._wrapped);var u=l.call(n);if(u!=l.call(t))return!1;switch(u){case"[object String]":return n==String(t);case"[object Number]":return n!=+n?t!=+t:0==n?1/n==1/t:n==+t;case"[object Date]":case"[object Boolean]":return+n==+t;case"[object RegExp]":return n.source==t.source&&n.global==t.global&&n.multiline==t.multiline&&n.ignoreCase==t.ignoreCase}if("object"!=typeof n||"object"!=typeof t)return!1;for(var i=r.length;i--;)if(r[i]==n)return e[i]==t;var a=n.constructor,o=t.constructor;if(a!==o&&!(j.isFunction(a)&&a instanceof a&&j.isFunction(o)&&o instanceof o)&&"constructor"in n&&"constructor"in t)return!1;r.push(n),e.push(t);var c=0,f=!0;if("[object Array]"==u){if(c=n.length,f=c==t.length)for(;c--&&(f=S(n[c],t[c],r,e)););}else{for(var s in n)if(j.has(n,s)&&(c++,!(f=j.has(t,s)&&S(n[s],t[s],r,e))))break;if(f){for(s in t)if(j.has(t,s)&&!c--)break;f=!c}}return r.pop(),e.pop(),f};j.isEqual=function(n,t){return S(n,t,[],[])},j.isEmpty=function(n){if(null==n)return!0;if(j.isArray(n)||j.isString(n))return 0===n.length;for(var t in n)if(j.has(n,t))return!1;return!0},j.isElement=function(n){return!(!n||1!==n.nodeType)},j.isArray=x||function(n){return"[object Array]"==l.call(n)},j.isObject=function(n){return n===Object(n)},A(["Arguments","Function","String","Number","Date","RegExp"],function(n){j["is"+n]=function(t){return l.call(t)=="[object "+n+"]"}}),j.isArguments(arguments)||(j.isArguments=function(n){return!(!n||!j.has(n,"callee"))}),"function"!=typeof/./&&(j.isFunction=function(n){return"function"==typeof n}),j.isFinite=function(n){return isFinite(n)&&!isNaN(parseFloat(n))},j.isNaN=function(n){return j.isNumber(n)&&n!=+n},j.isBoolean=function(n){return n===!0||n===!1||"[object Boolean]"==l.call(n)},j.isNull=function(n){return null===n},j.isUndefined=function(n){return n===void 0},j.has=function(n,t){return f.call(n,t)},j.noConflict=function(){return n._=t,this},j.identity=function(n){return n},j.constant=function(n){return function(){return n}},j.property=function(n){return function(t){return t[n]}},j.matches=function(n){return function(t){if(t===n)return!0;for(var r in n)if(n[r]!==t[r])return!1;return!0}},j.times=function(n,t,r){for(var e=Array(Math.max(0,n)),u=0;n>u;u++)e[u]=t.call(r,u);return e},j.random=function(n,t){return null==t&&(t=n,n=0),n+Math.floor(Math.random()*(t-n+1))},j.now=Date.now||function(){return(new Date).getTime()};var T={escape:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;"}};T.unescape=j.invert(T.escape);var I={escape:new RegExp("["+j.keys(T.escape).join("")+"]","g"),unescape:new RegExp("("+j.keys(T.unescape).join("|")+")","g")};j.each(["escape","unescape"],function(n){j[n]=function(t){return null==t?"":(""+t).replace(I[n],function(t){return T[n][t]})}}),j.result=function(n,t){if(null==n)return void 0;var r=n[t];return j.isFunction(r)?r.call(n):r},j.mixin=function(n){A(j.functions(n),function(t){var r=j[t]=n[t];j.prototype[t]=function(){var n=[this._wrapped];return a.apply(n,arguments),z.call(this,r.apply(j,n))}})};var N=0;j.uniqueId=function(n){var t=++N+"";return n?n+t:t},j.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var q=/(.)^/,B={"'":"'","\\":"\\","\r":"r","\n":"n","	":"t","\u2028":"u2028","\u2029":"u2029"},D=/\\|'|\r|\n|\t|\u2028|\u2029/g;j.template=function(n,t,r){var e;r=j.defaults({},r,j.templateSettings);var u=new RegExp([(r.escape||q).source,(r.interpolate||q).source,(r.evaluate||q).source].join("|")+"|$","g"),i=0,a="__p+='";n.replace(u,function(t,r,e,u,o){return a+=n.slice(i,o).replace(D,function(n){return"\\"+B[n]}),r&&(a+="'+\n((__t=("+r+"))==null?'':_.escape(__t))+\n'"),e&&(a+="'+\n((__t=("+e+"))==null?'':__t)+\n'"),u&&(a+="';\n"+u+"\n__p+='"),i=o+t.length,t}),a+="';\n",r.variable||(a="with(obj||{}){\n"+a+"}\n"),a="var __t,__p='',__j=Array.prototype.join,"+"print=function(){__p+=__j.call(arguments,'');};\n"+a+"return __p;\n";try{e=new Function(r.variable||"obj","_",a)}catch(o){throw o.source=a,o}if(t)return e(t,j);var c=function(n){return e.call(this,n,j)};return c.source="function("+(r.variable||"obj")+"){\n"+a+"}",c},j.chain=function(n){return j(n).chain()};var z=function(n){return this._chain?j(n).chain():n};j.mixin(j),A(["pop","push","reverse","shift","sort","splice","unshift"],function(n){var t=e[n];j.prototype[n]=function(){var r=this._wrapped;return t.apply(r,arguments),"shift"!=n&&"splice"!=n||0!==r.length||delete r[0],z.call(this,r)}}),A(["concat","join","slice"],function(n){var t=e[n];j.prototype[n]=function(){return z.call(this,t.apply(this._wrapped,arguments))}}),j.extend(j.prototype,{chain:function(){return this._chain=!0,this},value:function(){return this._wrapped}}),"function"==typeof define&&define.amd&&define("underscore",[],function(){return j})}).call(this);
//# sourceMappingURL=underscore-min.map
            </script>
            <script >
              (function(){var t=this;var e=t.Backbone;var i=[];var r=i.push;var s=i.slice;var n=i.splice;var a;if(typeof exports!=="undefined"){a=exports}else{a=t.Backbone={}}a.VERSION="1.1.0";var h=t._;if(!h&&typeof require!=="undefined")h=require("underscore");a.$=t.jQuery||t.Zepto||t.ender||t.$;a.noConflict=function(){t.Backbone=e;return this};a.emulateHTTP=false;a.emulateJSON=false;var o=a.Events={on:function(t,e,i){if(!l(this,"on",t,[e,i])||!e)return this;this._events||(this._events={});var r=this._events[t]||(this._events[t]=[]);r.push({callback:e,context:i,ctx:i||this});return this},once:function(t,e,i){if(!l(this,"once",t,[e,i])||!e)return this;var r=this;var s=h.once(function(){r.off(t,s);e.apply(this,arguments)});s._callback=e;return this.on(t,s,i)},off:function(t,e,i){var r,s,n,a,o,u,c,f;if(!this._events||!l(this,"off",t,[e,i]))return this;if(!t&&!e&&!i){this._events={};return this}a=t?[t]:h.keys(this._events);for(o=0,u=a.length;o<u;o++){t=a[o];if(n=this._events[t]){this._events[t]=r=[];if(e||i){for(c=0,f=n.length;c<f;c++){s=n[c];if(e&&e!==s.callback&&e!==s.callback._callback||i&&i!==s.context){r.push(s)}}}if(!r.length)delete this._events[t]}}return this},trigger:function(t){if(!this._events)return this;var e=s.call(arguments,1);if(!l(this,"trigger",t,e))return this;var i=this._events[t];var r=this._events.all;if(i)c(i,e);if(r)c(r,arguments);return this},stopListening:function(t,e,i){var r=this._listeningTo;if(!r)return this;var s=!e&&!i;if(!i&&typeof e==="object")i=this;if(t)(r={})[t._listenId]=t;for(var n in r){t=r[n];t.off(e,i,this);if(s||h.isEmpty(t._events))delete this._listeningTo[n]}return this}};var u=/\s+/;var l=function(t,e,i,r){if(!i)return true;if(typeof i==="object"){for(var s in i){t[e].apply(t,[s,i[s]].concat(r))}return false}if(u.test(i)){var n=i.split(u);for(var a=0,h=n.length;a<h;a++){t[e].apply(t,[n[a]].concat(r))}return false}return true};var c=function(t,e){var i,r=-1,s=t.length,n=e[0],a=e[1],h=e[2];switch(e.length){case 0:while(++r<s)(i=t[r]).callback.call(i.ctx);return;case 1:while(++r<s)(i=t[r]).callback.call(i.ctx,n);return;case 2:while(++r<s)(i=t[r]).callback.call(i.ctx,n,a);return;case 3:while(++r<s)(i=t[r]).callback.call(i.ctx,n,a,h);return;default:while(++r<s)(i=t[r]).callback.apply(i.ctx,e)}};var f={listenTo:"on",listenToOnce:"once"};h.each(f,function(t,e){o[e]=function(e,i,r){var s=this._listeningTo||(this._listeningTo={});var n=e._listenId||(e._listenId=h.uniqueId("l"));s[n]=e;if(!r&&typeof i==="object")r=this;e[t](i,r,this);return this}});o.bind=o.on;o.unbind=o.off;h.extend(a,o);var d=a.Model=function(t,e){var i=t||{};e||(e={});this.cid=h.uniqueId("c");this.attributes={};if(e.collection)this.collection=e.collection;if(e.parse)i=this.parse(i,e)||{};i=h.defaults({},i,h.result(this,"defaults"));this.set(i,e);this.changed={};this.initialize.apply(this,arguments)};h.extend(d.prototype,o,{changed:null,validationError:null,idAttribute:"id",initialize:function(){},toJSON:function(t){return h.clone(this.attributes)},sync:function(){return a.sync.apply(this,arguments)},get:function(t){return this.attributes[t]},escape:function(t){return h.escape(this.get(t))},has:function(t){return this.get(t)!=null},set:function(t,e,i){var r,s,n,a,o,u,l,c;if(t==null)return this;if(typeof t==="object"){s=t;i=e}else{(s={})[t]=e}i||(i={});if(!this._validate(s,i))return false;n=i.unset;o=i.silent;a=[];u=this._changing;this._changing=true;if(!u){this._previousAttributes=h.clone(this.attributes);this.changed={}}c=this.attributes,l=this._previousAttributes;if(this.idAttribute in s)this.id=s[this.idAttribute];for(r in s){e=s[r];if(!h.isEqual(c[r],e))a.push(r);if(!h.isEqual(l[r],e)){this.changed[r]=e}else{delete this.changed[r]}n?delete c[r]:c[r]=e}if(!o){if(a.length)this._pending=true;for(var f=0,d=a.length;f<d;f++){this.trigger("change:"+a[f],this,c[a[f]],i)}}if(u)return this;if(!o){while(this._pending){this._pending=false;this.trigger("change",this,i)}}this._pending=false;this._changing=false;return this},unset:function(t,e){return this.set(t,void 0,h.extend({},e,{unset:true}))},clear:function(t){var e={};for(var i in this.attributes)e[i]=void 0;return this.set(e,h.extend({},t,{unset:true}))},hasChanged:function(t){if(t==null)return!h.isEmpty(this.changed);return h.has(this.changed,t)},changedAttributes:function(t){if(!t)return this.hasChanged()?h.clone(this.changed):false;var e,i=false;var r=this._changing?this._previousAttributes:this.attributes;for(var s in t){if(h.isEqual(r[s],e=t[s]))continue;(i||(i={}))[s]=e}return i},previous:function(t){if(t==null||!this._previousAttributes)return null;return this._previousAttributes[t]},previousAttributes:function(){return h.clone(this._previousAttributes)},fetch:function(t){t=t?h.clone(t):{};if(t.parse===void 0)t.parse=true;var e=this;var i=t.success;t.success=function(r){if(!e.set(e.parse(r,t),t))return false;if(i)i(e,r,t);e.trigger("sync",e,r,t)};M(this,t);return this.sync("read",this,t)},save:function(t,e,i){var r,s,n,a=this.attributes;if(t==null||typeof t==="object"){r=t;i=e}else{(r={})[t]=e}i=h.extend({validate:true},i);if(r&&!i.wait){if(!this.set(r,i))return false}else{if(!this._validate(r,i))return false}if(r&&i.wait){this.attributes=h.extend({},a,r)}if(i.parse===void 0)i.parse=true;var o=this;var u=i.success;i.success=function(t){o.attributes=a;var e=o.parse(t,i);if(i.wait)e=h.extend(r||{},e);if(h.isObject(e)&&!o.set(e,i)){return false}if(u)u(o,t,i);o.trigger("sync",o,t,i)};M(this,i);s=this.isNew()?"create":i.patch?"patch":"update";if(s==="patch")i.attrs=r;n=this.sync(s,this,i);if(r&&i.wait)this.attributes=a;return n},destroy:function(t){t=t?h.clone(t):{};var e=this;var i=t.success;var r=function(){e.trigger("destroy",e,e.collection,t)};t.success=function(s){if(t.wait||e.isNew())r();if(i)i(e,s,t);if(!e.isNew())e.trigger("sync",e,s,t)};if(this.isNew()){t.success();return false}M(this,t);var s=this.sync("delete",this,t);if(!t.wait)r();return s},url:function(){var t=h.result(this,"urlRoot")||h.result(this.collection,"url")||U();if(this.isNew())return t;return t+(t.charAt(t.length-1)==="/"?"":"/")+encodeURIComponent(this.id)},parse:function(t,e){return t},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return this.id==null},isValid:function(t){return this._validate({},h.extend(t||{},{validate:true}))},_validate:function(t,e){if(!e.validate||!this.validate)return true;t=h.extend({},this.attributes,t);var i=this.validationError=this.validate(t,e)||null;if(!i)return true;this.trigger("invalid",this,i,h.extend(e,{validationError:i}));return false}});var p=["keys","values","pairs","invert","pick","omit"];h.each(p,function(t){d.prototype[t]=function(){var e=s.call(arguments);e.unshift(this.attributes);return h[t].apply(h,e)}});var v=a.Collection=function(t,e){e||(e={});if(e.model)this.model=e.model;if(e.comparator!==void 0)this.comparator=e.comparator;this._reset();this.initialize.apply(this,arguments);if(t)this.reset(t,h.extend({silent:true},e))};var g={add:true,remove:true,merge:true};var m={add:true,remove:false};h.extend(v.prototype,o,{model:d,initialize:function(){},toJSON:function(t){return this.map(function(e){return e.toJSON(t)})},sync:function(){return a.sync.apply(this,arguments)},add:function(t,e){return this.set(t,h.extend({merge:false},e,m))},remove:function(t,e){var i=!h.isArray(t);t=i?[t]:h.clone(t);e||(e={});var r,s,n,a;for(r=0,s=t.length;r<s;r++){a=t[r]=this.get(t[r]);if(!a)continue;delete this._byId[a.id];delete this._byId[a.cid];n=this.indexOf(a);this.models.splice(n,1);this.length--;if(!e.silent){e.index=n;a.trigger("remove",a,this,e)}this._removeReference(a)}return i?t[0]:t},set:function(t,e){e=h.defaults({},e,g);if(e.parse)t=this.parse(t,e);var i=!h.isArray(t);t=i?t?[t]:[]:h.clone(t);var r,s,n,a,o,u,l;var c=e.at;var f=this.model;var p=this.comparator&&c==null&&e.sort!==false;var v=h.isString(this.comparator)?this.comparator:null;var m=[],y=[],_={};var w=e.add,b=e.merge,x=e.remove;var E=!p&&w&&x?[]:false;for(r=0,s=t.length;r<s;r++){o=t[r];if(o instanceof d){n=a=o}else{n=o[f.prototype.idAttribute]}if(u=this.get(n)){if(x)_[u.cid]=true;if(b){o=o===a?a.attributes:o;if(e.parse)o=u.parse(o,e);u.set(o,e);if(p&&!l&&u.hasChanged(v))l=true}t[r]=u}else if(w){a=t[r]=this._prepareModel(o,e);if(!a)continue;m.push(a);a.on("all",this._onModelEvent,this);this._byId[a.cid]=a;if(a.id!=null)this._byId[a.id]=a}if(E)E.push(u||a)}if(x){for(r=0,s=this.length;r<s;++r){if(!_[(a=this.models[r]).cid])y.push(a)}if(y.length)this.remove(y,e)}if(m.length||E&&E.length){if(p)l=true;this.length+=m.length;if(c!=null){for(r=0,s=m.length;r<s;r++){this.models.splice(c+r,0,m[r])}}else{if(E)this.models.length=0;var T=E||m;for(r=0,s=T.length;r<s;r++){this.models.push(T[r])}}}if(l)this.sort({silent:true});if(!e.silent){for(r=0,s=m.length;r<s;r++){(a=m[r]).trigger("add",a,this,e)}if(l||E&&E.length)this.trigger("sort",this,e)}return i?t[0]:t},reset:function(t,e){e||(e={});for(var i=0,r=this.models.length;i<r;i++){this._removeReference(this.models[i])}e.previousModels=this.models;this._reset();t=this.add(t,h.extend({silent:true},e));if(!e.silent)this.trigger("reset",this,e);return t},push:function(t,e){return this.add(t,h.extend({at:this.length},e))},pop:function(t){var e=this.at(this.length-1);this.remove(e,t);return e},unshift:function(t,e){return this.add(t,h.extend({at:0},e))},shift:function(t){var e=this.at(0);this.remove(e,t);return e},slice:function(){return s.apply(this.models,arguments)},get:function(t){if(t==null)return void 0;return this._byId[t.id]||this._byId[t.cid]||this._byId[t]},at:function(t){return this.models[t]},where:function(t,e){if(h.isEmpty(t))return e?void 0:[];return this[e?"find":"filter"](function(e){for(var i in t){if(t[i]!==e.get(i))return false}return true})},findWhere:function(t){return this.where(t,true)},sort:function(t){if(!this.comparator)throw new Error("Cannot sort a set without a comparator");t||(t={});if(h.isString(this.comparator)||this.comparator.length===1){this.models=this.sortBy(this.comparator,this)}else{this.models.sort(h.bind(this.comparator,this))}if(!t.silent)this.trigger("sort",this,t);return this},pluck:function(t){return h.invoke(this.models,"get",t)},fetch:function(t){t=t?h.clone(t):{};if(t.parse===void 0)t.parse=true;var e=t.success;var i=this;t.success=function(r){var s=t.reset?"reset":"set";i[s](r,t);if(e)e(i,r,t);i.trigger("sync",i,r,t)};M(this,t);return this.sync("read",this,t)},create:function(t,e){e=e?h.clone(e):{};if(!(t=this._prepareModel(t,e)))return false;if(!e.wait)this.add(t,e);var i=this;var r=e.success;e.success=function(t,e,s){if(s.wait)i.add(t,s);if(r)r(t,e,s)};t.save(null,e);return t},parse:function(t,e){return t},clone:function(){return new this.constructor(this.models)},_reset:function(){this.length=0;this.models=[];this._byId={}},_prepareModel:function(t,e){if(t instanceof d){if(!t.collection)t.collection=this;return t}e=e?h.clone(e):{};e.collection=this;var i=new this.model(t,e);if(!i.validationError)return i;this.trigger("invalid",this,i.validationError,e);return false},_removeReference:function(t){if(this===t.collection)delete t.collection;t.off("all",this._onModelEvent,this)},_onModelEvent:function(t,e,i,r){if((t==="add"||t==="remove")&&i!==this)return;if(t==="destroy")this.remove(e,r);if(e&&t==="change:"+e.idAttribute){delete this._byId[e.previous(e.idAttribute)];if(e.id!=null)this._byId[e.id]=e}this.trigger.apply(this,arguments)}});var y=["forEach","each","map","collect","reduce","foldl","inject","reduceRight","foldr","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","max","min","toArray","size","first","head","take","initial","rest","tail","drop","last","without","difference","indexOf","shuffle","lastIndexOf","isEmpty","chain"];h.each(y,function(t){v.prototype[t]=function(){var e=s.call(arguments);e.unshift(this.models);return h[t].apply(h,e)}});var _=["groupBy","countBy","sortBy"];h.each(_,function(t){v.prototype[t]=function(e,i){var r=h.isFunction(e)?e:function(t){return t.get(e)};return h[t](this.models,r,i)}});var w=a.View=function(t){this.cid=h.uniqueId("view");t||(t={});h.extend(this,h.pick(t,x));this._ensureElement();this.initialize.apply(this,arguments);this.delegateEvents()};var b=/^(\S+)\s*(.*)$/;var x=["model","collection","el","id","attributes","className","tagName","events"];h.extend(w.prototype,o,{tagName:"div",$:function(t){return this.$el.find(t)},initialize:function(){},render:function(){return this},remove:function(){this.$el.remove();this.stopListening();return this},setElement:function(t,e){if(this.$el)this.undelegateEvents();this.$el=t instanceof a.$?t:a.$(t);this.el=this.$el[0];if(e!==false)this.delegateEvents();return this},delegateEvents:function(t){if(!(t||(t=h.result(this,"events"))))return this;this.undelegateEvents();for(var e in t){var i=t[e];if(!h.isFunction(i))i=this[t[e]];if(!i)continue;var r=e.match(b);var s=r[1],n=r[2];i=h.bind(i,this);s+=".delegateEvents"+this.cid;if(n===""){this.$el.on(s,i)}else{this.$el.on(s,n,i)}}return this},undelegateEvents:function(){this.$el.off(".delegateEvents"+this.cid);return this},_ensureElement:function(){if(!this.el){var t=h.extend({},h.result(this,"attributes"));if(this.id)t.id=h.result(this,"id");if(this.className)t["class"]=h.result(this,"className");var e=a.$("<"+h.result(this,"tagName")+">").attr(t);this.setElement(e,false)}else{this.setElement(h.result(this,"el"),false)}}});a.sync=function(t,e,i){var r=T[t];h.defaults(i||(i={}),{emulateHTTP:a.emulateHTTP,emulateJSON:a.emulateJSON});var s={type:r,dataType:"json"};if(!i.url){s.url=h.result(e,"url")||U()}if(i.data==null&&e&&(t==="create"||t==="update"||t==="patch")){s.contentType="application/json";s.data=JSON.stringify(i.attrs||e.toJSON(i))}if(i.emulateJSON){s.contentType="application/x-www-form-urlencoded";s.data=s.data?{model:s.data}:{}}if(i.emulateHTTP&&(r==="PUT"||r==="DELETE"||r==="PATCH")){s.type="POST";if(i.emulateJSON)s.data._method=r;var n=i.beforeSend;i.beforeSend=function(t){t.setRequestHeader("X-HTTP-Method-Override",r);if(n)return n.apply(this,arguments)}}if(s.type!=="GET"&&!i.emulateJSON){s.processData=false}if(s.type==="PATCH"&&E){s.xhr=function(){return new ActiveXObject("Microsoft.XMLHTTP")}}var o=i.xhr=a.ajax(h.extend(s,i));e.trigger("request",e,o,i);return o};var E=typeof window!=="undefined"&&!!window.ActiveXObject&&!(window.XMLHttpRequest&&(new XMLHttpRequest).dispatchEvent);var T={create:"POST",update:"PUT",patch:"PATCH","delete":"DELETE",read:"GET"};a.ajax=function(){return a.$.ajax.apply(a.$,arguments)};var k=a.Router=function(t){t||(t={});if(t.routes)this.routes=t.routes;this._bindRoutes();this.initialize.apply(this,arguments)};var S=/\((.*?)\)/g;var $=/(\(\?)?:\w+/g;var H=/\*\w+/g;var A=/[\-{}\[\]+?.,\\\^$|#\s]/g;h.extend(k.prototype,o,{initialize:function(){},route:function(t,e,i){if(!h.isRegExp(t))t=this._routeToRegExp(t);if(h.isFunction(e)){i=e;e=""}if(!i)i=this[e];var r=this;a.history.route(t,function(s){var n=r._extractParameters(t,s);i&&i.apply(r,n);r.trigger.apply(r,["route:"+e].concat(n));r.trigger("route",e,n);a.history.trigger("route",r,e,n)});return this},navigate:function(t,e){a.history.navigate(t,e);return this},_bindRoutes:function(){if(!this.routes)return;this.routes=h.result(this,"routes");var t,e=h.keys(this.routes);while((t=e.pop())!=null){this.route(t,this.routes[t])}},_routeToRegExp:function(t){t=t.replace(A,"\\$&").replace(S,"(?:$1)?").replace($,function(t,e){return e?t:"([^/]+)"}).replace(H,"(.*?)");return new RegExp("^"+t+"$")},_extractParameters:function(t,e){var i=t.exec(e).slice(1);return h.map(i,function(t){return t?decodeURIComponent(t):null})}});var I=a.History=function(){this.handlers=[];h.bindAll(this,"checkUrl");if(typeof window!=="undefined"){this.location=window.location;this.history=window.history}};var N=/^[#\/]|\s+$/g;var O=/^\/+|\/+$/g;var P=/msie [\w.]+/;var C=/\/$/;var j=/[?#].*$/;I.started=false;h.extend(I.prototype,o,{interval:50,getHash:function(t){var e=(t||this).location.href.match(/#(.*)$/);return e?e[1]:""},getFragment:function(t,e){if(t==null){if(this._hasPushState||!this._wantsHashChange||e){t=this.location.pathname;var i=this.root.replace(C,"");if(!t.indexOf(i))t=t.slice(i.length)}else{t=this.getHash()}}return t.replace(N,"")},start:function(t){if(I.started)throw new Error("Backbone.history has already been started");I.started=true;this.options=h.extend({root:"/"},this.options,t);this.root=this.options.root;this._wantsHashChange=this.options.hashChange!==false;this._wantsPushState=!!this.options.pushState;this._hasPushState=!!(this.options.pushState&&this.history&&this.history.pushState);var e=this.getFragment();var i=document.documentMode;var r=P.exec(navigator.userAgent.toLowerCase())&&(!i||i<=7);this.root=("/"+this.root+"/").replace(O,"/");if(r&&this._wantsHashChange){this.iframe=a.$('<iframe src="javascript:0" tabindex="-1" />').hide().appendTo("body")[0].contentWindow;this.navigate(e)}if(this._hasPushState){a.$(window).on("popstate",this.checkUrl)}else if(this._wantsHashChange&&"onhashchange"in window&&!r){a.$(window).on("hashchange",this.checkUrl)}else if(this._wantsHashChange){this._checkUrlInterval=setInterval(this.checkUrl,this.interval)}this.fragment=e;var s=this.location;var n=s.pathname.replace(/[^\/]$/,"$&/")===this.root;if(this._wantsHashChange&&this._wantsPushState){if(!this._hasPushState&&!n){this.fragment=this.getFragment(null,true);this.location.replace(this.root+this.location.search+"#"+this.fragment);return true}else if(this._hasPushState&&n&&s.hash){this.fragment=this.getHash().replace(N,"");this.history.replaceState({},document.title,this.root+this.fragment+s.search)}}if(!this.options.silent)return this.loadUrl()},stop:function(){a.$(window).off("popstate",this.checkUrl).off("hashchange",this.checkUrl);clearInterval(this._checkUrlInterval);I.started=false},route:function(t,e){this.handlers.unshift({route:t,callback:e})},checkUrl:function(t){var e=this.getFragment();if(e===this.fragment&&this.iframe){e=this.getFragment(this.getHash(this.iframe))}if(e===this.fragment)return false;if(this.iframe)this.navigate(e);this.loadUrl()},loadUrl:function(t){t=this.fragment=this.getFragment(t);return h.any(this.handlers,function(e){if(e.route.test(t)){e.callback(t);return true}})},navigate:function(t,e){if(!I.started)return false;if(!e||e===true)e={trigger:!!e};var i=this.root+(t=this.getFragment(t||""));t=t.replace(j,"");if(this.fragment===t)return;this.fragment=t;if(t===""&&i!=="/")i=i.slice(0,-1);if(this._hasPushState){this.history[e.replace?"replaceState":"pushState"]({},document.title,i)}else if(this._wantsHashChange){this._updateHash(this.location,t,e.replace);if(this.iframe&&t!==this.getFragment(this.getHash(this.iframe))){if(!e.replace)this.iframe.document.open().close();this._updateHash(this.iframe.location,t,e.replace)}}else{return this.location.assign(i)}if(e.trigger)return this.loadUrl(t)},_updateHash:function(t,e,i){if(i){var r=t.href.replace(/(javascript:|#).*$/,"");t.replace(r+"#"+e)}else{t.hash="#"+e}}});a.history=new I;var R=function(t,e){var i=this;var r;if(t&&h.has(t,"constructor")){r=t.constructor}else{r=function(){return i.apply(this,arguments)}}h.extend(r,i,e);var s=function(){this.constructor=r};s.prototype=i.prototype;r.prototype=new s;if(t)h.extend(r.prototype,t);r.__super__=i.prototype;return r};d.extend=v.extend=k.extend=w.extend=I.extend=R;var U=function(){throw new Error('A "url" property or function must be specified')};var M=function(t,e){var i=e.error;e.error=function(r){if(i)i(t,r,e);t.trigger("error",t,r,e)}}}).call(this);
//# sourceMappingURL=backbone-min.map
            </script>
            <script >
              topojson=function(){function t(t,e){function n(e){var n=t.arcs[e],r=n[0],o=[0,0];return n.forEach(function(t){o[0]+=t[0],o[1]+=t[1]}),[r,o]}var r={},o={},a={};e.forEach(function(t){var e=n(t);(r[e[0]]||(r[e[0]]=[])).push(t),(r[e[1]]||(r[e[1]]=[])).push(~t)}),e.forEach(function(t){var e,r,i=n(t),u=i[0],c=i[1];if(e=a[u])if(delete a[e.end],e.push(t),e.end=c,r=o[c]){delete o[r.start];var s=r===e?e:e.concat(r);o[s.start=e.start]=a[s.end=r.end]=s}else if(r=a[c]){delete o[r.start],delete a[r.end];var s=e.concat(r.map(function(t){return~t}).reverse());o[s.start=e.start]=a[s.end=r.start]=s}else o[e.start]=a[e.end]=e;else if(e=o[c])if(delete o[e.start],e.unshift(t),e.start=u,r=a[u]){delete a[r.end];var f=r===e?e:r.concat(e);o[f.start=r.start]=a[f.end=e.end]=f}else if(r=o[u]){delete o[r.start],delete a[r.end];var f=r.map(function(t){return~t}).reverse().concat(e);o[f.start=r.end]=a[f.end=e.end]=f}else o[e.start]=a[e.end]=e;else if(e=o[u])if(delete o[e.start],e.unshift(~t),e.start=c,r=a[c]){delete a[r.end];var f=r===e?e:r.concat(e);o[f.start=r.start]=a[f.end=e.end]=f}else if(r=o[c]){delete o[r.start],delete a[r.end];var f=r.map(function(t){return~t}).reverse().concat(e);o[f.start=r.end]=a[f.end=e.end]=f}else o[e.start]=a[e.end]=e;else if(e=a[c])if(delete a[e.end],e.push(~t),e.end=u,r=a[u]){delete o[r.start];var s=r===e?e:e.concat(r);o[s.start=e.start]=a[s.end=r.end]=s}else if(r=o[u]){delete o[r.start],delete a[r.end];var s=e.concat(r.map(function(t){return~t}).reverse());o[s.start=e.start]=a[s.end=r.start]=s}else o[e.start]=a[e.end]=e;else e=[t],o[e.start=u]=a[e.end=c]=e});var i=[];for(var u in a)i.push(a[u]);return i}function e(e,n,r){function a(t){0>t&&(t=~t),(l[t]||(l[t]=[])).push(f)}function i(t){t.forEach(a)}function u(t){t.forEach(i)}function c(t){t.type==="GeometryCollection"?t.geometries.forEach(c):t.type in d&&(f=t,d[t.type](t.arcs))}var s=[];if(arguments.length>1){var f,l=[],d={LineString:i,MultiLineString:u,Polygon:u,MultiPolygon:function(t){t.forEach(u)}};c(n),l.forEach(arguments.length<3?function(t,e){s.push([e])}:function(t,e){r(t[0],t[t.length-1])&&s.push([e])})}else for(var p=0,h=e.arcs.length;h>p;++p)s.push([p]);return o(e,{type:"MultiLineString",arcs:t(e,s)})}function n(t,e){return e.type==="GeometryCollection"?{type:"FeatureCollection",features:e.geometries.map(function(e){return r(t,e)})}:r(t,e)}function r(t,e){var n={type:"Feature",id:e.id,properties:e.properties||{},geometry:o(t,e)};return e.id==null&&delete n.id,n}function o(t,e){function n(t,e){e.length&&e.pop();for(var n,r=h[0>t?~t:t],o=0,i=r.length,u=0,c=0;i>o;++o)e.push([(u+=(n=r[o])[0])*f+d,(c+=n[1])*l+p]);0>t&&a(e,i)}function r(t){return[t[0]*f+d,t[1]*l+p]}function o(t){for(var e=[],r=0,o=t.length;o>r;++r)n(t[r],e);return e.length<2&&e.push(e[0]),e}function i(t){for(var e=o(t);e.length<4;)e.push(e[0]);return e}function u(t){return t.map(i)}function c(t){var e=t.type;return"GeometryCollection"===e?{type:e,geometries:t.geometries.map(c)}:e in v?{type:e,coordinates:v[e](t)}:null}var s=t.transform,f=s.scale[0],l=s.scale[1],d=s.translate[0],p=s.translate[1],h=t.arcs,v={Point:function(t){return r(t.coordinates)},MultiPoint:function(t){return t.coordinates.map(r)},LineString:function(t){return o(t.arcs)},MultiLineString:function(t){return t.arcs.map(o)},Polygon:function(t){return u(t.arcs)},MultiPolygon:function(t){return t.arcs.map(u)}};return c(e)}function a(t,e){for(var n,r=t.length,o=r-e;o<--r;)n=t[o],t[o++]=t[r],t[r]=n}function i(t,e){for(var n=0,r=t.length;r>n;){var o=n+r>>>1;t[o]<e?n=o+1:r=o}return n}function u(t){function e(t,e){t.forEach(function(t){0>t&&(t=~t);var n=o[t]||(o[t]=[]);n[e]||(n.forEach(function(t){var n,r;r=i(n=a[e],t),n[r]!==t&&n.splice(r,0,t),r=i(n=a[t],e),n[r]!==e&&n.splice(r,0,e)}),n[e]=e)})}function n(t,n){t.forEach(function(t){e(t,n)})}function r(t,e){t.type==="GeometryCollection"?t.geometries.forEach(function(t){r(t,e)}):t.type in u&&u[t.type](t.arcs,e)}var o=[],a=t.map(function(){return[]}),u={LineString:e,MultiLineString:n,Polygon:n,MultiPolygon:function(t,e){t.forEach(function(t){n(t,e)})}};return t.forEach(r),a}return{version:"1.1.0",mesh:e,feature:n,neighbors:u}}();
            </script>
            <script >
              d3=function(){function n(n){return null!=n&&!isNaN(n)}function t(n){return n.length}function e(n){for(var t=1;n*t%1;)t*=10;return t}function r(n,t){try{for(var e in t)Object.defineProperty(n.prototype,e,{value:t[e],enumerable:!1})}catch(r){n.prototype=t}}function u(){}function i(){}function o(n,t,e){return function(){var r=e.apply(t,arguments);return r===t?n:r}}function a(n,t){if(t in n)return t;t=t.charAt(0).toUpperCase()+t.substring(1);for(var e=0,r=la.length;r>e;++e){var u=la[e]+t;if(u in n)return u}}function c(){}function s(){}function l(n){function t(){for(var t,r=e,u=-1,i=r.length;++u<i;)(t=r[u].on)&&t.apply(this,arguments);return n}var e=[],r=new u;return t.on=function(t,u){var i,o=r.get(t);return arguments.length<2?o&&o.on:(o&&(o.on=null,e=e.slice(0,i=e.indexOf(o)).concat(e.slice(i+1)),r.remove(t)),u&&e.push(r.set(t,{on:u})),n)},t}function f(){$o.event.preventDefault()}function h(){for(var n,t=$o.event;n=t.sourceEvent;)t=n;return t}function g(n){for(var t=new s,e=0,r=arguments.length;++e<r;)t[arguments[e]]=l(t);return t.of=function(e,r){return function(u){try{var i=u.sourceEvent=$o.event;u.target=n,$o.event=u,t[u.type].apply(e,r)}finally{$o.event=i}}},t}function p(n){return ha(n,ma),n}function v(n){return"function"==typeof n?n:function(){return ga(n,this)}}function d(n){return"function"==typeof n?n:function(){return pa(n,this)}}function m(n,t){function e(){this.removeAttribute(n)}function r(){this.removeAttributeNS(n.space,n.local)}function u(){this.setAttribute(n,t)}function i(){this.setAttributeNS(n.space,n.local,t)}function o(){var e=t.apply(this,arguments);null==e?this.removeAttribute(n):this.setAttribute(n,e)}function a(){var e=t.apply(this,arguments);null==e?this.removeAttributeNS(n.space,n.local):this.setAttributeNS(n.space,n.local,e)}return n=$o.ns.qualify(n),null==t?n.local?r:e:"function"==typeof t?n.local?a:o:n.local?i:u}function y(n){return n.trim().replace(/\s+/g," ")}function x(n){return new RegExp("(?:^|\\s+)"+$o.requote(n)+"(?:\\s+|$)","g")}function M(n,t){function e(){for(var e=-1;++e<u;)n[e](this,t)}function r(){for(var e=-1,r=t.apply(this,arguments);++e<u;)n[e](this,r)}n=n.trim().split(/\s+/).map(_);var u=n.length;return"function"==typeof t?r:e}function _(n){var t=x(n);return function(e,r){if(u=e.classList)return r?u.add(n):u.remove(n);var u=e.getAttribute("class")||"";r?(t.lastIndex=0,t.test(u)||e.setAttribute("class",y(u+" "+n))):e.setAttribute("class",y(u.replace(t," ")))}}function b(n,t,e){function r(){this.style.removeProperty(n)}function u(){this.style.setProperty(n,t,e)}function i(){var r=t.apply(this,arguments);null==r?this.style.removeProperty(n):this.style.setProperty(n,r,e)}return null==t?r:"function"==typeof t?i:u}function w(n,t){function e(){delete this[n]}function r(){this[n]=t}function u(){var e=t.apply(this,arguments);null==e?delete this[n]:this[n]=e}return null==t?e:"function"==typeof t?u:r}function S(n){return"function"==typeof n?n:(n=$o.ns.qualify(n)).local?function(){return this.ownerDocument.createElementNS(n.space,n.local)}:function(){return this.ownerDocument.createElementNS(this.namespaceURI,n)}}function k(n){return{__data__:n}}function E(n){return function(){return da(this,n)}}function A(n){return arguments.length||(n=$o.ascending),function(t,e){return t&&e?n(t.__data__,e.__data__):!t-!e}}function C(n,t){for(var e=0,r=n.length;r>e;e++)for(var u,i=n[e],o=0,a=i.length;a>o;o++)(u=i[o])&&t(u,o,e);return n}function N(n){return ha(n,xa),n}function L(n){var t,e;return function(r,u,i){var o,a=n[i].update,c=a.length;for(i!=e&&(e=i,t=0),u>=t&&(t=u+1);!(o=a[t])&&++t<c;);return o}}function T(){var n=this.__transition__;n&&++n.active}function q(n,t,e){function r(){var t=this[o];t&&(this.removeEventListener(n,t,t.$),delete this[o])}function u(){var u=s(t,Wo(arguments));r.call(this),this.addEventListener(n,this[o]=u,u.$=e),u._=t}function i(){var t,e=new RegExp("^__on([^.]+)"+$o.requote(n)+"$");for(var r in this)if(t=r.match(e)){var u=this[r];this.removeEventListener(t[1],u,u.$),delete this[r]}}var o="__on"+n,a=n.indexOf("."),s=z;a>0&&(n=n.substring(0,a));var l=_a.get(n);return l&&(n=l,s=R),a?t?u:r:t?c:i}function z(n,t){return function(e){var r=$o.event;$o.event=e,t[0]=this.__data__;try{n.apply(this,t)}finally{$o.event=r}}}function R(n,t){var e=z(n,t);return function(n){var t=this,r=n.relatedTarget;r&&(r===t||8&r.compareDocumentPosition(t))||e.call(t,n)}}function D(){var n=".dragsuppress-"+ ++wa,t="click"+n,e=$o.select(Ko).on("touchmove"+n,f).on("dragstart"+n,f).on("selectstart"+n,f);if(ba){var r=Go.style,u=r[ba];r[ba]="none"}return function(i){function o(){e.on(t,null)}e.on(n,null),ba&&(r[ba]=u),i&&(e.on(t,function(){f(),o()},!0),setTimeout(o,0))}}function P(n,t){t.changedTouches&&(t=t.changedTouches[0]);var e=n.ownerSVGElement||n;if(e.createSVGPoint){var r=e.createSVGPoint();if(0>Sa&&(Ko.scrollX||Ko.scrollY)){e=$o.select("body").append("svg").style({position:"absolute",top:0,left:0,margin:0,padding:0,border:"none"},"important");var u=e[0][0].getScreenCTM();Sa=!(u.f||u.e),e.remove()}return Sa?(r.x=t.pageX,r.y=t.pageY):(r.x=t.clientX,r.y=t.clientY),r=r.matrixTransform(n.getScreenCTM().inverse()),[r.x,r.y]}var i=n.getBoundingClientRect();return[t.clientX-i.left-n.clientLeft,t.clientY-i.top-n.clientTop]}function U(n){return n>0?1:0>n?-1:0}function j(n){return n>1?0:-1>n?ka:Math.acos(n)}function H(n){return n>1?Aa:-1>n?-Aa:Math.asin(n)}function F(n){return((n=Math.exp(n))-1/n)/2}function O(n){return((n=Math.exp(n))+1/n)/2}function Y(n){return((n=Math.exp(2*n))-1)/(n+1)}function I(n){return(n=Math.sin(n/2))*n}function Z(){}function V(n,t,e){return new X(n,t,e)}function X(n,t,e){this.h=n,this.s=t,this.l=e}function $(n,t,e){function r(n){return n>360?n-=360:0>n&&(n+=360),60>n?i+(o-i)*n/60:180>n?o:240>n?i+(o-i)*(240-n)/60:i}function u(n){return Math.round(255*r(n))}var i,o;return n=isNaN(n)?0:(n%=360)<0?n+360:n,t=isNaN(t)?0:0>t?0:t>1?1:t,e=0>e?0:e>1?1:e,o=.5>=e?e*(1+t):e+t-e*t,i=2*e-o,ot(u(n+120),u(n),u(n-120))}function B(n,t,e){return new W(n,t,e)}function W(n,t,e){this.h=n,this.c=t,this.l=e}function J(n,t,e){return isNaN(n)&&(n=0),isNaN(t)&&(t=0),G(e,Math.cos(n*=La)*t,Math.sin(n)*t)}function G(n,t,e){return new K(n,t,e)}function K(n,t,e){this.l=n,this.a=t,this.b=e}function Q(n,t,e){var r=(n+16)/116,u=r+t/500,i=r-e/200;return u=tt(u)*Oa,r=tt(r)*Ya,i=tt(i)*Ia,ot(rt(3.2404542*u-1.5371385*r-.4985314*i),rt(-.969266*u+1.8760108*r+.041556*i),rt(.0556434*u-.2040259*r+1.0572252*i))}function nt(n,t,e){return n>0?B(Math.atan2(e,t)*Ta,Math.sqrt(t*t+e*e),n):B(0/0,0/0,n)}function tt(n){return n>.206893034?n*n*n:(n-4/29)/7.787037}function et(n){return n>.008856?Math.pow(n,1/3):7.787037*n+4/29}function rt(n){return Math.round(255*(.00304>=n?12.92*n:1.055*Math.pow(n,1/2.4)-.055))}function ut(n){return ot(n>>16,255&n>>8,255&n)}function it(n){return ut(n)+""}function ot(n,t,e){return new at(n,t,e)}function at(n,t,e){this.r=n,this.g=t,this.b=e}function ct(n){return 16>n?"0"+Math.max(0,n).toString(16):Math.min(255,n).toString(16)}function st(n,t,e){var r,u,i,o=0,a=0,c=0;if(r=/([a-z]+)\((.*)\)/i.exec(n))switch(u=r[2].split(","),r[1]){case"hsl":return e(parseFloat(u[0]),parseFloat(u[1])/100,parseFloat(u[2])/100);case"rgb":return t(gt(u[0]),gt(u[1]),gt(u[2]))}return(i=Xa.get(n))?t(i.r,i.g,i.b):(null!=n&&"#"===n.charAt(0)&&(4===n.length?(o=n.charAt(1),o+=o,a=n.charAt(2),a+=a,c=n.charAt(3),c+=c):7===n.length&&(o=n.substring(1,3),a=n.substring(3,5),c=n.substring(5,7)),o=parseInt(o,16),a=parseInt(a,16),c=parseInt(c,16)),t(o,a,c))}function lt(n,t,e){var r,u,i=Math.min(n/=255,t/=255,e/=255),o=Math.max(n,t,e),a=o-i,c=(o+i)/2;return a?(u=.5>c?a/(o+i):a/(2-o-i),r=n==o?(t-e)/a+(e>t?6:0):t==o?(e-n)/a+2:(n-t)/a+4,r*=60):(r=0/0,u=c>0&&1>c?0:r),V(r,u,c)}function ft(n,t,e){n=ht(n),t=ht(t),e=ht(e);var r=et((.4124564*n+.3575761*t+.1804375*e)/Oa),u=et((.2126729*n+.7151522*t+.072175*e)/Ya),i=et((.0193339*n+.119192*t+.9503041*e)/Ia);return G(116*u-16,500*(r-u),200*(u-i))}function ht(n){return(n/=255)<=.04045?n/12.92:Math.pow((n+.055)/1.055,2.4)}function gt(n){var t=parseFloat(n);return"%"===n.charAt(n.length-1)?Math.round(2.55*t):t}function pt(n){return"function"==typeof n?n:function(){return n}}function vt(n){return n}function dt(n){return function(t,e,r){return 2===arguments.length&&"function"==typeof e&&(r=e,e=null),mt(t,e,n,r)}}function mt(n,t,e,r){function u(){var n,t=c.status;if(!t&&c.responseText||t>=200&&300>t||304===t){try{n=e.call(i,c)}catch(r){return o.error.call(i,r),void 0}o.load.call(i,n)}else o.error.call(i,c)}var i={},o=$o.dispatch("beforesend","progress","load","error"),a={},c=new XMLHttpRequest,s=null;return!Ko.XDomainRequest||"withCredentials"in c||!/^(http(s)?:)?\/\//.test(n)||(c=new XDomainRequest),"onload"in c?c.onload=c.onerror=u:c.onreadystatechange=function(){c.readyState>3&&u()},c.onprogress=function(n){var t=$o.event;$o.event=n;try{o.progress.call(i,c)}finally{$o.event=t}},i.header=function(n,t){return n=(n+"").toLowerCase(),arguments.length<2?a[n]:(null==t?delete a[n]:a[n]=t+"",i)},i.mimeType=function(n){return arguments.length?(t=null==n?null:n+"",i):t},i.responseType=function(n){return arguments.length?(s=n,i):s},i.response=function(n){return e=n,i},["get","post"].forEach(function(n){i[n]=function(){return i.send.apply(i,[n].concat(Wo(arguments)))}}),i.send=function(e,r,u){if(2===arguments.length&&"function"==typeof r&&(u=r,r=null),c.open(e,n,!0),null==t||"accept"in a||(a.accept=t+",*/*"),c.setRequestHeader)for(var l in a)c.setRequestHeader(l,a[l]);return null!=t&&c.overrideMimeType&&c.overrideMimeType(t),null!=s&&(c.responseType=s),null!=u&&i.on("error",u).on("load",function(n){u(null,n)}),o.beforesend.call(i,c),c.send(null==r?null:r),i},i.abort=function(){return c.abort(),i},$o.rebind(i,o,"on"),null==r?i:i.get(yt(r))}function yt(n){return 1===n.length?function(t,e){n(null==t?e:null)}:n}function xt(){var n=Mt(),t=_t()-n;t>24?(isFinite(t)&&(clearTimeout(Ja),Ja=setTimeout(xt,t)),Wa=0):(Wa=1,Ka(xt))}function Mt(){var n=Date.now();for(Ga=$a;Ga;)n>=Ga.t&&(Ga.f=Ga.c(n-Ga.t)),Ga=Ga.n;return n}function _t(){for(var n,t=$a,e=1/0;t;)t.f?t=n?n.n=t.n:$a=t.n:(t.t<e&&(e=t.t),t=(n=t).n);return Ba=n,e}function bt(n,t){var e=Math.pow(10,3*aa(8-t));return{scale:t>8?function(n){return n/e}:function(n){return n*e},symbol:n}}function wt(n,t){return t-(n?Math.ceil(Math.log(n)/Math.LN10):1)}function St(n){return n+""}function kt(){}function Et(n,t,e){var r=e.s=n+t,u=r-n,i=r-u;e.t=n-i+(t-u)}function At(n,t){n&&lc.hasOwnProperty(n.type)&&lc[n.type](n,t)}function Ct(n,t,e){var r,u=-1,i=n.length-e;for(t.lineStart();++u<i;)r=n[u],t.point(r[0],r[1],r[2]);t.lineEnd()}function Nt(n,t){var e=-1,r=n.length;for(t.polygonStart();++e<r;)Ct(n[e],t,1);t.polygonEnd()}function Lt(){function n(n,t){n*=La,t=t*La/2+ka/4;var e=n-r,o=Math.cos(t),a=Math.sin(t),c=i*a,s=u*o+c*Math.cos(e),l=c*Math.sin(e);hc.add(Math.atan2(l,s)),r=n,u=o,i=a}var t,e,r,u,i;gc.point=function(o,a){gc.point=n,r=(t=o)*La,u=Math.cos(a=(e=a)*La/2+ka/4),i=Math.sin(a)},gc.lineEnd=function(){n(t,e)}}function Tt(n){var t=n[0],e=n[1],r=Math.cos(e);return[r*Math.cos(t),r*Math.sin(t),Math.sin(e)]}function qt(n,t){return n[0]*t[0]+n[1]*t[1]+n[2]*t[2]}function zt(n,t){return[n[1]*t[2]-n[2]*t[1],n[2]*t[0]-n[0]*t[2],n[0]*t[1]-n[1]*t[0]]}function Rt(n,t){n[0]+=t[0],n[1]+=t[1],n[2]+=t[2]}function Dt(n,t){return[n[0]*t,n[1]*t,n[2]*t]}function Pt(n){var t=Math.sqrt(n[0]*n[0]+n[1]*n[1]+n[2]*n[2]);n[0]/=t,n[1]/=t,n[2]/=t}function Ut(n){return[Math.atan2(n[1],n[0]),H(n[2])]}function jt(n,t){return aa(n[0]-t[0])<Ca&&aa(n[1]-t[1])<Ca}function Ht(n,t){n*=La;var e=Math.cos(t*=La);Ft(e*Math.cos(n),e*Math.sin(n),Math.sin(t))}function Ft(n,t,e){++pc,dc+=(n-dc)/pc,mc+=(t-mc)/pc,yc+=(e-yc)/pc}function Ot(){function n(n,u){n*=La;var i=Math.cos(u*=La),o=i*Math.cos(n),a=i*Math.sin(n),c=Math.sin(u),s=Math.atan2(Math.sqrt((s=e*c-r*a)*s+(s=r*o-t*c)*s+(s=t*a-e*o)*s),t*o+e*a+r*c);vc+=s,xc+=s*(t+(t=o)),Mc+=s*(e+(e=a)),_c+=s*(r+(r=c)),Ft(t,e,r)}var t,e,r;kc.point=function(u,i){u*=La;var o=Math.cos(i*=La);t=o*Math.cos(u),e=o*Math.sin(u),r=Math.sin(i),kc.point=n,Ft(t,e,r)}}function Yt(){kc.point=Ht}function It(){function n(n,t){n*=La;var e=Math.cos(t*=La),o=e*Math.cos(n),a=e*Math.sin(n),c=Math.sin(t),s=u*c-i*a,l=i*o-r*c,f=r*a-u*o,h=Math.sqrt(s*s+l*l+f*f),g=r*o+u*a+i*c,p=h&&-j(g)/h,v=Math.atan2(h,g);bc+=p*s,wc+=p*l,Sc+=p*f,vc+=v,xc+=v*(r+(r=o)),Mc+=v*(u+(u=a)),_c+=v*(i+(i=c)),Ft(r,u,i)}var t,e,r,u,i;kc.point=function(o,a){t=o,e=a,kc.point=n,o*=La;var c=Math.cos(a*=La);r=c*Math.cos(o),u=c*Math.sin(o),i=Math.sin(a),Ft(r,u,i)},kc.lineEnd=function(){n(t,e),kc.lineEnd=Yt,kc.point=Ht}}function Zt(){return!0}function Vt(n,t,e,r,u){var i=[],o=[];if(n.forEach(function(n){if(!((t=n.length-1)<=0)){var t,e=n[0],r=n[t];if(jt(e,r)){u.lineStart();for(var a=0;t>a;++a)u.point((e=n[a])[0],e[1]);return u.lineEnd(),void 0}var c=new $t(e,n,null,!0),s=new $t(e,null,c,!1);c.o=s,i.push(c),o.push(s),c=new $t(r,n,null,!1),s=new $t(r,null,c,!0),c.o=s,i.push(c),o.push(s)}}),o.sort(t),Xt(i),Xt(o),i.length){for(var a=0,c=e,s=o.length;s>a;++a)o[a].e=c=!c;for(var l,f,h=i[0];;){for(var g=h,p=!0;g.v;)if((g=g.n)===h)return;l=g.z,u.lineStart();do{if(g.v=g.o.v=!0,g.e){if(p)for(var a=0,s=l.length;s>a;++a)u.point((f=l[a])[0],f[1]);else r(g.x,g.n.x,1,u);g=g.n}else{if(p){l=g.p.z;for(var a=l.length-1;a>=0;--a)u.point((f=l[a])[0],f[1])}else r(g.x,g.p.x,-1,u);g=g.p}g=g.o,l=g.z,p=!p}while(!g.v);u.lineEnd()}}}function Xt(n){if(t=n.length){for(var t,e,r=0,u=n[0];++r<t;)u.n=e=n[r],e.p=u,u=e;u.n=e=n[0],e.p=u}}function $t(n,t,e,r){this.x=n,this.z=t,this.o=e,this.e=r,this.v=!1,this.n=this.p=null}function Bt(n,t,e,r){return function(u,i){function o(t,e){var r=u(t,e);n(t=r[0],e=r[1])&&i.point(t,e)}function a(n,t){var e=u(n,t);d.point(e[0],e[1])}function c(){y.point=a,d.lineStart()}function s(){y.point=o,d.lineEnd()}function l(n,t){v.push([n,t]);var e=u(n,t);M.point(e[0],e[1])}function f(){M.lineStart(),v=[]}function h(){l(v[0][0],v[0][1]),M.lineEnd();var n,t=M.clean(),e=x.buffer(),r=e.length;if(v.pop(),p.push(v),v=null,r){if(1&t){n=e[0];var u,r=n.length-1,o=-1;for(i.lineStart();++o<r;)i.point((u=n[o])[0],u[1]);return i.lineEnd(),void 0}r>1&&2&t&&e.push(e.pop().concat(e.shift())),g.push(e.filter(Wt))}}var g,p,v,d=t(i),m=u.invert(r[0],r[1]),y={point:o,lineStart:c,lineEnd:s,polygonStart:function(){y.point=l,y.lineStart=f,y.lineEnd=h,g=[],p=[],i.polygonStart()},polygonEnd:function(){y.point=o,y.lineStart=c,y.lineEnd=s,g=$o.merge(g);var n=Kt(m,p);g.length?Vt(g,Gt,n,e,i):n&&(i.lineStart(),e(null,null,1,i),i.lineEnd()),i.polygonEnd(),g=p=null},sphere:function(){i.polygonStart(),i.lineStart(),e(null,null,1,i),i.lineEnd(),i.polygonEnd()}},x=Jt(),M=t(x);return y}}function Wt(n){return n.length>1}function Jt(){var n,t=[];return{lineStart:function(){t.push(n=[])},point:function(t,e){n.push([t,e])},lineEnd:c,buffer:function(){var e=t;return t=[],n=null,e},rejoin:function(){t.length>1&&t.push(t.pop().concat(t.shift()))}}}function Gt(n,t){return((n=n.x)[0]<0?n[1]-Aa-Ca:Aa-n[1])-((t=t.x)[0]<0?t[1]-Aa-Ca:Aa-t[1])}function Kt(n,t){var e=n[0],r=n[1],u=[Math.sin(e),-Math.cos(e),0],i=0,o=0;hc.reset();for(var a=0,c=t.length;c>a;++a){var s=t[a],l=s.length;if(l)for(var f=s[0],h=f[0],g=f[1]/2+ka/4,p=Math.sin(g),v=Math.cos(g),d=1;;){d===l&&(d=0),n=s[d];var m=n[0],y=n[1]/2+ka/4,x=Math.sin(y),M=Math.cos(y),_=m-h,b=aa(_)>ka,w=p*x;if(hc.add(Math.atan2(w*Math.sin(_),v*M+w*Math.cos(_))),i+=b?_+(_>=0?Ea:-Ea):_,b^h>=e^m>=e){var S=zt(Tt(f),Tt(n));Pt(S);var k=zt(u,S);Pt(k);var E=(b^_>=0?-1:1)*H(k[2]);(r>E||r===E&&(S[0]||S[1]))&&(o+=b^_>=0?1:-1)}if(!d++)break;h=m,p=x,v=M,f=n}}return(-Ca>i||Ca>i&&0>hc)^1&o}function Qt(n){var t,e=0/0,r=0/0,u=0/0;return{lineStart:function(){n.lineStart(),t=1},point:function(i,o){var a=i>0?ka:-ka,c=aa(i-e);aa(c-ka)<Ca?(n.point(e,r=(r+o)/2>0?Aa:-Aa),n.point(u,r),n.lineEnd(),n.lineStart(),n.point(a,r),n.point(i,r),t=0):u!==a&&c>=ka&&(aa(e-u)<Ca&&(e-=u*Ca),aa(i-a)<Ca&&(i-=a*Ca),r=ne(e,r,i,o),n.point(u,r),n.lineEnd(),n.lineStart(),n.point(a,r),t=0),n.point(e=i,r=o),u=a},lineEnd:function(){n.lineEnd(),e=r=0/0},clean:function(){return 2-t}}}function ne(n,t,e,r){var u,i,o=Math.sin(n-e);return aa(o)>Ca?Math.atan((Math.sin(t)*(i=Math.cos(r))*Math.sin(e)-Math.sin(r)*(u=Math.cos(t))*Math.sin(n))/(u*i*o)):(t+r)/2}function te(n,t,e,r){var u;if(null==n)u=e*Aa,r.point(-ka,u),r.point(0,u),r.point(ka,u),r.point(ka,0),r.point(ka,-u),r.point(0,-u),r.point(-ka,-u),r.point(-ka,0),r.point(-ka,u);else if(aa(n[0]-t[0])>Ca){var i=n[0]<t[0]?ka:-ka;u=e*i/2,r.point(-i,u),r.point(0,u),r.point(i,u)}else r.point(t[0],t[1])}function ee(n){function t(n,t){return Math.cos(n)*Math.cos(t)>i}function e(n){var e,i,c,s,l;return{lineStart:function(){s=c=!1,l=1},point:function(f,h){var g,p=[f,h],v=t(f,h),d=o?v?0:u(f,h):v?u(f+(0>f?ka:-ka),h):0;if(!e&&(s=c=v)&&n.lineStart(),v!==c&&(g=r(e,p),(jt(e,g)||jt(p,g))&&(p[0]+=Ca,p[1]+=Ca,v=t(p[0],p[1]))),v!==c)l=0,v?(n.lineStart(),g=r(p,e),n.point(g[0],g[1])):(g=r(e,p),n.point(g[0],g[1]),n.lineEnd()),e=g;else if(a&&e&&o^v){var m;d&i||!(m=r(p,e,!0))||(l=0,o?(n.lineStart(),n.point(m[0][0],m[0][1]),n.point(m[1][0],m[1][1]),n.lineEnd()):(n.point(m[1][0],m[1][1]),n.lineEnd(),n.lineStart(),n.point(m[0][0],m[0][1])))}!v||e&&jt(e,p)||n.point(p[0],p[1]),e=p,c=v,i=d},lineEnd:function(){c&&n.lineEnd(),e=null},clean:function(){return l|(s&&c)<<1}}}function r(n,t,e){var r=Tt(n),u=Tt(t),o=[1,0,0],a=zt(r,u),c=qt(a,a),s=a[0],l=c-s*s;if(!l)return!e&&n;var f=i*c/l,h=-i*s/l,g=zt(o,a),p=Dt(o,f),v=Dt(a,h);Rt(p,v);var d=g,m=qt(p,d),y=qt(d,d),x=m*m-y*(qt(p,p)-1);if(!(0>x)){var M=Math.sqrt(x),_=Dt(d,(-m-M)/y);if(Rt(_,p),_=Ut(_),!e)return _;var b,w=n[0],S=t[0],k=n[1],E=t[1];w>S&&(b=w,w=S,S=b);var A=S-w,C=aa(A-ka)<Ca,N=C||Ca>A;if(!C&&k>E&&(b=k,k=E,E=b),N?C?k+E>0^_[1]<(aa(_[0]-w)<Ca?k:E):k<=_[1]&&_[1]<=E:A>ka^(w<=_[0]&&_[0]<=S)){var L=Dt(d,(-m+M)/y);return Rt(L,p),[_,Ut(L)]}}}function u(t,e){var r=o?n:ka-n,u=0;return-r>t?u|=1:t>r&&(u|=2),-r>e?u|=4:e>r&&(u|=8),u}var i=Math.cos(n),o=i>0,a=aa(i)>Ca,c=Le(n,6*La);return Bt(t,e,c,o?[0,-n]:[-ka,n-ka])}function re(n,t,e,r){return function(u){var i,o=u.a,a=u.b,c=o.x,s=o.y,l=a.x,f=a.y,h=0,g=1,p=l-c,v=f-s;if(i=n-c,p||!(i>0)){if(i/=p,0>p){if(h>i)return;g>i&&(g=i)}else if(p>0){if(i>g)return;i>h&&(h=i)}if(i=e-c,p||!(0>i)){if(i/=p,0>p){if(i>g)return;i>h&&(h=i)}else if(p>0){if(h>i)return;g>i&&(g=i)}if(i=t-s,v||!(i>0)){if(i/=v,0>v){if(h>i)return;g>i&&(g=i)}else if(v>0){if(i>g)return;i>h&&(h=i)}if(i=r-s,v||!(0>i)){if(i/=v,0>v){if(i>g)return;i>h&&(h=i)}else if(v>0){if(h>i)return;g>i&&(g=i)}return h>0&&(u.a={x:c+h*p,y:s+h*v}),1>g&&(u.b={x:c+g*p,y:s+g*v}),u}}}}}}function ue(n,t,e,r){function u(r,u){return aa(r[0]-n)<Ca?u>0?0:3:aa(r[0]-e)<Ca?u>0?2:1:aa(r[1]-t)<Ca?u>0?1:0:u>0?3:2}function i(n,t){return o(n.x,t.x)}function o(n,t){var e=u(n,1),r=u(t,1);return e!==r?e-r:0===e?t[1]-n[1]:1===e?n[0]-t[0]:2===e?n[1]-t[1]:t[0]-n[0]}return function(a){function c(n){for(var t=0,e=m.length,r=n[1],u=0;e>u;++u)for(var i,o=1,a=m[u],c=a.length,l=a[0];c>o;++o)i=a[o],l[1]<=r?i[1]>r&&s(l,i,n)>0&&++t:i[1]<=r&&s(l,i,n)<0&&--t,l=i;return 0!==t}function s(n,t,e){return(t[0]-n[0])*(e[1]-n[1])-(e[0]-n[0])*(t[1]-n[1])}function l(i,a,c,s){var l=0,f=0;if(null==i||(l=u(i,c))!==(f=u(a,c))||o(i,a)<0^c>0){do s.point(0===l||3===l?n:e,l>1?r:t);while((l=(l+c+4)%4)!==f)}else s.point(a[0],a[1])}function f(u,i){return u>=n&&e>=u&&i>=t&&r>=i}function h(n,t){f(n,t)&&a.point(n,t)}function g(){L.point=v,m&&m.push(y=[]),k=!0,S=!1,b=w=0/0}function p(){d&&(v(x,M),_&&S&&C.rejoin(),d.push(C.buffer())),L.point=h,S&&a.lineEnd()}function v(n,t){n=Math.max(-Ac,Math.min(Ac,n)),t=Math.max(-Ac,Math.min(Ac,t));var e=f(n,t);if(m&&y.push([n,t]),k)x=n,M=t,_=e,k=!1,e&&(a.lineStart(),a.point(n,t));else if(e&&S)a.point(n,t);else{var r={a:{x:b,y:w},b:{x:n,y:t}};N(r)?(S||(a.lineStart(),a.point(r.a.x,r.a.y)),a.point(r.b.x,r.b.y),e||a.lineEnd(),E=!1):e&&(a.lineStart(),a.point(n,t),E=!1)}b=n,w=t,S=e}var d,m,y,x,M,_,b,w,S,k,E,A=a,C=Jt(),N=re(n,t,e,r),L={point:h,lineStart:g,lineEnd:p,polygonStart:function(){a=C,d=[],m=[],E=!0},polygonEnd:function(){a=A,d=$o.merge(d);var t=c([n,r]),e=E&&t,u=d.length;(e||u)&&(a.polygonStart(),e&&(a.lineStart(),l(null,null,1,a),a.lineEnd()),u&&Vt(d,i,t,l,a),a.polygonEnd()),d=m=y=null}};return L}}function ie(n,t){function e(e,r){return e=n(e,r),t(e[0],e[1])}return n.invert&&t.invert&&(e.invert=function(e,r){return e=t.invert(e,r),e&&n.invert(e[0],e[1])}),e}function oe(n){var t=0,e=ka/3,r=be(n),u=r(t,e);return u.parallels=function(n){return arguments.length?r(t=n[0]*ka/180,e=n[1]*ka/180):[180*(t/ka),180*(e/ka)]},u}function ae(n,t){function e(n,t){var e=Math.sqrt(i-2*u*Math.sin(t))/u;return[e*Math.sin(n*=u),o-e*Math.cos(n)]}var r=Math.sin(n),u=(r+Math.sin(t))/2,i=1+r*(2*u-r),o=Math.sqrt(i)/u;return e.invert=function(n,t){var e=o-t;return[Math.atan2(n,e)/u,H((i-(n*n+e*e)*u*u)/(2*u))]},e}function ce(){function n(n,t){Nc+=u*n-r*t,r=n,u=t}var t,e,r,u;Rc.point=function(i,o){Rc.point=n,t=r=i,e=u=o},Rc.lineEnd=function(){n(t,e)}}function se(n,t){Lc>n&&(Lc=n),n>qc&&(qc=n),Tc>t&&(Tc=t),t>zc&&(zc=t)}function le(){function n(n,t){o.push("M",n,",",t,i)}function t(n,t){o.push("M",n,",",t),a.point=e}function e(n,t){o.push("L",n,",",t)}function r(){a.point=n}function u(){o.push("Z")}var i=fe(4.5),o=[],a={point:n,lineStart:function(){a.point=t},lineEnd:r,polygonStart:function(){a.lineEnd=u},polygonEnd:function(){a.lineEnd=r,a.point=n},pointRadius:function(n){return i=fe(n),a},result:function(){if(o.length){var n=o.join("");return o=[],n}}};return a}function fe(n){return"m0,"+n+"a"+n+","+n+" 0 1,1 0,"+-2*n+"a"+n+","+n+" 0 1,1 0,"+2*n+"z"}function he(n,t){dc+=n,mc+=t,++yc}function ge(){function n(n,r){var u=n-t,i=r-e,o=Math.sqrt(u*u+i*i);xc+=o*(t+n)/2,Mc+=o*(e+r)/2,_c+=o,he(t=n,e=r)}var t,e;Pc.point=function(r,u){Pc.point=n,he(t=r,e=u)}}function pe(){Pc.point=he}function ve(){function n(n,t){var e=n-r,i=t-u,o=Math.sqrt(e*e+i*i);xc+=o*(r+n)/2,Mc+=o*(u+t)/2,_c+=o,o=u*n-r*t,bc+=o*(r+n),wc+=o*(u+t),Sc+=3*o,he(r=n,u=t)}var t,e,r,u;Pc.point=function(i,o){Pc.point=n,he(t=r=i,e=u=o)},Pc.lineEnd=function(){n(t,e)}}function de(n){function t(t,e){n.moveTo(t,e),n.arc(t,e,o,0,Ea)}function e(t,e){n.moveTo(t,e),a.point=r}function r(t,e){n.lineTo(t,e)}function u(){a.point=t}function i(){n.closePath()}var o=4.5,a={point:t,lineStart:function(){a.point=e},lineEnd:u,polygonStart:function(){a.lineEnd=i},polygonEnd:function(){a.lineEnd=u,a.point=t},pointRadius:function(n){return o=n,a},result:c};return a}function me(n){function t(n){return(a?r:e)(n)}function e(t){return Me(t,function(e,r){e=n(e,r),t.point(e[0],e[1])})}function r(t){function e(e,r){e=n(e,r),t.point(e[0],e[1])}function r(){x=0/0,S.point=i,t.lineStart()}function i(e,r){var i=Tt([e,r]),o=n(e,r);u(x,M,y,_,b,w,x=o[0],M=o[1],y=e,_=i[0],b=i[1],w=i[2],a,t),t.point(x,M)}function o(){S.point=e,t.lineEnd()}function c(){r(),S.point=s,S.lineEnd=l}function s(n,t){i(f=n,h=t),g=x,p=M,v=_,d=b,m=w,S.point=i}function l(){u(x,M,y,_,b,w,g,p,f,v,d,m,a,t),S.lineEnd=o,o()}var f,h,g,p,v,d,m,y,x,M,_,b,w,S={point:e,lineStart:r,lineEnd:o,polygonStart:function(){t.polygonStart(),S.lineStart=c},polygonEnd:function(){t.polygonEnd(),S.lineStart=r}};return S}function u(t,e,r,a,c,s,l,f,h,g,p,v,d,m){var y=l-t,x=f-e,M=y*y+x*x;if(M>4*i&&d--){var _=a+g,b=c+p,w=s+v,S=Math.sqrt(_*_+b*b+w*w),k=Math.asin(w/=S),E=aa(aa(w)-1)<Ca||aa(r-h)<Ca?(r+h)/2:Math.atan2(b,_),A=n(E,k),C=A[0],N=A[1],L=C-t,T=N-e,q=x*L-y*T;(q*q/M>i||aa((y*L+x*T)/M-.5)>.3||o>a*g+c*p+s*v)&&(u(t,e,r,a,c,s,C,N,E,_/=S,b/=S,w,d,m),m.point(C,N),u(C,N,E,_,b,w,l,f,h,g,p,v,d,m))}}var i=.5,o=Math.cos(30*La),a=16;return t.precision=function(n){return arguments.length?(a=(i=n*n)>0&&16,t):Math.sqrt(i)},t}function ye(n){var t=me(function(t,e){return n([t*Ta,e*Ta])});return function(n){return we(t(n))}}function xe(n){this.stream=n}function Me(n,t){return{point:t,sphere:function(){n.sphere()},lineStart:function(){n.lineStart()},lineEnd:function(){n.lineEnd()},polygonStart:function(){n.polygonStart()},polygonEnd:function(){n.polygonEnd()}}}function _e(n){return be(function(){return n})()}function be(n){function t(n){return n=a(n[0]*La,n[1]*La),[n[0]*h+c,s-n[1]*h]}function e(n){return n=a.invert((n[0]-c)/h,(s-n[1])/h),n&&[n[0]*Ta,n[1]*Ta]}function r(){a=ie(o=Ee(m,y,x),i);var n=i(v,d);return c=g-n[0]*h,s=p+n[1]*h,u()}function u(){return l&&(l.valid=!1,l=null),t}var i,o,a,c,s,l,f=me(function(n,t){return n=i(n,t),[n[0]*h+c,s-n[1]*h]}),h=150,g=480,p=250,v=0,d=0,m=0,y=0,x=0,M=Ec,_=vt,b=null,w=null;return t.stream=function(n){return l&&(l.valid=!1),l=we(M(o,f(_(n)))),l.valid=!0,l},t.clipAngle=function(n){return arguments.length?(M=null==n?(b=n,Ec):ee((b=+n)*La),u()):b},t.clipExtent=function(n){return arguments.length?(w=n,_=n?ue(n[0][0],n[0][1],n[1][0],n[1][1]):vt,u()):w},t.scale=function(n){return arguments.length?(h=+n,r()):h},t.translate=function(n){return arguments.length?(g=+n[0],p=+n[1],r()):[g,p]},t.center=function(n){return arguments.length?(v=n[0]%360*La,d=n[1]%360*La,r()):[v*Ta,d*Ta]},t.rotate=function(n){return arguments.length?(m=n[0]%360*La,y=n[1]%360*La,x=n.length>2?n[2]%360*La:0,r()):[m*Ta,y*Ta,x*Ta]},$o.rebind(t,f,"precision"),function(){return i=n.apply(this,arguments),t.invert=i.invert&&e,r()}}function we(n){return Me(n,function(t,e){n.point(t*La,e*La)})}function Se(n,t){return[n,t]}function ke(n,t){return[n>ka?n-Ea:-ka>n?n+Ea:n,t]}function Ee(n,t,e){return n?t||e?ie(Ce(n),Ne(t,e)):Ce(n):t||e?Ne(t,e):ke}function Ae(n){return function(t,e){return t+=n,[t>ka?t-Ea:-ka>t?t+Ea:t,e]}}function Ce(n){var t=Ae(n);return t.invert=Ae(-n),t}function Ne(n,t){function e(n,t){var e=Math.cos(t),a=Math.cos(n)*e,c=Math.sin(n)*e,s=Math.sin(t),l=s*r+a*u;return[Math.atan2(c*i-l*o,a*r-s*u),H(l*i+c*o)]}var r=Math.cos(n),u=Math.sin(n),i=Math.cos(t),o=Math.sin(t);return e.invert=function(n,t){var e=Math.cos(t),a=Math.cos(n)*e,c=Math.sin(n)*e,s=Math.sin(t),l=s*i-c*o;return[Math.atan2(c*i+s*o,a*r+l*u),H(l*r-a*u)]},e}function Le(n,t){var e=Math.cos(n),r=Math.sin(n);return function(u,i,o,a){var c=o*t;null!=u?(u=Te(e,u),i=Te(e,i),(o>0?i>u:u>i)&&(u+=o*Ea)):(u=n+o*Ea,i=n-.5*c);for(var s,l=u;o>0?l>i:i>l;l-=c)a.point((s=Ut([e,-r*Math.cos(l),-r*Math.sin(l)]))[0],s[1])}}function Te(n,t){var e=Tt(t);e[0]-=n,Pt(e);var r=j(-e[1]);return((-e[2]<0?-r:r)+2*Math.PI-Ca)%(2*Math.PI)}function qe(n,t,e){var r=$o.range(n,t-Ca,e).concat(t);return function(n){return r.map(function(t){return[n,t]})}}function ze(n,t,e){var r=$o.range(n,t-Ca,e).concat(t);return function(n){return r.map(function(t){return[t,n]})}}function Re(n){return n.source}function De(n){return n.target}function Pe(n,t,e,r){var u=Math.cos(t),i=Math.sin(t),o=Math.cos(r),a=Math.sin(r),c=u*Math.cos(n),s=u*Math.sin(n),l=o*Math.cos(e),f=o*Math.sin(e),h=2*Math.asin(Math.sqrt(I(r-t)+u*o*I(e-n))),g=1/Math.sin(h),p=h?function(n){var t=Math.sin(n*=h)*g,e=Math.sin(h-n)*g,r=e*c+t*l,u=e*s+t*f,o=e*i+t*a;return[Math.atan2(u,r)*Ta,Math.atan2(o,Math.sqrt(r*r+u*u))*Ta]}:function(){return[n*Ta,t*Ta]};return p.distance=h,p}function Ue(){function n(n,u){var i=Math.sin(u*=La),o=Math.cos(u),a=aa((n*=La)-t),c=Math.cos(a);Uc+=Math.atan2(Math.sqrt((a=o*Math.sin(a))*a+(a=r*i-e*o*c)*a),e*i+r*o*c),t=n,e=i,r=o}var t,e,r;jc.point=function(u,i){t=u*La,e=Math.sin(i*=La),r=Math.cos(i),jc.point=n},jc.lineEnd=function(){jc.point=jc.lineEnd=c}}function je(n,t){function e(t,e){var r=Math.cos(t),u=Math.cos(e),i=n(r*u);return[i*u*Math.sin(t),i*Math.sin(e)]}return e.invert=function(n,e){var r=Math.sqrt(n*n+e*e),u=t(r),i=Math.sin(u),o=Math.cos(u);return[Math.atan2(n*i,r*o),Math.asin(r&&e*i/r)]},e}function He(n,t){function e(n,t){var e=aa(aa(t)-Aa)<Ca?0:o/Math.pow(u(t),i);return[e*Math.sin(i*n),o-e*Math.cos(i*n)]}var r=Math.cos(n),u=function(n){return Math.tan(ka/4+n/2)},i=n===t?Math.sin(n):Math.log(r/Math.cos(t))/Math.log(u(t)/u(n)),o=r*Math.pow(u(n),i)/i;return i?(e.invert=function(n,t){var e=o-t,r=U(i)*Math.sqrt(n*n+e*e);return[Math.atan2(n,e)/i,2*Math.atan(Math.pow(o/r,1/i))-Aa]},e):Oe}function Fe(n,t){function e(n,t){var e=i-t;return[e*Math.sin(u*n),i-e*Math.cos(u*n)]}var r=Math.cos(n),u=n===t?Math.sin(n):(r-Math.cos(t))/(t-n),i=r/u+n;return aa(u)<Ca?Se:(e.invert=function(n,t){var e=i-t;return[Math.atan2(n,e)/u,i-U(u)*Math.sqrt(n*n+e*e)]},e)}function Oe(n,t){return[n,Math.log(Math.tan(ka/4+t/2))]}function Ye(n){var t,e=_e(n),r=e.scale,u=e.translate,i=e.clipExtent;return e.scale=function(){var n=r.apply(e,arguments);return n===e?t?e.clipExtent(null):e:n},e.translate=function(){var n=u.apply(e,arguments);return n===e?t?e.clipExtent(null):e:n},e.clipExtent=function(n){var o=i.apply(e,arguments);if(o===e){if(t=null==n){var a=ka*r(),c=u();i([[c[0]-a,c[1]-a],[c[0]+a,c[1]+a]])}}else t&&(o=null);return o},e.clipExtent(null)}function Ie(n,t){var e=Math.cos(t)*Math.sin(n);return[Math.log((1+e)/(1-e))/2,Math.atan2(Math.tan(t),Math.cos(n))]}function Ze(n){return n[0]}function Ve(n){return n[1]}function Xe(n,t,e,r){var u,i,o,a,c,s,l;return u=r[n],i=u[0],o=u[1],u=r[t],a=u[0],c=u[1],u=r[e],s=u[0],l=u[1],(l-o)*(a-i)-(c-o)*(s-i)>0}function $e(n,t,e){return(e[0]-t[0])*(n[1]-t[1])<(e[1]-t[1])*(n[0]-t[0])}function Be(n,t,e,r){var u=n[0],i=e[0],o=t[0]-u,a=r[0]-i,c=n[1],s=e[1],l=t[1]-c,f=r[1]-s,h=(a*(c-s)-f*(u-i))/(f*o-a*l);return[u+h*o,c+h*l]}function We(n){var t=n[0],e=n[n.length-1];return!(t[0]-e[0]||t[1]-e[1])}function Je(){mr(this),this.edge=this.site=this.circle=null}function Ge(n){var t=Jc.pop()||new Je;return t.site=n,t}function Ke(n){cr(n),$c.remove(n),Jc.push(n),mr(n)}function Qe(n){var t=n.circle,e=t.x,r=t.cy,u={x:e,y:r},i=n.P,o=n.N,a=[n];Ke(n);for(var c=i;c.circle&&aa(e-c.circle.x)<Ca&&aa(r-c.circle.cy)<Ca;)i=c.P,a.unshift(c),Ke(c),c=i;a.unshift(c),cr(c);for(var s=o;s.circle&&aa(e-s.circle.x)<Ca&&aa(r-s.circle.cy)<Ca;)o=s.N,a.push(s),Ke(s),s=o;a.push(s),cr(s);var l,f=a.length;for(l=1;f>l;++l)s=a[l],c=a[l-1],pr(s.edge,c.site,s.site,u);c=a[0],s=a[f-1],s.edge=hr(c.site,s.site,null,u),ar(c),ar(s)}function nr(n){for(var t,e,r,u,i=n.x,o=n.y,a=$c._;a;)if(r=tr(a,o)-i,r>Ca)a=a.L;else{if(u=i-er(a,o),!(u>Ca)){r>-Ca?(t=a.P,e=a):u>-Ca?(t=a,e=a.N):t=e=a;break}if(!a.R){t=a;break}a=a.R}var c=Ge(n);if($c.insert(t,c),t||e){if(t===e)return cr(t),e=Ge(t.site),$c.insert(c,e),c.edge=e.edge=hr(t.site,c.site),ar(t),ar(e),void 0;if(!e)return c.edge=hr(t.site,c.site),void 0;cr(t),cr(e);var s=t.site,l=s.x,f=s.y,h=n.x-l,g=n.y-f,p=e.site,v=p.x-l,d=p.y-f,m=2*(h*d-g*v),y=h*h+g*g,x=v*v+d*d,M={x:(d*y-g*x)/m+l,y:(h*x-v*y)/m+f};pr(e.edge,s,p,M),c.edge=hr(s,n,null,M),e.edge=hr(n,p,null,M),ar(t),ar(e)}}function tr(n,t){var e=n.site,r=e.x,u=e.y,i=u-t;if(!i)return r;var o=n.P;if(!o)return-1/0;e=o.site;var a=e.x,c=e.y,s=c-t;if(!s)return a;var l=a-r,f=1/i-1/s,h=l/s;return f?(-h+Math.sqrt(h*h-2*f*(l*l/(-2*s)-c+s/2+u-i/2)))/f+r:(r+a)/2}function er(n,t){var e=n.N;if(e)return tr(e,t);var r=n.site;return r.y===t?r.x:1/0}function rr(n){this.site=n,this.edges=[]}function ur(n){for(var t,e,r,u,i,o,a,c,s,l,f=n[0][0],h=n[1][0],g=n[0][1],p=n[1][1],v=Xc,d=v.length;d--;)if(i=v[d],i&&i.prepare())for(a=i.edges,c=a.length,o=0;c>o;)l=a[o].end(),r=l.x,u=l.y,s=a[++o%c].start(),t=s.x,e=s.y,(aa(r-t)>Ca||aa(u-e)>Ca)&&(a.splice(o,0,new vr(gr(i.site,l,aa(r-f)<Ca&&p-u>Ca?{x:f,y:aa(t-f)<Ca?e:p}:aa(u-p)<Ca&&h-r>Ca?{x:aa(e-p)<Ca?t:h,y:p}:aa(r-h)<Ca&&u-g>Ca?{x:h,y:aa(t-h)<Ca?e:g}:aa(u-g)<Ca&&r-f>Ca?{x:aa(e-g)<Ca?t:f,y:g}:null),i.site,null)),++c)}function ir(n,t){return t.angle-n.angle}function or(){mr(this),this.x=this.y=this.arc=this.site=this.cy=null}function ar(n){var t=n.P,e=n.N;if(t&&e){var r=t.site,u=n.site,i=e.site;if(r!==i){var o=u.x,a=u.y,c=r.x-o,s=r.y-a,l=i.x-o,f=i.y-a,h=2*(c*f-s*l);if(!(h>=-Na)){var g=c*c+s*s,p=l*l+f*f,v=(f*g-s*p)/h,d=(c*p-l*g)/h,f=d+a,m=Gc.pop()||new or;m.arc=n,m.site=u,m.x=v+o,m.y=f+Math.sqrt(v*v+d*d),m.cy=f,n.circle=m;for(var y=null,x=Wc._;x;)if(m.y<x.y||m.y===x.y&&m.x<=x.x){if(!x.L){y=x.P;break}x=x.L}else{if(!x.R){y=x;break}x=x.R}Wc.insert(y,m),y||(Bc=m)}}}}function cr(n){var t=n.circle;t&&(t.P||(Bc=t.N),Wc.remove(t),Gc.push(t),mr(t),n.circle=null)}function sr(n){for(var t,e=Vc,r=re(n[0][0],n[0][1],n[1][0],n[1][1]),u=e.length;u--;)t=e[u],(!lr(t,n)||!r(t)||aa(t.a.x-t.b.x)<Ca&&aa(t.a.y-t.b.y)<Ca)&&(t.a=t.b=null,e.splice(u,1))}function lr(n,t){var e=n.b;if(e)return!0;var r,u,i=n.a,o=t[0][0],a=t[1][0],c=t[0][1],s=t[1][1],l=n.l,f=n.r,h=l.x,g=l.y,p=f.x,v=f.y,d=(h+p)/2,m=(g+v)/2;
if(v===g){if(o>d||d>=a)return;if(h>p){if(i){if(i.y>=s)return}else i={x:d,y:c};e={x:d,y:s}}else{if(i){if(i.y<c)return}else i={x:d,y:s};e={x:d,y:c}}}else if(r=(h-p)/(v-g),u=m-r*d,-1>r||r>1)if(h>p){if(i){if(i.y>=s)return}else i={x:(c-u)/r,y:c};e={x:(s-u)/r,y:s}}else{if(i){if(i.y<c)return}else i={x:(s-u)/r,y:s};e={x:(c-u)/r,y:c}}else if(v>g){if(i){if(i.x>=a)return}else i={x:o,y:r*o+u};e={x:a,y:r*a+u}}else{if(i){if(i.x<o)return}else i={x:a,y:r*a+u};e={x:o,y:r*o+u}}return n.a=i,n.b=e,!0}function fr(n,t){this.l=n,this.r=t,this.a=this.b=null}function hr(n,t,e,r){var u=new fr(n,t);return Vc.push(u),e&&pr(u,n,t,e),r&&pr(u,t,n,r),Xc[n.i].edges.push(new vr(u,n,t)),Xc[t.i].edges.push(new vr(u,t,n)),u}function gr(n,t,e){var r=new fr(n,null);return r.a=t,r.b=e,Vc.push(r),r}function pr(n,t,e,r){n.a||n.b?n.l===e?n.b=r:n.a=r:(n.a=r,n.l=t,n.r=e)}function vr(n,t,e){var r=n.a,u=n.b;this.edge=n,this.site=t,this.angle=e?Math.atan2(e.y-t.y,e.x-t.x):n.l===t?Math.atan2(u.x-r.x,r.y-u.y):Math.atan2(r.x-u.x,u.y-r.y)}function dr(){this._=null}function mr(n){n.U=n.C=n.L=n.R=n.P=n.N=null}function yr(n,t){var e=t,r=t.R,u=e.U;u?u.L===e?u.L=r:u.R=r:n._=r,r.U=u,e.U=r,e.R=r.L,e.R&&(e.R.U=e),r.L=e}function xr(n,t){var e=t,r=t.L,u=e.U;u?u.L===e?u.L=r:u.R=r:n._=r,r.U=u,e.U=r,e.L=r.R,e.L&&(e.L.U=e),r.R=e}function Mr(n){for(;n.L;)n=n.L;return n}function _r(n,t){var e,r,u,i=n.sort(br).pop();for(Vc=[],Xc=new Array(n.length),$c=new dr,Wc=new dr;;)if(u=Bc,i&&(!u||i.y<u.y||i.y===u.y&&i.x<u.x))(i.x!==e||i.y!==r)&&(Xc[i.i]=new rr(i),nr(i),e=i.x,r=i.y),i=n.pop();else{if(!u)break;Qe(u.arc)}t&&(sr(t),ur(t));var o={cells:Xc,edges:Vc};return $c=Wc=Vc=Xc=null,o}function br(n,t){return t.y-n.y||t.x-n.x}function wr(n,t,e){return(n.x-e.x)*(t.y-n.y)-(n.x-t.x)*(e.y-n.y)}function Sr(n){return n.x}function kr(n){return n.y}function Er(){return{leaf:!0,nodes:[],point:null,x:null,y:null}}function Ar(n,t,e,r,u,i){if(!n(t,e,r,u,i)){var o=.5*(e+u),a=.5*(r+i),c=t.nodes;c[0]&&Ar(n,c[0],e,r,o,a),c[1]&&Ar(n,c[1],o,r,u,a),c[2]&&Ar(n,c[2],e,a,o,i),c[3]&&Ar(n,c[3],o,a,u,i)}}function Cr(n,t){n=$o.rgb(n),t=$o.rgb(t);var e=n.r,r=n.g,u=n.b,i=t.r-e,o=t.g-r,a=t.b-u;return function(n){return"#"+ct(Math.round(e+i*n))+ct(Math.round(r+o*n))+ct(Math.round(u+a*n))}}function Nr(n,t){var e,r={},u={};for(e in n)e in t?r[e]=qr(n[e],t[e]):u[e]=n[e];for(e in t)e in n||(u[e]=t[e]);return function(n){for(e in r)u[e]=r[e](n);return u}}function Lr(n,t){return t-=n=+n,function(e){return n+t*e}}function Tr(n,t){var e,r,u,i,o,a=0,c=0,s=[],l=[];for(n+="",t+="",Qc.lastIndex=0,r=0;e=Qc.exec(t);++r)e.index&&s.push(t.substring(a,c=e.index)),l.push({i:s.length,x:e[0]}),s.push(null),a=Qc.lastIndex;for(a<t.length&&s.push(t.substring(a)),r=0,i=l.length;(e=Qc.exec(n))&&i>r;++r)if(o=l[r],o.x==e[0]){if(o.i)if(null==s[o.i+1])for(s[o.i-1]+=o.x,s.splice(o.i,1),u=r+1;i>u;++u)l[u].i--;else for(s[o.i-1]+=o.x+s[o.i+1],s.splice(o.i,2),u=r+1;i>u;++u)l[u].i-=2;else if(null==s[o.i+1])s[o.i]=o.x;else for(s[o.i]=o.x+s[o.i+1],s.splice(o.i+1,1),u=r+1;i>u;++u)l[u].i--;l.splice(r,1),i--,r--}else o.x=Lr(parseFloat(e[0]),parseFloat(o.x));for(;i>r;)o=l.pop(),null==s[o.i+1]?s[o.i]=o.x:(s[o.i]=o.x+s[o.i+1],s.splice(o.i+1,1)),i--;return 1===s.length?null==s[0]?(o=l[0].x,function(n){return o(n)+""}):function(){return t}:function(n){for(r=0;i>r;++r)s[(o=l[r]).i]=o.x(n);return s.join("")}}function qr(n,t){for(var e,r=$o.interpolators.length;--r>=0&&!(e=$o.interpolators[r](n,t)););return e}function zr(n,t){var e,r=[],u=[],i=n.length,o=t.length,a=Math.min(n.length,t.length);for(e=0;a>e;++e)r.push(qr(n[e],t[e]));for(;i>e;++e)u[e]=n[e];for(;o>e;++e)u[e]=t[e];return function(n){for(e=0;a>e;++e)u[e]=r[e](n);return u}}function Rr(n){return function(t){return 0>=t?0:t>=1?1:n(t)}}function Dr(n){return function(t){return 1-n(1-t)}}function Pr(n){return function(t){return.5*(.5>t?n(2*t):2-n(2-2*t))}}function Ur(n){return n*n}function jr(n){return n*n*n}function Hr(n){if(0>=n)return 0;if(n>=1)return 1;var t=n*n,e=t*n;return 4*(.5>n?e:3*(n-t)+e-.75)}function Fr(n){return function(t){return Math.pow(t,n)}}function Or(n){return 1-Math.cos(n*Aa)}function Yr(n){return Math.pow(2,10*(n-1))}function Ir(n){return 1-Math.sqrt(1-n*n)}function Zr(n,t){var e;return arguments.length<2&&(t=.45),arguments.length?e=t/Ea*Math.asin(1/n):(n=1,e=t/4),function(r){return 1+n*Math.pow(2,-10*r)*Math.sin((r-e)*Ea/t)}}function Vr(n){return n||(n=1.70158),function(t){return t*t*((n+1)*t-n)}}function Xr(n){return 1/2.75>n?7.5625*n*n:2/2.75>n?7.5625*(n-=1.5/2.75)*n+.75:2.5/2.75>n?7.5625*(n-=2.25/2.75)*n+.9375:7.5625*(n-=2.625/2.75)*n+.984375}function $r(n,t){n=$o.hcl(n),t=$o.hcl(t);var e=n.h,r=n.c,u=n.l,i=t.h-e,o=t.c-r,a=t.l-u;return isNaN(o)&&(o=0,r=isNaN(r)?t.c:r),isNaN(i)?(i=0,e=isNaN(e)?t.h:e):i>180?i-=360:-180>i&&(i+=360),function(n){return J(e+i*n,r+o*n,u+a*n)+""}}function Br(n,t){n=$o.hsl(n),t=$o.hsl(t);var e=n.h,r=n.s,u=n.l,i=t.h-e,o=t.s-r,a=t.l-u;return isNaN(o)&&(o=0,r=isNaN(r)?t.s:r),isNaN(i)?(i=0,e=isNaN(e)?t.h:e):i>180?i-=360:-180>i&&(i+=360),function(n){return $(e+i*n,r+o*n,u+a*n)+""}}function Wr(n,t){n=$o.lab(n),t=$o.lab(t);var e=n.l,r=n.a,u=n.b,i=t.l-e,o=t.a-r,a=t.b-u;return function(n){return Q(e+i*n,r+o*n,u+a*n)+""}}function Jr(n,t){return t-=n,function(e){return Math.round(n+t*e)}}function Gr(n){var t=[n.a,n.b],e=[n.c,n.d],r=Qr(t),u=Kr(t,e),i=Qr(nu(e,t,-u))||0;t[0]*e[1]<e[0]*t[1]&&(t[0]*=-1,t[1]*=-1,r*=-1,u*=-1),this.rotate=(r?Math.atan2(t[1],t[0]):Math.atan2(-e[0],e[1]))*Ta,this.translate=[n.e,n.f],this.scale=[r,i],this.skew=i?Math.atan2(u,i)*Ta:0}function Kr(n,t){return n[0]*t[0]+n[1]*t[1]}function Qr(n){var t=Math.sqrt(Kr(n,n));return t&&(n[0]/=t,n[1]/=t),t}function nu(n,t,e){return n[0]+=e*t[0],n[1]+=e*t[1],n}function tu(n,t){var e,r=[],u=[],i=$o.transform(n),o=$o.transform(t),a=i.translate,c=o.translate,s=i.rotate,l=o.rotate,f=i.skew,h=o.skew,g=i.scale,p=o.scale;return a[0]!=c[0]||a[1]!=c[1]?(r.push("translate(",null,",",null,")"),u.push({i:1,x:Lr(a[0],c[0])},{i:3,x:Lr(a[1],c[1])})):c[0]||c[1]?r.push("translate("+c+")"):r.push(""),s!=l?(s-l>180?l+=360:l-s>180&&(s+=360),u.push({i:r.push(r.pop()+"rotate(",null,")")-2,x:Lr(s,l)})):l&&r.push(r.pop()+"rotate("+l+")"),f!=h?u.push({i:r.push(r.pop()+"skewX(",null,")")-2,x:Lr(f,h)}):h&&r.push(r.pop()+"skewX("+h+")"),g[0]!=p[0]||g[1]!=p[1]?(e=r.push(r.pop()+"scale(",null,",",null,")"),u.push({i:e-4,x:Lr(g[0],p[0])},{i:e-2,x:Lr(g[1],p[1])})):(1!=p[0]||1!=p[1])&&r.push(r.pop()+"scale("+p+")"),e=u.length,function(n){for(var t,i=-1;++i<e;)r[(t=u[i]).i]=t.x(n);return r.join("")}}function eu(n,t){return t=t-(n=+n)?1/(t-n):0,function(e){return(e-n)*t}}function ru(n,t){return t=t-(n=+n)?1/(t-n):0,function(e){return Math.max(0,Math.min(1,(e-n)*t))}}function uu(n){for(var t=n.source,e=n.target,r=ou(t,e),u=[t];t!==r;)t=t.parent,u.push(t);for(var i=u.length;e!==r;)u.splice(i,0,e),e=e.parent;return u}function iu(n){for(var t=[],e=n.parent;null!=e;)t.push(n),n=e,e=e.parent;return t.push(n),t}function ou(n,t){if(n===t)return n;for(var e=iu(n),r=iu(t),u=e.pop(),i=r.pop(),o=null;u===i;)o=u,u=e.pop(),i=r.pop();return o}function au(n){n.fixed|=2}function cu(n){n.fixed&=-7}function su(n){n.fixed|=4,n.px=n.x,n.py=n.y}function lu(n){n.fixed&=-5}function fu(n,t,e){var r=0,u=0;if(n.charge=0,!n.leaf)for(var i,o=n.nodes,a=o.length,c=-1;++c<a;)i=o[c],null!=i&&(fu(i,t,e),n.charge+=i.charge,r+=i.charge*i.cx,u+=i.charge*i.cy);if(n.point){n.leaf||(n.point.x+=Math.random()-.5,n.point.y+=Math.random()-.5);var s=t*e[n.point.index];n.charge+=n.pointCharge=s,r+=s*n.point.x,u+=s*n.point.y}n.cx=r/n.charge,n.cy=u/n.charge}function hu(n,t){return $o.rebind(n,t,"sort","children","value"),n.nodes=n,n.links=du,n}function gu(n){return n.children}function pu(n){return n.value}function vu(n,t){return t.value-n.value}function du(n){return $o.merge(n.map(function(n){return(n.children||[]).map(function(t){return{source:n,target:t}})}))}function mu(n){return n.x}function yu(n){return n.y}function xu(n,t,e){n.y0=t,n.y=e}function Mu(n){return $o.range(n.length)}function _u(n){for(var t=-1,e=n[0].length,r=[];++t<e;)r[t]=0;return r}function bu(n){for(var t,e=1,r=0,u=n[0][1],i=n.length;i>e;++e)(t=n[e][1])>u&&(r=e,u=t);return r}function wu(n){return n.reduce(Su,0)}function Su(n,t){return n+t[1]}function ku(n,t){return Eu(n,Math.ceil(Math.log(t.length)/Math.LN2+1))}function Eu(n,t){for(var e=-1,r=+n[0],u=(n[1]-r)/t,i=[];++e<=t;)i[e]=u*e+r;return i}function Au(n){return[$o.min(n),$o.max(n)]}function Cu(n,t){return n.parent==t.parent?1:2}function Nu(n){var t=n.children;return t&&t.length?t[0]:n._tree.thread}function Lu(n){var t,e=n.children;return e&&(t=e.length)?e[t-1]:n._tree.thread}function Tu(n,t){var e=n.children;if(e&&(u=e.length))for(var r,u,i=-1;++i<u;)t(r=Tu(e[i],t),n)>0&&(n=r);return n}function qu(n,t){return n.x-t.x}function zu(n,t){return t.x-n.x}function Ru(n,t){return n.depth-t.depth}function Du(n,t){function e(n,r){var u=n.children;if(u&&(o=u.length))for(var i,o,a=null,c=-1;++c<o;)i=u[c],e(i,a),a=i;t(n,r)}e(n,null)}function Pu(n){for(var t,e=0,r=0,u=n.children,i=u.length;--i>=0;)t=u[i]._tree,t.prelim+=e,t.mod+=e,e+=t.shift+(r+=t.change)}function Uu(n,t,e){n=n._tree,t=t._tree;var r=e/(t.number-n.number);n.change+=r,t.change-=r,t.shift+=e,t.prelim+=e,t.mod+=e}function ju(n,t,e){return n._tree.ancestor.parent==t.parent?n._tree.ancestor:e}function Hu(n,t){return n.value-t.value}function Fu(n,t){var e=n._pack_next;n._pack_next=t,t._pack_prev=n,t._pack_next=e,e._pack_prev=t}function Ou(n,t){n._pack_next=t,t._pack_prev=n}function Yu(n,t){var e=t.x-n.x,r=t.y-n.y,u=n.r+t.r;return.999*u*u>e*e+r*r}function Iu(n){function t(n){l=Math.min(n.x-n.r,l),f=Math.max(n.x+n.r,f),h=Math.min(n.y-n.r,h),g=Math.max(n.y+n.r,g)}if((e=n.children)&&(s=e.length)){var e,r,u,i,o,a,c,s,l=1/0,f=-1/0,h=1/0,g=-1/0;if(e.forEach(Zu),r=e[0],r.x=-r.r,r.y=0,t(r),s>1&&(u=e[1],u.x=u.r,u.y=0,t(u),s>2))for(i=e[2],$u(r,u,i),t(i),Fu(r,i),r._pack_prev=i,Fu(i,u),u=r._pack_next,o=3;s>o;o++){$u(r,u,i=e[o]);var p=0,v=1,d=1;for(a=u._pack_next;a!==u;a=a._pack_next,v++)if(Yu(a,i)){p=1;break}if(1==p)for(c=r._pack_prev;c!==a._pack_prev&&!Yu(c,i);c=c._pack_prev,d++);p?(d>v||v==d&&u.r<r.r?Ou(r,u=a):Ou(r=c,u),o--):(Fu(r,i),u=i,t(i))}var m=(l+f)/2,y=(h+g)/2,x=0;for(o=0;s>o;o++)i=e[o],i.x-=m,i.y-=y,x=Math.max(x,i.r+Math.sqrt(i.x*i.x+i.y*i.y));n.r=x,e.forEach(Vu)}}function Zu(n){n._pack_next=n._pack_prev=n}function Vu(n){delete n._pack_next,delete n._pack_prev}function Xu(n,t,e,r){var u=n.children;if(n.x=t+=r*n.x,n.y=e+=r*n.y,n.r*=r,u)for(var i=-1,o=u.length;++i<o;)Xu(u[i],t,e,r)}function $u(n,t,e){var r=n.r+e.r,u=t.x-n.x,i=t.y-n.y;if(r&&(u||i)){var o=t.r+e.r,a=u*u+i*i;o*=o,r*=r;var c=.5+(r-o)/(2*a),s=Math.sqrt(Math.max(0,2*o*(r+a)-(r-=a)*r-o*o))/(2*a);e.x=n.x+c*u+s*i,e.y=n.y+c*i-s*u}else e.x=n.x+r,e.y=n.y}function Bu(n){return 1+$o.max(n,function(n){return n.y})}function Wu(n){return n.reduce(function(n,t){return n+t.x},0)/n.length}function Ju(n){var t=n.children;return t&&t.length?Ju(t[0]):n}function Gu(n){var t,e=n.children;return e&&(t=e.length)?Gu(e[t-1]):n}function Ku(n){return{x:n.x,y:n.y,dx:n.dx,dy:n.dy}}function Qu(n,t){var e=n.x+t[3],r=n.y+t[0],u=n.dx-t[1]-t[3],i=n.dy-t[0]-t[2];return 0>u&&(e+=u/2,u=0),0>i&&(r+=i/2,i=0),{x:e,y:r,dx:u,dy:i}}function ni(n){var t=n[0],e=n[n.length-1];return e>t?[t,e]:[e,t]}function ti(n){return n.rangeExtent?n.rangeExtent():ni(n.range())}function ei(n,t,e,r){var u=e(n[0],n[1]),i=r(t[0],t[1]);return function(n){return i(u(n))}}function ri(n,t){var e,r=0,u=n.length-1,i=n[r],o=n[u];return i>o&&(e=r,r=u,u=e,e=i,i=o,o=e),n[r]=t.floor(i),n[u]=t.ceil(o),n}function ui(n){return n?{floor:function(t){return Math.floor(t/n)*n},ceil:function(t){return Math.ceil(t/n)*n}}:ss}function ii(n,t,e,r){var u=[],i=[],o=0,a=Math.min(n.length,t.length)-1;for(n[a]<n[0]&&(n=n.slice().reverse(),t=t.slice().reverse());++o<=a;)u.push(e(n[o-1],n[o])),i.push(r(t[o-1],t[o]));return function(t){var e=$o.bisect(n,t,1,a)-1;return i[e](u[e](t))}}function oi(n,t,e,r){function u(){var u=Math.min(n.length,t.length)>2?ii:ei,c=r?ru:eu;return o=u(n,t,c,e),a=u(t,n,c,qr),i}function i(n){return o(n)}var o,a;return i.invert=function(n){return a(n)},i.domain=function(t){return arguments.length?(n=t.map(Number),u()):n},i.range=function(n){return arguments.length?(t=n,u()):t},i.rangeRound=function(n){return i.range(n).interpolate(Jr)},i.clamp=function(n){return arguments.length?(r=n,u()):r},i.interpolate=function(n){return arguments.length?(e=n,u()):e},i.ticks=function(t){return li(n,t)},i.tickFormat=function(t,e){return fi(n,t,e)},i.nice=function(t){return ci(n,t),u()},i.copy=function(){return oi(n,t,e,r)},u()}function ai(n,t){return $o.rebind(n,t,"range","rangeRound","interpolate","clamp")}function ci(n,t){return ri(n,ui(si(n,t)[2]))}function si(n,t){null==t&&(t=10);var e=ni(n),r=e[1]-e[0],u=Math.pow(10,Math.floor(Math.log(r/t)/Math.LN10)),i=t/r*u;return.15>=i?u*=10:.35>=i?u*=5:.75>=i&&(u*=2),e[0]=Math.ceil(e[0]/u)*u,e[1]=Math.floor(e[1]/u)*u+.5*u,e[2]=u,e}function li(n,t){return $o.range.apply($o,si(n,t))}function fi(n,t,e){var r=si(n,t);return $o.format(e?e.replace(uc,function(n,t,e,u,i,o,a,c,s,l){return[t,e,u,i,o,a,c,s||"."+gi(l,r),l].join("")}):",."+hi(r[2])+"f")}function hi(n){return-Math.floor(Math.log(n)/Math.LN10+.01)}function gi(n,t){var e=hi(t[2]);return n in ls?Math.abs(e-hi(Math.max(Math.abs(t[0]),Math.abs(t[1]))))+ +("e"!==n):e-2*("%"===n)}function pi(n,t,e,r){function u(n){return(e?Math.log(0>n?0:n):-Math.log(n>0?0:-n))/Math.log(t)}function i(n){return e?Math.pow(t,n):-Math.pow(t,-n)}function o(t){return n(u(t))}return o.invert=function(t){return i(n.invert(t))},o.domain=function(t){return arguments.length?(e=t[0]>=0,n.domain((r=t.map(Number)).map(u)),o):r},o.base=function(e){return arguments.length?(t=+e,n.domain(r.map(u)),o):t},o.nice=function(){var t=ri(r.map(u),e?Math:hs);return n.domain(t),r=t.map(i),o},o.ticks=function(){var n=ni(r),o=[],a=n[0],c=n[1],s=Math.floor(u(a)),l=Math.ceil(u(c)),f=t%1?2:t;if(isFinite(l-s)){if(e){for(;l>s;s++)for(var h=1;f>h;h++)o.push(i(s)*h);o.push(i(s))}else for(o.push(i(s));s++<l;)for(var h=f-1;h>0;h--)o.push(i(s)*h);for(s=0;o[s]<a;s++);for(l=o.length;o[l-1]>c;l--);o=o.slice(s,l)}return o},o.tickFormat=function(n,t){if(!arguments.length)return fs;arguments.length<2?t=fs:"function"!=typeof t&&(t=$o.format(t));var r,a=Math.max(.1,n/o.ticks().length),c=e?(r=1e-12,Math.ceil):(r=-1e-12,Math.floor);return function(n){return n/i(c(u(n)+r))<=a?t(n):""}},o.copy=function(){return pi(n.copy(),t,e,r)},ai(o,n)}function vi(n,t,e){function r(t){return n(u(t))}var u=di(t),i=di(1/t);return r.invert=function(t){return i(n.invert(t))},r.domain=function(t){return arguments.length?(n.domain((e=t.map(Number)).map(u)),r):e},r.ticks=function(n){return li(e,n)},r.tickFormat=function(n,t){return fi(e,n,t)},r.nice=function(n){return r.domain(ci(e,n))},r.exponent=function(o){return arguments.length?(u=di(t=o),i=di(1/t),n.domain(e.map(u)),r):t},r.copy=function(){return vi(n.copy(),t,e)},ai(r,n)}function di(n){return function(t){return 0>t?-Math.pow(-t,n):Math.pow(t,n)}}function mi(n,t){function e(e){return o[((i.get(e)||"range"===t.t&&i.set(e,n.push(e)))-1)%o.length]}function r(t,e){return $o.range(n.length).map(function(n){return t+e*n})}var i,o,a;return e.domain=function(r){if(!arguments.length)return n;n=[],i=new u;for(var o,a=-1,c=r.length;++a<c;)i.has(o=r[a])||i.set(o,n.push(o));return e[t.t].apply(e,t.a)},e.range=function(n){return arguments.length?(o=n,a=0,t={t:"range",a:arguments},e):o},e.rangePoints=function(u,i){arguments.length<2&&(i=0);var c=u[0],s=u[1],l=(s-c)/(Math.max(1,n.length-1)+i);return o=r(n.length<2?(c+s)/2:c+l*i/2,l),a=0,t={t:"rangePoints",a:arguments},e},e.rangeBands=function(u,i,c){arguments.length<2&&(i=0),arguments.length<3&&(c=i);var s=u[1]<u[0],l=u[s-0],f=u[1-s],h=(f-l)/(n.length-i+2*c);return o=r(l+h*c,h),s&&o.reverse(),a=h*(1-i),t={t:"rangeBands",a:arguments},e},e.rangeRoundBands=function(u,i,c){arguments.length<2&&(i=0),arguments.length<3&&(c=i);var s=u[1]<u[0],l=u[s-0],f=u[1-s],h=Math.floor((f-l)/(n.length-i+2*c)),g=f-l-(n.length-i)*h;return o=r(l+Math.round(g/2),h),s&&o.reverse(),a=Math.round(h*(1-i)),t={t:"rangeRoundBands",a:arguments},e},e.rangeBand=function(){return a},e.rangeExtent=function(){return ni(t.a[0])},e.copy=function(){return mi(n,t)},e.domain(n)}function yi(n,t){function e(){var e=0,i=t.length;for(u=[];++e<i;)u[e-1]=$o.quantile(n,e/i);return r}function r(n){return isNaN(n=+n)?void 0:t[$o.bisect(u,n)]}var u;return r.domain=function(t){return arguments.length?(n=t.filter(function(n){return!isNaN(n)}).sort($o.ascending),e()):n},r.range=function(n){return arguments.length?(t=n,e()):t},r.quantiles=function(){return u},r.invertExtent=function(e){return e=t.indexOf(e),0>e?[0/0,0/0]:[e>0?u[e-1]:n[0],e<u.length?u[e]:n[n.length-1]]},r.copy=function(){return yi(n,t)},e()}function xi(n,t,e){function r(t){return e[Math.max(0,Math.min(o,Math.floor(i*(t-n))))]}function u(){return i=e.length/(t-n),o=e.length-1,r}var i,o;return r.domain=function(e){return arguments.length?(n=+e[0],t=+e[e.length-1],u()):[n,t]},r.range=function(n){return arguments.length?(e=n,u()):e},r.invertExtent=function(t){return t=e.indexOf(t),t=0>t?0/0:t/i+n,[t,t+1/i]},r.copy=function(){return xi(n,t,e)},u()}function Mi(n,t){function e(e){return e>=e?t[$o.bisect(n,e)]:void 0}return e.domain=function(t){return arguments.length?(n=t,e):n},e.range=function(n){return arguments.length?(t=n,e):t},e.invertExtent=function(e){return e=t.indexOf(e),[n[e-1],n[e]]},e.copy=function(){return Mi(n,t)},e}function _i(n){function t(n){return+n}return t.invert=t,t.domain=t.range=function(e){return arguments.length?(n=e.map(t),t):n},t.ticks=function(t){return li(n,t)},t.tickFormat=function(t,e){return fi(n,t,e)},t.copy=function(){return _i(n)},t}function bi(n){return n.innerRadius}function wi(n){return n.outerRadius}function Si(n){return n.startAngle}function ki(n){return n.endAngle}function Ei(n){function t(t){function o(){s.push("M",i(n(l),a))}for(var c,s=[],l=[],f=-1,h=t.length,g=pt(e),p=pt(r);++f<h;)u.call(this,c=t[f],f)?l.push([+g.call(this,c,f),+p.call(this,c,f)]):l.length&&(o(),l=[]);return l.length&&o(),s.length?s.join(""):null}var e=Ze,r=Ve,u=Zt,i=Ai,o=i.key,a=.7;return t.x=function(n){return arguments.length?(e=n,t):e},t.y=function(n){return arguments.length?(r=n,t):r},t.defined=function(n){return arguments.length?(u=n,t):u},t.interpolate=function(n){return arguments.length?(o="function"==typeof n?i=n:(i=xs.get(n)||Ai).key,t):o},t.tension=function(n){return arguments.length?(a=n,t):a},t}function Ai(n){return n.join("L")}function Ci(n){return Ai(n)+"Z"}function Ni(n){for(var t=0,e=n.length,r=n[0],u=[r[0],",",r[1]];++t<e;)u.push("H",(r[0]+(r=n[t])[0])/2,"V",r[1]);return e>1&&u.push("H",r[0]),u.join("")}function Li(n){for(var t=0,e=n.length,r=n[0],u=[r[0],",",r[1]];++t<e;)u.push("V",(r=n[t])[1],"H",r[0]);return u.join("")}function Ti(n){for(var t=0,e=n.length,r=n[0],u=[r[0],",",r[1]];++t<e;)u.push("H",(r=n[t])[0],"V",r[1]);return u.join("")}function qi(n,t){return n.length<4?Ai(n):n[1]+Di(n.slice(1,n.length-1),Pi(n,t))}function zi(n,t){return n.length<3?Ai(n):n[0]+Di((n.push(n[0]),n),Pi([n[n.length-2]].concat(n,[n[1]]),t))}function Ri(n,t){return n.length<3?Ai(n):n[0]+Di(n,Pi(n,t))}function Di(n,t){if(t.length<1||n.length!=t.length&&n.length!=t.length+2)return Ai(n);var e=n.length!=t.length,r="",u=n[0],i=n[1],o=t[0],a=o,c=1;if(e&&(r+="Q"+(i[0]-2*o[0]/3)+","+(i[1]-2*o[1]/3)+","+i[0]+","+i[1],u=n[1],c=2),t.length>1){a=t[1],i=n[c],c++,r+="C"+(u[0]+o[0])+","+(u[1]+o[1])+","+(i[0]-a[0])+","+(i[1]-a[1])+","+i[0]+","+i[1];for(var s=2;s<t.length;s++,c++)i=n[c],a=t[s],r+="S"+(i[0]-a[0])+","+(i[1]-a[1])+","+i[0]+","+i[1]}if(e){var l=n[c];r+="Q"+(i[0]+2*a[0]/3)+","+(i[1]+2*a[1]/3)+","+l[0]+","+l[1]}return r}function Pi(n,t){for(var e,r=[],u=(1-t)/2,i=n[0],o=n[1],a=1,c=n.length;++a<c;)e=i,i=o,o=n[a],r.push([u*(o[0]-e[0]),u*(o[1]-e[1])]);return r}function Ui(n){if(n.length<3)return Ai(n);var t=1,e=n.length,r=n[0],u=r[0],i=r[1],o=[u,u,u,(r=n[1])[0]],a=[i,i,i,r[1]],c=[u,",",i,"L",Oi(bs,o),",",Oi(bs,a)];for(n.push(n[e-1]);++t<=e;)r=n[t],o.shift(),o.push(r[0]),a.shift(),a.push(r[1]),Yi(c,o,a);return n.pop(),c.push("L",r),c.join("")}function ji(n){if(n.length<4)return Ai(n);for(var t,e=[],r=-1,u=n.length,i=[0],o=[0];++r<3;)t=n[r],i.push(t[0]),o.push(t[1]);for(e.push(Oi(bs,i)+","+Oi(bs,o)),--r;++r<u;)t=n[r],i.shift(),i.push(t[0]),o.shift(),o.push(t[1]),Yi(e,i,o);return e.join("")}function Hi(n){for(var t,e,r=-1,u=n.length,i=u+4,o=[],a=[];++r<4;)e=n[r%u],o.push(e[0]),a.push(e[1]);for(t=[Oi(bs,o),",",Oi(bs,a)],--r;++r<i;)e=n[r%u],o.shift(),o.push(e[0]),a.shift(),a.push(e[1]),Yi(t,o,a);return t.join("")}function Fi(n,t){var e=n.length-1;if(e)for(var r,u,i=n[0][0],o=n[0][1],a=n[e][0]-i,c=n[e][1]-o,s=-1;++s<=e;)r=n[s],u=s/e,r[0]=t*r[0]+(1-t)*(i+u*a),r[1]=t*r[1]+(1-t)*(o+u*c);return Ui(n)}function Oi(n,t){return n[0]*t[0]+n[1]*t[1]+n[2]*t[2]+n[3]*t[3]}function Yi(n,t,e){n.push("C",Oi(Ms,t),",",Oi(Ms,e),",",Oi(_s,t),",",Oi(_s,e),",",Oi(bs,t),",",Oi(bs,e))}function Ii(n,t){return(t[1]-n[1])/(t[0]-n[0])}function Zi(n){for(var t=0,e=n.length-1,r=[],u=n[0],i=n[1],o=r[0]=Ii(u,i);++t<e;)r[t]=(o+(o=Ii(u=i,i=n[t+1])))/2;return r[t]=o,r}function Vi(n){for(var t,e,r,u,i=[],o=Zi(n),a=-1,c=n.length-1;++a<c;)t=Ii(n[a],n[a+1]),aa(t)<Ca?o[a]=o[a+1]=0:(e=o[a]/t,r=o[a+1]/t,u=e*e+r*r,u>9&&(u=3*t/Math.sqrt(u),o[a]=u*e,o[a+1]=u*r));for(a=-1;++a<=c;)u=(n[Math.min(c,a+1)][0]-n[Math.max(0,a-1)][0])/(6*(1+o[a]*o[a])),i.push([u||0,o[a]*u||0]);return i}function Xi(n){return n.length<3?Ai(n):n[0]+Di(n,Vi(n))}function $i(n){for(var t,e,r,u=-1,i=n.length;++u<i;)t=n[u],e=t[0],r=t[1]+ms,t[0]=e*Math.cos(r),t[1]=e*Math.sin(r);return n}function Bi(n){function t(t){function c(){v.push("M",a(n(m),f),l,s(n(d.reverse()),f),"Z")}for(var h,g,p,v=[],d=[],m=[],y=-1,x=t.length,M=pt(e),_=pt(u),b=e===r?function(){return g}:pt(r),w=u===i?function(){return p}:pt(i);++y<x;)o.call(this,h=t[y],y)?(d.push([g=+M.call(this,h,y),p=+_.call(this,h,y)]),m.push([+b.call(this,h,y),+w.call(this,h,y)])):d.length&&(c(),d=[],m=[]);return d.length&&c(),v.length?v.join(""):null}var e=Ze,r=Ze,u=0,i=Ve,o=Zt,a=Ai,c=a.key,s=a,l="L",f=.7;return t.x=function(n){return arguments.length?(e=r=n,t):r},t.x0=function(n){return arguments.length?(e=n,t):e},t.x1=function(n){return arguments.length?(r=n,t):r},t.y=function(n){return arguments.length?(u=i=n,t):i},t.y0=function(n){return arguments.length?(u=n,t):u},t.y1=function(n){return arguments.length?(i=n,t):i},t.defined=function(n){return arguments.length?(o=n,t):o},t.interpolate=function(n){return arguments.length?(c="function"==typeof n?a=n:(a=xs.get(n)||Ai).key,s=a.reverse||a,l=a.closed?"M":"L",t):c},t.tension=function(n){return arguments.length?(f=n,t):f},t}function Wi(n){return n.radius}function Ji(n){return[n.x,n.y]}function Gi(n){return function(){var t=n.apply(this,arguments),e=t[0],r=t[1]+ms;return[e*Math.cos(r),e*Math.sin(r)]}}function Ki(){return 64}function Qi(){return"circle"}function no(n){var t=Math.sqrt(n/ka);return"M0,"+t+"A"+t+","+t+" 0 1,1 0,"+-t+"A"+t+","+t+" 0 1,1 0,"+t+"Z"}function to(n,t){return ha(n,Cs),n.id=t,n}function eo(n,t,e,r){var u=n.id;return C(n,"function"==typeof e?function(n,i,o){n.__transition__[u].tween.set(t,r(e.call(n,n.__data__,i,o)))}:(e=r(e),function(n){n.__transition__[u].tween.set(t,e)}))}function ro(n){return null==n&&(n=""),function(){this.textContent=n}}function uo(n,t,e,r){var i=n.__transition__||(n.__transition__={active:0,count:0}),o=i[e];if(!o){var a=r.time;o=i[e]={tween:new u,time:a,ease:r.ease,delay:r.delay,duration:r.duration},++i.count,$o.timer(function(r){function u(r){return i.active>e?s():(i.active=e,o.event&&o.event.start.call(n,l,t),o.tween.forEach(function(e,r){(r=r.call(n,l,t))&&v.push(r)}),$o.timer(function(){return p.c=c(r||1)?Zt:c,1},0,a),void 0)}function c(r){if(i.active!==e)return s();for(var u=r/g,a=f(u),c=v.length;c>0;)v[--c].call(n,a);return u>=1?(o.event&&o.event.end.call(n,l,t),s()):void 0}function s(){return--i.count?delete i[e]:delete n.__transition__,1}var l=n.__data__,f=o.ease,h=o.delay,g=o.duration,p=Ga,v=[];return p.t=h+a,r>=h?u(r-h):(p.c=u,void 0)},0,a)}}function io(n,t){n.attr("transform",function(n){return"translate("+t(n)+",0)"})}function oo(n,t){n.attr("transform",function(n){return"translate(0,"+t(n)+")"})}function ao(){this._=new Date(arguments.length>1?Date.UTC.apply(this,arguments):arguments[0])}function co(n,t,e){function r(t){var e=n(t),r=i(e,1);return r-t>t-e?e:r}function u(e){return t(e=n(new Ds(e-1)),1),e}function i(n,e){return t(n=new Ds(+n),e),n}function o(n,r,i){var o=u(n),a=[];if(i>1)for(;r>o;)e(o)%i||a.push(new Date(+o)),t(o,1);else for(;r>o;)a.push(new Date(+o)),t(o,1);return a}function a(n,t,e){try{Ds=ao;var r=new ao;return r._=n,o(r,t,e)}finally{Ds=Date}}n.floor=n,n.round=r,n.ceil=u,n.offset=i,n.range=o;var c=n.utc=so(n);return c.floor=c,c.round=so(r),c.ceil=so(u),c.offset=so(i),c.range=a,n}function so(n){return function(t,e){try{Ds=ao;var r=new ao;return r._=t,n(r,e)._}finally{Ds=Date}}}function lo(n){function t(t){for(var r,u,i,o=[],a=-1,c=0;++a<e;)37===n.charCodeAt(a)&&(o.push(n.substring(c,a)),null!=(u=nl[r=n.charAt(++a)])&&(r=n.charAt(++a)),(i=tl[r])&&(r=i(t,null==u?"e"===r?" ":"0":u)),o.push(r),c=a+1);return o.push(n.substring(c,a)),o.join("")}var e=n.length;return t.parse=function(t){var e={y:1900,m:0,d:1,H:0,M:0,S:0,L:0,Z:null},r=fo(e,n,t,0);if(r!=t.length)return null;"p"in e&&(e.H=e.H%12+12*e.p);var u=null!=e.Z&&Ds!==ao,i=new(u?ao:Ds);return"j"in e?i.setFullYear(e.y,0,e.j):"w"in e&&("W"in e||"U"in e)?(i.setFullYear(e.y,0,1),i.setFullYear(e.y,0,"W"in e?(e.w+6)%7+7*e.W-(i.getDay()+5)%7:e.w+7*e.U-(i.getDay()+6)%7)):i.setFullYear(e.y,e.m,e.d),i.setHours(e.H+Math.floor(e.Z/100),e.M+e.Z%100,e.S,e.L),u?i._:i},t.toString=function(){return n},t}function fo(n,t,e,r){for(var u,i,o,a=0,c=t.length,s=e.length;c>a;){if(r>=s)return-1;if(u=t.charCodeAt(a++),37===u){if(o=t.charAt(a++),i=el[o in nl?t.charAt(a++):o],!i||(r=i(n,e,r))<0)return-1}else if(u!=e.charCodeAt(r++))return-1}return r}function ho(n){return new RegExp("^(?:"+n.map($o.requote).join("|")+")","i")}function go(n){for(var t=new u,e=-1,r=n.length;++e<r;)t.set(n[e].toLowerCase(),e);return t}function po(n,t,e){var r=0>n?"-":"",u=(r?-n:n)+"",i=u.length;return r+(e>i?new Array(e-i+1).join(t)+u:u)}function vo(n,t,e){$s.lastIndex=0;var r=$s.exec(t.substring(e));return r?(n.w=Bs.get(r[0].toLowerCase()),e+r[0].length):-1}function mo(n,t,e){Vs.lastIndex=0;var r=Vs.exec(t.substring(e));return r?(n.w=Xs.get(r[0].toLowerCase()),e+r[0].length):-1}function yo(n,t,e){rl.lastIndex=0;var r=rl.exec(t.substring(e,e+1));return r?(n.w=+r[0],e+r[0].length):-1}function xo(n,t,e){rl.lastIndex=0;var r=rl.exec(t.substring(e));return r?(n.U=+r[0],e+r[0].length):-1}function Mo(n,t,e){rl.lastIndex=0;var r=rl.exec(t.substring(e));return r?(n.W=+r[0],e+r[0].length):-1}function _o(n,t,e){Gs.lastIndex=0;var r=Gs.exec(t.substring(e));return r?(n.m=Ks.get(r[0].toLowerCase()),e+r[0].length):-1}function bo(n,t,e){Ws.lastIndex=0;var r=Ws.exec(t.substring(e));return r?(n.m=Js.get(r[0].toLowerCase()),e+r[0].length):-1}function wo(n,t,e){return fo(n,tl.c.toString(),t,e)}function So(n,t,e){return fo(n,tl.x.toString(),t,e)}function ko(n,t,e){return fo(n,tl.X.toString(),t,e)}function Eo(n,t,e){rl.lastIndex=0;var r=rl.exec(t.substring(e,e+4));return r?(n.y=+r[0],e+r[0].length):-1}function Ao(n,t,e){rl.lastIndex=0;var r=rl.exec(t.substring(e,e+2));return r?(n.y=No(+r[0]),e+r[0].length):-1}function Co(n,t,e){return/^[+-]\d{4}$/.test(t=t.substring(e,e+5))?(n.Z=+t,e+5):-1}function No(n){return n+(n>68?1900:2e3)}function Lo(n,t,e){rl.lastIndex=0;var r=rl.exec(t.substring(e,e+2));return r?(n.m=r[0]-1,e+r[0].length):-1}function To(n,t,e){rl.lastIndex=0;var r=rl.exec(t.substring(e,e+2));return r?(n.d=+r[0],e+r[0].length):-1}function qo(n,t,e){rl.lastIndex=0;var r=rl.exec(t.substring(e,e+3));return r?(n.j=+r[0],e+r[0].length):-1}function zo(n,t,e){rl.lastIndex=0;var r=rl.exec(t.substring(e,e+2));return r?(n.H=+r[0],e+r[0].length):-1}function Ro(n,t,e){rl.lastIndex=0;var r=rl.exec(t.substring(e,e+2));return r?(n.M=+r[0],e+r[0].length):-1}function Do(n,t,e){rl.lastIndex=0;var r=rl.exec(t.substring(e,e+2));return r?(n.S=+r[0],e+r[0].length):-1}function Po(n,t,e){rl.lastIndex=0;var r=rl.exec(t.substring(e,e+3));return r?(n.L=+r[0],e+r[0].length):-1}function Uo(n,t,e){var r=ul.get(t.substring(e,e+=2).toLowerCase());return null==r?-1:(n.p=r,e)}function jo(n){var t=n.getTimezoneOffset(),e=t>0?"-":"+",r=~~(aa(t)/60),u=aa(t)%60;return e+po(r,"0",2)+po(u,"0",2)}function Ho(n,t,e){Qs.lastIndex=0;var r=Qs.exec(t.substring(e,e+1));return r?e+r[0].length:-1}function Fo(n){function t(n){try{Ds=ao;var t=new Ds;return t._=n,e(t)}finally{Ds=Date}}var e=lo(n);return t.parse=function(n){try{Ds=ao;var t=e.parse(n);return t&&t._}finally{Ds=Date}},t.toString=e.toString,t}function Oo(n){return n.toISOString()}function Yo(n,t,e){function r(t){return n(t)}function u(n,e){var r=n[1]-n[0],u=r/e,i=$o.bisect(ol,u);return i==ol.length?[t.year,si(n.map(function(n){return n/31536e6}),e)[2]]:i?t[u/ol[i-1]<ol[i]/u?i-1:i]:[ll,si(n,e)[2]]}return r.invert=function(t){return Io(n.invert(t))},r.domain=function(t){return arguments.length?(n.domain(t),r):n.domain().map(Io)},r.nice=function(n,t){function e(e){return!isNaN(e)&&!n.range(e,Io(+e+1),t).length}var i=r.domain(),o=ni(i),a=null==n?u(o,10):"number"==typeof n&&u(o,n);return a&&(n=a[0],t=a[1]),r.domain(ri(i,t>1?{floor:function(t){for(;e(t=n.floor(t));)t=Io(t-1);return t},ceil:function(t){for(;e(t=n.ceil(t));)t=Io(+t+1);return t}}:n))},r.ticks=function(n,t){var e=ni(r.domain()),i=null==n?u(e,10):"number"==typeof n?u(e,n):!n.range&&[{range:n},t];return i&&(n=i[0],t=i[1]),n.range(e[0],Io(+e[1]+1),1>t?1:t)},r.tickFormat=function(){return e},r.copy=function(){return Yo(n.copy(),t,e)},ai(r,n)}function Io(n){return new Date(n)}function Zo(n){return function(t){for(var e=n.length-1,r=n[e];!r[1](t);)r=n[--e];return r[0](t)}}function Vo(n){return JSON.parse(n.responseText)}function Xo(n){var t=Jo.createRange();return t.selectNode(Jo.body),t.createContextualFragment(n.responseText)}var $o={version:"3.3.10"};Date.now||(Date.now=function(){return+new Date});var Bo=[].slice,Wo=function(n){return Bo.call(n)},Jo=document,Go=Jo.documentElement,Ko=window;try{Wo(Go.childNodes)[0].nodeType}catch(Qo){Wo=function(n){for(var t=n.length,e=new Array(t);t--;)e[t]=n[t];return e}}try{Jo.createElement("div").style.setProperty("opacity",0,"")}catch(na){var ta=Ko.Element.prototype,ea=ta.setAttribute,ra=ta.setAttributeNS,ua=Ko.CSSStyleDeclaration.prototype,ia=ua.setProperty;ta.setAttribute=function(n,t){ea.call(this,n,t+"")},ta.setAttributeNS=function(n,t,e){ra.call(this,n,t,e+"")},ua.setProperty=function(n,t,e){ia.call(this,n,t+"",e)}}$o.ascending=function(n,t){return t>n?-1:n>t?1:n>=t?0:0/0},$o.descending=function(n,t){return n>t?-1:t>n?1:t>=n?0:0/0},$o.min=function(n,t){var e,r,u=-1,i=n.length;if(1===arguments.length){for(;++u<i&&!(null!=(e=n[u])&&e>=e);)e=void 0;for(;++u<i;)null!=(r=n[u])&&e>r&&(e=r)}else{for(;++u<i&&!(null!=(e=t.call(n,n[u],u))&&e>=e);)e=void 0;for(;++u<i;)null!=(r=t.call(n,n[u],u))&&e>r&&(e=r)}return e},$o.max=function(n,t){var e,r,u=-1,i=n.length;if(1===arguments.length){for(;++u<i&&!(null!=(e=n[u])&&e>=e);)e=void 0;for(;++u<i;)null!=(r=n[u])&&r>e&&(e=r)}else{for(;++u<i&&!(null!=(e=t.call(n,n[u],u))&&e>=e);)e=void 0;for(;++u<i;)null!=(r=t.call(n,n[u],u))&&r>e&&(e=r)}return e},$o.extent=function(n,t){var e,r,u,i=-1,o=n.length;if(1===arguments.length){for(;++i<o&&!(null!=(e=u=n[i])&&e>=e);)e=u=void 0;for(;++i<o;)null!=(r=n[i])&&(e>r&&(e=r),r>u&&(u=r))}else{for(;++i<o&&!(null!=(e=u=t.call(n,n[i],i))&&e>=e);)e=void 0;for(;++i<o;)null!=(r=t.call(n,n[i],i))&&(e>r&&(e=r),r>u&&(u=r))}return[e,u]},$o.sum=function(n,t){var e,r=0,u=n.length,i=-1;if(1===arguments.length)for(;++i<u;)isNaN(e=+n[i])||(r+=e);else for(;++i<u;)isNaN(e=+t.call(n,n[i],i))||(r+=e);return r},$o.mean=function(t,e){var r,u=t.length,i=0,o=-1,a=0;if(1===arguments.length)for(;++o<u;)n(r=t[o])&&(i+=(r-i)/++a);else for(;++o<u;)n(r=e.call(t,t[o],o))&&(i+=(r-i)/++a);return a?i:void 0},$o.quantile=function(n,t){var e=(n.length-1)*t+1,r=Math.floor(e),u=+n[r-1],i=e-r;
return i?u+i*(n[r]-u):u},$o.median=function(t,e){return arguments.length>1&&(t=t.map(e)),t=t.filter(n),t.length?$o.quantile(t.sort($o.ascending),.5):void 0},$o.bisector=function(n){return{left:function(t,e,r,u){for(arguments.length<3&&(r=0),arguments.length<4&&(u=t.length);u>r;){var i=r+u>>>1;n.call(t,t[i],i)<e?r=i+1:u=i}return r},right:function(t,e,r,u){for(arguments.length<3&&(r=0),arguments.length<4&&(u=t.length);u>r;){var i=r+u>>>1;e<n.call(t,t[i],i)?u=i:r=i+1}return r}}};var oa=$o.bisector(function(n){return n});$o.bisectLeft=oa.left,$o.bisect=$o.bisectRight=oa.right,$o.shuffle=function(n){for(var t,e,r=n.length;r;)e=0|Math.random()*r--,t=n[r],n[r]=n[e],n[e]=t;return n},$o.permute=function(n,t){for(var e=t.length,r=new Array(e);e--;)r[e]=n[t[e]];return r},$o.pairs=function(n){for(var t,e=0,r=n.length-1,u=n[0],i=new Array(0>r?0:r);r>e;)i[e]=[t=u,u=n[++e]];return i},$o.zip=function(){if(!(u=arguments.length))return[];for(var n=-1,e=$o.min(arguments,t),r=new Array(e);++n<e;)for(var u,i=-1,o=r[n]=new Array(u);++i<u;)o[i]=arguments[i][n];return r},$o.transpose=function(n){return $o.zip.apply($o,n)},$o.keys=function(n){var t=[];for(var e in n)t.push(e);return t},$o.values=function(n){var t=[];for(var e in n)t.push(n[e]);return t},$o.entries=function(n){var t=[];for(var e in n)t.push({key:e,value:n[e]});return t},$o.merge=function(n){for(var t,e,r,u=n.length,i=-1,o=0;++i<u;)o+=n[i].length;for(e=new Array(o);--u>=0;)for(r=n[u],t=r.length;--t>=0;)e[--o]=r[t];return e};var aa=Math.abs;$o.range=function(n,t,r){if(arguments.length<3&&(r=1,arguments.length<2&&(t=n,n=0)),1/0===(t-n)/r)throw new Error("infinite range");var u,i=[],o=e(aa(r)),a=-1;if(n*=o,t*=o,r*=o,0>r)for(;(u=n+r*++a)>t;)i.push(u/o);else for(;(u=n+r*++a)<t;)i.push(u/o);return i},$o.map=function(n){var t=new u;if(n instanceof u)n.forEach(function(n,e){t.set(n,e)});else for(var e in n)t.set(e,n[e]);return t},r(u,{has:function(n){return ca+n in this},get:function(n){return this[ca+n]},set:function(n,t){return this[ca+n]=t},remove:function(n){return n=ca+n,n in this&&delete this[n]},keys:function(){var n=[];return this.forEach(function(t){n.push(t)}),n},values:function(){var n=[];return this.forEach(function(t,e){n.push(e)}),n},entries:function(){var n=[];return this.forEach(function(t,e){n.push({key:t,value:e})}),n},forEach:function(n){for(var t in this)t.charCodeAt(0)===sa&&n.call(this,t.substring(1),this[t])}});var ca="\x00",sa=ca.charCodeAt(0);$o.nest=function(){function n(t,a,c){if(c>=o.length)return r?r.call(i,a):e?a.sort(e):a;for(var s,l,f,h,g=-1,p=a.length,v=o[c++],d=new u;++g<p;)(h=d.get(s=v(l=a[g])))?h.push(l):d.set(s,[l]);return t?(l=t(),f=function(e,r){l.set(e,n(t,r,c))}):(l={},f=function(e,r){l[e]=n(t,r,c)}),d.forEach(f),l}function t(n,e){if(e>=o.length)return n;var r=[],u=a[e++];return n.forEach(function(n,u){r.push({key:n,values:t(u,e)})}),u?r.sort(function(n,t){return u(n.key,t.key)}):r}var e,r,i={},o=[],a=[];return i.map=function(t,e){return n(e,t,0)},i.entries=function(e){return t(n($o.map,e,0),0)},i.key=function(n){return o.push(n),i},i.sortKeys=function(n){return a[o.length-1]=n,i},i.sortValues=function(n){return e=n,i},i.rollup=function(n){return r=n,i},i},$o.set=function(n){var t=new i;if(n)for(var e=0,r=n.length;r>e;++e)t.add(n[e]);return t},r(i,{has:function(n){return ca+n in this},add:function(n){return this[ca+n]=!0,n},remove:function(n){return n=ca+n,n in this&&delete this[n]},values:function(){var n=[];return this.forEach(function(t){n.push(t)}),n},forEach:function(n){for(var t in this)t.charCodeAt(0)===sa&&n.call(this,t.substring(1))}}),$o.behavior={},$o.rebind=function(n,t){for(var e,r=1,u=arguments.length;++r<u;)n[e=arguments[r]]=o(n,t,t[e]);return n};var la=["webkit","ms","moz","Moz","o","O"];$o.dispatch=function(){for(var n=new s,t=-1,e=arguments.length;++t<e;)n[arguments[t]]=l(n);return n},s.prototype.on=function(n,t){var e=n.indexOf("."),r="";if(e>=0&&(r=n.substring(e+1),n=n.substring(0,e)),n)return arguments.length<2?this[n].on(r):this[n].on(r,t);if(2===arguments.length){if(null==t)for(n in this)this.hasOwnProperty(n)&&this[n].on(r,null);return this}},$o.event=null,$o.requote=function(n){return n.replace(fa,"\\$&")};var fa=/[\\\^\$\*\+\?\|\[\]\(\)\.\{\}]/g,ha={}.__proto__?function(n,t){n.__proto__=t}:function(n,t){for(var e in t)n[e]=t[e]},ga=function(n,t){return t.querySelector(n)},pa=function(n,t){return t.querySelectorAll(n)},va=Go[a(Go,"matchesSelector")],da=function(n,t){return va.call(n,t)};"function"==typeof Sizzle&&(ga=function(n,t){return Sizzle(n,t)[0]||null},pa=function(n,t){return Sizzle.uniqueSort(Sizzle(n,t))},da=Sizzle.matchesSelector),$o.selection=function(){return Ma};var ma=$o.selection.prototype=[];ma.select=function(n){var t,e,r,u,i=[];n=v(n);for(var o=-1,a=this.length;++o<a;){i.push(t=[]),t.parentNode=(r=this[o]).parentNode;for(var c=-1,s=r.length;++c<s;)(u=r[c])?(t.push(e=n.call(u,u.__data__,c,o)),e&&"__data__"in u&&(e.__data__=u.__data__)):t.push(null)}return p(i)},ma.selectAll=function(n){var t,e,r=[];n=d(n);for(var u=-1,i=this.length;++u<i;)for(var o=this[u],a=-1,c=o.length;++a<c;)(e=o[a])&&(r.push(t=Wo(n.call(e,e.__data__,a,u))),t.parentNode=e);return p(r)};var ya={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};$o.ns={prefix:ya,qualify:function(n){var t=n.indexOf(":"),e=n;return t>=0&&(e=n.substring(0,t),n=n.substring(t+1)),ya.hasOwnProperty(e)?{space:ya[e],local:n}:n}},ma.attr=function(n,t){if(arguments.length<2){if("string"==typeof n){var e=this.node();return n=$o.ns.qualify(n),n.local?e.getAttributeNS(n.space,n.local):e.getAttribute(n)}for(t in n)this.each(m(t,n[t]));return this}return this.each(m(n,t))},ma.classed=function(n,t){if(arguments.length<2){if("string"==typeof n){var e=this.node(),r=(n=n.trim().split(/^|\s+/g)).length,u=-1;if(t=e.classList){for(;++u<r;)if(!t.contains(n[u]))return!1}else for(t=e.getAttribute("class");++u<r;)if(!x(n[u]).test(t))return!1;return!0}for(t in n)this.each(M(t,n[t]));return this}return this.each(M(n,t))},ma.style=function(n,t,e){var r=arguments.length;if(3>r){if("string"!=typeof n){2>r&&(t="");for(e in n)this.each(b(e,n[e],t));return this}if(2>r)return Ko.getComputedStyle(this.node(),null).getPropertyValue(n);e=""}return this.each(b(n,t,e))},ma.property=function(n,t){if(arguments.length<2){if("string"==typeof n)return this.node()[n];for(t in n)this.each(w(t,n[t]));return this}return this.each(w(n,t))},ma.text=function(n){return arguments.length?this.each("function"==typeof n?function(){var t=n.apply(this,arguments);this.textContent=null==t?"":t}:null==n?function(){this.textContent=""}:function(){this.textContent=n}):this.node().textContent},ma.html=function(n){return arguments.length?this.each("function"==typeof n?function(){var t=n.apply(this,arguments);this.innerHTML=null==t?"":t}:null==n?function(){this.innerHTML=""}:function(){this.innerHTML=n}):this.node().innerHTML},ma.append=function(n){return n=S(n),this.select(function(){return this.appendChild(n.apply(this,arguments))})},ma.insert=function(n,t){return n=S(n),t=v(t),this.select(function(){return this.insertBefore(n.apply(this,arguments),t.apply(this,arguments)||null)})},ma.remove=function(){return this.each(function(){var n=this.parentNode;n&&n.removeChild(this)})},ma.data=function(n,t){function e(n,e){var r,i,o,a=n.length,f=e.length,h=Math.min(a,f),g=new Array(f),p=new Array(f),v=new Array(a);if(t){var d,m=new u,y=new u,x=[];for(r=-1;++r<a;)d=t.call(i=n[r],i.__data__,r),m.has(d)?v[r]=i:m.set(d,i),x.push(d);for(r=-1;++r<f;)d=t.call(e,o=e[r],r),(i=m.get(d))?(g[r]=i,i.__data__=o):y.has(d)||(p[r]=k(o)),y.set(d,o),m.remove(d);for(r=-1;++r<a;)m.has(x[r])&&(v[r]=n[r])}else{for(r=-1;++r<h;)i=n[r],o=e[r],i?(i.__data__=o,g[r]=i):p[r]=k(o);for(;f>r;++r)p[r]=k(e[r]);for(;a>r;++r)v[r]=n[r]}p.update=g,p.parentNode=g.parentNode=v.parentNode=n.parentNode,c.push(p),s.push(g),l.push(v)}var r,i,o=-1,a=this.length;if(!arguments.length){for(n=new Array(a=(r=this[0]).length);++o<a;)(i=r[o])&&(n[o]=i.__data__);return n}var c=N([]),s=p([]),l=p([]);if("function"==typeof n)for(;++o<a;)e(r=this[o],n.call(r,r.parentNode.__data__,o));else for(;++o<a;)e(r=this[o],n);return s.enter=function(){return c},s.exit=function(){return l},s},ma.datum=function(n){return arguments.length?this.property("__data__",n):this.property("__data__")},ma.filter=function(n){var t,e,r,u=[];"function"!=typeof n&&(n=E(n));for(var i=0,o=this.length;o>i;i++){u.push(t=[]),t.parentNode=(e=this[i]).parentNode;for(var a=0,c=e.length;c>a;a++)(r=e[a])&&n.call(r,r.__data__,a,i)&&t.push(r)}return p(u)},ma.order=function(){for(var n=-1,t=this.length;++n<t;)for(var e,r=this[n],u=r.length-1,i=r[u];--u>=0;)(e=r[u])&&(i&&i!==e.nextSibling&&i.parentNode.insertBefore(e,i),i=e);return this},ma.sort=function(n){n=A.apply(this,arguments);for(var t=-1,e=this.length;++t<e;)this[t].sort(n);return this.order()},ma.each=function(n){return C(this,function(t,e,r){n.call(t,t.__data__,e,r)})},ma.call=function(n){var t=Wo(arguments);return n.apply(t[0]=this,t),this},ma.empty=function(){return!this.node()},ma.node=function(){for(var n=0,t=this.length;t>n;n++)for(var e=this[n],r=0,u=e.length;u>r;r++){var i=e[r];if(i)return i}return null},ma.size=function(){var n=0;return this.each(function(){++n}),n};var xa=[];$o.selection.enter=N,$o.selection.enter.prototype=xa,xa.append=ma.append,xa.empty=ma.empty,xa.node=ma.node,xa.call=ma.call,xa.size=ma.size,xa.select=function(n){for(var t,e,r,u,i,o=[],a=-1,c=this.length;++a<c;){r=(u=this[a]).update,o.push(t=[]),t.parentNode=u.parentNode;for(var s=-1,l=u.length;++s<l;)(i=u[s])?(t.push(r[s]=e=n.call(u.parentNode,i.__data__,s,a)),e.__data__=i.__data__):t.push(null)}return p(o)},xa.insert=function(n,t){return arguments.length<2&&(t=L(this)),ma.insert.call(this,n,t)},ma.transition=function(){for(var n,t,e=Ss||++Ns,r=[],u=ks||{time:Date.now(),ease:Hr,delay:0,duration:250},i=-1,o=this.length;++i<o;){r.push(n=[]);for(var a=this[i],c=-1,s=a.length;++c<s;)(t=a[c])&&uo(t,c,e,u),n.push(t)}return to(r,e)},ma.interrupt=function(){return this.each(T)},$o.select=function(n){var t=["string"==typeof n?ga(n,Jo):n];return t.parentNode=Go,p([t])},$o.selectAll=function(n){var t=Wo("string"==typeof n?pa(n,Jo):n);return t.parentNode=Go,p([t])};var Ma=$o.select(Go);ma.on=function(n,t,e){var r=arguments.length;if(3>r){if("string"!=typeof n){2>r&&(t=!1);for(e in n)this.each(q(e,n[e],t));return this}if(2>r)return(r=this.node()["__on"+n])&&r._;e=!1}return this.each(q(n,t,e))};var _a=$o.map({mouseenter:"mouseover",mouseleave:"mouseout"});_a.forEach(function(n){"on"+n in Jo&&_a.remove(n)});var ba="onselectstart"in Jo?null:a(Go.style,"userSelect"),wa=0;$o.mouse=function(n){return P(n,h())};var Sa=/WebKit/.test(Ko.navigator.userAgent)?-1:0;$o.touches=function(n,t){return arguments.length<2&&(t=h().touches),t?Wo(t).map(function(t){var e=P(n,t);return e.identifier=t.identifier,e}):[]},$o.behavior.drag=function(){function n(){this.on("mousedown.drag",o).on("touchstart.drag",a)}function t(){return $o.event.changedTouches[0].identifier}function e(n,t){return $o.touches(n).filter(function(n){return n.identifier===t})[0]}function r(n,t,e,r){return function(){function o(){var n=t(l,g),e=n[0]-v[0],r=n[1]-v[1];d|=e|r,v=n,f({type:"drag",x:n[0]+c[0],y:n[1]+c[1],dx:e,dy:r})}function a(){m.on(e+"."+p,null).on(r+"."+p,null),y(d&&$o.event.target===h),f({type:"dragend"})}var c,s=this,l=s.parentNode,f=u.of(s,arguments),h=$o.event.target,g=n(),p=null==g?"drag":"drag-"+g,v=t(l,g),d=0,m=$o.select(Ko).on(e+"."+p,o).on(r+"."+p,a),y=D();i?(c=i.apply(s,arguments),c=[c.x-v[0],c.y-v[1]]):c=[0,0],f({type:"dragstart"})}}var u=g(n,"drag","dragstart","dragend"),i=null,o=r(c,$o.mouse,"mousemove","mouseup"),a=r(t,e,"touchmove","touchend");return n.origin=function(t){return arguments.length?(i=t,n):i},$o.rebind(n,u,"on")};var ka=Math.PI,Ea=2*ka,Aa=ka/2,Ca=1e-6,Na=Ca*Ca,La=ka/180,Ta=180/ka,qa=Math.SQRT2,za=2,Ra=4;$o.interpolateZoom=function(n,t){function e(n){var t=n*y;if(m){var e=O(v),o=i/(za*h)*(e*Y(qa*t+v)-F(v));return[r+o*s,u+o*l,i*e/O(qa*t+v)]}return[r+n*s,u+n*l,i*Math.exp(qa*t)]}var r=n[0],u=n[1],i=n[2],o=t[0],a=t[1],c=t[2],s=o-r,l=a-u,f=s*s+l*l,h=Math.sqrt(f),g=(c*c-i*i+Ra*f)/(2*i*za*h),p=(c*c-i*i-Ra*f)/(2*c*za*h),v=Math.log(Math.sqrt(g*g+1)-g),d=Math.log(Math.sqrt(p*p+1)-p),m=d-v,y=(m||Math.log(c/i))/qa;return e.duration=1e3*y,e},$o.behavior.zoom=function(){function n(n){n.on(A,s).on(Ua+".zoom",h).on(C,p).on("dblclick.zoom",v).on(L,l)}function t(n){return[(n[0]-S.x)/S.k,(n[1]-S.y)/S.k]}function e(n){return[n[0]*S.k+S.x,n[1]*S.k+S.y]}function r(n){S.k=Math.max(E[0],Math.min(E[1],n))}function u(n,t){t=e(t),S.x+=n[0]-t[0],S.y+=n[1]-t[1]}function i(){_&&_.domain(M.range().map(function(n){return(n-S.x)/S.k}).map(M.invert)),w&&w.domain(b.range().map(function(n){return(n-S.y)/S.k}).map(b.invert))}function o(n){n({type:"zoomstart"})}function a(n){i(),n({type:"zoom",scale:S.k,translate:[S.x,S.y]})}function c(n){n({type:"zoomend"})}function s(){function n(){l=1,u($o.mouse(r),h),a(i)}function e(){f.on(C,Ko===r?p:null).on(N,null),g(l&&$o.event.target===s),c(i)}var r=this,i=q.of(r,arguments),s=$o.event.target,l=0,f=$o.select(Ko).on(C,n).on(N,e),h=t($o.mouse(r)),g=D();T.call(r),o(i)}function l(){function n(){var n=$o.touches(p);return g=S.k,n.forEach(function(n){n.identifier in d&&(d[n.identifier]=t(n))}),n}function e(){for(var t=$o.event.changedTouches,e=0,i=t.length;i>e;++e)d[t[e].identifier]=null;var o=n(),c=Date.now();if(1===o.length){if(500>c-x){var s=o[0],l=d[s.identifier];r(2*S.k),u(s,l),f(),a(v)}x=c}else if(o.length>1){var s=o[0],h=o[1],g=s[0]-h[0],p=s[1]-h[1];m=g*g+p*p}}function i(){for(var n,t,e,i,o=$o.touches(p),c=0,s=o.length;s>c;++c,i=null)if(e=o[c],i=d[e.identifier]){if(t)break;n=e,t=i}if(i){var l=(l=e[0]-n[0])*l+(l=e[1]-n[1])*l,f=m&&Math.sqrt(l/m);n=[(n[0]+e[0])/2,(n[1]+e[1])/2],t=[(t[0]+i[0])/2,(t[1]+i[1])/2],r(f*g)}x=null,u(n,t),a(v)}function h(){if($o.event.touches.length){for(var t=$o.event.changedTouches,e=0,r=t.length;r>e;++e)delete d[t[e].identifier];for(var u in d)return void n()}b.on(M,null).on(_,null),w.on(A,s).on(L,l),k(),c(v)}var g,p=this,v=q.of(p,arguments),d={},m=0,y=$o.event.changedTouches[0].identifier,M="touchmove.zoom-"+y,_="touchend.zoom-"+y,b=$o.select(Ko).on(M,i).on(_,h),w=$o.select(p).on(A,null).on(L,e),k=D();T.call(p),e(),o(v)}function h(){var n=q.of(this,arguments);y?clearTimeout(y):(T.call(this),o(n)),y=setTimeout(function(){y=null,c(n)},50),f();var e=m||$o.mouse(this);d||(d=t(e)),r(Math.pow(2,.002*Da())*S.k),u(e,d),a(n)}function p(){d=null}function v(){var n=q.of(this,arguments),e=$o.mouse(this),i=t(e),s=Math.log(S.k)/Math.LN2;o(n),r(Math.pow(2,$o.event.shiftKey?Math.ceil(s)-1:Math.floor(s)+1)),u(e,i),a(n),c(n)}var d,m,y,x,M,_,b,w,S={x:0,y:0,k:1},k=[960,500],E=Pa,A="mousedown.zoom",C="mousemove.zoom",N="mouseup.zoom",L="touchstart.zoom",q=g(n,"zoomstart","zoom","zoomend");return n.event=function(n){n.each(function(){var n=q.of(this,arguments),t=S;Ss?$o.select(this).transition().each("start.zoom",function(){S=this.__chart__||{x:0,y:0,k:1},o(n)}).tween("zoom:zoom",function(){var e=k[0],r=k[1],u=e/2,i=r/2,o=$o.interpolateZoom([(u-S.x)/S.k,(i-S.y)/S.k,e/S.k],[(u-t.x)/t.k,(i-t.y)/t.k,e/t.k]);return function(t){var r=o(t),c=e/r[2];this.__chart__=S={x:u-r[0]*c,y:i-r[1]*c,k:c},a(n)}}).each("end.zoom",function(){c(n)}):(this.__chart__=S,o(n),a(n),c(n))})},n.translate=function(t){return arguments.length?(S={x:+t[0],y:+t[1],k:S.k},i(),n):[S.x,S.y]},n.scale=function(t){return arguments.length?(S={x:S.x,y:S.y,k:+t},i(),n):S.k},n.scaleExtent=function(t){return arguments.length?(E=null==t?Pa:[+t[0],+t[1]],n):E},n.center=function(t){return arguments.length?(m=t&&[+t[0],+t[1]],n):m},n.size=function(t){return arguments.length?(k=t&&[+t[0],+t[1]],n):k},n.x=function(t){return arguments.length?(_=t,M=t.copy(),S={x:0,y:0,k:1},n):_},n.y=function(t){return arguments.length?(w=t,b=t.copy(),S={x:0,y:0,k:1},n):w},$o.rebind(n,q,"on")};var Da,Pa=[0,1/0],Ua="onwheel"in Jo?(Da=function(){return-$o.event.deltaY*($o.event.deltaMode?120:1)},"wheel"):"onmousewheel"in Jo?(Da=function(){return $o.event.wheelDelta},"mousewheel"):(Da=function(){return-$o.event.detail},"MozMousePixelScroll");Z.prototype.toString=function(){return this.rgb()+""},$o.hsl=function(n,t,e){return 1===arguments.length?n instanceof X?V(n.h,n.s,n.l):st(""+n,lt,V):V(+n,+t,+e)};var ja=X.prototype=new Z;ja.brighter=function(n){return n=Math.pow(.7,arguments.length?n:1),V(this.h,this.s,this.l/n)},ja.darker=function(n){return n=Math.pow(.7,arguments.length?n:1),V(this.h,this.s,n*this.l)},ja.rgb=function(){return $(this.h,this.s,this.l)},$o.hcl=function(n,t,e){return 1===arguments.length?n instanceof W?B(n.h,n.c,n.l):n instanceof K?nt(n.l,n.a,n.b):nt((n=ft((n=$o.rgb(n)).r,n.g,n.b)).l,n.a,n.b):B(+n,+t,+e)};var Ha=W.prototype=new Z;Ha.brighter=function(n){return B(this.h,this.c,Math.min(100,this.l+Fa*(arguments.length?n:1)))},Ha.darker=function(n){return B(this.h,this.c,Math.max(0,this.l-Fa*(arguments.length?n:1)))},Ha.rgb=function(){return J(this.h,this.c,this.l).rgb()},$o.lab=function(n,t,e){return 1===arguments.length?n instanceof K?G(n.l,n.a,n.b):n instanceof W?J(n.l,n.c,n.h):ft((n=$o.rgb(n)).r,n.g,n.b):G(+n,+t,+e)};var Fa=18,Oa=.95047,Ya=1,Ia=1.08883,Za=K.prototype=new Z;Za.brighter=function(n){return G(Math.min(100,this.l+Fa*(arguments.length?n:1)),this.a,this.b)},Za.darker=function(n){return G(Math.max(0,this.l-Fa*(arguments.length?n:1)),this.a,this.b)},Za.rgb=function(){return Q(this.l,this.a,this.b)},$o.rgb=function(n,t,e){return 1===arguments.length?n instanceof at?ot(n.r,n.g,n.b):st(""+n,ot,$):ot(~~n,~~t,~~e)};var Va=at.prototype=new Z;Va.brighter=function(n){n=Math.pow(.7,arguments.length?n:1);var t=this.r,e=this.g,r=this.b,u=30;return t||e||r?(t&&u>t&&(t=u),e&&u>e&&(e=u),r&&u>r&&(r=u),ot(Math.min(255,~~(t/n)),Math.min(255,~~(e/n)),Math.min(255,~~(r/n)))):ot(u,u,u)},Va.darker=function(n){return n=Math.pow(.7,arguments.length?n:1),ot(~~(n*this.r),~~(n*this.g),~~(n*this.b))},Va.hsl=function(){return lt(this.r,this.g,this.b)},Va.toString=function(){return"#"+ct(this.r)+ct(this.g)+ct(this.b)};var Xa=$o.map({aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074});Xa.forEach(function(n,t){Xa.set(n,ut(t))}),$o.functor=pt,$o.xhr=dt(vt),$o.dsv=function(n,t){function e(n,e,i){arguments.length<3&&(i=e,e=null);var o=$o.xhr(n,t,i);return o.row=function(n){return arguments.length?o.response(null==(e=n)?r:u(n)):e},o.row(e)}function r(n){return e.parse(n.responseText)}function u(n){return function(t){return e.parse(t.responseText,n)}}function o(t){return t.map(a).join(n)}function a(n){return c.test(n)?'"'+n.replace(/\"/g,'""')+'"':n}var c=new RegExp('["'+n+"\n]"),s=n.charCodeAt(0);return e.parse=function(n,t){var r;return e.parseRows(n,function(n,e){if(r)return r(n,e-1);var u=new Function("d","return {"+n.map(function(n,t){return JSON.stringify(n)+": d["+t+"]"}).join(",")+"}");r=t?function(n,e){return t(u(n),e)}:u})},e.parseRows=function(n,t){function e(){if(l>=c)return o;if(u)return u=!1,i;var t=l;if(34===n.charCodeAt(t)){for(var e=t;e++<c;)if(34===n.charCodeAt(e)){if(34!==n.charCodeAt(e+1))break;++e}l=e+2;var r=n.charCodeAt(e+1);return 13===r?(u=!0,10===n.charCodeAt(e+2)&&++l):10===r&&(u=!0),n.substring(t+1,e).replace(/""/g,'"')}for(;c>l;){var r=n.charCodeAt(l++),a=1;if(10===r)u=!0;else if(13===r)u=!0,10===n.charCodeAt(l)&&(++l,++a);else if(r!==s)continue;return n.substring(t,l-a)}return n.substring(t)}for(var r,u,i={},o={},a=[],c=n.length,l=0,f=0;(r=e())!==o;){for(var h=[];r!==i&&r!==o;)h.push(r),r=e();(!t||(h=t(h,f++)))&&a.push(h)}return a},e.format=function(t){if(Array.isArray(t[0]))return e.formatRows(t);var r=new i,u=[];return t.forEach(function(n){for(var t in n)r.has(t)||u.push(r.add(t))}),[u.map(a).join(n)].concat(t.map(function(t){return u.map(function(n){return a(t[n])}).join(n)})).join("\n")},e.formatRows=function(n){return n.map(o).join("\n")},e},$o.csv=$o.dsv(",","text/csv"),$o.tsv=$o.dsv("	","text/tab-separated-values");var $a,Ba,Wa,Ja,Ga,Ka=Ko[a(Ko,"requestAnimationFrame")]||function(n){setTimeout(n,17)};$o.timer=function(n,t,e){var r=arguments.length;2>r&&(t=0),3>r&&(e=Date.now());var u=e+t,i={c:n,t:u,f:!1,n:null};Ba?Ba.n=i:$a=i,Ba=i,Wa||(Ja=clearTimeout(Ja),Wa=1,Ka(xt))},$o.timer.flush=function(){Mt(),_t()};var Qa=".",nc=",",tc=[3,3],ec="$",rc=["y","z","a","f","p","n","\xb5","m","","k","M","G","T","P","E","Z","Y"].map(bt);$o.formatPrefix=function(n,t){var e=0;return n&&(0>n&&(n*=-1),t&&(n=$o.round(n,wt(n,t))),e=1+Math.floor(1e-12+Math.log(n)/Math.LN10),e=Math.max(-24,Math.min(24,3*Math.floor((0>=e?e+1:e-1)/3)))),rc[8+e/3]},$o.round=function(n,t){return t?Math.round(n*(t=Math.pow(10,t)))/t:Math.round(n)},$o.format=function(n){var t=uc.exec(n),e=t[1]||" ",r=t[2]||">",u=t[3]||"",i=t[4]||"",o=t[5],a=+t[6],c=t[7],s=t[8],l=t[9],f=1,h="",g=!1;switch(s&&(s=+s.substring(1)),(o||"0"===e&&"="===r)&&(o=e="0",r="=",c&&(a-=Math.floor((a-1)/4))),l){case"n":c=!0,l="g";break;case"%":f=100,h="%",l="f";break;case"p":f=100,h="%",l="r";break;case"b":case"o":case"x":case"X":"#"===i&&(i="0"+l.toLowerCase());case"c":case"d":g=!0,s=0;break;case"s":f=-1,l="r"}"#"===i?i="":"$"===i&&(i=ec),"r"!=l||s||(l="g"),null!=s&&("g"==l?s=Math.max(1,Math.min(21,s)):("e"==l||"f"==l)&&(s=Math.max(0,Math.min(20,s)))),l=ic.get(l)||St;var p=o&&c;return function(n){if(g&&n%1)return"";var t=0>n||0===n&&0>1/n?(n=-n,"-"):u;if(0>f){var v=$o.formatPrefix(n,s);n=v.scale(n),h=v.symbol}else n*=f;n=l(n,s);var d=n.lastIndexOf("."),m=0>d?n:n.substring(0,d),y=0>d?"":Qa+n.substring(d+1);!o&&c&&(m=oc(m));var x=i.length+m.length+y.length+(p?0:t.length),M=a>x?new Array(x=a-x+1).join(e):"";return p&&(m=oc(M+m)),t+=i,n=m+y,("<"===r?t+n+M:">"===r?M+t+n:"^"===r?M.substring(0,x>>=1)+t+n+M.substring(x):t+(p?n:M+n))+h}};var uc=/(?:([^{])?([<>=^]))?([+\- ])?([$#])?(0)?(\d+)?(,)?(\.-?\d+)?([a-z%])?/i,ic=$o.map({b:function(n){return n.toString(2)},c:function(n){return String.fromCharCode(n)},o:function(n){return n.toString(8)},x:function(n){return n.toString(16)},X:function(n){return n.toString(16).toUpperCase()},g:function(n,t){return n.toPrecision(t)},e:function(n,t){return n.toExponential(t)},f:function(n,t){return n.toFixed(t)},r:function(n,t){return(n=$o.round(n,wt(n,t))).toFixed(Math.max(0,Math.min(20,wt(n*(1+1e-15),t))))}}),oc=vt;if(tc){var ac=tc.length;oc=function(n){for(var t=n.length,e=[],r=0,u=tc[0];t>0&&u>0;)e.push(n.substring(t-=u,t+u)),u=tc[r=(r+1)%ac];return e.reverse().join(nc)}}$o.geo={},kt.prototype={s:0,t:0,add:function(n){Et(n,this.t,cc),Et(cc.s,this.s,this),this.s?this.t+=cc.t:this.s=cc.t},reset:function(){this.s=this.t=0},valueOf:function(){return this.s}};var cc=new kt;$o.geo.stream=function(n,t){n&&sc.hasOwnProperty(n.type)?sc[n.type](n,t):At(n,t)};var sc={Feature:function(n,t){At(n.geometry,t)},FeatureCollection:function(n,t){for(var e=n.features,r=-1,u=e.length;++r<u;)At(e[r].geometry,t)}},lc={Sphere:function(n,t){t.sphere()},Point:function(n,t){n=n.coordinates,t.point(n[0],n[1],n[2])},MultiPoint:function(n,t){for(var e=n.coordinates,r=-1,u=e.length;++r<u;)n=e[r],t.point(n[0],n[1],n[2])},LineString:function(n,t){Ct(n.coordinates,t,0)},MultiLineString:function(n,t){for(var e=n.coordinates,r=-1,u=e.length;++r<u;)Ct(e[r],t,0)},Polygon:function(n,t){Nt(n.coordinates,t)},MultiPolygon:function(n,t){for(var e=n.coordinates,r=-1,u=e.length;++r<u;)Nt(e[r],t)},GeometryCollection:function(n,t){for(var e=n.geometries,r=-1,u=e.length;++r<u;)At(e[r],t)}};$o.geo.area=function(n){return fc=0,$o.geo.stream(n,gc),fc};var fc,hc=new kt,gc={sphere:function(){fc+=4*ka},point:c,lineStart:c,lineEnd:c,polygonStart:function(){hc.reset(),gc.lineStart=Lt},polygonEnd:function(){var n=2*hc;fc+=0>n?4*ka+n:n,gc.lineStart=gc.lineEnd=gc.point=c}};$o.geo.bounds=function(){function n(n,t){x.push(M=[l=n,h=n]),f>t&&(f=t),t>g&&(g=t)}function t(t,e){var r=Tt([t*La,e*La]);if(m){var u=zt(m,r),i=[u[1],-u[0],0],o=zt(i,u);Pt(o),o=Ut(o);var c=t-p,s=c>0?1:-1,v=o[0]*Ta*s,d=aa(c)>180;if(d^(v>s*p&&s*t>v)){var y=o[1]*Ta;y>g&&(g=y)}else if(v=(v+360)%360-180,d^(v>s*p&&s*t>v)){var y=-o[1]*Ta;f>y&&(f=y)}else f>e&&(f=e),e>g&&(g=e);d?p>t?a(l,t)>a(l,h)&&(h=t):a(t,h)>a(l,h)&&(l=t):h>=l?(l>t&&(l=t),t>h&&(h=t)):t>p?a(l,t)>a(l,h)&&(h=t):a(t,h)>a(l,h)&&(l=t)}else n(t,e);m=r,p=t}function e(){_.point=t}function r(){M[0]=l,M[1]=h,_.point=n,m=null}function u(n,e){if(m){var r=n-p;y+=aa(r)>180?r+(r>0?360:-360):r}else v=n,d=e;gc.point(n,e),t(n,e)}function i(){gc.lineStart()}function o(){u(v,d),gc.lineEnd(),aa(y)>Ca&&(l=-(h=180)),M[0]=l,M[1]=h,m=null}function a(n,t){return(t-=n)<0?t+360:t}function c(n,t){return n[0]-t[0]}function s(n,t){return t[0]<=t[1]?t[0]<=n&&n<=t[1]:n<t[0]||t[1]<n}var l,f,h,g,p,v,d,m,y,x,M,_={point:n,lineStart:e,lineEnd:r,polygonStart:function(){_.point=u,_.lineStart=i,_.lineEnd=o,y=0,gc.polygonStart()},polygonEnd:function(){gc.polygonEnd(),_.point=n,_.lineStart=e,_.lineEnd=r,0>hc?(l=-(h=180),f=-(g=90)):y>Ca?g=90:-Ca>y&&(f=-90),M[0]=l,M[1]=h}};return function(n){g=h=-(l=f=1/0),x=[],$o.geo.stream(n,_);var t=x.length;if(t){x.sort(c);for(var e,r=1,u=x[0],i=[u];t>r;++r)e=x[r],s(e[0],u)||s(e[1],u)?(a(u[0],e[1])>a(u[0],u[1])&&(u[1]=e[1]),a(e[0],u[1])>a(u[0],u[1])&&(u[0]=e[0])):i.push(u=e);for(var o,e,p=-1/0,t=i.length-1,r=0,u=i[t];t>=r;u=e,++r)e=i[r],(o=a(u[1],e[0]))>p&&(p=o,l=e[0],h=u[1])}return x=M=null,1/0===l||1/0===f?[[0/0,0/0],[0/0,0/0]]:[[l,f],[h,g]]}}(),$o.geo.centroid=function(n){pc=vc=dc=mc=yc=xc=Mc=_c=bc=wc=Sc=0,$o.geo.stream(n,kc);var t=bc,e=wc,r=Sc,u=t*t+e*e+r*r;return Na>u&&(t=xc,e=Mc,r=_c,Ca>vc&&(t=dc,e=mc,r=yc),u=t*t+e*e+r*r,Na>u)?[0/0,0/0]:[Math.atan2(e,t)*Ta,H(r/Math.sqrt(u))*Ta]};var pc,vc,dc,mc,yc,xc,Mc,_c,bc,wc,Sc,kc={sphere:c,point:Ht,lineStart:Ot,lineEnd:Yt,polygonStart:function(){kc.lineStart=It},polygonEnd:function(){kc.lineStart=Ot}},Ec=Bt(Zt,Qt,te,[-ka,-ka/2]),Ac=1e9;$o.geo.clipExtent=function(){var n,t,e,r,u,i,o={stream:function(n){return u&&(u.valid=!1),u=i(n),u.valid=!0,u},extent:function(a){return arguments.length?(i=ue(n=+a[0][0],t=+a[0][1],e=+a[1][0],r=+a[1][1]),u&&(u.valid=!1,u=null),o):[[n,t],[e,r]]}};return o.extent([[0,0],[960,500]])},($o.geo.conicEqualArea=function(){return oe(ae)}).raw=ae,$o.geo.albers=function(){return $o.geo.conicEqualArea().rotate([96,0]).center([-.6,38.7]).parallels([29.5,45.5]).scale(1070)},$o.geo.albersUsa=function(){function n(n){var i=n[0],o=n[1];return t=null,e(i,o),t||(r(i,o),t)||u(i,o),t}var t,e,r,u,i=$o.geo.albers(),o=$o.geo.conicEqualArea().rotate([154,0]).center([-2,58.5]).parallels([55,65]),a=$o.geo.conicEqualArea().rotate([157,0]).center([-3,19.9]).parallels([8,18]),c={point:function(n,e){t=[n,e]}};return n.invert=function(n){var t=i.scale(),e=i.translate(),r=(n[0]-e[0])/t,u=(n[1]-e[1])/t;return(u>=.12&&.234>u&&r>=-.425&&-.214>r?o:u>=.166&&.234>u&&r>=-.214&&-.115>r?a:i).invert(n)},n.stream=function(n){var t=i.stream(n),e=o.stream(n),r=a.stream(n);return{point:function(n,u){t.point(n,u),e.point(n,u),r.point(n,u)},sphere:function(){t.sphere(),e.sphere(),r.sphere()},lineStart:function(){t.lineStart(),e.lineStart(),r.lineStart()},lineEnd:function(){t.lineEnd(),e.lineEnd(),r.lineEnd()},polygonStart:function(){t.polygonStart(),e.polygonStart(),r.polygonStart()},polygonEnd:function(){t.polygonEnd(),e.polygonEnd(),r.polygonEnd()}}},n.precision=function(t){return arguments.length?(i.precision(t),o.precision(t),a.precision(t),n):i.precision()},n.scale=function(t){return arguments.length?(i.scale(t),o.scale(.35*t),a.scale(t),n.translate(i.translate())):i.scale()},n.translate=function(t){if(!arguments.length)return i.translate();var s=i.scale(),l=+t[0],f=+t[1];return e=i.translate(t).clipExtent([[l-.455*s,f-.238*s],[l+.455*s,f+.238*s]]).stream(c).point,r=o.translate([l-.307*s,f+.201*s]).clipExtent([[l-.425*s+Ca,f+.12*s+Ca],[l-.214*s-Ca,f+.234*s-Ca]]).stream(c).point,u=a.translate([l-.205*s,f+.212*s]).clipExtent([[l-.214*s+Ca,f+.166*s+Ca],[l-.115*s-Ca,f+.234*s-Ca]]).stream(c).point,n},n.scale(1070)};var Cc,Nc,Lc,Tc,qc,zc,Rc={point:c,lineStart:c,lineEnd:c,polygonStart:function(){Nc=0,Rc.lineStart=ce},polygonEnd:function(){Rc.lineStart=Rc.lineEnd=Rc.point=c,Cc+=aa(Nc/2)}},Dc={point:se,lineStart:c,lineEnd:c,polygonStart:c,polygonEnd:c},Pc={point:he,lineStart:ge,lineEnd:pe,polygonStart:function(){Pc.lineStart=ve},polygonEnd:function(){Pc.point=he,Pc.lineStart=ge,Pc.lineEnd=pe}};$o.geo.path=function(){function n(n){return n&&("function"==typeof a&&i.pointRadius(+a.apply(this,arguments)),o&&o.valid||(o=u(i)),$o.geo.stream(n,o)),i.result()}function t(){return o=null,n}var e,r,u,i,o,a=4.5;return n.area=function(n){return Cc=0,$o.geo.stream(n,u(Rc)),Cc},n.centroid=function(n){return dc=mc=yc=xc=Mc=_c=bc=wc=Sc=0,$o.geo.stream(n,u(Pc)),Sc?[bc/Sc,wc/Sc]:_c?[xc/_c,Mc/_c]:yc?[dc/yc,mc/yc]:[0/0,0/0]},n.bounds=function(n){return qc=zc=-(Lc=Tc=1/0),$o.geo.stream(n,u(Dc)),[[Lc,Tc],[qc,zc]]},n.projection=function(n){return arguments.length?(u=(e=n)?n.stream||ye(n):vt,t()):e},n.context=function(n){return arguments.length?(i=null==(r=n)?new le:new de(n),"function"!=typeof a&&i.pointRadius(a),t()):r},n.pointRadius=function(t){return arguments.length?(a="function"==typeof t?t:(i.pointRadius(+t),+t),n):a},n.projection($o.geo.albersUsa()).context(null)},$o.geo.transform=function(n){return{stream:function(t){var e=new xe(t);for(var r in n)e[r]=n[r];return e}}},xe.prototype={point:function(n,t){this.stream.point(n,t)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()
},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}},$o.geo.projection=_e,$o.geo.projectionMutator=be,($o.geo.equirectangular=function(){return _e(Se)}).raw=Se.invert=Se,$o.geo.rotation=function(n){function t(t){return t=n(t[0]*La,t[1]*La),t[0]*=Ta,t[1]*=Ta,t}return n=Ee(n[0]%360*La,n[1]*La,n.length>2?n[2]*La:0),t.invert=function(t){return t=n.invert(t[0]*La,t[1]*La),t[0]*=Ta,t[1]*=Ta,t},t},ke.invert=Se,$o.geo.circle=function(){function n(){var n="function"==typeof r?r.apply(this,arguments):r,t=Ee(-n[0]*La,-n[1]*La,0).invert,u=[];return e(null,null,1,{point:function(n,e){u.push(n=t(n,e)),n[0]*=Ta,n[1]*=Ta}}),{type:"Polygon",coordinates:[u]}}var t,e,r=[0,0],u=6;return n.origin=function(t){return arguments.length?(r=t,n):r},n.angle=function(r){return arguments.length?(e=Le((t=+r)*La,u*La),n):t},n.precision=function(r){return arguments.length?(e=Le(t*La,(u=+r)*La),n):u},n.angle(90)},$o.geo.distance=function(n,t){var e,r=(t[0]-n[0])*La,u=n[1]*La,i=t[1]*La,o=Math.sin(r),a=Math.cos(r),c=Math.sin(u),s=Math.cos(u),l=Math.sin(i),f=Math.cos(i);return Math.atan2(Math.sqrt((e=f*o)*e+(e=s*l-c*f*a)*e),c*l+s*f*a)},$o.geo.graticule=function(){function n(){return{type:"MultiLineString",coordinates:t()}}function t(){return $o.range(Math.ceil(i/d)*d,u,d).map(h).concat($o.range(Math.ceil(s/m)*m,c,m).map(g)).concat($o.range(Math.ceil(r/p)*p,e,p).filter(function(n){return aa(n%d)>Ca}).map(l)).concat($o.range(Math.ceil(a/v)*v,o,v).filter(function(n){return aa(n%m)>Ca}).map(f))}var e,r,u,i,o,a,c,s,l,f,h,g,p=10,v=p,d=90,m=360,y=2.5;return n.lines=function(){return t().map(function(n){return{type:"LineString",coordinates:n}})},n.outline=function(){return{type:"Polygon",coordinates:[h(i).concat(g(c).slice(1),h(u).reverse().slice(1),g(s).reverse().slice(1))]}},n.extent=function(t){return arguments.length?n.majorExtent(t).minorExtent(t):n.minorExtent()},n.majorExtent=function(t){return arguments.length?(i=+t[0][0],u=+t[1][0],s=+t[0][1],c=+t[1][1],i>u&&(t=i,i=u,u=t),s>c&&(t=s,s=c,c=t),n.precision(y)):[[i,s],[u,c]]},n.minorExtent=function(t){return arguments.length?(r=+t[0][0],e=+t[1][0],a=+t[0][1],o=+t[1][1],r>e&&(t=r,r=e,e=t),a>o&&(t=a,a=o,o=t),n.precision(y)):[[r,a],[e,o]]},n.step=function(t){return arguments.length?n.majorStep(t).minorStep(t):n.minorStep()},n.majorStep=function(t){return arguments.length?(d=+t[0],m=+t[1],n):[d,m]},n.minorStep=function(t){return arguments.length?(p=+t[0],v=+t[1],n):[p,v]},n.precision=function(t){return arguments.length?(y=+t,l=qe(a,o,90),f=ze(r,e,y),h=qe(s,c,90),g=ze(i,u,y),n):y},n.majorExtent([[-180,-90+Ca],[180,90-Ca]]).minorExtent([[-180,-80-Ca],[180,80+Ca]])},$o.geo.greatArc=function(){function n(){return{type:"LineString",coordinates:[t||r.apply(this,arguments),e||u.apply(this,arguments)]}}var t,e,r=Re,u=De;return n.distance=function(){return $o.geo.distance(t||r.apply(this,arguments),e||u.apply(this,arguments))},n.source=function(e){return arguments.length?(r=e,t="function"==typeof e?null:e,n):r},n.target=function(t){return arguments.length?(u=t,e="function"==typeof t?null:t,n):u},n.precision=function(){return arguments.length?n:0},n},$o.geo.interpolate=function(n,t){return Pe(n[0]*La,n[1]*La,t[0]*La,t[1]*La)},$o.geo.length=function(n){return Uc=0,$o.geo.stream(n,jc),Uc};var Uc,jc={sphere:c,point:c,lineStart:Ue,lineEnd:c,polygonStart:c,polygonEnd:c},Hc=je(function(n){return Math.sqrt(2/(1+n))},function(n){return 2*Math.asin(n/2)});($o.geo.azimuthalEqualArea=function(){return _e(Hc)}).raw=Hc;var Fc=je(function(n){var t=Math.acos(n);return t&&t/Math.sin(t)},vt);($o.geo.azimuthalEquidistant=function(){return _e(Fc)}).raw=Fc,($o.geo.conicConformal=function(){return oe(He)}).raw=He,($o.geo.conicEquidistant=function(){return oe(Fe)}).raw=Fe;var Oc=je(function(n){return 1/n},Math.atan);($o.geo.gnomonic=function(){return _e(Oc)}).raw=Oc,Oe.invert=function(n,t){return[n,2*Math.atan(Math.exp(t))-Aa]},($o.geo.mercator=function(){return Ye(Oe)}).raw=Oe;var Yc=je(function(){return 1},Math.asin);($o.geo.orthographic=function(){return _e(Yc)}).raw=Yc;var Ic=je(function(n){return 1/(1+n)},function(n){return 2*Math.atan(n)});($o.geo.stereographic=function(){return _e(Ic)}).raw=Ic,Ie.invert=function(n,t){return[Math.atan2(F(n),Math.cos(t)),H(Math.sin(t)/O(n))]},($o.geo.transverseMercator=function(){return Ye(Ie)}).raw=Ie,$o.geom={},$o.geom.hull=function(n){function t(n){if(n.length<3)return[];var t,u,i,o,a,c,s,l,f,h,g,p,v=pt(e),d=pt(r),m=n.length,y=m-1,x=[],M=[],_=0;if(v===Ze&&r===Ve)t=n;else for(i=0,t=[];m>i;++i)t.push([+v.call(this,u=n[i],i),+d.call(this,u,i)]);for(i=1;m>i;++i)(t[i][1]<t[_][1]||t[i][1]==t[_][1]&&t[i][0]<t[_][0])&&(_=i);for(i=0;m>i;++i)i!==_&&(c=t[i][1]-t[_][1],a=t[i][0]-t[_][0],x.push({angle:Math.atan2(c,a),index:i}));for(x.sort(function(n,t){return n.angle-t.angle}),g=x[0].angle,h=x[0].index,f=0,i=1;y>i;++i){if(o=x[i].index,g==x[i].angle){if(a=t[h][0]-t[_][0],c=t[h][1]-t[_][1],s=t[o][0]-t[_][0],l=t[o][1]-t[_][1],a*a+c*c>=s*s+l*l){x[i].index=-1;continue}x[f].index=-1}g=x[i].angle,f=i,h=o}for(M.push(_),i=0,o=0;2>i;++o)x[o].index>-1&&(M.push(x[o].index),i++);for(p=M.length;y>o;++o)if(!(x[o].index<0)){for(;!Xe(M[p-2],M[p-1],x[o].index,t);)--p;M[p++]=x[o].index}var b=[];for(i=p-1;i>=0;--i)b.push(n[M[i]]);return b}var e=Ze,r=Ve;return arguments.length?t(n):(t.x=function(n){return arguments.length?(e=n,t):e},t.y=function(n){return arguments.length?(r=n,t):r},t)},$o.geom.polygon=function(n){return ha(n,Zc),n};var Zc=$o.geom.polygon.prototype=[];Zc.area=function(){for(var n,t=-1,e=this.length,r=this[e-1],u=0;++t<e;)n=r,r=this[t],u+=n[1]*r[0]-n[0]*r[1];return.5*u},Zc.centroid=function(n){var t,e,r=-1,u=this.length,i=0,o=0,a=this[u-1];for(arguments.length||(n=-1/(6*this.area()));++r<u;)t=a,a=this[r],e=t[0]*a[1]-a[0]*t[1],i+=(t[0]+a[0])*e,o+=(t[1]+a[1])*e;return[i*n,o*n]},Zc.clip=function(n){for(var t,e,r,u,i,o,a=We(n),c=-1,s=this.length-We(this),l=this[s-1];++c<s;){for(t=n.slice(),n.length=0,u=this[c],i=t[(r=t.length-a)-1],e=-1;++e<r;)o=t[e],$e(o,l,u)?($e(i,l,u)||n.push(Be(i,o,l,u)),n.push(o)):$e(i,l,u)&&n.push(Be(i,o,l,u)),i=o;a&&n.push(n[0]),l=u}return n};var Vc,Xc,$c,Bc,Wc,Jc=[],Gc=[];rr.prototype.prepare=function(){for(var n,t=this.edges,e=t.length;e--;)n=t[e].edge,n.b&&n.a||t.splice(e,1);return t.sort(ir),t.length},vr.prototype={start:function(){return this.edge.l===this.site?this.edge.a:this.edge.b},end:function(){return this.edge.l===this.site?this.edge.b:this.edge.a}},dr.prototype={insert:function(n,t){var e,r,u;if(n){if(t.P=n,t.N=n.N,n.N&&(n.N.P=t),n.N=t,n.R){for(n=n.R;n.L;)n=n.L;n.L=t}else n.R=t;e=n}else this._?(n=Mr(this._),t.P=null,t.N=n,n.P=n.L=t,e=n):(t.P=t.N=null,this._=t,e=null);for(t.L=t.R=null,t.U=e,t.C=!0,n=t;e&&e.C;)r=e.U,e===r.L?(u=r.R,u&&u.C?(e.C=u.C=!1,r.C=!0,n=r):(n===e.R&&(yr(this,e),n=e,e=n.U),e.C=!1,r.C=!0,xr(this,r))):(u=r.L,u&&u.C?(e.C=u.C=!1,r.C=!0,n=r):(n===e.L&&(xr(this,e),n=e,e=n.U),e.C=!1,r.C=!0,yr(this,r))),e=n.U;this._.C=!1},remove:function(n){n.N&&(n.N.P=n.P),n.P&&(n.P.N=n.N),n.N=n.P=null;var t,e,r,u=n.U,i=n.L,o=n.R;if(e=i?o?Mr(o):i:o,u?u.L===n?u.L=e:u.R=e:this._=e,i&&o?(r=e.C,e.C=n.C,e.L=i,i.U=e,e!==o?(u=e.U,e.U=n.U,n=e.R,u.L=n,e.R=o,o.U=e):(e.U=u,u=e,n=e.R)):(r=n.C,n=e),n&&(n.U=u),!r){if(n&&n.C)return n.C=!1,void 0;do{if(n===this._)break;if(n===u.L){if(t=u.R,t.C&&(t.C=!1,u.C=!0,yr(this,u),t=u.R),t.L&&t.L.C||t.R&&t.R.C){t.R&&t.R.C||(t.L.C=!1,t.C=!0,xr(this,t),t=u.R),t.C=u.C,u.C=t.R.C=!1,yr(this,u),n=this._;break}}else if(t=u.L,t.C&&(t.C=!1,u.C=!0,xr(this,u),t=u.L),t.L&&t.L.C||t.R&&t.R.C){t.L&&t.L.C||(t.R.C=!1,t.C=!0,yr(this,t),t=u.L),t.C=u.C,u.C=t.L.C=!1,xr(this,u),n=this._;break}t.C=!0,n=u,u=u.U}while(!n.C);n&&(n.C=!1)}}},$o.geom.voronoi=function(n){function t(n){var t=new Array(n.length),r=a[0][0],u=a[0][1],i=a[1][0],o=a[1][1];return _r(e(n),a).cells.forEach(function(e,a){var c=e.edges,s=e.site,l=t[a]=c.length?c.map(function(n){var t=n.start();return[t.x,t.y]}):s.x>=r&&s.x<=i&&s.y>=u&&s.y<=o?[[r,o],[i,o],[i,u],[r,u]]:[];l.point=n[a]}),t}function e(n){return n.map(function(n,t){return{x:Math.round(i(n,t)/Ca)*Ca,y:Math.round(o(n,t)/Ca)*Ca,i:t}})}var r=Ze,u=Ve,i=r,o=u,a=Kc;return n?t(n):(t.links=function(n){return _r(e(n)).edges.filter(function(n){return n.l&&n.r}).map(function(t){return{source:n[t.l.i],target:n[t.r.i]}})},t.triangles=function(n){var t=[];return _r(e(n)).cells.forEach(function(e,r){for(var u,i,o=e.site,a=e.edges.sort(ir),c=-1,s=a.length,l=a[s-1].edge,f=l.l===o?l.r:l.l;++c<s;)u=l,i=f,l=a[c].edge,f=l.l===o?l.r:l.l,r<i.i&&r<f.i&&wr(o,i,f)<0&&t.push([n[r],n[i.i],n[f.i]])}),t},t.x=function(n){return arguments.length?(i=pt(r=n),t):r},t.y=function(n){return arguments.length?(o=pt(u=n),t):u},t.clipExtent=function(n){return arguments.length?(a=null==n?Kc:n,t):a===Kc?null:a},t.size=function(n){return arguments.length?t.clipExtent(n&&[[0,0],n]):a===Kc?null:a&&a[1]},t)};var Kc=[[-1e6,-1e6],[1e6,1e6]];$o.geom.delaunay=function(n){return $o.geom.voronoi().triangles(n)},$o.geom.quadtree=function(n,t,e,r,u){function i(n){function i(n,t,e,r,u,i,o,a){if(!isNaN(e)&&!isNaN(r))if(n.leaf){var c=n.x,l=n.y;if(null!=c)if(aa(c-e)+aa(l-r)<.01)s(n,t,e,r,u,i,o,a);else{var f=n.point;n.x=n.y=n.point=null,s(n,f,c,l,u,i,o,a),s(n,t,e,r,u,i,o,a)}else n.x=e,n.y=r,n.point=t}else s(n,t,e,r,u,i,o,a)}function s(n,t,e,r,u,o,a,c){var s=.5*(u+a),l=.5*(o+c),f=e>=s,h=r>=l,g=(h<<1)+f;n.leaf=!1,n=n.nodes[g]||(n.nodes[g]=Er()),f?u=s:a=s,h?o=l:c=l,i(n,t,e,r,u,o,a,c)}var l,f,h,g,p,v,d,m,y,x=pt(a),M=pt(c);if(null!=t)v=t,d=e,m=r,y=u;else if(m=y=-(v=d=1/0),f=[],h=[],p=n.length,o)for(g=0;p>g;++g)l=n[g],l.x<v&&(v=l.x),l.y<d&&(d=l.y),l.x>m&&(m=l.x),l.y>y&&(y=l.y),f.push(l.x),h.push(l.y);else for(g=0;p>g;++g){var _=+x(l=n[g],g),b=+M(l,g);v>_&&(v=_),d>b&&(d=b),_>m&&(m=_),b>y&&(y=b),f.push(_),h.push(b)}var w=m-v,S=y-d;w>S?y=d+w:m=v+S;var k=Er();if(k.add=function(n){i(k,n,+x(n,++g),+M(n,g),v,d,m,y)},k.visit=function(n){Ar(n,k,v,d,m,y)},g=-1,null==t){for(;++g<p;)i(k,n[g],f[g],h[g],v,d,m,y);--g}else n.forEach(k.add);return f=h=n=l=null,k}var o,a=Ze,c=Ve;return(o=arguments.length)?(a=Sr,c=kr,3===o&&(u=e,r=t,e=t=0),i(n)):(i.x=function(n){return arguments.length?(a=n,i):a},i.y=function(n){return arguments.length?(c=n,i):c},i.extent=function(n){return arguments.length?(null==n?t=e=r=u=null:(t=+n[0][0],e=+n[0][1],r=+n[1][0],u=+n[1][1]),i):null==t?null:[[t,e],[r,u]]},i.size=function(n){return arguments.length?(null==n?t=e=r=u=null:(t=e=0,r=+n[0],u=+n[1]),i):null==t?null:[r-t,u-e]},i)},$o.interpolateRgb=Cr,$o.interpolateObject=Nr,$o.interpolateNumber=Lr,$o.interpolateString=Tr;var Qc=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g;$o.interpolate=qr,$o.interpolators=[function(n,t){var e=typeof t;return("string"===e?Xa.has(t)||/^(#|rgb\(|hsl\()/.test(t)?Cr:Tr:t instanceof Z?Cr:"object"===e?Array.isArray(t)?zr:Nr:Lr)(n,t)}],$o.interpolateArray=zr;var ns=function(){return vt},ts=$o.map({linear:ns,poly:Fr,quad:function(){return Ur},cubic:function(){return jr},sin:function(){return Or},exp:function(){return Yr},circle:function(){return Ir},elastic:Zr,back:Vr,bounce:function(){return Xr}}),es=$o.map({"in":vt,out:Dr,"in-out":Pr,"out-in":function(n){return Pr(Dr(n))}});$o.ease=function(n){var t=n.indexOf("-"),e=t>=0?n.substring(0,t):n,r=t>=0?n.substring(t+1):"in";return e=ts.get(e)||ns,r=es.get(r)||vt,Rr(r(e.apply(null,Bo.call(arguments,1))))},$o.interpolateHcl=$r,$o.interpolateHsl=Br,$o.interpolateLab=Wr,$o.interpolateRound=Jr,$o.transform=function(n){var t=Jo.createElementNS($o.ns.prefix.svg,"g");return($o.transform=function(n){if(null!=n){t.setAttribute("transform",n);var e=t.transform.baseVal.consolidate()}return new Gr(e?e.matrix:rs)})(n)},Gr.prototype.toString=function(){return"translate("+this.translate+")rotate("+this.rotate+")skewX("+this.skew+")scale("+this.scale+")"};var rs={a:1,b:0,c:0,d:1,e:0,f:0};$o.interpolateTransform=tu,$o.layout={},$o.layout.bundle=function(){return function(n){for(var t=[],e=-1,r=n.length;++e<r;)t.push(uu(n[e]));return t}},$o.layout.chord=function(){function n(){var n,s,f,h,g,p={},v=[],d=$o.range(i),m=[];for(e=[],r=[],n=0,h=-1;++h<i;){for(s=0,g=-1;++g<i;)s+=u[h][g];v.push(s),m.push($o.range(i)),n+=s}for(o&&d.sort(function(n,t){return o(v[n],v[t])}),a&&m.forEach(function(n,t){n.sort(function(n,e){return a(u[t][n],u[t][e])})}),n=(Ea-l*i)/n,s=0,h=-1;++h<i;){for(f=s,g=-1;++g<i;){var y=d[h],x=m[y][g],M=u[y][x],_=s,b=s+=M*n;p[y+"-"+x]={index:y,subindex:x,startAngle:_,endAngle:b,value:M}}r[y]={index:y,startAngle:f,endAngle:s,value:(s-f)/n},s+=l}for(h=-1;++h<i;)for(g=h-1;++g<i;){var w=p[h+"-"+g],S=p[g+"-"+h];(w.value||S.value)&&e.push(w.value<S.value?{source:S,target:w}:{source:w,target:S})}c&&t()}function t(){e.sort(function(n,t){return c((n.source.value+n.target.value)/2,(t.source.value+t.target.value)/2)})}var e,r,u,i,o,a,c,s={},l=0;return s.matrix=function(n){return arguments.length?(i=(u=n)&&u.length,e=r=null,s):u},s.padding=function(n){return arguments.length?(l=n,e=r=null,s):l},s.sortGroups=function(n){return arguments.length?(o=n,e=r=null,s):o},s.sortSubgroups=function(n){return arguments.length?(a=n,e=null,s):a},s.sortChords=function(n){return arguments.length?(c=n,e&&t(),s):c},s.chords=function(){return e||n(),e},s.groups=function(){return r||n(),r},s},$o.layout.force=function(){function n(n){return function(t,e,r,u){if(t.point!==n){var i=t.cx-n.x,o=t.cy-n.y,a=1/Math.sqrt(i*i+o*o);if(v>(u-e)*a){var c=t.charge*a*a;return n.px-=i*c,n.py-=o*c,!0}if(t.point&&isFinite(a)){var c=t.pointCharge*a*a;n.px-=i*c,n.py-=o*c}}return!t.charge}}function t(n){n.px=$o.event.x,n.py=$o.event.y,a.resume()}var e,r,u,i,o,a={},c=$o.dispatch("start","tick","end"),s=[1,1],l=.9,f=us,h=is,g=-30,p=.1,v=.8,d=[],m=[];return a.tick=function(){if((r*=.99)<.005)return c.end({type:"end",alpha:r=0}),!0;var t,e,a,f,h,v,y,x,M,_=d.length,b=m.length;for(e=0;b>e;++e)a=m[e],f=a.source,h=a.target,x=h.x-f.x,M=h.y-f.y,(v=x*x+M*M)&&(v=r*i[e]*((v=Math.sqrt(v))-u[e])/v,x*=v,M*=v,h.x-=x*(y=f.weight/(h.weight+f.weight)),h.y-=M*y,f.x+=x*(y=1-y),f.y+=M*y);if((y=r*p)&&(x=s[0]/2,M=s[1]/2,e=-1,y))for(;++e<_;)a=d[e],a.x+=(x-a.x)*y,a.y+=(M-a.y)*y;if(g)for(fu(t=$o.geom.quadtree(d),r,o),e=-1;++e<_;)(a=d[e]).fixed||t.visit(n(a));for(e=-1;++e<_;)a=d[e],a.fixed?(a.x=a.px,a.y=a.py):(a.x-=(a.px-(a.px=a.x))*l,a.y-=(a.py-(a.py=a.y))*l);c.tick({type:"tick",alpha:r})},a.nodes=function(n){return arguments.length?(d=n,a):d},a.links=function(n){return arguments.length?(m=n,a):m},a.size=function(n){return arguments.length?(s=n,a):s},a.linkDistance=function(n){return arguments.length?(f="function"==typeof n?n:+n,a):f},a.distance=a.linkDistance,a.linkStrength=function(n){return arguments.length?(h="function"==typeof n?n:+n,a):h},a.friction=function(n){return arguments.length?(l=+n,a):l},a.charge=function(n){return arguments.length?(g="function"==typeof n?n:+n,a):g},a.gravity=function(n){return arguments.length?(p=+n,a):p},a.theta=function(n){return arguments.length?(v=+n,a):v},a.alpha=function(n){return arguments.length?(n=+n,r?r=n>0?n:0:n>0&&(c.start({type:"start",alpha:r=n}),$o.timer(a.tick)),a):r},a.start=function(){function n(n,r){if(!e){for(e=new Array(c),a=0;c>a;++a)e[a]=[];for(a=0;s>a;++a){var u=m[a];e[u.source.index].push(u.target),e[u.target.index].push(u.source)}}for(var i,o=e[t],a=-1,s=o.length;++a<s;)if(!isNaN(i=o[a][n]))return i;return Math.random()*r}var t,e,r,c=d.length,l=m.length,p=s[0],v=s[1];for(t=0;c>t;++t)(r=d[t]).index=t,r.weight=0;for(t=0;l>t;++t)r=m[t],"number"==typeof r.source&&(r.source=d[r.source]),"number"==typeof r.target&&(r.target=d[r.target]),++r.source.weight,++r.target.weight;for(t=0;c>t;++t)r=d[t],isNaN(r.x)&&(r.x=n("x",p)),isNaN(r.y)&&(r.y=n("y",v)),isNaN(r.px)&&(r.px=r.x),isNaN(r.py)&&(r.py=r.y);if(u=[],"function"==typeof f)for(t=0;l>t;++t)u[t]=+f.call(this,m[t],t);else for(t=0;l>t;++t)u[t]=f;if(i=[],"function"==typeof h)for(t=0;l>t;++t)i[t]=+h.call(this,m[t],t);else for(t=0;l>t;++t)i[t]=h;if(o=[],"function"==typeof g)for(t=0;c>t;++t)o[t]=+g.call(this,d[t],t);else for(t=0;c>t;++t)o[t]=g;return a.resume()},a.resume=function(){return a.alpha(.1)},a.stop=function(){return a.alpha(0)},a.drag=function(){return e||(e=$o.behavior.drag().origin(vt).on("dragstart.force",au).on("drag.force",t).on("dragend.force",cu)),arguments.length?(this.on("mouseover.force",su).on("mouseout.force",lu).call(e),void 0):e},$o.rebind(a,c,"on")};var us=20,is=1;$o.layout.hierarchy=function(){function n(t,o,a){var c=u.call(e,t,o);if(t.depth=o,a.push(t),c&&(s=c.length)){for(var s,l,f=-1,h=t.children=new Array(s),g=0,p=o+1;++f<s;)l=h[f]=n(c[f],p,a),l.parent=t,g+=l.value;r&&h.sort(r),i&&(t.value=g)}else delete t.children,i&&(t.value=+i.call(e,t,o)||0);return t}function t(n,r){var u=n.children,o=0;if(u&&(a=u.length))for(var a,c=-1,s=r+1;++c<a;)o+=t(u[c],s);else i&&(o=+i.call(e,n,r)||0);return i&&(n.value=o),o}function e(t){var e=[];return n(t,0,e),e}var r=vu,u=gu,i=pu;return e.sort=function(n){return arguments.length?(r=n,e):r},e.children=function(n){return arguments.length?(u=n,e):u},e.value=function(n){return arguments.length?(i=n,e):i},e.revalue=function(n){return t(n,0),n},e},$o.layout.partition=function(){function n(t,e,r,u){var i=t.children;if(t.x=e,t.y=t.depth*u,t.dx=r,t.dy=u,i&&(o=i.length)){var o,a,c,s=-1;for(r=t.value?r/t.value:0;++s<o;)n(a=i[s],e,c=a.value*r,u),e+=c}}function t(n){var e=n.children,r=0;if(e&&(u=e.length))for(var u,i=-1;++i<u;)r=Math.max(r,t(e[i]));return 1+r}function e(e,i){var o=r.call(this,e,i);return n(o[0],0,u[0],u[1]/t(o[0])),o}var r=$o.layout.hierarchy(),u=[1,1];return e.size=function(n){return arguments.length?(u=n,e):u},hu(e,r)},$o.layout.pie=function(){function n(i){var o=i.map(function(e,r){return+t.call(n,e,r)}),a=+("function"==typeof r?r.apply(this,arguments):r),c=(("function"==typeof u?u.apply(this,arguments):u)-a)/$o.sum(o),s=$o.range(i.length);null!=e&&s.sort(e===os?function(n,t){return o[t]-o[n]}:function(n,t){return e(i[n],i[t])});var l=[];return s.forEach(function(n){var t;l[n]={data:i[n],value:t=o[n],startAngle:a,endAngle:a+=t*c}}),l}var t=Number,e=os,r=0,u=Ea;return n.value=function(e){return arguments.length?(t=e,n):t},n.sort=function(t){return arguments.length?(e=t,n):e},n.startAngle=function(t){return arguments.length?(r=t,n):r},n.endAngle=function(t){return arguments.length?(u=t,n):u},n};var os={};$o.layout.stack=function(){function n(a,c){var s=a.map(function(e,r){return t.call(n,e,r)}),l=s.map(function(t){return t.map(function(t,e){return[i.call(n,t,e),o.call(n,t,e)]})}),f=e.call(n,l,c);s=$o.permute(s,f),l=$o.permute(l,f);var h,g,p,v=r.call(n,l,c),d=s.length,m=s[0].length;for(g=0;m>g;++g)for(u.call(n,s[0][g],p=v[g],l[0][g][1]),h=1;d>h;++h)u.call(n,s[h][g],p+=l[h-1][g][1],l[h][g][1]);return a}var t=vt,e=Mu,r=_u,u=xu,i=mu,o=yu;return n.values=function(e){return arguments.length?(t=e,n):t},n.order=function(t){return arguments.length?(e="function"==typeof t?t:as.get(t)||Mu,n):e},n.offset=function(t){return arguments.length?(r="function"==typeof t?t:cs.get(t)||_u,n):r},n.x=function(t){return arguments.length?(i=t,n):i},n.y=function(t){return arguments.length?(o=t,n):o},n.out=function(t){return arguments.length?(u=t,n):u},n};var as=$o.map({"inside-out":function(n){var t,e,r=n.length,u=n.map(bu),i=n.map(wu),o=$o.range(r).sort(function(n,t){return u[n]-u[t]}),a=0,c=0,s=[],l=[];for(t=0;r>t;++t)e=o[t],c>a?(a+=i[e],s.push(e)):(c+=i[e],l.push(e));return l.reverse().concat(s)},reverse:function(n){return $o.range(n.length).reverse()},"default":Mu}),cs=$o.map({silhouette:function(n){var t,e,r,u=n.length,i=n[0].length,o=[],a=0,c=[];for(e=0;i>e;++e){for(t=0,r=0;u>t;t++)r+=n[t][e][1];r>a&&(a=r),o.push(r)}for(e=0;i>e;++e)c[e]=(a-o[e])/2;return c},wiggle:function(n){var t,e,r,u,i,o,a,c,s,l=n.length,f=n[0],h=f.length,g=[];for(g[0]=c=s=0,e=1;h>e;++e){for(t=0,u=0;l>t;++t)u+=n[t][e][1];for(t=0,i=0,a=f[e][0]-f[e-1][0];l>t;++t){for(r=0,o=(n[t][e][1]-n[t][e-1][1])/(2*a);t>r;++r)o+=(n[r][e][1]-n[r][e-1][1])/a;i+=o*n[t][e][1]}g[e]=c-=u?i/u*a:0,s>c&&(s=c)}for(e=0;h>e;++e)g[e]-=s;return g},expand:function(n){var t,e,r,u=n.length,i=n[0].length,o=1/u,a=[];for(e=0;i>e;++e){for(t=0,r=0;u>t;t++)r+=n[t][e][1];if(r)for(t=0;u>t;t++)n[t][e][1]/=r;else for(t=0;u>t;t++)n[t][e][1]=o}for(e=0;i>e;++e)a[e]=0;return a},zero:_u});$o.layout.histogram=function(){function n(n,i){for(var o,a,c=[],s=n.map(e,this),l=r.call(this,s,i),f=u.call(this,l,s,i),i=-1,h=s.length,g=f.length-1,p=t?1:1/h;++i<g;)o=c[i]=[],o.dx=f[i+1]-(o.x=f[i]),o.y=0;if(g>0)for(i=-1;++i<h;)a=s[i],a>=l[0]&&a<=l[1]&&(o=c[$o.bisect(f,a,1,g)-1],o.y+=p,o.push(n[i]));return c}var t=!0,e=Number,r=Au,u=ku;return n.value=function(t){return arguments.length?(e=t,n):e},n.range=function(t){return arguments.length?(r=pt(t),n):r},n.bins=function(t){return arguments.length?(u="number"==typeof t?function(n){return Eu(n,t)}:pt(t),n):u},n.frequency=function(e){return arguments.length?(t=!!e,n):t},n},$o.layout.tree=function(){function n(n,i){function o(n,t){var r=n.children,u=n._tree;if(r&&(i=r.length)){for(var i,a,s,l=r[0],f=l,h=-1;++h<i;)s=r[h],o(s,a),f=c(s,a,f),a=s;Pu(n);var g=.5*(l._tree.prelim+s._tree.prelim);t?(u.prelim=t._tree.prelim+e(n,t),u.mod=u.prelim-g):u.prelim=g}else t&&(u.prelim=t._tree.prelim+e(n,t))}function a(n,t){n.x=n._tree.prelim+t;var e=n.children;if(e&&(r=e.length)){var r,u=-1;for(t+=n._tree.mod;++u<r;)a(e[u],t)}}function c(n,t,r){if(t){for(var u,i=n,o=n,a=t,c=n.parent.children[0],s=i._tree.mod,l=o._tree.mod,f=a._tree.mod,h=c._tree.mod;a=Lu(a),i=Nu(i),a&&i;)c=Nu(c),o=Lu(o),o._tree.ancestor=n,u=a._tree.prelim+f-i._tree.prelim-s+e(a,i),u>0&&(Uu(ju(a,n,r),n,u),s+=u,l+=u),f+=a._tree.mod,s+=i._tree.mod,h+=c._tree.mod,l+=o._tree.mod;a&&!Lu(o)&&(o._tree.thread=a,o._tree.mod+=f-l),i&&!Nu(c)&&(c._tree.thread=i,c._tree.mod+=s-h,r=n)}return r}var s=t.call(this,n,i),l=s[0];Du(l,function(n,t){n._tree={ancestor:n,prelim:0,mod:0,change:0,shift:0,number:t?t._tree.number+1:0}}),o(l),a(l,-l._tree.prelim);var f=Tu(l,zu),h=Tu(l,qu),g=Tu(l,Ru),p=f.x-e(f,h)/2,v=h.x+e(h,f)/2,d=g.depth||1;return Du(l,u?function(n){n.x*=r[0],n.y=n.depth*r[1],delete n._tree}:function(n){n.x=(n.x-p)/(v-p)*r[0],n.y=n.depth/d*r[1],delete n._tree}),s}var t=$o.layout.hierarchy().sort(null).value(null),e=Cu,r=[1,1],u=!1;return n.separation=function(t){return arguments.length?(e=t,n):e},n.size=function(t){return arguments.length?(u=null==(r=t),n):u?null:r},n.nodeSize=function(t){return arguments.length?(u=null!=(r=t),n):u?r:null},hu(n,t)},$o.layout.pack=function(){function n(n,i){var o=e.call(this,n,i),a=o[0],c=u[0],s=u[1],l=null==t?Math.sqrt:"function"==typeof t?t:function(){return t};if(a.x=a.y=0,Du(a,function(n){n.r=+l(n.value)}),Du(a,Iu),r){var f=r*(t?1:Math.max(2*a.r/c,2*a.r/s))/2;Du(a,function(n){n.r+=f}),Du(a,Iu),Du(a,function(n){n.r-=f})}return Xu(a,c/2,s/2,t?1:1/Math.max(2*a.r/c,2*a.r/s)),o}var t,e=$o.layout.hierarchy().sort(Hu),r=0,u=[1,1];return n.size=function(t){return arguments.length?(u=t,n):u},n.radius=function(e){return arguments.length?(t=null==e||"function"==typeof e?e:+e,n):t},n.padding=function(t){return arguments.length?(r=+t,n):r},hu(n,e)},$o.layout.cluster=function(){function n(n,i){var o,a=t.call(this,n,i),c=a[0],s=0;Du(c,function(n){var t=n.children;t&&t.length?(n.x=Wu(t),n.y=Bu(t)):(n.x=o?s+=e(n,o):0,n.y=0,o=n)});var l=Ju(c),f=Gu(c),h=l.x-e(l,f)/2,g=f.x+e(f,l)/2;return Du(c,u?function(n){n.x=(n.x-c.x)*r[0],n.y=(c.y-n.y)*r[1]}:function(n){n.x=(n.x-h)/(g-h)*r[0],n.y=(1-(c.y?n.y/c.y:1))*r[1]}),a}var t=$o.layout.hierarchy().sort(null).value(null),e=Cu,r=[1,1],u=!1;return n.separation=function(t){return arguments.length?(e=t,n):e},n.size=function(t){return arguments.length?(u=null==(r=t),n):u?null:r},n.nodeSize=function(t){return arguments.length?(u=null!=(r=t),n):u?r:null},hu(n,t)},$o.layout.treemap=function(){function n(n,t){for(var e,r,u=-1,i=n.length;++u<i;)r=(e=n[u]).value*(0>t?0:t),e.area=isNaN(r)||0>=r?0:r}function t(e){var i=e.children;if(i&&i.length){var o,a,c,s=f(e),l=[],h=i.slice(),p=1/0,v="slice"===g?s.dx:"dice"===g?s.dy:"slice-dice"===g?1&e.depth?s.dy:s.dx:Math.min(s.dx,s.dy);for(n(h,s.dx*s.dy/e.value),l.area=0;(c=h.length)>0;)l.push(o=h[c-1]),l.area+=o.area,"squarify"!==g||(a=r(l,v))<=p?(h.pop(),p=a):(l.area-=l.pop().area,u(l,v,s,!1),v=Math.min(s.dx,s.dy),l.length=l.area=0,p=1/0);l.length&&(u(l,v,s,!0),l.length=l.area=0),i.forEach(t)}}function e(t){var r=t.children;if(r&&r.length){var i,o=f(t),a=r.slice(),c=[];for(n(a,o.dx*o.dy/t.value),c.area=0;i=a.pop();)c.push(i),c.area+=i.area,null!=i.z&&(u(c,i.z?o.dx:o.dy,o,!a.length),c.length=c.area=0);r.forEach(e)}}function r(n,t){for(var e,r=n.area,u=0,i=1/0,o=-1,a=n.length;++o<a;)(e=n[o].area)&&(i>e&&(i=e),e>u&&(u=e));return r*=r,t*=t,r?Math.max(t*u*p/r,r/(t*i*p)):1/0}function u(n,t,e,r){var u,i=-1,o=n.length,a=e.x,s=e.y,l=t?c(n.area/t):0;if(t==e.dx){for((r||l>e.dy)&&(l=e.dy);++i<o;)u=n[i],u.x=a,u.y=s,u.dy=l,a+=u.dx=Math.min(e.x+e.dx-a,l?c(u.area/l):0);u.z=!0,u.dx+=e.x+e.dx-a,e.y+=l,e.dy-=l}else{for((r||l>e.dx)&&(l=e.dx);++i<o;)u=n[i],u.x=a,u.y=s,u.dx=l,s+=u.dy=Math.min(e.y+e.dy-s,l?c(u.area/l):0);u.z=!1,u.dy+=e.y+e.dy-s,e.x+=l,e.dx-=l}}function i(r){var u=o||a(r),i=u[0];return i.x=0,i.y=0,i.dx=s[0],i.dy=s[1],o&&a.revalue(i),n([i],i.dx*i.dy/i.value),(o?e:t)(i),h&&(o=u),u}var o,a=$o.layout.hierarchy(),c=Math.round,s=[1,1],l=null,f=Ku,h=!1,g="squarify",p=.5*(1+Math.sqrt(5));return i.size=function(n){return arguments.length?(s=n,i):s},i.padding=function(n){function t(t){var e=n.call(i,t,t.depth);return null==e?Ku(t):Qu(t,"number"==typeof e?[e,e,e,e]:e)}function e(t){return Qu(t,n)}if(!arguments.length)return l;var r;return f=null==(l=n)?Ku:"function"==(r=typeof n)?t:"number"===r?(n=[n,n,n,n],e):e,i},i.round=function(n){return arguments.length?(c=n?Math.round:Number,i):c!=Number},i.sticky=function(n){return arguments.length?(h=n,o=null,i):h},i.ratio=function(n){return arguments.length?(p=n,i):p},i.mode=function(n){return arguments.length?(g=n+"",i):g},hu(i,a)},$o.random={normal:function(n,t){var e=arguments.length;return 2>e&&(t=1),1>e&&(n=0),function(){var e,r,u;do e=2*Math.random()-1,r=2*Math.random()-1,u=e*e+r*r;while(!u||u>1);return n+t*e*Math.sqrt(-2*Math.log(u)/u)}},logNormal:function(){var n=$o.random.normal.apply($o,arguments);return function(){return Math.exp(n())}},irwinHall:function(n){return function(){for(var t=0,e=0;n>e;e++)t+=Math.random();return t/n}}},$o.scale={};var ss={floor:vt,ceil:vt};$o.scale.linear=function(){return oi([0,1],[0,1],qr,!1)};var ls={s:1,g:1,p:1,r:1,e:1};$o.scale.log=function(){return pi($o.scale.linear().domain([0,1]),10,!0,[1,10])};var fs=$o.format(".0e"),hs={floor:function(n){return-Math.ceil(-n)},ceil:function(n){return-Math.floor(-n)}};$o.scale.pow=function(){return vi($o.scale.linear(),1,[0,1])},$o.scale.sqrt=function(){return $o.scale.pow().exponent(.5)},$o.scale.ordinal=function(){return mi([],{t:"range",a:[[]]})},$o.scale.category10=function(){return $o.scale.ordinal().range(gs)},$o.scale.category20=function(){return $o.scale.ordinal().range(ps)},$o.scale.category20b=function(){return $o.scale.ordinal().range(vs)},$o.scale.category20c=function(){return $o.scale.ordinal().range(ds)};var gs=[2062260,16744206,2924588,14034728,9725885,9197131,14907330,8355711,12369186,1556175].map(it),ps=[2062260,11454440,16744206,16759672,2924588,10018698,14034728,16750742,9725885,12955861,9197131,12885140,14907330,16234194,8355711,13092807,12369186,14408589,1556175,10410725].map(it),vs=[3750777,5395619,7040719,10264286,6519097,9216594,11915115,13556636,9202993,12426809,15186514,15190932,8666169,11356490,14049643,15177372,8077683,10834324,13528509,14589654].map(it),ds=[3244733,7057110,10406625,13032431,15095053,16616764,16625259,16634018,3253076,7652470,10607003,13101504,7695281,10394312,12369372,14342891,6513507,9868950,12434877,14277081].map(it);$o.scale.quantile=function(){return yi([],[])},$o.scale.quantize=function(){return xi(0,1,[0,1])},$o.scale.threshold=function(){return Mi([.5],[0,1])},$o.scale.identity=function(){return _i([0,1])},$o.svg={},$o.svg.arc=function(){function n(){var n=t.apply(this,arguments),i=e.apply(this,arguments),o=r.apply(this,arguments)+ms,a=u.apply(this,arguments)+ms,c=(o>a&&(c=o,o=a,a=c),a-o),s=ka>c?"0":"1",l=Math.cos(o),f=Math.sin(o),h=Math.cos(a),g=Math.sin(a);return c>=ys?n?"M0,"+i+"A"+i+","+i+" 0 1,1 0,"+-i+"A"+i+","+i+" 0 1,1 0,"+i+"M0,"+n+"A"+n+","+n+" 0 1,0 0,"+-n+"A"+n+","+n+" 0 1,0 0,"+n+"Z":"M0,"+i+"A"+i+","+i+" 0 1,1 0,"+-i+"A"+i+","+i+" 0 1,1 0,"+i+"Z":n?"M"+i*l+","+i*f+"A"+i+","+i+" 0 "+s+",1 "+i*h+","+i*g+"L"+n*h+","+n*g+"A"+n+","+n+" 0 "+s+",0 "+n*l+","+n*f+"Z":"M"+i*l+","+i*f+"A"+i+","+i+" 0 "+s+",1 "+i*h+","+i*g+"L0,0"+"Z"}var t=bi,e=wi,r=Si,u=ki;return n.innerRadius=function(e){return arguments.length?(t=pt(e),n):t},n.outerRadius=function(t){return arguments.length?(e=pt(t),n):e},n.startAngle=function(t){return arguments.length?(r=pt(t),n):r},n.endAngle=function(t){return arguments.length?(u=pt(t),n):u},n.centroid=function(){var n=(t.apply(this,arguments)+e.apply(this,arguments))/2,i=(r.apply(this,arguments)+u.apply(this,arguments))/2+ms;return[Math.cos(i)*n,Math.sin(i)*n]},n};var ms=-Aa,ys=Ea-Ca;$o.svg.line=function(){return Ei(vt)};var xs=$o.map({linear:Ai,"linear-closed":Ci,step:Ni,"step-before":Li,"step-after":Ti,basis:Ui,"basis-open":ji,"basis-closed":Hi,bundle:Fi,cardinal:Ri,"cardinal-open":qi,"cardinal-closed":zi,monotone:Xi});xs.forEach(function(n,t){t.key=n,t.closed=/-closed$/.test(n)});var Ms=[0,2/3,1/3,0],_s=[0,1/3,2/3,0],bs=[0,1/6,2/3,1/6];$o.svg.line.radial=function(){var n=Ei($i);return n.radius=n.x,delete n.x,n.angle=n.y,delete n.y,n},Li.reverse=Ti,Ti.reverse=Li,$o.svg.area=function(){return Bi(vt)},$o.svg.area.radial=function(){var n=Bi($i);return n.radius=n.x,delete n.x,n.innerRadius=n.x0,delete n.x0,n.outerRadius=n.x1,delete n.x1,n.angle=n.y,delete n.y,n.startAngle=n.y0,delete n.y0,n.endAngle=n.y1,delete n.y1,n},$o.svg.chord=function(){function n(n,a){var c=t(this,i,n,a),s=t(this,o,n,a);return"M"+c.p0+r(c.r,c.p1,c.a1-c.a0)+(e(c,s)?u(c.r,c.p1,c.r,c.p0):u(c.r,c.p1,s.r,s.p0)+r(s.r,s.p1,s.a1-s.a0)+u(s.r,s.p1,c.r,c.p0))+"Z"}function t(n,t,e,r){var u=t.call(n,e,r),i=a.call(n,u,r),o=c.call(n,u,r)+ms,l=s.call(n,u,r)+ms;return{r:i,a0:o,a1:l,p0:[i*Math.cos(o),i*Math.sin(o)],p1:[i*Math.cos(l),i*Math.sin(l)]}}function e(n,t){return n.a0==t.a0&&n.a1==t.a1}function r(n,t,e){return"A"+n+","+n+" 0 "+ +(e>ka)+",1 "+t}function u(n,t,e,r){return"Q 0,0 "+r}var i=Re,o=De,a=Wi,c=Si,s=ki;return n.radius=function(t){return arguments.length?(a=pt(t),n):a},n.source=function(t){return arguments.length?(i=pt(t),n):i},n.target=function(t){return arguments.length?(o=pt(t),n):o},n.startAngle=function(t){return arguments.length?(c=pt(t),n):c},n.endAngle=function(t){return arguments.length?(s=pt(t),n):s},n},$o.svg.diagonal=function(){function n(n,u){var i=t.call(this,n,u),o=e.call(this,n,u),a=(i.y+o.y)/2,c=[i,{x:i.x,y:a},{x:o.x,y:a},o];return c=c.map(r),"M"+c[0]+"C"+c[1]+" "+c[2]+" "+c[3]}var t=Re,e=De,r=Ji;return n.source=function(e){return arguments.length?(t=pt(e),n):t},n.target=function(t){return arguments.length?(e=pt(t),n):e},n.projection=function(t){return arguments.length?(r=t,n):r},n},$o.svg.diagonal.radial=function(){var n=$o.svg.diagonal(),t=Ji,e=n.projection;return n.projection=function(n){return arguments.length?e(Gi(t=n)):t},n},$o.svg.symbol=function(){function n(n,r){return(ws.get(t.call(this,n,r))||no)(e.call(this,n,r))}var t=Qi,e=Ki;return n.type=function(e){return arguments.length?(t=pt(e),n):t},n.size=function(t){return arguments.length?(e=pt(t),n):e},n};var ws=$o.map({circle:no,cross:function(n){var t=Math.sqrt(n/5)/2;return"M"+-3*t+","+-t+"H"+-t+"V"+-3*t+"H"+t+"V"+-t+"H"+3*t+"V"+t+"H"+t+"V"+3*t+"H"+-t+"V"+t+"H"+-3*t+"Z"},diamond:function(n){var t=Math.sqrt(n/(2*As)),e=t*As;return"M0,"+-t+"L"+e+",0"+" 0,"+t+" "+-e+",0"+"Z"},square:function(n){var t=Math.sqrt(n)/2;return"M"+-t+","+-t+"L"+t+","+-t+" "+t+","+t+" "+-t+","+t+"Z"},"triangle-down":function(n){var t=Math.sqrt(n/Es),e=t*Es/2;return"M0,"+e+"L"+t+","+-e+" "+-t+","+-e+"Z"},"triangle-up":function(n){var t=Math.sqrt(n/Es),e=t*Es/2;return"M0,"+-e+"L"+t+","+e+" "+-t+","+e+"Z"}});$o.svg.symbolTypes=ws.keys();var Ss,ks,Es=Math.sqrt(3),As=Math.tan(30*La),Cs=[],Ns=0;
Cs.call=ma.call,Cs.empty=ma.empty,Cs.node=ma.node,Cs.size=ma.size,$o.transition=function(n){return arguments.length?Ss?n.transition():n:Ma.transition()},$o.transition.prototype=Cs,Cs.select=function(n){var t,e,r,u=this.id,i=[];n=v(n);for(var o=-1,a=this.length;++o<a;){i.push(t=[]);for(var c=this[o],s=-1,l=c.length;++s<l;)(r=c[s])&&(e=n.call(r,r.__data__,s,o))?("__data__"in r&&(e.__data__=r.__data__),uo(e,s,u,r.__transition__[u]),t.push(e)):t.push(null)}return to(i,u)},Cs.selectAll=function(n){var t,e,r,u,i,o=this.id,a=[];n=d(n);for(var c=-1,s=this.length;++c<s;)for(var l=this[c],f=-1,h=l.length;++f<h;)if(r=l[f]){i=r.__transition__[o],e=n.call(r,r.__data__,f,c),a.push(t=[]);for(var g=-1,p=e.length;++g<p;)(u=e[g])&&uo(u,g,o,i),t.push(u)}return to(a,o)},Cs.filter=function(n){var t,e,r,u=[];"function"!=typeof n&&(n=E(n));for(var i=0,o=this.length;o>i;i++){u.push(t=[]);for(var e=this[i],a=0,c=e.length;c>a;a++)(r=e[a])&&n.call(r,r.__data__,a,i)&&t.push(r)}return to(u,this.id)},Cs.tween=function(n,t){var e=this.id;return arguments.length<2?this.node().__transition__[e].tween.get(n):C(this,null==t?function(t){t.__transition__[e].tween.remove(n)}:function(r){r.__transition__[e].tween.set(n,t)})},Cs.attr=function(n,t){function e(){this.removeAttribute(a)}function r(){this.removeAttributeNS(a.space,a.local)}function u(n){return null==n?e:(n+="",function(){var t,e=this.getAttribute(a);return e!==n&&(t=o(e,n),function(n){this.setAttribute(a,t(n))})})}function i(n){return null==n?r:(n+="",function(){var t,e=this.getAttributeNS(a.space,a.local);return e!==n&&(t=o(e,n),function(n){this.setAttributeNS(a.space,a.local,t(n))})})}if(arguments.length<2){for(t in n)this.attr(t,n[t]);return this}var o="transform"==n?tu:qr,a=$o.ns.qualify(n);return eo(this,"attr."+n,t,a.local?i:u)},Cs.attrTween=function(n,t){function e(n,e){var r=t.call(this,n,e,this.getAttribute(u));return r&&function(n){this.setAttribute(u,r(n))}}function r(n,e){var r=t.call(this,n,e,this.getAttributeNS(u.space,u.local));return r&&function(n){this.setAttributeNS(u.space,u.local,r(n))}}var u=$o.ns.qualify(n);return this.tween("attr."+n,u.local?r:e)},Cs.style=function(n,t,e){function r(){this.style.removeProperty(n)}function u(t){return null==t?r:(t+="",function(){var r,u=Ko.getComputedStyle(this,null).getPropertyValue(n);return u!==t&&(r=qr(u,t),function(t){this.style.setProperty(n,r(t),e)})})}var i=arguments.length;if(3>i){if("string"!=typeof n){2>i&&(t="");for(e in n)this.style(e,n[e],t);return this}e=""}return eo(this,"style."+n,t,u)},Cs.styleTween=function(n,t,e){function r(r,u){var i=t.call(this,r,u,Ko.getComputedStyle(this,null).getPropertyValue(n));return i&&function(t){this.style.setProperty(n,i(t),e)}}return arguments.length<3&&(e=""),this.tween("style."+n,r)},Cs.text=function(n){return eo(this,"text",n,ro)},Cs.remove=function(){return this.each("end.transition",function(){var n;this.__transition__.count<2&&(n=this.parentNode)&&n.removeChild(this)})},Cs.ease=function(n){var t=this.id;return arguments.length<1?this.node().__transition__[t].ease:("function"!=typeof n&&(n=$o.ease.apply($o,arguments)),C(this,function(e){e.__transition__[t].ease=n}))},Cs.delay=function(n){var t=this.id;return C(this,"function"==typeof n?function(e,r,u){e.__transition__[t].delay=+n.call(e,e.__data__,r,u)}:(n=+n,function(e){e.__transition__[t].delay=n}))},Cs.duration=function(n){var t=this.id;return C(this,"function"==typeof n?function(e,r,u){e.__transition__[t].duration=Math.max(1,n.call(e,e.__data__,r,u))}:(n=Math.max(1,n),function(e){e.__transition__[t].duration=n}))},Cs.each=function(n,t){var e=this.id;if(arguments.length<2){var r=ks,u=Ss;Ss=e,C(this,function(t,r,u){ks=t.__transition__[e],n.call(t,t.__data__,r,u)}),ks=r,Ss=u}else C(this,function(r){var u=r.__transition__[e];(u.event||(u.event=$o.dispatch("start","end"))).on(n,t)});return this},Cs.transition=function(){for(var n,t,e,r,u=this.id,i=++Ns,o=[],a=0,c=this.length;c>a;a++){o.push(n=[]);for(var t=this[a],s=0,l=t.length;l>s;s++)(e=t[s])&&(r=Object.create(e.__transition__[u]),r.delay+=r.duration,uo(e,s,i,r)),n.push(e)}return to(o,i)},$o.svg.axis=function(){function n(n){n.each(function(){var n,s=$o.select(this),l=this.__chart__||e,f=this.__chart__=e.copy(),h=null==c?f.ticks?f.ticks.apply(f,a):f.domain():c,g=null==t?f.tickFormat?f.tickFormat.apply(f,a):vt:t,p=s.selectAll(".tick").data(h,f),v=p.enter().insert("g",".domain").attr("class","tick").style("opacity",Ca),d=$o.transition(p.exit()).style("opacity",Ca).remove(),m=$o.transition(p).style("opacity",1),y=ti(f),x=s.selectAll(".domain").data([0]),M=(x.enter().append("path").attr("class","domain"),$o.transition(x));v.append("line"),v.append("text");var _=v.select("line"),b=m.select("line"),w=p.select("text").text(g),S=v.select("text"),k=m.select("text");switch(r){case"bottom":n=io,_.attr("y2",u),S.attr("y",Math.max(u,0)+o),b.attr("x2",0).attr("y2",u),k.attr("x",0).attr("y",Math.max(u,0)+o),w.attr("dy",".71em").style("text-anchor","middle"),M.attr("d","M"+y[0]+","+i+"V0H"+y[1]+"V"+i);break;case"top":n=io,_.attr("y2",-u),S.attr("y",-(Math.max(u,0)+o)),b.attr("x2",0).attr("y2",-u),k.attr("x",0).attr("y",-(Math.max(u,0)+o)),w.attr("dy","0em").style("text-anchor","middle"),M.attr("d","M"+y[0]+","+-i+"V0H"+y[1]+"V"+-i);break;case"left":n=oo,_.attr("x2",-u),S.attr("x",-(Math.max(u,0)+o)),b.attr("x2",-u).attr("y2",0),k.attr("x",-(Math.max(u,0)+o)).attr("y",0),w.attr("dy",".32em").style("text-anchor","end"),M.attr("d","M"+-i+","+y[0]+"H0V"+y[1]+"H"+-i);break;case"right":n=oo,_.attr("x2",u),S.attr("x",Math.max(u,0)+o),b.attr("x2",u).attr("y2",0),k.attr("x",Math.max(u,0)+o).attr("y",0),w.attr("dy",".32em").style("text-anchor","start"),M.attr("d","M"+i+","+y[0]+"H0V"+y[1]+"H"+i)}if(f.rangeBand){var E=f,A=E.rangeBand()/2;l=f=function(n){return E(n)+A}}else l.rangeBand?l=f:d.call(n,f);v.call(n,l),m.call(n,f)})}var t,e=$o.scale.linear(),r=Ls,u=6,i=6,o=3,a=[10],c=null;return n.scale=function(t){return arguments.length?(e=t,n):e},n.orient=function(t){return arguments.length?(r=t in Ts?t+"":Ls,n):r},n.ticks=function(){return arguments.length?(a=arguments,n):a},n.tickValues=function(t){return arguments.length?(c=t,n):c},n.tickFormat=function(e){return arguments.length?(t=e,n):t},n.tickSize=function(t){var e=arguments.length;return e?(u=+t,i=+arguments[e-1],n):u},n.innerTickSize=function(t){return arguments.length?(u=+t,n):u},n.outerTickSize=function(t){return arguments.length?(i=+t,n):i},n.tickPadding=function(t){return arguments.length?(o=+t,n):o},n.tickSubdivide=function(){return arguments.length&&n},n};var Ls="bottom",Ts={top:1,right:1,bottom:1,left:1};$o.svg.brush=function(){function n(i){i.each(function(){var i=$o.select(this).style("pointer-events","all").style("-webkit-tap-highlight-color","rgba(0,0,0,0)").on("mousedown.brush",u).on("touchstart.brush",u),o=i.selectAll(".background").data([0]);o.enter().append("rect").attr("class","background").style("visibility","hidden").style("cursor","crosshair"),i.selectAll(".extent").data([0]).enter().append("rect").attr("class","extent").style("cursor","move");var a=i.selectAll(".resize").data(d,vt);a.exit().remove(),a.enter().append("g").attr("class",function(n){return"resize "+n}).style("cursor",function(n){return qs[n]}).append("rect").attr("x",function(n){return/[ew]$/.test(n)?-3:null}).attr("y",function(n){return/^[ns]/.test(n)?-3:null}).attr("width",6).attr("height",6).style("visibility","hidden"),a.style("display",n.empty()?"none":null);var l,f=$o.transition(i),h=$o.transition(o);c&&(l=ti(c),h.attr("x",l[0]).attr("width",l[1]-l[0]),e(f)),s&&(l=ti(s),h.attr("y",l[0]).attr("height",l[1]-l[0]),r(f)),t(f)})}function t(n){n.selectAll(".resize").attr("transform",function(n){return"translate("+l[+/e$/.test(n)]+","+h[+/^s/.test(n)]+")"})}function e(n){n.select(".extent").attr("x",l[0]),n.selectAll(".extent,.n>rect,.s>rect").attr("width",l[1]-l[0])}function r(n){n.select(".extent").attr("y",h[0]),n.selectAll(".extent,.e>rect,.w>rect").attr("height",h[1]-h[0])}function u(){function u(){32==$o.event.keyCode&&(C||(x=null,L[0]-=l[1],L[1]-=h[1],C=2),f())}function g(){32==$o.event.keyCode&&2==C&&(L[0]+=l[1],L[1]+=h[1],C=0,f())}function d(){var n=$o.mouse(_),u=!1;M&&(n[0]+=M[0],n[1]+=M[1]),C||($o.event.altKey?(x||(x=[(l[0]+l[1])/2,(h[0]+h[1])/2]),L[0]=l[+(n[0]<x[0])],L[1]=h[+(n[1]<x[1])]):x=null),E&&m(n,c,0)&&(e(S),u=!0),A&&m(n,s,1)&&(r(S),u=!0),u&&(t(S),w({type:"brush",mode:C?"move":"resize"}))}function m(n,t,e){var r,u,a=ti(t),c=a[0],s=a[1],f=L[e],g=e?h:l,d=g[1]-g[0];return C&&(c-=f,s-=d+f),r=(e?v:p)?Math.max(c,Math.min(s,n[e])):n[e],C?u=(r+=f)+d:(x&&(f=Math.max(c,Math.min(s,2*x[e]-r))),r>f?(u=r,r=f):u=f),g[0]!=r||g[1]!=u?(e?o=null:i=null,g[0]=r,g[1]=u,!0):void 0}function y(){d(),S.style("pointer-events","all").selectAll(".resize").style("display",n.empty()?"none":null),$o.select("body").style("cursor",null),T.on("mousemove.brush",null).on("mouseup.brush",null).on("touchmove.brush",null).on("touchend.brush",null).on("keydown.brush",null).on("keyup.brush",null),N(),w({type:"brushend"})}var x,M,_=this,b=$o.select($o.event.target),w=a.of(_,arguments),S=$o.select(_),k=b.datum(),E=!/^(n|s)$/.test(k)&&c,A=!/^(e|w)$/.test(k)&&s,C=b.classed("extent"),N=D(),L=$o.mouse(_),T=$o.select(Ko).on("keydown.brush",u).on("keyup.brush",g);if($o.event.changedTouches?T.on("touchmove.brush",d).on("touchend.brush",y):T.on("mousemove.brush",d).on("mouseup.brush",y),S.interrupt().selectAll("*").interrupt(),C)L[0]=l[0]-L[0],L[1]=h[0]-L[1];else if(k){var q=+/w$/.test(k),z=+/^n/.test(k);M=[l[1-q]-L[0],h[1-z]-L[1]],L[0]=l[q],L[1]=h[z]}else $o.event.altKey&&(x=L.slice());S.style("pointer-events","none").selectAll(".resize").style("display",null),$o.select("body").style("cursor",b.style("cursor")),w({type:"brushstart"}),d()}var i,o,a=g(n,"brushstart","brush","brushend"),c=null,s=null,l=[0,0],h=[0,0],p=!0,v=!0,d=zs[0];return n.event=function(n){n.each(function(){var n=a.of(this,arguments),t={x:l,y:h,i:i,j:o},e=this.__chart__||t;this.__chart__=t,Ss?$o.select(this).transition().each("start.brush",function(){i=e.i,o=e.j,l=e.x,h=e.y,n({type:"brushstart"})}).tween("brush:brush",function(){var e=zr(l,t.x),r=zr(h,t.y);return i=o=null,function(u){l=t.x=e(u),h=t.y=r(u),n({type:"brush",mode:"resize"})}}).each("end.brush",function(){i=t.i,o=t.j,n({type:"brush",mode:"resize"}),n({type:"brushend"})}):(n({type:"brushstart"}),n({type:"brush",mode:"resize"}),n({type:"brushend"}))})},n.x=function(t){return arguments.length?(c=t,d=zs[!c<<1|!s],n):c},n.y=function(t){return arguments.length?(s=t,d=zs[!c<<1|!s],n):s},n.clamp=function(t){return arguments.length?(c&&s?(p=!!t[0],v=!!t[1]):c?p=!!t:s&&(v=!!t),n):c&&s?[p,v]:c?p:s?v:null},n.extent=function(t){var e,r,u,a,f;return arguments.length?(c&&(e=t[0],r=t[1],s&&(e=e[0],r=r[0]),i=[e,r],c.invert&&(e=c(e),r=c(r)),e>r&&(f=e,e=r,r=f),(e!=l[0]||r!=l[1])&&(l=[e,r])),s&&(u=t[0],a=t[1],c&&(u=u[1],a=a[1]),o=[u,a],s.invert&&(u=s(u),a=s(a)),u>a&&(f=u,u=a,a=f),(u!=h[0]||a!=h[1])&&(h=[u,a])),n):(c&&(i?(e=i[0],r=i[1]):(e=l[0],r=l[1],c.invert&&(e=c.invert(e),r=c.invert(r)),e>r&&(f=e,e=r,r=f))),s&&(o?(u=o[0],a=o[1]):(u=h[0],a=h[1],s.invert&&(u=s.invert(u),a=s.invert(a)),u>a&&(f=u,u=a,a=f))),c&&s?[[e,u],[r,a]]:c?[e,r]:s&&[u,a])},n.clear=function(){return n.empty()||(l=[0,0],h=[0,0],i=o=null),n},n.empty=function(){return!!c&&l[0]==l[1]||!!s&&h[0]==h[1]},$o.rebind(n,a,"on")};var qs={n:"ns-resize",e:"ew-resize",s:"ns-resize",w:"ew-resize",nw:"nwse-resize",ne:"nesw-resize",se:"nwse-resize",sw:"nesw-resize"},zs=[["n","e","s","w","nw","ne","se","sw"],["e","w"],["n","s"],[]],Rs=$o.time={},Ds=Date,Ps=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];ao.prototype={getDate:function(){return this._.getUTCDate()},getDay:function(){return this._.getUTCDay()},getFullYear:function(){return this._.getUTCFullYear()},getHours:function(){return this._.getUTCHours()},getMilliseconds:function(){return this._.getUTCMilliseconds()},getMinutes:function(){return this._.getUTCMinutes()},getMonth:function(){return this._.getUTCMonth()},getSeconds:function(){return this._.getUTCSeconds()},getTime:function(){return this._.getTime()},getTimezoneOffset:function(){return 0},valueOf:function(){return this._.valueOf()},setDate:function(){Us.setUTCDate.apply(this._,arguments)},setDay:function(){Us.setUTCDay.apply(this._,arguments)},setFullYear:function(){Us.setUTCFullYear.apply(this._,arguments)},setHours:function(){Us.setUTCHours.apply(this._,arguments)},setMilliseconds:function(){Us.setUTCMilliseconds.apply(this._,arguments)},setMinutes:function(){Us.setUTCMinutes.apply(this._,arguments)},setMonth:function(){Us.setUTCMonth.apply(this._,arguments)},setSeconds:function(){Us.setUTCSeconds.apply(this._,arguments)},setTime:function(){Us.setTime.apply(this._,arguments)}};var Us=Date.prototype,js="%a %b %e %X %Y",Hs="%m/%d/%Y",Fs="%H:%M:%S",Os=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],Ys=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],Is=["January","February","March","April","May","June","July","August","September","October","November","December"],Zs=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];Rs.year=co(function(n){return n=Rs.day(n),n.setMonth(0,1),n},function(n,t){n.setFullYear(n.getFullYear()+t)},function(n){return n.getFullYear()}),Rs.years=Rs.year.range,Rs.years.utc=Rs.year.utc.range,Rs.day=co(function(n){var t=new Ds(2e3,0);return t.setFullYear(n.getFullYear(),n.getMonth(),n.getDate()),t},function(n,t){n.setDate(n.getDate()+t)},function(n){return n.getDate()-1}),Rs.days=Rs.day.range,Rs.days.utc=Rs.day.utc.range,Rs.dayOfYear=function(n){var t=Rs.year(n);return Math.floor((n-t-6e4*(n.getTimezoneOffset()-t.getTimezoneOffset()))/864e5)},Ps.forEach(function(n,t){n=n.toLowerCase(),t=7-t;var e=Rs[n]=co(function(n){return(n=Rs.day(n)).setDate(n.getDate()-(n.getDay()+t)%7),n},function(n,t){n.setDate(n.getDate()+7*Math.floor(t))},function(n){var e=Rs.year(n).getDay();return Math.floor((Rs.dayOfYear(n)+(e+t)%7)/7)-(e!==t)});Rs[n+"s"]=e.range,Rs[n+"s"].utc=e.utc.range,Rs[n+"OfYear"]=function(n){var e=Rs.year(n).getDay();return Math.floor((Rs.dayOfYear(n)+(e+t)%7)/7)}}),Rs.week=Rs.sunday,Rs.weeks=Rs.sunday.range,Rs.weeks.utc=Rs.sunday.utc.range,Rs.weekOfYear=Rs.sundayOfYear,Rs.format=lo;var Vs=ho(Os),Xs=go(Os),$s=ho(Ys),Bs=go(Ys),Ws=ho(Is),Js=go(Is),Gs=ho(Zs),Ks=go(Zs),Qs=/^%/,nl={"-":"",_:" ",0:"0"},tl={a:function(n){return Ys[n.getDay()]},A:function(n){return Os[n.getDay()]},b:function(n){return Zs[n.getMonth()]},B:function(n){return Is[n.getMonth()]},c:lo(js),d:function(n,t){return po(n.getDate(),t,2)},e:function(n,t){return po(n.getDate(),t,2)},H:function(n,t){return po(n.getHours(),t,2)},I:function(n,t){return po(n.getHours()%12||12,t,2)},j:function(n,t){return po(1+Rs.dayOfYear(n),t,3)},L:function(n,t){return po(n.getMilliseconds(),t,3)},m:function(n,t){return po(n.getMonth()+1,t,2)},M:function(n,t){return po(n.getMinutes(),t,2)},p:function(n){return n.getHours()>=12?"PM":"AM"},S:function(n,t){return po(n.getSeconds(),t,2)},U:function(n,t){return po(Rs.sundayOfYear(n),t,2)},w:function(n){return n.getDay()},W:function(n,t){return po(Rs.mondayOfYear(n),t,2)},x:lo(Hs),X:lo(Fs),y:function(n,t){return po(n.getFullYear()%100,t,2)},Y:function(n,t){return po(n.getFullYear()%1e4,t,4)},Z:jo,"%":function(){return"%"}},el={a:vo,A:mo,b:_o,B:bo,c:wo,d:To,e:To,H:zo,I:zo,j:qo,L:Po,m:Lo,M:Ro,p:Uo,S:Do,U:xo,w:yo,W:Mo,x:So,X:ko,y:Ao,Y:Eo,Z:Co,"%":Ho},rl=/^\s*\d+/,ul=$o.map({am:0,pm:1});lo.utc=Fo;var il=Fo("%Y-%m-%dT%H:%M:%S.%LZ");lo.iso=Date.prototype.toISOString&&+new Date("2000-01-01T00:00:00.000Z")?Oo:il,Oo.parse=function(n){var t=new Date(n);return isNaN(t)?null:t},Oo.toString=il.toString,Rs.second=co(function(n){return new Ds(1e3*Math.floor(n/1e3))},function(n,t){n.setTime(n.getTime()+1e3*Math.floor(t))},function(n){return n.getSeconds()}),Rs.seconds=Rs.second.range,Rs.seconds.utc=Rs.second.utc.range,Rs.minute=co(function(n){return new Ds(6e4*Math.floor(n/6e4))},function(n,t){n.setTime(n.getTime()+6e4*Math.floor(t))},function(n){return n.getMinutes()}),Rs.minutes=Rs.minute.range,Rs.minutes.utc=Rs.minute.utc.range,Rs.hour=co(function(n){var t=n.getTimezoneOffset()/60;return new Ds(36e5*(Math.floor(n/36e5-t)+t))},function(n,t){n.setTime(n.getTime()+36e5*Math.floor(t))},function(n){return n.getHours()}),Rs.hours=Rs.hour.range,Rs.hours.utc=Rs.hour.utc.range,Rs.month=co(function(n){return n=Rs.day(n),n.setDate(1),n},function(n,t){n.setMonth(n.getMonth()+t)},function(n){return n.getMonth()}),Rs.months=Rs.month.range,Rs.months.utc=Rs.month.utc.range;var ol=[1e3,5e3,15e3,3e4,6e4,3e5,9e5,18e5,36e5,108e5,216e5,432e5,864e5,1728e5,6048e5,2592e6,7776e6,31536e6],al=[[Rs.second,1],[Rs.second,5],[Rs.second,15],[Rs.second,30],[Rs.minute,1],[Rs.minute,5],[Rs.minute,15],[Rs.minute,30],[Rs.hour,1],[Rs.hour,3],[Rs.hour,6],[Rs.hour,12],[Rs.day,1],[Rs.day,2],[Rs.week,1],[Rs.month,1],[Rs.month,3],[Rs.year,1]],cl=[[lo("%Y"),Zt],[lo("%B"),function(n){return n.getMonth()}],[lo("%b %d"),function(n){return 1!=n.getDate()}],[lo("%a %d"),function(n){return n.getDay()&&1!=n.getDate()}],[lo("%I %p"),function(n){return n.getHours()}],[lo("%I:%M"),function(n){return n.getMinutes()}],[lo(":%S"),function(n){return n.getSeconds()}],[lo(".%L"),function(n){return n.getMilliseconds()}]],sl=Zo(cl);al.year=Rs.year,Rs.scale=function(){return Yo($o.scale.linear(),al,sl)};var ll={range:function(n,t,e){return $o.range(+n,+t,e).map(Io)}},fl=al.map(function(n){return[n[0].utc,n[1]]}),hl=[[Fo("%Y"),Zt],[Fo("%B"),function(n){return n.getUTCMonth()}],[Fo("%b %d"),function(n){return 1!=n.getUTCDate()}],[Fo("%a %d"),function(n){return n.getUTCDay()&&1!=n.getUTCDate()}],[Fo("%I %p"),function(n){return n.getUTCHours()}],[Fo("%I:%M"),function(n){return n.getUTCMinutes()}],[Fo(":%S"),function(n){return n.getUTCSeconds()}],[Fo(".%L"),function(n){return n.getUTCMilliseconds()}]],gl=Zo(hl);return fl.year=Rs.year.utc,Rs.scale.utc=function(){return Yo($o.scale.linear(),fl,gl)},$o.text=dt(function(n){return n.responseText}),$o.json=function(n,t){return mt(n,"application/json",Vo,t)},$o.html=function(n,t){return mt(n,"text/html",Xo,t)},$o.xml=dt(function(n){return n.responseXML}),$o}();
            </script>
            
            <script >
              !function e(t,i,r){function n(o,s){if(!i[o]){if(!t[o]){var l="function"==typeof require&&require;if(!s&&l)return l(o,!0);if(a)return a(o,!0);var h=new Error("Cannot find module '"+o+"'");throw h.code="MODULE_NOT_FOUND",h}var f=i[o]={exports:{}};t[o][0].call(f.exports,function(e){var i=t[o][1][e];return n(i||e)},f,f.exports,e,t,i,r)}return i[o].exports}for(var a="function"==typeof require&&require,o=0;o<r.length;o++)n(r[o]);return n}({1:[function(e,t,i){"use strict";var r=e("./zlib/inflate"),n=e("./utils/common"),a=e("./utils/strings"),o=e("./zlib/constants"),s=e("./zlib/messages"),l=e("./zlib/zstream"),h=e("./zlib/gzheader"),f=Object.prototype.toString;function c(e){if(!(this instanceof c))return new c(e);this.options=n.assign({chunkSize:16384,windowBits:0,to:""},e||{});var t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,0===t.windowBits&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&0==(15&t.windowBits)&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new l,this.strm.avail_out=0;var i=r.inflateInit2(this.strm,t.windowBits);if(i!==o.Z_OK)throw new Error(s[i]);this.header=new h,r.inflateGetHeader(this.strm,this.header)}function u(e,t){var i=new c(t);if(i.push(e,!0),i.err)throw i.msg;return i.result}c.prototype.push=function(e,t){var i,s,l,h,c,u,d=this.strm,g=this.options.chunkSize,p=this.options.dictionary,y=!1;if(this.ended)return!1;s=t===~~t?t:!0===t?o.Z_FINISH:o.Z_NO_FLUSH,"string"==typeof e?d.input=a.binstring2buf(e):"[object ArrayBuffer]"===f.call(e)?d.input=new Uint8Array(e):d.input=e,d.next_in=0,d.avail_in=d.input.length;do{if(0===d.avail_out&&(d.output=new n.Buf8(g),d.next_out=0,d.avail_out=g),(i=r.inflate(d,o.Z_NO_FLUSH))===o.Z_NEED_DICT&&p&&(u="string"==typeof p?a.string2buf(p):"[object ArrayBuffer]"===f.call(p)?new Uint8Array(p):p,i=r.inflateSetDictionary(this.strm,u)),i===o.Z_BUF_ERROR&&!0===y&&(i=o.Z_OK,y=!1),i!==o.Z_STREAM_END&&i!==o.Z_OK)return this.onEnd(i),this.ended=!0,!1;d.next_out&&(0!==d.avail_out&&i!==o.Z_STREAM_END&&(0!==d.avail_in||s!==o.Z_FINISH&&s!==o.Z_SYNC_FLUSH)||("string"===this.options.to?(l=a.utf8border(d.output,d.next_out),h=d.next_out-l,c=a.buf2string(d.output,l),d.next_out=h,d.avail_out=g-h,h&&n.arraySet(d.output,d.output,l,h,0),this.onData(c)):this.onData(n.shrinkBuf(d.output,d.next_out)))),0===d.avail_in&&0===d.avail_out&&(y=!0)}while((d.avail_in>0||0===d.avail_out)&&i!==o.Z_STREAM_END);return i===o.Z_STREAM_END&&(s=o.Z_FINISH),s===o.Z_FINISH?(i=r.inflateEnd(this.strm),this.onEnd(i),this.ended=!0,i===o.Z_OK):s!==o.Z_SYNC_FLUSH||(this.onEnd(o.Z_OK),d.avail_out=0,!0)},c.prototype.onData=function(e){this.chunks.push(e)},c.prototype.onEnd=function(e){e===o.Z_OK&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=n.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},i.Inflate=c,i.inflate=u,i.inflateRaw=function(e,t){return(t=t||{}).raw=!0,u(e,t)},i.ungzip=u},{"./utils/common":2,"./utils/strings":3,"./zlib/constants":5,"./zlib/gzheader":7,"./zlib/inflate":9,"./zlib/messages":11,"./zlib/zstream":12}],2:[function(e,t,i){"use strict";var r="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;i.assign=function(e){for(var t=Array.prototype.slice.call(arguments,1);t.length;){var i=t.shift();if(i){if("object"!=typeof i)throw new TypeError(i+"must be non-object");for(var r in i)i.hasOwnProperty(r)&&(e[r]=i[r])}}return e},i.shrinkBuf=function(e,t){return e.length===t?e:e.subarray?e.subarray(0,t):(e.length=t,e)};var n={arraySet:function(e,t,i,r,n){if(t.subarray&&e.subarray)e.set(t.subarray(i,i+r),n);else for(var a=0;a<r;a++)e[n+a]=t[i+a]},flattenChunks:function(e){var t,i,r,n,a,o;for(r=0,t=0,i=e.length;t<i;t++)r+=e[t].length;for(o=new Uint8Array(r),n=0,t=0,i=e.length;t<i;t++)a=e[t],o.set(a,n),n+=a.length;return o}},a={arraySet:function(e,t,i,r,n){for(var a=0;a<r;a++)e[n+a]=t[i+a]},flattenChunks:function(e){return[].concat.apply([],e)}};i.setTyped=function(e){e?(i.Buf8=Uint8Array,i.Buf16=Uint16Array,i.Buf32=Int32Array,i.assign(i,n)):(i.Buf8=Array,i.Buf16=Array,i.Buf32=Array,i.assign(i,a))},i.setTyped(r)},{}],3:[function(e,t,i){"use strict";var r=e("./common"),n=!0,a=!0;try{String.fromCharCode.apply(null,[0])}catch(e){n=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(e){a=!1}for(var o=new r.Buf8(256),s=0;s<256;s++)o[s]=s>=252?6:s>=248?5:s>=240?4:s>=224?3:s>=192?2:1;function l(e,t){if(t<65537&&(e.subarray&&a||!e.subarray&&n))return String.fromCharCode.apply(null,r.shrinkBuf(e,t));for(var i="",o=0;o<t;o++)i+=String.fromCharCode(e[o]);return i}o[254]=o[254]=1,i.string2buf=function(e){var t,i,n,a,o,s=e.length,l=0;for(a=0;a<s;a++)55296==(64512&(i=e.charCodeAt(a)))&&a+1<s&&56320==(64512&(n=e.charCodeAt(a+1)))&&(i=65536+(i-55296<<10)+(n-56320),a++),l+=i<128?1:i<2048?2:i<65536?3:4;for(t=new r.Buf8(l),o=0,a=0;o<l;a++)55296==(64512&(i=e.charCodeAt(a)))&&a+1<s&&56320==(64512&(n=e.charCodeAt(a+1)))&&(i=65536+(i-55296<<10)+(n-56320),a++),i<128?t[o++]=i:i<2048?(t[o++]=192|i>>>6,t[o++]=128|63&i):i<65536?(t[o++]=224|i>>>12,t[o++]=128|i>>>6&63,t[o++]=128|63&i):(t[o++]=240|i>>>18,t[o++]=128|i>>>12&63,t[o++]=128|i>>>6&63,t[o++]=128|63&i);return t},i.buf2binstring=function(e){return l(e,e.length)},i.binstring2buf=function(e){for(var t=new r.Buf8(e.length),i=0,n=t.length;i<n;i++)t[i]=e.charCodeAt(i);return t},i.buf2string=function(e,t){var i,r,n,a,s=t||e.length,h=new Array(2*s);for(r=0,i=0;i<s;)if((n=e[i++])<128)h[r++]=n;else if((a=o[n])>4)h[r++]=65533,i+=a-1;else{for(n&=2===a?31:3===a?15:7;a>1&&i<s;)n=n<<6|63&e[i++],a--;a>1?h[r++]=65533:n<65536?h[r++]=n:(n-=65536,h[r++]=55296|n>>10&1023,h[r++]=56320|1023&n)}return l(h,r)},i.utf8border=function(e,t){var i;for((t=t||e.length)>e.length&&(t=e.length),i=t-1;i>=0&&128==(192&e[i]);)i--;return i<0?t:0===i?t:i+o[e[i]]>t?i:t}},{"./common":2}],4:[function(e,t,i){"use strict";t.exports=function(e,t,i,r){for(var n=65535&e|0,a=e>>>16&65535|0,o=0;0!==i;){i-=o=i>2e3?2e3:i;do{a=a+(n=n+t[r++]|0)|0}while(--o);n%=65521,a%=65521}return n|a<<16|0}},{}],5:[function(e,t,i){"use strict";t.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],6:[function(e,t,i){"use strict";var r=function(){for(var e,t=[],i=0;i<256;i++){e=i;for(var r=0;r<8;r++)e=1&e?3988292384^e>>>1:e>>>1;t[i]=e}return t}();t.exports=function(e,t,i,n){var a=r,o=n+i;e^=-1;for(var s=n;s<o;s++)e=e>>>8^a[255&(e^t[s])];return-1^e}},{}],7:[function(e,t,i){"use strict";t.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],8:[function(e,t,i){"use strict";t.exports=function(e,t){var i,r,n,a,o,s,l,h,f,c,u,d,g,p,y,w,m,b,v,k,S,_,x,D,A;i=e.state,r=e.next_in,D=e.input,n=r+(e.avail_in-5),a=e.next_out,A=e.output,o=a-(t-e.avail_out),s=a+(e.avail_out-257),l=i.dmax,h=i.wsize,f=i.whave,c=i.wnext,u=i.window,d=i.hold,g=i.bits,p=i.lencode,y=i.distcode,w=(1<<i.lenbits)-1,m=(1<<i.distbits)-1;e:do{g<15&&(d+=D[r++]<<g,g+=8,d+=D[r++]<<g,g+=8),b=p[d&w];t:for(;;){if(d>>>=v=b>>>24,g-=v,0===(v=b>>>16&255))A[a++]=65535&b;else{if(!(16&v)){if(0==(64&v)){b=p[(65535&b)+(d&(1<<v)-1)];continue t}if(32&v){i.mode=12;break e}e.msg="invalid literal/length code",i.mode=30;break e}k=65535&b,(v&=15)&&(g<v&&(d+=D[r++]<<g,g+=8),k+=d&(1<<v)-1,d>>>=v,g-=v),g<15&&(d+=D[r++]<<g,g+=8,d+=D[r++]<<g,g+=8),b=y[d&m];i:for(;;){if(d>>>=v=b>>>24,g-=v,!(16&(v=b>>>16&255))){if(0==(64&v)){b=y[(65535&b)+(d&(1<<v)-1)];continue i}e.msg="invalid distance code",i.mode=30;break e}if(S=65535&b,g<(v&=15)&&(d+=D[r++]<<g,(g+=8)<v&&(d+=D[r++]<<g,g+=8)),(S+=d&(1<<v)-1)>l){e.msg="invalid distance too far back",i.mode=30;break e}if(d>>>=v,g-=v,S>(v=a-o)){if((v=S-v)>f&&i.sane){e.msg="invalid distance too far back",i.mode=30;break e}if(_=0,x=u,0===c){if(_+=h-v,v<k){k-=v;do{A[a++]=u[_++]}while(--v);_=a-S,x=A}}else if(c<v){if(_+=h+c-v,(v-=c)<k){k-=v;do{A[a++]=u[_++]}while(--v);if(_=0,c<k){k-=v=c;do{A[a++]=u[_++]}while(--v);_=a-S,x=A}}}else if(_+=c-v,v<k){k-=v;do{A[a++]=u[_++]}while(--v);_=a-S,x=A}for(;k>2;)A[a++]=x[_++],A[a++]=x[_++],A[a++]=x[_++],k-=3;k&&(A[a++]=x[_++],k>1&&(A[a++]=x[_++]))}else{_=a-S;do{A[a++]=A[_++],A[a++]=A[_++],A[a++]=A[_++],k-=3}while(k>2);k&&(A[a++]=A[_++],k>1&&(A[a++]=A[_++]))}break}}break}}while(r<n&&a<s);r-=k=g>>3,d&=(1<<(g-=k<<3))-1,e.next_in=r,e.next_out=a,e.avail_in=r<n?n-r+5:5-(r-n),e.avail_out=a<s?s-a+257:257-(a-s),i.hold=d,i.bits=g}},{}],9:[function(e,t,i){"use strict";var r=e("../utils/common"),n=e("./adler32"),a=e("./crc32"),o=e("./inffast"),s=e("./inftrees"),l=0,h=1,f=2,c=4,u=5,d=6,g=0,p=1,y=2,w=-2,m=-3,b=-4,v=-5,k=8,S=1,_=2,x=3,D=4,A=5,T=6,E=7,I=8,C=9,B=10,O=11,L=12,P=13,U=14,G=15,M=16,F=17,N=18,R=19,K=20,V=21,j=22,Z=23,z=24,H=25,W=26,Y=27,X=28,q=29,J=30,Q=31,$=32,ee=852,te=592,ie=15;function re(e){return(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24)}function ne(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new r.Buf16(320),this.work=new r.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function ae(e){var t;return e&&e.state?(t=e.state,e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=S,t.last=0,t.havedict=0,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new r.Buf32(ee),t.distcode=t.distdyn=new r.Buf32(te),t.sane=1,t.back=-1,g):w}function oe(e){var t;return e&&e.state?((t=e.state).wsize=0,t.whave=0,t.wnext=0,ae(e)):w}function se(e,t){var i,r;return e&&e.state?(r=e.state,t<0?(i=0,t=-t):(i=1+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?w:(null!==r.window&&r.wbits!==t&&(r.window=null),r.wrap=i,r.wbits=t,oe(e))):w}function le(e,t){var i,r;return e?(r=new ne,e.state=r,r.window=null,(i=se(e,t))!==g&&(e.state=null),i):w}var he,fe,ce=!0;function ue(e){if(ce){var t;for(he=new r.Buf32(512),fe=new r.Buf32(32),t=0;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(s(h,e.lens,0,288,he,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;s(f,e.lens,0,32,fe,0,e.work,{bits:5}),ce=!1}e.lencode=he,e.lenbits=9,e.distcode=fe,e.distbits=5}function de(e,t,i,n){var a,o=e.state;return null===o.window&&(o.wsize=1<<o.wbits,o.wnext=0,o.whave=0,o.window=new r.Buf8(o.wsize)),n>=o.wsize?(r.arraySet(o.window,t,i-o.wsize,o.wsize,0),o.wnext=0,o.whave=o.wsize):((a=o.wsize-o.wnext)>n&&(a=n),r.arraySet(o.window,t,i-n,a,o.wnext),(n-=a)?(r.arraySet(o.window,t,i-n,n,0),o.wnext=n,o.whave=o.wsize):(o.wnext+=a,o.wnext===o.wsize&&(o.wnext=0),o.whave<o.wsize&&(o.whave+=a))),0}i.inflateReset=oe,i.inflateReset2=se,i.inflateResetKeep=ae,i.inflateInit=function(e){return le(e,ie)},i.inflateInit2=le,i.inflate=function(e,t){var i,ee,te,ie,ne,ae,oe,se,le,he,fe,ce,ge,pe,ye,we,me,be,ve,ke,Se,_e,xe,De,Ae=0,Te=new r.Buf8(4),Ee=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!e||!e.state||!e.output||!e.input&&0!==e.avail_in)return w;(i=e.state).mode===L&&(i.mode=P),ne=e.next_out,te=e.output,oe=e.avail_out,ie=e.next_in,ee=e.input,ae=e.avail_in,se=i.hold,le=i.bits,he=ae,fe=oe,_e=g;e:for(;;)switch(i.mode){case S:if(0===i.wrap){i.mode=P;break}for(;le<16;){if(0===ae)break e;ae--,se+=ee[ie++]<<le,le+=8}if(2&i.wrap&&35615===se){i.check=0,Te[0]=255&se,Te[1]=se>>>8&255,i.check=a(i.check,Te,2,0),se=0,le=0,i.mode=_;break}if(i.flags=0,i.head&&(i.head.done=!1),!(1&i.wrap)||(((255&se)<<8)+(se>>8))%31){e.msg="incorrect header check",i.mode=J;break}if((15&se)!==k){e.msg="unknown compression method",i.mode=J;break}if(le-=4,Se=8+(15&(se>>>=4)),0===i.wbits)i.wbits=Se;else if(Se>i.wbits){e.msg="invalid window size",i.mode=J;break}i.dmax=1<<Se,e.adler=i.check=1,i.mode=512&se?B:L,se=0,le=0;break;case _:for(;le<16;){if(0===ae)break e;ae--,se+=ee[ie++]<<le,le+=8}if(i.flags=se,(255&i.flags)!==k){e.msg="unknown compression method",i.mode=J;break}if(57344&i.flags){e.msg="unknown header flags set",i.mode=J;break}i.head&&(i.head.text=se>>8&1),512&i.flags&&(Te[0]=255&se,Te[1]=se>>>8&255,i.check=a(i.check,Te,2,0)),se=0,le=0,i.mode=x;case x:for(;le<32;){if(0===ae)break e;ae--,se+=ee[ie++]<<le,le+=8}i.head&&(i.head.time=se),512&i.flags&&(Te[0]=255&se,Te[1]=se>>>8&255,Te[2]=se>>>16&255,Te[3]=se>>>24&255,i.check=a(i.check,Te,4,0)),se=0,le=0,i.mode=D;case D:for(;le<16;){if(0===ae)break e;ae--,se+=ee[ie++]<<le,le+=8}i.head&&(i.head.xflags=255&se,i.head.os=se>>8),512&i.flags&&(Te[0]=255&se,Te[1]=se>>>8&255,i.check=a(i.check,Te,2,0)),se=0,le=0,i.mode=A;case A:if(1024&i.flags){for(;le<16;){if(0===ae)break e;ae--,se+=ee[ie++]<<le,le+=8}i.length=se,i.head&&(i.head.extra_len=se),512&i.flags&&(Te[0]=255&se,Te[1]=se>>>8&255,i.check=a(i.check,Te,2,0)),se=0,le=0}else i.head&&(i.head.extra=null);i.mode=T;case T:if(1024&i.flags&&((ce=i.length)>ae&&(ce=ae),ce&&(i.head&&(Se=i.head.extra_len-i.length,i.head.extra||(i.head.extra=new Array(i.head.extra_len)),r.arraySet(i.head.extra,ee,ie,ce,Se)),512&i.flags&&(i.check=a(i.check,ee,ce,ie)),ae-=ce,ie+=ce,i.length-=ce),i.length))break e;i.length=0,i.mode=E;case E:if(2048&i.flags){if(0===ae)break e;ce=0;do{Se=ee[ie+ce++],i.head&&Se&&i.length<65536&&(i.head.name+=String.fromCharCode(Se))}while(Se&&ce<ae);if(512&i.flags&&(i.check=a(i.check,ee,ce,ie)),ae-=ce,ie+=ce,Se)break e}else i.head&&(i.head.name=null);i.length=0,i.mode=I;case I:if(4096&i.flags){if(0===ae)break e;ce=0;do{Se=ee[ie+ce++],i.head&&Se&&i.length<65536&&(i.head.comment+=String.fromCharCode(Se))}while(Se&&ce<ae);if(512&i.flags&&(i.check=a(i.check,ee,ce,ie)),ae-=ce,ie+=ce,Se)break e}else i.head&&(i.head.comment=null);i.mode=C;case C:if(512&i.flags){for(;le<16;){if(0===ae)break e;ae--,se+=ee[ie++]<<le,le+=8}if(se!==(65535&i.check)){e.msg="header crc mismatch",i.mode=J;break}se=0,le=0}i.head&&(i.head.hcrc=i.flags>>9&1,i.head.done=!0),e.adler=i.check=0,i.mode=L;break;case B:for(;le<32;){if(0===ae)break e;ae--,se+=ee[ie++]<<le,le+=8}e.adler=i.check=re(se),se=0,le=0,i.mode=O;case O:if(0===i.havedict)return e.next_out=ne,e.avail_out=oe,e.next_in=ie,e.avail_in=ae,i.hold=se,i.bits=le,y;e.adler=i.check=1,i.mode=L;case L:if(t===u||t===d)break e;case P:if(i.last){se>>>=7&le,le-=7&le,i.mode=Y;break}for(;le<3;){if(0===ae)break e;ae--,se+=ee[ie++]<<le,le+=8}switch(i.last=1&se,le-=1,3&(se>>>=1)){case 0:i.mode=U;break;case 1:if(ue(i),i.mode=K,t===d){se>>>=2,le-=2;break e}break;case 2:i.mode=F;break;case 3:e.msg="invalid block type",i.mode=J}se>>>=2,le-=2;break;case U:for(se>>>=7&le,le-=7&le;le<32;){if(0===ae)break e;ae--,se+=ee[ie++]<<le,le+=8}if((65535&se)!=(se>>>16^65535)){e.msg="invalid stored block lengths",i.mode=J;break}if(i.length=65535&se,se=0,le=0,i.mode=G,t===d)break e;case G:i.mode=M;case M:if(ce=i.length){if(ce>ae&&(ce=ae),ce>oe&&(ce=oe),0===ce)break e;r.arraySet(te,ee,ie,ce,ne),ae-=ce,ie+=ce,oe-=ce,ne+=ce,i.length-=ce;break}i.mode=L;break;case F:for(;le<14;){if(0===ae)break e;ae--,se+=ee[ie++]<<le,le+=8}if(i.nlen=257+(31&se),se>>>=5,le-=5,i.ndist=1+(31&se),se>>>=5,le-=5,i.ncode=4+(15&se),se>>>=4,le-=4,i.nlen>286||i.ndist>30){e.msg="too many length or distance symbols",i.mode=J;break}i.have=0,i.mode=N;case N:for(;i.have<i.ncode;){for(;le<3;){if(0===ae)break e;ae--,se+=ee[ie++]<<le,le+=8}i.lens[Ee[i.have++]]=7&se,se>>>=3,le-=3}for(;i.have<19;)i.lens[Ee[i.have++]]=0;if(i.lencode=i.lendyn,i.lenbits=7,xe={bits:i.lenbits},_e=s(l,i.lens,0,19,i.lencode,0,i.work,xe),i.lenbits=xe.bits,_e){e.msg="invalid code lengths set",i.mode=J;break}i.have=0,i.mode=R;case R:for(;i.have<i.nlen+i.ndist;){for(;we=(Ae=i.lencode[se&(1<<i.lenbits)-1])>>>16&255,me=65535&Ae,!((ye=Ae>>>24)<=le);){if(0===ae)break e;ae--,se+=ee[ie++]<<le,le+=8}if(me<16)se>>>=ye,le-=ye,i.lens[i.have++]=me;else{if(16===me){for(De=ye+2;le<De;){if(0===ae)break e;ae--,se+=ee[ie++]<<le,le+=8}if(se>>>=ye,le-=ye,0===i.have){e.msg="invalid bit length repeat",i.mode=J;break}Se=i.lens[i.have-1],ce=3+(3&se),se>>>=2,le-=2}else if(17===me){for(De=ye+3;le<De;){if(0===ae)break e;ae--,se+=ee[ie++]<<le,le+=8}le-=ye,Se=0,ce=3+(7&(se>>>=ye)),se>>>=3,le-=3}else{for(De=ye+7;le<De;){if(0===ae)break e;ae--,se+=ee[ie++]<<le,le+=8}le-=ye,Se=0,ce=11+(127&(se>>>=ye)),se>>>=7,le-=7}if(i.have+ce>i.nlen+i.ndist){e.msg="invalid bit length repeat",i.mode=J;break}for(;ce--;)i.lens[i.have++]=Se}}if(i.mode===J)break;if(0===i.lens[256]){e.msg="invalid code -- missing end-of-block",i.mode=J;break}if(i.lenbits=9,xe={bits:i.lenbits},_e=s(h,i.lens,0,i.nlen,i.lencode,0,i.work,xe),i.lenbits=xe.bits,_e){e.msg="invalid literal/lengths set",i.mode=J;break}if(i.distbits=6,i.distcode=i.distdyn,xe={bits:i.distbits},_e=s(f,i.lens,i.nlen,i.ndist,i.distcode,0,i.work,xe),i.distbits=xe.bits,_e){e.msg="invalid distances set",i.mode=J;break}if(i.mode=K,t===d)break e;case K:i.mode=V;case V:if(ae>=6&&oe>=258){e.next_out=ne,e.avail_out=oe,e.next_in=ie,e.avail_in=ae,i.hold=se,i.bits=le,o(e,fe),ne=e.next_out,te=e.output,oe=e.avail_out,ie=e.next_in,ee=e.input,ae=e.avail_in,se=i.hold,le=i.bits,i.mode===L&&(i.back=-1);break}for(i.back=0;we=(Ae=i.lencode[se&(1<<i.lenbits)-1])>>>16&255,me=65535&Ae,!((ye=Ae>>>24)<=le);){if(0===ae)break e;ae--,se+=ee[ie++]<<le,le+=8}if(we&&0==(240&we)){for(be=ye,ve=we,ke=me;we=(Ae=i.lencode[ke+((se&(1<<be+ve)-1)>>be)])>>>16&255,me=65535&Ae,!(be+(ye=Ae>>>24)<=le);){if(0===ae)break e;ae--,se+=ee[ie++]<<le,le+=8}se>>>=be,le-=be,i.back+=be}if(se>>>=ye,le-=ye,i.back+=ye,i.length=me,0===we){i.mode=W;break}if(32&we){i.back=-1,i.mode=L;break}if(64&we){e.msg="invalid literal/length code",i.mode=J;break}i.extra=15&we,i.mode=j;case j:if(i.extra){for(De=i.extra;le<De;){if(0===ae)break e;ae--,se+=ee[ie++]<<le,le+=8}i.length+=se&(1<<i.extra)-1,se>>>=i.extra,le-=i.extra,i.back+=i.extra}i.was=i.length,i.mode=Z;case Z:for(;we=(Ae=i.distcode[se&(1<<i.distbits)-1])>>>16&255,me=65535&Ae,!((ye=Ae>>>24)<=le);){if(0===ae)break e;ae--,se+=ee[ie++]<<le,le+=8}if(0==(240&we)){for(be=ye,ve=we,ke=me;we=(Ae=i.distcode[ke+((se&(1<<be+ve)-1)>>be)])>>>16&255,me=65535&Ae,!(be+(ye=Ae>>>24)<=le);){if(0===ae)break e;ae--,se+=ee[ie++]<<le,le+=8}se>>>=be,le-=be,i.back+=be}if(se>>>=ye,le-=ye,i.back+=ye,64&we){e.msg="invalid distance code",i.mode=J;break}i.offset=me,i.extra=15&we,i.mode=z;case z:if(i.extra){for(De=i.extra;le<De;){if(0===ae)break e;ae--,se+=ee[ie++]<<le,le+=8}i.offset+=se&(1<<i.extra)-1,se>>>=i.extra,le-=i.extra,i.back+=i.extra}if(i.offset>i.dmax){e.msg="invalid distance too far back",i.mode=J;break}i.mode=H;case H:if(0===oe)break e;if(ce=fe-oe,i.offset>ce){if((ce=i.offset-ce)>i.whave&&i.sane){e.msg="invalid distance too far back",i.mode=J;break}ce>i.wnext?(ce-=i.wnext,ge=i.wsize-ce):ge=i.wnext-ce,ce>i.length&&(ce=i.length),pe=i.window}else pe=te,ge=ne-i.offset,ce=i.length;ce>oe&&(ce=oe),oe-=ce,i.length-=ce;do{te[ne++]=pe[ge++]}while(--ce);0===i.length&&(i.mode=V);break;case W:if(0===oe)break e;te[ne++]=i.length,oe--,i.mode=V;break;case Y:if(i.wrap){for(;le<32;){if(0===ae)break e;ae--,se|=ee[ie++]<<le,le+=8}if(fe-=oe,e.total_out+=fe,i.total+=fe,fe&&(e.adler=i.check=i.flags?a(i.check,te,fe,ne-fe):n(i.check,te,fe,ne-fe)),fe=oe,(i.flags?se:re(se))!==i.check){e.msg="incorrect data check",i.mode=J;break}se=0,le=0}i.mode=X;case X:if(i.wrap&&i.flags){for(;le<32;){if(0===ae)break e;ae--,se+=ee[ie++]<<le,le+=8}if(se!==(4294967295&i.total)){e.msg="incorrect length check",i.mode=J;break}se=0,le=0}i.mode=q;case q:_e=p;break e;case J:_e=m;break e;case Q:return b;case $:default:return w}return e.next_out=ne,e.avail_out=oe,e.next_in=ie,e.avail_in=ae,i.hold=se,i.bits=le,(i.wsize||fe!==e.avail_out&&i.mode<J&&(i.mode<Y||t!==c))&&de(e,e.output,e.next_out,fe-e.avail_out)?(i.mode=Q,b):(he-=e.avail_in,fe-=e.avail_out,e.total_in+=he,e.total_out+=fe,i.total+=fe,i.wrap&&fe&&(e.adler=i.check=i.flags?a(i.check,te,fe,e.next_out-fe):n(i.check,te,fe,e.next_out-fe)),e.data_type=i.bits+(i.last?64:0)+(i.mode===L?128:0)+(i.mode===K||i.mode===G?256:0),(0===he&&0===fe||t===c)&&_e===g&&(_e=v),_e)},i.inflateEnd=function(e){if(!e||!e.state)return w;var t=e.state;return t.window&&(t.window=null),e.state=null,g},i.inflateGetHeader=function(e,t){var i;return e&&e.state?0==(2&(i=e.state).wrap)?w:(i.head=t,t.done=!1,g):w},i.inflateSetDictionary=function(e,t){var i,r=t.length;return e&&e.state?0!==(i=e.state).wrap&&i.mode!==O?w:i.mode===O&&n(1,t,r,0)!==i.check?m:de(e,t,r,r)?(i.mode=Q,b):(i.havedict=1,g):w},i.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":2,"./adler32":4,"./crc32":6,"./inffast":8,"./inftrees":10}],10:[function(e,t,i){"use strict";var r=e("../utils/common"),n=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],a=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],o=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],s=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];t.exports=function(e,t,i,l,h,f,c,u){var d,g,p,y,w,m,b,v,k,S=u.bits,_=0,x=0,D=0,A=0,T=0,E=0,I=0,C=0,B=0,O=0,L=null,P=0,U=new r.Buf16(16),G=new r.Buf16(16),M=null,F=0;for(_=0;_<=15;_++)U[_]=0;for(x=0;x<l;x++)U[t[i+x]]++;for(T=S,A=15;A>=1&&0===U[A];A--);if(T>A&&(T=A),0===A)return h[f++]=20971520,h[f++]=20971520,u.bits=1,0;for(D=1;D<A&&0===U[D];D++);for(T<D&&(T=D),C=1,_=1;_<=15;_++)if(C<<=1,(C-=U[_])<0)return-1;if(C>0&&(0===e||1!==A))return-1;for(G[1]=0,_=1;_<15;_++)G[_+1]=G[_]+U[_];for(x=0;x<l;x++)0!==t[i+x]&&(c[G[t[i+x]]++]=x);if(0===e?(L=M=c,m=19):1===e?(L=n,P-=257,M=a,F-=257,m=256):(L=o,M=s,m=-1),O=0,x=0,_=D,w=f,E=T,I=0,p=-1,y=(B=1<<T)-1,1===e&&B>852||2===e&&B>592)return 1;for(;;){0,b=_-I,c[x]<m?(v=0,k=c[x]):c[x]>m?(v=M[F+c[x]],k=L[P+c[x]]):(v=96,k=0),d=1<<_-I,D=g=1<<E;do{h[w+(O>>I)+(g-=d)]=b<<24|v<<16|k|0}while(0!==g);for(d=1<<_-1;O&d;)d>>=1;if(0!==d?(O&=d-1,O+=d):O=0,x++,0==--U[_]){if(_===A)break;_=t[i+c[x]]}if(_>T&&(O&y)!==p){for(0===I&&(I=T),w+=D,C=1<<(E=_-I);E+I<A&&!((C-=U[E+I])<=0);)E++,C<<=1;if(B+=1<<E,1===e&&B>852||2===e&&B>592)return 1;h[p=O&y]=T<<24|E<<16|w-f|0}}return 0!==O&&(h[w+O]=_-I<<24|64<<16|0),u.bits=T,0}},{"../utils/common":2}],11:[function(e,t,i){"use strict";t.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],12:[function(e,t,i){"use strict";t.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],13:[function(e,t,i){"use strict";function r(){}r.prototype={isAsync:function(){return void 0===this.decodeBlock}},t.exports=r},{}],14:[function(e,t,i){"use strict";var r=e("../abstractdecoder.js"),n=e("pako/lib/inflate").inflate;function a(){}a.prototype=Object.create(r.prototype),a.prototype.constructor=a,a.prototype.decodeBlock=function(e){return n(new Uint8Array(e)).buffer},t.exports=a},{"../abstractdecoder.js":13,"pako/lib/inflate":1}],15:[function(e,t,i){"use strict";var r=e("../abstractdecoder.js");function n(){this.littleEndian=!1,this.position=0,this._makeEntryLookup=!1,this.dictionary=[]}function a(){this.decompressor=new n}n.prototype={constructor:n,initDictionary:function(){this.dictionary=new Array(258),this.entryLookup={},this.byteLength=9;for(var e=0;e<=257;e++)this.dictionary[e]=[e],this._makeEntryLookup&&(this.entryLookup[e]=e)},decompress:function(e){this._makeEntryLookup=!1,this.initDictionary(),this.position=0,this.result=[],e.buffer||(e=new Uint8Array(e));for(var t,i=new DataView(e.buffer),r=this.getNext(i);257!==r;){if(256===r){for(this.initDictionary(),r=this.getNext(i);256===r;)r=this.getNext(i);if(r>256)throw"corrupted code at scanline "+r;if(257===r)break;var n=this.dictionary[r];this.appendArray(this.result,n),t=r}else if(void 0!==this.dictionary[r]){var a=this.dictionary[r];this.appendArray(this.result,a);var o=this.dictionary[t].concat(this.dictionary[r][0]);this.addToDictionary(o),t=r}else{var s=this.dictionary[t];if(!s)throw"Bogus entry. Not in dictionary, "+t+" / "+this.dictionary.length+", position: "+this.position;var l=s.concat(this.dictionary[t][0]);this.appendArray(this.result,l),this.addToDictionary(l),t=r}this.dictionary.length>=Math.pow(2,this.byteLength)-1&&this.byteLength++,r=this.getNext(i)}return new Uint8Array(this.result)},appendArray:function(e,t){for(var i=0;i<t.length;i++)e.push(t[i]);return e},haveBytesChanged:function(){return this.dictionary.length>=Math.pow(2,this.byteLength)&&(this.byteLength++,!0)},addToDictionary:function(e){return this.dictionary.push(e),this._makeEntryLookup&&(this.entryLookup[e]=this.dictionary.length-1),this.haveBytesChanged(),this.dictionary.length-1},getNext:function(e){var t=this.getByte(e,this.position,this.byteLength);return this.position+=this.byteLength,t},getByte:function(e,t,i){var r=t%8,n=Math.floor(t/8),a=8-r,o=t+i-8*(n+1),s=8*(n+2)-(t+i),l=8*(n+2)-t;if(s=Math.max(0,s),n>=e.byteLength)return console.warn("ran off the end of the buffer before finding EOI_CODE (end on input code)"),257;var h=e.getUint8(n,this.littleEndian)&Math.pow(2,8-r)-1,f=h<<=i-a;if(n+1<e.byteLength){var c=e.getUint8(n+1,this.littleEndian)>>>s;f+=c<<=Math.max(0,i-l)}if(o>8&&n+2<e.byteLength){var u=8*(n+3)-(t+i);f+=e.getUint8(n+2,this.littleEndian)>>>u}return f},compress:function(e){this._makeEntryLookup=!0,this.initDictionary(),this.position=0;var t=[],i=[];t=this.appendArray(t,this.binaryFromByte(256,this.byteLength));for(var r=0;r<e.length;r++){var n=[e[r]],a=i.concat(n);if(void 0!==this.entryLookup[a])i=a;else{var o=this.entryLookup[i],s=this.binaryFromByte(o,this.byteLength);t=this.appendArray(t,s),this.addToDictionary(a),i=n,this.dictionary.length>=Math.pow(2,12)&&(t=this.appendArray(t,this.binaryFromByte(256,this.byteLength)),this.initDictionary())}}var l=this.entryLookup[i],h=this.binaryFromByte(l,this.byteLength);return t=this.appendArray(t,h),t=t=this.appendArray(t,this.binaryFromByte(257,this.byteLength)),this.binary=t,this.result=this.binaryToUint8(t),this.result},byteFromCode:function(e){return this.dictionary[e]},binaryFromByte:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:8,i=new Uint8Array(t),r=0;r<i.length;r++){var n=(e&Math.pow(2,r))>0;i[i.length-1-r]=n}return i},binaryToNumber:function(e){for(var t=0,i=0;i<e.length;i++)t+=Math.pow(2,e.length-i-1)*e[i];return t},inputToBinary:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:8,i=new Uint8Array(e.length*t),r=0;r<e.length;r++){var n=this.binaryFromByte(e[r],t);i.set(n,r*t)}return i},binaryToUint8:function(e){for(var t=new Uint8Array(Math.ceil(e.length/8)),i=0,r=0;r<e.length;r+=8){for(var n=0,a=0;a<8&&r+a<e.length;a++)n+=e[r+a]*Math.pow(2,8-a-1);t[i]=n,i++}return t}},a.prototype=Object.create(r.prototype),a.prototype.constructor=a,a.prototype.decodeBlock=function(e){return this.decompressor.decompress(e).buffer},t.exports=a},{"../abstractdecoder.js":13}],16:[function(e,t,i){"use strict";var r=e("../abstractdecoder.js");function n(){}n.prototype=Object.create(r.prototype),n.prototype.constructor=n,n.prototype.decodeBlock=function(e){var t,i,r=new DataView(e),n=[];for(t=0;t<e.byteLength;++t){var a=r.getInt8(t);if(a<0){var o=r.getUint8(t+1);for(a=-a,i=0;i<=a;++i)n.push(o);t+=1}else{for(i=0;i<=a;++i)n.push(r.getUint8(t+i+1));t+=a+1}}return new Uint8Array(n).buffer},t.exports=n},{"../abstractdecoder.js":13}],17:[function(e,t,i){"use strict";var r=e("../abstractdecoder.js");function n(){}n.prototype=Object.create(r.prototype),n.prototype.constructor=n,n.prototype.decodeBlock=function(e){return e},t.exports=n},{"../abstractdecoder.js":13}],18:[function(e,t,i){"use strict";var r=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}();var n=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._dataView=new DataView(t)}return r(e,[{key:"getUint64",value:function(e,t){var i=this.getUint32(e,t),r=this.getUint32(e+4,t);return t?i<<32|r:r<<32|i}},{key:"getInt64",value:function(e,t){var i;return t?(i=this.getInt32(e,t))<<32|this.getUint32(e+4,t):(i=this.getUint32(e,t),this.getInt32(e+4,t)<<32|i)}},{key:"getUint8",value:function(e,t){return this._dataView.getUint8(e,t)}},{key:"getInt8",value:function(e,t){return this._dataView.getInt8(e,t)}},{key:"getUint16",value:function(e,t){return this._dataView.getUint16(e,t)}},{key:"getInt16",value:function(e,t){return this._dataView.getInt16(e,t)}},{key:"getUint32",value:function(e,t){return this._dataView.getUint32(e,t)}},{key:"getInt32",value:function(e,t){return this._dataView.getInt32(e,t)}},{key:"getFloat32",value:function(e,t){return this._dataView.getFloat32(e,t)}},{key:"getFloat64",value:function(e,t){return this._dataView.getFloat64(e,t)}},{key:"buffer",get:function(){return this._dataView.buffer}}]),e}();t.exports=n},{}],19:[function(e,t,i){"use strict";var r=e("./globals.js"),n=e("./geotiffimage.js"),a=e("./dataview64.js"),o=r.fieldTypes,s=r.fieldTagNames,l=r.arrayFields,h=r.geoKeyNames;function f(e,t){this.dataView=new a(e),t=t||{},this.cache=t.cache||!1;var i=this.dataView.getUint16(0,0);if(18761===i)this.littleEndian=!0;else{if(19789!==i)throw new TypeError("Invalid byte order value.");this.littleEndian=!1}var r=this.dataView.getUint16(2,this.littleEndian);if(42===this.dataView.getUint16(2,this.littleEndian))this.bigTiff=!1;else{if(43!==r)throw new TypeError("Invalid magic number.");if(this.bigTiff=!0,8!==this.dataView.getUint16(4,this.littleEndian))throw new Error("Unsupported offset byte-size.")}this.fileDirectories=this.parseFileDirectories(this.getOffset(this.bigTiff?8:4))}f.prototype={getOffset:function(e){return this.bigTiff?this.dataView.getUint64(e,this.littleEndian):this.dataView.getUint32(e,this.littleEndian)},getFieldTypeLength:function(e){switch(e){case o.BYTE:case o.ASCII:case o.SBYTE:case o.UNDEFINED:return 1;case o.SHORT:case o.SSHORT:return 2;case o.LONG:case o.SLONG:case o.FLOAT:return 4;case o.RATIONAL:case o.SRATIONAL:case o.DOUBLE:case o.LONG8:case o.SLONG8:case o.IFD8:return 8;default:throw new RangeError("Invalid field type: "+e)}},getValues:function(e,t,i){var r,n=null,a=null,s=this.getFieldTypeLength(e);switch(e){case o.BYTE:case o.ASCII:case o.UNDEFINED:n=new Uint8Array(t),a=this.dataView.getUint8;break;case o.SBYTE:n=new Int8Array(t),a=this.dataView.getInt8;break;case o.SHORT:n=new Uint16Array(t),a=this.dataView.getUint16;break;case o.SSHORT:n=new Int16Array(t),a=this.dataView.getInt16;break;case o.LONG:n=new Uint32Array(t),a=this.dataView.getUint32;break;case o.SLONG:n=new Int32Array(t),a=this.dataView.getInt32;break;case o.LONG8:case o.IFD8:n=new Array(t),a=this.dataView.getUint64;break;case o.SLONG8:n=new Array(t),a=this.dataView.getInt64;break;case o.RATIONAL:n=new Uint32Array(2*t),a=this.dataView.getUint32;break;case o.SRATIONAL:n=new Int32Array(2*t),a=this.dataView.getInt32;break;case o.FLOAT:n=new Float32Array(t),a=this.dataView.getFloat32;break;case o.DOUBLE:n=new Float64Array(t),a=this.dataView.getFloat64;break;default:throw new RangeError("Invalid field type: "+e)}if(e!==o.RATIONAL&&e!==o.SRATIONAL)for(r=0;r<t;++r)n[r]=a.call(this.dataView,i+r*s,this.littleEndian);else for(r=0;r<t;r+=2)n[r]=a.call(this.dataView,i+r*s,this.littleEndian),n[r+1]=a.call(this.dataView,i+(r*s+4),this.littleEndian);return e===o.ASCII?String.fromCharCode.apply(null,n):n},getFieldValues:function(e,t,i,r){var n;if(this.getFieldTypeLength(t)*i<=(this.bigTiff?8:4))n=this.getValues(t,i,r);else{var a=this.getOffset(r);n=this.getValues(t,i,a)}return 1===i&&-1===l.indexOf(e)&&t!==o.RATIONAL&&t!==o.SRATIONAL?n[0]:n},parseGeoKeyDirectory:function(e){var t=e.GeoKeyDirectory;if(!t)return null;for(var i={},r=4;r<4*t[3];r+=4){var n=h[t[r]],a=t[r+1]?s[t[r+1]]:null,o=t[r+2],l=t[r+3],f=null;if(a){if(null==(f=e[a]))throw new Error("Could not get value of geoKey '"+n+"'.");"string"==typeof f?f=f.substring(l,l+o-1):f.subarray&&(f=f.subarray(l,l+o-1))}else f=l;i[n]=f}return i},parseFileDirectories:function(e){for(var t=e,i=[];0!==t;){for(var r=this.bigTiff?this.dataView.getUint64(t,this.littleEndian):this.dataView.getUint16(t,this.littleEndian),n={},a=t+(this.bigTiff?8:2),o=0;o<r;a+=this.bigTiff?20:12,++o){var l=this.dataView.getUint16(a,this.littleEndian),h=this.dataView.getUint16(a+2,this.littleEndian),f=this.bigTiff?this.dataView.getUint64(a+4,this.littleEndian):this.dataView.getUint32(a+4,this.littleEndian);n[s[l]]=this.getFieldValues(l,h,f,a+(this.bigTiff?12:8))}i.push([n,this.parseGeoKeyDirectory(n)]),t=this.getOffset(a)}return i},getImage:function(e){e=e||0;var t=this.fileDirectories[e];if(!t)throw new RangeError("Invalid image index");return new n(t[0],t[1],this.dataView,this.littleEndian,this.cache)},getImageCount:function(){return this.fileDirectories.length}},t.exports=f},{"./dataview64.js":18,"./geotiffimage.js":20,"./globals.js":21}],20:[function(e,t,i){"use strict";var r=e("./globals.js"),n=e("./rgb.js"),a=e("./compression/raw.js"),o=e("./compression/lzw.js"),s=e("./compression/deflate.js"),l=e("./compression/packbits.js"),h=function(e,t,i){for(var r=0,n=t;n<i;++n)r+=e[n];return r},f=function(e,t,i){switch(e){case 1:switch(t){case 8:return new Uint8Array(i);case 16:return new Uint16Array(i);case 32:return new Uint32Array(i)}break;case 2:switch(t){case 8:return new Int8Array(i);case 16:return new Int16Array(i);case 32:return new Int32Array(i)}break;case 3:switch(t){case 32:return new Float32Array(i);case 64:return new Float64Array(i)}}throw Error("Unsupported data format/bitsPerSample")};function c(e,t,i,r,n){this.fileDirectory=e,this.geoKeys=t,this.dataView=i,this.littleEndian=r,this.tiles=n?{}:null,this.isTiled=!e.StripOffsets;var h=e.PlanarConfiguration;if(this.planarConfiguration=void 0===h?1:h,1!==this.planarConfiguration&&2!==this.planarConfiguration)throw new Error("Invalid planar configuration.");switch(this.fileDirectory.Compression){case void 0:case 1:this.decoder=new a;break;case 5:this.decoder=new o;break;case 6:throw new Error("JPEG compression not supported.");case 8:this.decoder=new s;break;case 32773:this.decoder=new l;break;default:throw new Error("Unknown compresseion method identifier: "+this.fileDirectory.Compression)}}c.prototype={getFileDirectory:function(){return this.fileDirectory},getGeoKeys:function(){return this.geoKeys},getWidth:function(){return this.fileDirectory.ImageWidth},getHeight:function(){return this.fileDirectory.ImageLength},getSamplesPerPixel:function(){return this.fileDirectory.SamplesPerPixel},getTileWidth:function(){return this.isTiled?this.fileDirectory.TileWidth:this.getWidth()},getTileHeight:function(){return this.isTiled?this.fileDirectory.TileLength:this.fileDirectory.RowsPerStrip},getBytesPerPixel:function(){for(var e=0,t=0;t<this.fileDirectory.BitsPerSample.length;++t){var i=this.fileDirectory.BitsPerSample[t];if(i%8!=0)throw new Error("Sample bit-width of "+i+" is not supported.");if(i!==this.fileDirectory.BitsPerSample[0])throw new Error("Differing size of samples in a pixel are not supported.");e+=i}return e/8},getSampleByteSize:function(e){if(e>=this.fileDirectory.BitsPerSample.length)throw new RangeError("Sample index "+e+" is out of range.");var t=this.fileDirectory.BitsPerSample[e];if(t%8!=0)throw new Error("Sample bit-width of "+t+" is not supported.");return t/8},getReaderForSample:function(e){var t=this.fileDirectory.SampleFormat?this.fileDirectory.SampleFormat[e]:1,i=this.fileDirectory.BitsPerSample[e];switch(t){case 1:switch(i){case 8:return DataView.prototype.getUint8;case 16:return DataView.prototype.getUint16;case 32:return DataView.prototype.getUint32}break;case 2:switch(i){case 8:return DataView.prototype.getInt8;case 16:return DataView.prototype.getInt16;case 32:return DataView.prototype.getInt32}break;case 3:switch(i){case 32:return DataView.prototype.getFloat32;case 64:return DataView.prototype.getFloat64}}},getArrayForSample:function(e,t){var i=this.fileDirectory.SampleFormat?this.fileDirectory.SampleFormat[e]:1,r=this.fileDirectory.BitsPerSample[e];return f(i,r,t)},getDecoder:function(){return this.decoder},getTileOrStrip:function(e,t,i,r){var n,a,o,s=Math.ceil(this.getWidth()/this.getTileWidth()),l=Math.ceil(this.getHeight()/this.getTileHeight()),h=this.tiles;if(1===this.planarConfiguration?n=t*s+e:2===this.planarConfiguration&&(n=i*s*l+t*s+e),null!==h&&n in h)return r?r(null,{x:e,y:t,sample:i,data:h[n]}):h[n];this.isTiled?(a=this.fileDirectory.TileOffsets[n],o=this.fileDirectory.TileByteCounts[n]):(a=this.fileDirectory.StripOffsets[n],o=this.fileDirectory.StripByteCounts[n]);var f=this.dataView.buffer.slice(a,a+o);if(r)return this.getDecoder().decodeBlockAsync(f,function(a,o){a||null===h||(h[n]=o),r(a,{x:e,y:t,sample:i,data:o})});var c=this.getDecoder().decodeBlock(f);return null!==h&&(h[n]=c),c},_readRasterAsync:function(e,t,i,r,n,a){for(var o=this.getTileWidth(),s=this.getTileHeight(),l=Math.floor(e[0]/o),f=Math.ceil(e[2]/o),c=Math.floor(e[1]/s),u=Math.ceil(e[3]/s),d=(Math.ceil(this.getWidth()/o),e[2]-e[0]),g=(e[3],e[1],this.getBytesPerPixel()),p=(this.getWidth(),this.fileDirectory.Predictor||1),y=[],w=[],m=0;m<t.length;++m)1===this.planarConfiguration?y.push(h(this.fileDirectory.BitsPerSample,0,t[m])/8):y.push(0),w.push(this.getReaderForSample(t[m]));var b=!1,v=0,k=this.littleEndian,S=null;function _(){b&&0===v&&(S?a(S):n(i))}function x(n,a){if(n)S=n;else for(var l=new DataView(a.data),h=a.y*s,f=a.x*o,c=(a.y+1)*s,u=(a.x+1)*o,m=a.sample,b=Math.max(0,e[1]-h);b<Math.min(s,s-(c-e[3]));++b)for(var x=Math.max(0,e[0]-f);x<Math.min(o,o-(u-e[2]));++x){var D,A=(b*o+x)*g,T=w[m].call(l,A+y[m],k);r?(1!==p&&x>0&&(D=(b+h-e[1])*d*t.length+(x+f-e[0]-1)*t.length+m,T+=i[D]),D=(b+h-e[1])*d*t.length+(x+f-e[0])*t.length+m,i[D]=T):(1!==p&&x>0&&(D=(b+h-e[1])*d+x-1+f-e[0],T+=i[m][D]),D=(b+h-e[1])*d+x+f-e[0],i[m][D]=T)}v-=1,_()}for(var D=c;D<=u;++D)for(var A=l;A<=f;++A)for(var T=0;T<t.length;++T){var E=t[T];2===this.planarConfiguration&&(g=this.getSampleByteSize(E));v+=1,this.getTileOrStrip(A,D,E,x)}b=!0,_()},_readRaster:function(e,t,i,r,n,a){try{for(var o=this.getTileWidth(),s=this.getTileHeight(),l=Math.floor(e[0]/o),f=Math.ceil(e[2]/o),c=Math.floor(e[1]/s),u=Math.ceil(e[3]/s),d=(Math.ceil(this.getWidth()/o),e[2]-e[0]),g=(e[3],e[1],this.getBytesPerPixel()),p=(this.getWidth(),this.fileDirectory.Predictor||1),y=[],w=[],m=0;m<t.length;++m)1===this.planarConfiguration?y.push(h(this.fileDirectory.BitsPerSample,0,t[m])/8):y.push(0),w.push(this.getReaderForSample(t[m]));for(var b=c;b<u;++b)for(var v=l;v<f;++v)for(var k=b*s,S=v*o,_=(b+1)*s,x=(v+1)*o,D=0;D<t.length;++D){var A=t[D];2===this.planarConfiguration&&(g=this.getSampleByteSize(A));var T=new DataView(this.getTileOrStrip(v,b,A)),E=w[D],I=Math.min(s,s-(_-e[3])),C=Math.min(o,o-(x-e[2])),B=(I*o+C)*g,O=new Uint8Array(T.buffer).length;2*O!==B&&this._debugMessages&&console.warn("dimension mismatch",O,B);for(var L=Math.max(0,e[1]-k);L<I;++L)for(var P=Math.max(0,e[0]-S);P<C;++P){var U,G=(L*o+P)*g,M=0;G<O-1&&(M=E.call(T,G+y[D],this.littleEndian)),r?(1!==p&&P>0&&(M+=i[U=(L+k-e[1])*d*t.length+(P+S-e[0]-1)*t.length+D]),i[U=(L+k-e[1])*d*t.length+(P+S-e[0])*t.length+D]=M):(1!==p&&P>0&&(U=(L+k-e[1])*d+P-1+S-e[0],M+=i[D][U]),U=(L+k-e[1])*d+P+S-e[0],i[D][U]=M)}}return n(i),i}catch(e){return a(e)}},readRasters:function(){var e,t,i;switch(arguments.length){case 0:break;case 1:"function"==typeof arguments[0]?t=arguments[0]:e=arguments[0];break;case 2:"function"==typeof arguments[0]?(t=arguments[0],i=arguments[1]):(e=arguments[0],t=arguments[1]);break;case 3:e=arguments[0],t=arguments[1],i=arguments[2];break;default:throw new Error("Invalid number of arguments passed.")}i=i||function(e){console.error(e)};var r=(e=e||{}).window||[0,0,this.getWidth(),this.getHeight()],n=e.samples,a=e.interleave;if(r[0]<0||r[1]<0||r[2]>this.getWidth()||r[3]>this.getHeight())throw new Error("Select window is out of image bounds.");if(r[0]>r[2]||r[1]>r[3])throw new Error("Invalid subsets");var o,s,l=(r[2]-r[0])*(r[3]-r[1]);if(n){for(o=0;o<n.length;++o)if(n[o]>=this.fileDirectory.SamplesPerPixel)throw new RangeError("Invalid sample index '"+n[o]+"'.")}else for(n=[],o=0;o<this.fileDirectory.SamplesPerPixel;++o)n.push(o);if(a){var h=this.fileDirectory.SampleFormat?Math.max.apply(null,this.fileDirectory.SampleFormat):1,c=Math.max.apply(null,this.fileDirectory.BitsPerSample);s=f(h,c,l*n.length)}else for(s=[],o=0;o<n.length;++o)s.push(this.getArrayForSample(n[o],l));if(this.getDecoder().isAsync()){if(!t)throw new Error("No callback specified for asynchronous raster reading.");return this._readRasterAsync(r,n,s,a,t,i)}return t=t||function(){},this._readRaster(r,n,s,a,t,i)},readRGB:function(){var e=null,t=null,i=null;switch(arguments.length){case 0:break;case 1:"function"==typeof arguments[0]?t=arguments[0]:e=arguments[0];break;case 2:"function"==typeof arguments[0]?(t=arguments[0],i=arguments[1]):(e=arguments[0],t=arguments[1]);break;case 3:e=arguments[0],t=arguments[1],i=arguments[2];break;default:throw new Error("Invalid number of arguments passed.")}i=i||function(e){console.error(e)};var a=(e=e||{}).window||[0,0,this.getWidth(),this.getHeight()];if(a[0]<0||a[1]<0||a[2]>this.getWidth()||a[3]>this.getHeight())throw new Error("Select window is out of image bounds.");if(a[0]>a[2]||a[1]>a[3])throw new Error("Invalid subsets");var o,s=a[2]-a[0],l=a[3]-a[1],h=this.fileDirectory.PhotometricInterpretation,f=this.fileDirectory.BitsPerSample[0],c=Math.pow(2,f);if(h===r.photometricInterpretations.RGB)return this.readRasters({window:e.window,interleave:!0},t,i);switch(h){case r.photometricInterpretations.WhiteIsZero:case r.photometricInterpretations.BlackIsZero:case r.photometricInterpretations.Palette:o=[0];break;case r.photometricInterpretations.CMYK:o=[0,1,2,3];break;case r.photometricInterpretations.YCbCr:case r.photometricInterpretations.CIELab:o=[0,1,2];break;default:throw new Error("Invalid or unsupported photometric interpretation.")}var u={window:e.window,interleave:!0,samples:o},d=this.fileDirectory;return this.readRasters(u,function(e){switch(h){case r.photometricInterpretations.WhiteIsZero:return t(n.fromWhiteIsZero(e,c,s,l));case r.photometricInterpretations.BlackIsZero:return t(n.fromBlackIsZero(e,c,s,l));case r.photometricInterpretations.Palette:return t(n.fromPalette(e,d.ColorMap,s,l));case r.photometricInterpretations.CMYK:return t(n.fromCMYK(e,s,l));case r.photometricInterpretations.YCbCr:return t(n.fromYCbCr(e,s,l));case r.photometricInterpretations.CIELab:return t(n.fromCIELab(e,s,l))}},i)},getTiePoints:function(){if(!this.fileDirectory.ModelTiepoint)return[];for(var e=[],t=0;t<this.fileDirectory.ModelTiepoint.length;t+=6)e.push({i:this.fileDirectory.ModelTiepoint[t],j:this.fileDirectory.ModelTiepoint[t+1],k:this.fileDirectory.ModelTiepoint[t+2],x:this.fileDirectory.ModelTiepoint[t+3],y:this.fileDirectory.ModelTiepoint[t+4],z:this.fileDirectory.ModelTiepoint[t+5]});return e},getGDALMetadata:function(){var e={};if(!this.fileDirectory.GDAL_METADATA)return null;for(var t=this.fileDirectory.GDAL_METADATA,i=r.parseXml(t.substring(0,t.length-1)),n=i.evaluate("GDALMetadata/Item",i,null,XPathResult.UNORDERED_NODE_SNAPSHOT_TYPE,null),a=0;a<n.snapshotLength;++a){var o=n.snapshotItem(a);e[o.getAttribute("name")]=o.textContent}return e},getOrigin:function(){var e=this.fileDirectory.ModelTiepoint;if(!e||6!==e.length)throw new Error("The image does not have an affine transformation.");return[e[3],e[4],e[5]]},getResolution:function(){if(!this.fileDirectory.ModelPixelScale)throw new Error("The image does not have an affine transformation.");return[this.fileDirectory.ModelPixelScale[0],this.fileDirectory.ModelPixelScale[1],this.fileDirectory.ModelPixelScale[2]]},pixelIsArea:function(){return 1===this.geoKeys.GTRasterTypeGeoKey},getBoundingBox:function(){var e=this.getOrigin(),t=this.getResolution(),i=e[0],r=e[1],n=i+t[0]*this.getWidth(),a=r+t[1]*this.getHeight();return[Math.min(i,n),Math.min(r,a),Math.max(i,n),Math.max(r,a)]}},t.exports=c},{"./compression/deflate.js":14,"./compression/lzw.js":15,"./compression/packbits.js":16,"./compression/raw.js":17,"./globals.js":21,"./rgb.js":23}],21:[function(e,t,i){"use strict";var r,n={315:"Artist",258:"BitsPerSample",265:"CellLength",264:"CellWidth",320:"ColorMap",259:"Compression",33432:"Copyright",306:"DateTime",338:"ExtraSamples",266:"FillOrder",289:"FreeByteCounts",288:"FreeOffsets",291:"GrayResponseCurve",290:"GrayResponseUnit",316:"HostComputer",270:"ImageDescription",257:"ImageLength",256:"ImageWidth",271:"Make",281:"MaxSampleValue",280:"MinSampleValue",272:"Model",254:"NewSubfileType",274:"Orientation",262:"PhotometricInterpretation",284:"PlanarConfiguration",296:"ResolutionUnit",278:"RowsPerStrip",277:"SamplesPerPixel",305:"Software",279:"StripByteCounts",273:"StripOffsets",255:"SubfileType",263:"Threshholding",282:"XResolution",283:"YResolution",326:"BadFaxLines",327:"CleanFaxData",343:"ClipPath",328:"ConsecutiveBadFaxLines",433:"Decode",434:"DefaultImageColor",269:"DocumentName",336:"DotRange",321:"HalftoneHints",346:"Indexed",347:"JPEGTables",285:"PageName",297:"PageNumber",317:"Predictor",319:"PrimaryChromaticities",532:"ReferenceBlackWhite",339:"SampleFormat",340:"SMinSampleValue",341:"SMaxSampleValue",559:"StripRowCounts",330:"SubIFDs",292:"T4Options",293:"T6Options",325:"TileByteCounts",323:"TileLength",324:"TileOffsets",322:"TileWidth",301:"TransferFunction",318:"WhitePoint",344:"XClipPathUnits",286:"XPosition",529:"YCbCrCoefficients",531:"YCbCrPositioning",530:"YCbCrSubSampling",345:"YClipPathUnits",287:"YPosition",37378:"ApertureValue",40961:"ColorSpace",36868:"DateTimeDigitized",36867:"DateTimeOriginal",34665:"Exif IFD",36864:"ExifVersion",33434:"ExposureTime",41728:"FileSource",37385:"Flash",40960:"FlashpixVersion",33437:"FNumber",42016:"ImageUniqueID",37384:"LightSource",37500:"MakerNote",37377:"ShutterSpeedValue",37510:"UserComment",33723:"IPTC",34675:"ICC Profile",700:"XMP",42112:"GDAL_METADATA",42113:"GDAL_NODATA",34377:"Photoshop",33550:"ModelPixelScale",33922:"ModelTiepoint",34264:"ModelTransformation",34735:"GeoKeyDirectory",34736:"GeoDoubleParams",34737:"GeoAsciiParams"},a={};for(r in n)a[n[r]]=parseInt(r);var o=[a.BitsPerSample,a.ExtraSamples,a.SampleFormat,a.StripByteCounts,a.StripOffsets,a.StripRowCounts,a.TileByteCounts,a.TileOffsets],s={1:"BYTE",2:"ASCII",3:"SHORT",4:"LONG",5:"RATIONAL",6:"SBYTE",7:"UNDEFINED",8:"SSHORT",9:"SLONG",10:"SRATIONAL",11:"FLOAT",12:"DOUBLE",16:"LONG8",17:"SLONG8",18:"IFD8"},l={};for(r in s)l[s[r]]=parseInt(r);var h,f={1024:"GTModelTypeGeoKey",1025:"GTRasterTypeGeoKey",1026:"GTCitationGeoKey",2048:"GeographicTypeGeoKey",2049:"GeogCitationGeoKey",2050:"GeogGeodeticDatumGeoKey",2051:"GeogPrimeMeridianGeoKey",2052:"GeogLinearUnitsGeoKey",2053:"GeogLinearUnitSizeGeoKey",2054:"GeogAngularUnitsGeoKey",2055:"GeogAngularUnitSizeGeoKey",2056:"GeogEllipsoidGeoKey",2057:"GeogSemiMajorAxisGeoKey",2058:"GeogSemiMinorAxisGeoKey",2059:"GeogInvFlatteningGeoKey",2060:"GeogAzimuthUnitsGeoKey",2061:"GeogPrimeMeridianLongGeoKey",2062:"GeogTOWGS84GeoKey",3072:"ProjectedCSTypeGeoKey",3073:"PCSCitationGeoKey",3074:"ProjectionGeoKey",3075:"ProjCoordTransGeoKey",3076:"ProjLinearUnitsGeoKey",3077:"ProjLinearUnitSizeGeoKey",3078:"ProjStdParallel1GeoKey",3079:"ProjStdParallel2GeoKey",3080:"ProjNatOriginLongGeoKey",3081:"ProjNatOriginLatGeoKey",3082:"ProjFalseEastingGeoKey",3083:"ProjFalseNorthingGeoKey",3084:"ProjFalseOriginLongGeoKey",3085:"ProjFalseOriginLatGeoKey",3086:"ProjFalseOriginEastingGeoKey",3087:"ProjFalseOriginNorthingGeoKey",3088:"ProjCenterLongGeoKey",3089:"ProjCenterLatGeoKey",3090:"ProjCenterEastingGeoKey",3091:"ProjCenterNorthingGeoKey",3092:"ProjScaleAtNatOriginGeoKey",3093:"ProjScaleAtCenterGeoKey",3094:"ProjAzimuthAngleGeoKey",3095:"ProjStraightVertPoleLongGeoKey",3096:"ProjRectifiedGridAngleGeoKey",4096:"VerticalCSTypeGeoKey",4097:"VerticalCitationGeoKey",4098:"VerticalDatumGeoKey",4099:"VerticalUnitsGeoKey"},c={};for(r in f)c[f[r]]=parseInt(r);"undefined"==typeof window?h=function(t){return(new(0,e("xmldom").DOMParser)).parseFromString(t,"text/xml")}:void 0!==window.DOMParser?h=function(e){return(new window.DOMParser).parseFromString(e,"text/xml")}:void 0!==window.ActiveXObject&&new window.ActiveXObject("Microsoft.XMLDOM")&&(h=function(e){var t=new window.ActiveXObject("Microsoft.XMLDOM");return t.async="false",t.loadXML(e),t}),t.exports={fieldTags:a,fieldTagNames:n,arrayFields:o,fieldTypes:l,fieldTypeNames:s,photometricInterpretations:{WhiteIsZero:0,BlackIsZero:1,RGB:2,Palette:3,TransparencyMask:4,CMYK:5,YCbCr:6,CIELab:8,ICCLab:9},geoKeys:c,geoKeyNames:f,parseXml:h}},{xmldom:"xmldom"}],22:[function(e,t,i){"use strict";var r=e("./geotiff.js"),n=function(e,t){var i,n,a,o;if("string"==typeof e||e instanceof String)for(i=new ArrayBuffer(2*e.length),o=new Uint16Array(i),n=0,a=e.length;n<a;++n)o[n]=e.charCodeAt(n);else{if(!(e instanceof ArrayBuffer))throw new Error("Invalid input data given.");i=e}return new r(i,t)};void 0!==t&&void 0!==t.exports&&(t.exports.parse=n),"undefined"!=typeof window&&(window.GeoTIFF={parse:n})},{"./geotiff.js":19}],23:[function(e,t,i){"use strict";t.exports={fromWhiteIsZero:function(e,t,i,r){for(var n,a=new Uint8Array(i*r*3),o=0,s=0;o<e.length;++o,s+=3)n=256-e[o]/t*256,a[s]=n,a[s+1]=n,a[s+2]=n;return a},fromBlackIsZero:function(e,t,i,r){for(var n,a=new Uint8Array(i*r*3),o=0,s=0;o<e.length;++o,s+=3)n=e[o]/t*256,a[s]=n,a[s+1]=n,a[s+2]=n;return a},fromPalette:function(e,t,i,r){for(var n=new Uint8Array(i*r*3),a=t.length/3,o=t.length/3*2,s=0,l=0;s<e.length;++s,l+=3){var h=e[s];n[l]=t[h]/65536*256,n[l+1]=t[h+a]/65536*256,n[l+2]=t[h+o]/65536*256}return n},fromCMYK:function(e,t,i){for(var r,n,a,o,s=new Uint8Array(t*i*3),l=0,h=0;l<e.length;l+=4,h+=3)r=e[l],n=e[l+1],a=e[l+2],o=e[l+3],s[h]=(255-r)/256*255*((255-o)/256),s[h+1]=(255-n)/256*255*((255-o)/256),s[h+2]=(255-a)/256*255*((255-o)/256);return s},fromYCbCr:function(e,t,i){for(var r,n,a,o=new Uint8Array(t*i*3),s=0,l=0;s<e.length;s+=3,l+=3)r=e[s],n=e[s+1],a=e[s+2],o[l]=r+1.402*(a-128),o[l+1]=r-.34414*(n-128)-.71414*(a-128),o[l+2]=r+1.772*(n-128);return o},fromCIELab:function(e,t,i){for(var r,n,a,o,s,l,h,f,c,u,d,g,p=[3.240479,-1.53715,-.498535,-.969256,1.875992,.041556,.055648,-.204043,1.057311],y=new Uint8Array(t*i*3),w=0,m=0;w<e.length;w+=3,m+=3)r=e[w],n=e[w+1],a=e[w+2],d=s=(0!==(f=(s=Math.pow((r+16)/116,3))>.008856))*(r/903.3)+f*s,u=(h=(o=n/500+(s=f*Math.pow(s,1/3)+(0!==f)*(7.787*s+16/116)))>.206893)*Math.pow(o,3)+(0!==h)*((o-16/116)/7.787),g=(c=(l=s-a/200)>.206893)*Math.pow(l,3)+(0!==c)*((l-16/116)/7.787),u*=.950456,g*=1.088754,y[m]=u*p[0]+d*p[1]+g*p[2],y[m+1]=u*p[3]+d*p[4]+g*p[5],y[m+2]=u*p[6]+d*p[7]+g*p[8];return y}}},{}]},{},[22]);
            </script>
            <script src="./Js/d3-marching-squares.min.js"  charset="utf-8"></script>
            <script >
// http://geoexamples.com/path-properties/ Version 0.1.1. Copyright 2016 Roger Veciana i Rovira.
!function(t,h){"object"==typeof exports&&"undefined"!=typeof module?h(exports):"function"==typeof define&&define.amd?define(["exports"],h):h(t.spp=t.spp||{})}(this,function(t){"use strict";function h(t){var h=t.match(l);return h?h.map(Number):[]}function n(t,h,n,s,u,g,c,x){this.a={x:t,y:h},this.b={x:n,y:s},this.c={x:u,y:g},this.d={x:c,y:x},c&&x?(this.getArcLength=y,this.getPoint=a,this.getDerivative=e):(this.getArcLength=o,this.getPoint=r,this.getDerivative=i),this.init()}function i(t,h,n){return{x:2*(1-n)*(t[1]-t[0])+2*n*(t[2]-t[1]),y:2*(1-n)*(h[1]-h[0])+2*n*(h[2]-h[1])}}function e(t,h,n){var i=r([3*(t[1]-t[0]),3*(t[2]-t[1]),3*(t[3]-t[2])],[3*(h[1]-h[0]),3*(h[2]-h[1]),3*(h[3]-h[2])],n);return i}function s(t,h,n,i,e){for(var s=1,r=t/h;s>.008;){var a=n(i,e,r);s=Math.abs(t-a)/h,r+=(t-a)/h}return r}function r(t,h,n){var i=(1-n)*(1-n)*t[0]+2*(1-n)*n*t[1]+n*n*t[2],e=(1-n)*(1-n)*h[0]+2*(1-n)*n*h[1]+n*n*h[2];return{x:i,y:e}}function a(t,h,n){var i=(1-n)*(1-n)*(1-n)*t[0]+3*(1-n)*(1-n)*n*t[1]+3*(1-n)*n*n*t[2]+n*n*n*t[3],e=(1-n)*(1-n)*(1-n)*h[0]+3*(1-n)*(1-n)*n*h[1]+3*(1-n)*n*n*h[2]+n*n*n*h[3];return{x:i,y:e}}function o(t,h,n){void 0===n&&(n=1);var i=t[0]-2*t[1]+t[2],e=h[0]-2*h[1]+h[2],s=2*t[1]-2*t[0],r=2*h[1]-2*h[0],a=4*(i*i+e*e),o=4*(i*s+e*r),u=s*s+r*r,g=o/(2*a),c=u/a,y=n+g,x=c-g*g;return Math.sqrt(a)/2*(y*Math.sqrt(y*y+x)-g*Math.sqrt(g*g+x)+x*Math.log(Math.abs((y+Math.sqrt(y*y+x))/(g+Math.sqrt(g*g+x)))))}function u(t,h){return L[t][h]}function g(t,h,n){var i,e,s,r=n.length-1;if(0===r)return 0;if(0===t){for(e=0,s=0;s<=r;s++)e+=u(r,s)*Math.pow(1-h,r-s)*Math.pow(h,s)*n[s];return e}for(i=new Array(r),s=0;s<r;s++)i[s]=r*(n[s+1]-n[s]);return g(t-1,h,i)}function c(t,h,n){var i=g(1,n,t),e=g(1,n,h),s=i*i+e*e;return Math.sqrt(s)}function y(t,h,n){var i,e,s,r;void 0===n&&(n=1);var a=20;for(i=n/2,e=0,s=0;s<a;s++)r=i*w[a][s]+i,e+=M[a][s]*c(t,h,r);return i*e}function x(t,h,n,i){this.x0=t,this.x1=h,this.y0=n,this.y1=i}var f={a:7,c:6,h:1,l:2,m:2,q:4,s:4,t:2,v:1,z:0},p=/([astvzqmhlc])([^astvzqmhlc]*)/gi,v=function(t){var n=[];return t.replace(p,function(t,i,e){var s=i.toLowerCase();for(e=h(e),"m"===s&&e.length>2&&(n.push([i].concat(e.splice(0,2))),s="l",i="m"===i?"l":"L");e.length>=0;){if(e.length===f[s])return e.unshift(i),n.push(e);if(e.length<f[s])throw new Error("malformed path data");n.push([i].concat(e.splice(0,f[s])))}}),n},l=/-?[0-9]*\.?[0-9]+(?:e[-+]?\d+)?/gi,d=function(t,h,i,e,s,r,a,o){return new n(t,h,i,e,s,r,a,o)};n.prototype={constructor:n,init:function(){this.length=this.getArcLength([this.a.x,this.b.x,this.c.x,this.d.x],[this.a.y,this.b.y,this.c.y,this.d.y])},getTotalLength:function(){return this.length},getPointAtLength:function(t){var h=s(t,this.length,this.getArcLength,[this.a.x,this.b.x,this.c.x,this.d.x],[this.a.y,this.b.y,this.c.y,this.d.y]);return this.getPoint([this.a.x,this.b.x,this.c.x,this.d.x],[this.a.y,this.b.y,this.c.y,this.d.y],h)},getTangentAtLength:function(t){var h,n=s(t,this.length,this.getArcLength,[this.a.x,this.b.x,this.c.x,this.d.x],[this.a.y,this.b.y,this.c.y,this.d.y]),i=this.getDerivative([this.a.x,this.b.x,this.c.x,this.d.x],[this.a.y,this.b.y,this.c.y,this.d.y],n),e=Math.sqrt(i.x*i.x+i.y*i.y);return h=e>0?{x:i.x/e,y:i.y/e}:{x:0,y:0}},getPropertiesAtLength:function(t){var h,n=s(t,this.length,this.getArcLength,[this.a.x,this.b.x,this.c.x,this.d.x],[this.a.y,this.b.y,this.c.y,this.d.y]),i=this.getDerivative([this.a.x,this.b.x,this.c.x,this.d.x],[this.a.y,this.b.y,this.c.y,this.d.y],n),e=Math.sqrt(i.x*i.x+i.y*i.y);h=e>0?{x:i.x/e,y:i.y/e}:{x:0,y:0};var r=this.getPoint([this.a.x,this.b.x,this.c.x,this.d.x],[this.a.y,this.b.y,this.c.y,this.d.y],n);return{x:r.x,y:r.y,tangentX:h.x,tangentY:h.y}}};var w=[[],[],[-.5773502691896257,.5773502691896257],[0,-.7745966692414834,.7745966692414834],[-.33998104358485626,.33998104358485626,-.8611363115940526,.8611363115940526],[0,-.5384693101056831,.5384693101056831,-.906179845938664,.906179845938664],[.6612093864662645,-.6612093864662645,-.2386191860831969,.2386191860831969,-.932469514203152,.932469514203152],[0,.4058451513773972,-.4058451513773972,-.7415311855993945,.7415311855993945,-.9491079123427585,.9491079123427585],[-.1834346424956498,.1834346424956498,-.525532409916329,.525532409916329,-.7966664774136267,.7966664774136267,-.9602898564975363,.9602898564975363],[0,-.8360311073266358,.8360311073266358,-.9681602395076261,.9681602395076261,-.3242534234038089,.3242534234038089,-.6133714327005904,.6133714327005904],[-.14887433898163122,.14887433898163122,-.4333953941292472,.4333953941292472,-.6794095682990244,.6794095682990244,-.8650633666889845,.8650633666889845,-.9739065285171717,.9739065285171717],[0,-.26954315595234496,.26954315595234496,-.5190961292068118,.5190961292068118,-.7301520055740494,.7301520055740494,-.8870625997680953,.8870625997680953,-.978228658146057,.978228658146057],[-.1252334085114689,.1252334085114689,-.3678314989981802,.3678314989981802,-.5873179542866175,.5873179542866175,-.7699026741943047,.7699026741943047,-.9041172563704749,.9041172563704749,-.9815606342467192,.9815606342467192],[0,-.2304583159551348,.2304583159551348,-.44849275103644687,.44849275103644687,-.6423493394403402,.6423493394403402,-.8015780907333099,.8015780907333099,-.9175983992229779,.9175983992229779,-.9841830547185881,.9841830547185881],[-.10805494870734367,.10805494870734367,-.31911236892788974,.31911236892788974,-.5152486363581541,.5152486363581541,-.6872929048116855,.6872929048116855,-.827201315069765,.827201315069765,-.9284348836635735,.9284348836635735,-.9862838086968123,.9862838086968123],[0,-.20119409399743451,.20119409399743451,-.3941513470775634,.3941513470775634,-.5709721726085388,.5709721726085388,-.7244177313601701,.7244177313601701,-.8482065834104272,.8482065834104272,-.937273392400706,.937273392400706,-.9879925180204854,.9879925180204854],[-.09501250983763744,.09501250983763744,-.2816035507792589,.2816035507792589,-.45801677765722737,.45801677765722737,-.6178762444026438,.6178762444026438,-.755404408355003,.755404408355003,-.8656312023878318,.8656312023878318,-.9445750230732326,.9445750230732326,-.9894009349916499,.9894009349916499],[0,-.17848418149584785,.17848418149584785,-.3512317634538763,.3512317634538763,-.5126905370864769,.5126905370864769,-.6576711592166907,.6576711592166907,-.7815140038968014,.7815140038968014,-.8802391537269859,.8802391537269859,-.9506755217687678,.9506755217687678,-.9905754753144174,.9905754753144174],[-.0847750130417353,.0847750130417353,-.2518862256915055,.2518862256915055,-.41175116146284263,.41175116146284263,-.5597708310739475,.5597708310739475,-.6916870430603532,.6916870430603532,-.8037049589725231,.8037049589725231,-.8926024664975557,.8926024664975557,-.9558239495713977,.9558239495713977,-.9915651684209309,.9915651684209309],[0,-.16035864564022537,.16035864564022537,-.31656409996362983,.31656409996362983,-.46457074137596094,.46457074137596094,-.600545304661681,.600545304661681,-.7209661773352294,.7209661773352294,-.8227146565371428,.8227146565371428,-.9031559036148179,.9031559036148179,-.96020815213483,.96020815213483,-.9924068438435844,.9924068438435844],[-.07652652113349734,.07652652113349734,-.22778585114164507,.22778585114164507,-.37370608871541955,.37370608871541955,-.5108670019508271,.5108670019508271,-.636053680726515,.636053680726515,-.7463319064601508,.7463319064601508,-.8391169718222188,.8391169718222188,-.912234428251326,.912234428251326,-.9639719272779138,.9639719272779138,-.9931285991850949,.9931285991850949],[0,-.1455618541608951,.1455618541608951,-.2880213168024011,.2880213168024011,-.4243421202074388,.4243421202074388,-.5516188358872198,.5516188358872198,-.6671388041974123,.6671388041974123,-.7684399634756779,.7684399634756779,-.8533633645833173,.8533633645833173,-.9200993341504008,.9200993341504008,-.9672268385663063,.9672268385663063,-.9937521706203895,.9937521706203895],[-.06973927331972223,.06973927331972223,-.20786042668822127,.20786042668822127,-.34193582089208424,.34193582089208424,-.469355837986757,.469355837986757,-.5876404035069116,.5876404035069116,-.6944872631866827,.6944872631866827,-.7878168059792081,.7878168059792081,-.8658125777203002,.8658125777203002,-.926956772187174,.926956772187174,-.9700604978354287,.9700604978354287,-.9942945854823992,.9942945854823992],[0,-.1332568242984661,.1332568242984661,-.26413568097034495,.26413568097034495,-.3903010380302908,.3903010380302908,-.5095014778460075,.5095014778460075,-.6196098757636461,.6196098757636461,-.7186613631319502,.7186613631319502,-.8048884016188399,.8048884016188399,-.8767523582704416,.8767523582704416,-.9329710868260161,.9329710868260161,-.9725424712181152,.9725424712181152,-.9947693349975522,.9947693349975522],[-.06405689286260563,.06405689286260563,-.1911188674736163,.1911188674736163,-.3150426796961634,.3150426796961634,-.4337935076260451,.4337935076260451,-.5454214713888396,.5454214713888396,-.6480936519369755,.6480936519369755,-.7401241915785544,.7401241915785544,-.820001985973903,.820001985973903,-.8864155270044011,.8864155270044011,-.9382745520027328,.9382745520027328,-.9747285559713095,.9747285559713095,-.9951872199970213,.9951872199970213]],M=[[],[],[1,1],[.8888888888888888,.5555555555555556,.5555555555555556],[.6521451548625461,.6521451548625461,.34785484513745385,.34785484513745385],[.5688888888888889,.47862867049936647,.47862867049936647,.23692688505618908,.23692688505618908],[.3607615730481386,.3607615730481386,.46791393457269104,.46791393457269104,.17132449237917036,.17132449237917036],[.4179591836734694,.3818300505051189,.3818300505051189,.27970539148927664,.27970539148927664,.1294849661688697,.1294849661688697],[.362683783378362,.362683783378362,.31370664587788727,.31370664587788727,.22238103445337448,.22238103445337448,.10122853629037626,.10122853629037626],[.3302393550012598,.1806481606948574,.1806481606948574,.08127438836157441,.08127438836157441,.31234707704000286,.31234707704000286,.26061069640293544,.26061069640293544],[.29552422471475287,.29552422471475287,.26926671930999635,.26926671930999635,.21908636251598204,.21908636251598204,.1494513491505806,.1494513491505806,.06667134430868814,.06667134430868814],[.2729250867779006,.26280454451024665,.26280454451024665,.23319376459199048,.23319376459199048,.18629021092773426,.18629021092773426,.1255803694649046,.1255803694649046,.05566856711617366,.05566856711617366],[.24914704581340277,.24914704581340277,.2334925365383548,.2334925365383548,.20316742672306592,.20316742672306592,.16007832854334622,.16007832854334622,.10693932599531843,.10693932599531843,.04717533638651183,.04717533638651183],[.2325515532308739,.22628318026289723,.22628318026289723,.2078160475368885,.2078160475368885,.17814598076194574,.17814598076194574,.13887351021978725,.13887351021978725,.09212149983772845,.09212149983772845,.04048400476531588,.04048400476531588],[.2152638534631578,.2152638534631578,.2051984637212956,.2051984637212956,.18553839747793782,.18553839747793782,.15720316715819355,.15720316715819355,.12151857068790319,.12151857068790319,.08015808715976021,.08015808715976021,.03511946033175186,.03511946033175186],[.2025782419255613,.19843148532711158,.19843148532711158,.1861610000155622,.1861610000155622,.16626920581699392,.16626920581699392,.13957067792615432,.13957067792615432,.10715922046717194,.10715922046717194,.07036604748810812,.07036604748810812,.03075324199611727,.03075324199611727],[.1894506104550685,.1894506104550685,.18260341504492358,.18260341504492358,.16915651939500254,.16915651939500254,.14959598881657674,.14959598881657674,.12462897125553388,.12462897125553388,.09515851168249279,.09515851168249279,.062253523938647894,.062253523938647894,.027152459411754096,.027152459411754096],[.17944647035620653,.17656270536699264,.17656270536699264,.16800410215645004,.16800410215645004,.15404576107681028,.15404576107681028,.13513636846852548,.13513636846852548,.11188384719340397,.11188384719340397,.08503614831717918,.08503614831717918,.0554595293739872,.0554595293739872,.02414830286854793,.02414830286854793],[.1691423829631436,.1691423829631436,.16427648374583273,.16427648374583273,.15468467512626524,.15468467512626524,.14064291467065065,.14064291467065065,.12255520671147846,.12255520671147846,.10094204410628717,.10094204410628717,.07642573025488905,.07642573025488905,.0497145488949698,.0497145488949698,.02161601352648331,.02161601352648331],[.1610544498487837,.15896884339395434,.15896884339395434,.15276604206585967,.15276604206585967,.1426067021736066,.1426067021736066,.12875396253933621,.12875396253933621,.11156664554733399,.11156664554733399,.09149002162245,.09149002162245,.06904454273764123,.06904454273764123,.0448142267656996,.0448142267656996,.019461788229726478,.019461788229726478],[.15275338713072584,.15275338713072584,.14917298647260374,.14917298647260374,.14209610931838204,.14209610931838204,.13168863844917664,.13168863844917664,.11819453196151841,.11819453196151841,.10193011981724044,.10193011981724044,.08327674157670475,.08327674157670475,.06267204833410907,.06267204833410907,.04060142980038694,.04060142980038694,.017614007139152118,.017614007139152118],[.14608113364969041,.14452440398997005,.14452440398997005,.13988739479107315,.13988739479107315,.13226893863333747,.13226893863333747,.12183141605372853,.12183141605372853,.10879729916714838,.10879729916714838,.09344442345603386,.09344442345603386,.0761001136283793,.0761001136283793,.057134425426857205,.057134425426857205,.036953789770852494,.036953789770852494,.016017228257774335,.016017228257774335],[.13925187285563198,.13925187285563198,.13654149834601517,.13654149834601517,.13117350478706238,.13117350478706238,.12325237681051242,.12325237681051242,.11293229608053922,.11293229608053922,.10041414444288096,.10041414444288096,.08594160621706773,.08594160621706773,.06979646842452049,.06979646842452049,.052293335152683286,.052293335152683286,.03377490158481415,.03377490158481415,.0146279952982722,.0146279952982722],[.13365457218610619,.1324620394046966,.1324620394046966,.12890572218808216,.12890572218808216,.12304908430672953,.12304908430672953,.11499664022241136,.11499664022241136,.10489209146454141,.10489209146454141,.09291576606003515,.09291576606003515,.07928141177671895,.07928141177671895,.06423242140852585,.06423242140852585,.04803767173108467,.04803767173108467,.030988005856979445,.030988005856979445,.013411859487141771,.013411859487141771],[.12793819534675216,.12793819534675216,.1258374563468283,.1258374563468283,.12167047292780339,.12167047292780339,.1155056680537256,.1155056680537256,.10744427011596563,.10744427011596563,.09761865210411388,.09761865210411388,.08619016153195327,.08619016153195327,.0733464814110803,.0733464814110803,.05929858491543678,.05929858491543678,.04427743881741981,.04427743881741981,.028531388628933663,.028531388628933663,.0123412297999872,.0123412297999872]],L=[[1],[1,1],[1,2,1],[1,3,3,1]],b=function(t,h,n,i){return new x(t,h,n,i)};x.prototype.getTotalLength=function(){return Math.sqrt(Math.pow(this.x0-this.x1,2)+Math.pow(this.y0-this.y1,2))},x.prototype.getPointAtLength=function(t){var h=t/Math.sqrt(Math.pow(this.x0-this.x1,2)+Math.pow(this.y0-this.y1,2)),n=(this.x1-this.x0)*h,i=(this.y1-this.y0)*h;return{x:this.x0+n,y:this.y0+i}},x.prototype.getTangentAtLength=function(){var t=Math.sqrt((this.x1-this.x0)*(this.x1-this.x0)+(this.y1-this.y0)*(this.y1-this.y0));return{x:(this.x1-this.x0)/t,y:(this.y1-this.y0)/t}},x.prototype.getPropertiesAtLength=function(t){var h=this.getPointAtLength(t),n=this.getTangentAtLength();return{x:h.x,y:h.y,tangentX:n.x,tangentY:n.y}};var A=function(t){function h(t){if(!t)return null;for(var s,r=v(t),a=[0,0],o=[0,0],u=0;u<r.length;u++)"M"===r[u][0]?(a=[r[u][1],r[u][2]],e.push(null)):"m"===r[u][0]?(a=[r[u][1]+a[0],r[u][2]+a[1]],e.push(null)):"L"===r[u][0]?(n+=Math.sqrt(Math.pow(a[0]-r[u][1],2)+Math.pow(a[1]-r[u][2],2)),e.push(new b(a[0],r[u][1],a[1],r[u][2])),a=[r[u][1],r[u][2]]):"l"===r[u][0]?(n+=Math.sqrt(Math.pow(r[u][1],2)+Math.pow(r[u][2],2)),e.push(new b(a[0],r[u][1]+a[0],a[1],r[u][2]+a[1])),a=[r[u][1]+a[0],r[u][2]+a[1]]):"H"===r[u][0]?(n+=Math.abs(a[0]-r[u][1]),e.push(new b(a[0],r[u][1],a[1],a[1])),a[0]=r[u][1]):"h"===r[u][0]?(n+=Math.abs(r[u][1]),e.push(new b(a[0],a[0]+r[u][1],a[1],a[1])),a[0]=r[u][1]+a[0]):"V"===r[u][0]?(n+=Math.abs(a[1]-r[u][1]),e.push(new b(a[0],a[0],a[1],r[u][1])),a[1]=r[u][1]):"v"===r[u][0]?(n+=Math.abs(r[u][1]),e.push(new b(a[0],a[0],a[1],a[1]+r[u][1])),a[1]=r[u][1]+a[1]):"z"===r[u][0]||"Z"===r[u][0]?(n+=Math.sqrt(Math.pow(r[0][1]-a[0],2)+Math.pow(r[0][2]-a[1],2)),e.push(new b(a[0],r[0][1],a[1],r[0][2])),a=[r[0][1],r[0][2]]):"C"===r[u][0]?(s=new d(a[0],a[1],r[u][1],r[u][2],r[u][3],r[u][4],r[u][5],r[u][6]),n+=s.getTotalLength(),a=[r[u][5],r[u][6]],e.push(s)):"c"===r[u][0]?(s=new d(a[0],a[1],a[0]+r[u][1],a[1]+r[u][2],a[0]+r[u][3],a[1]+r[u][4],a[0]+r[u][5],a[1]+r[u][6]),n+=s.getTotalLength(),a=[r[u][5]+a[0],r[u][6]+a[1]],e.push(s)):"S"===r[u][0]?(s=u>0&&["C","c","S","s"].indexOf(r[u-1][0])>-1?new d(a[0],a[1],2*a[0]-r[u-1][r[u-1].length-4],2*a[1]-r[u-1][r[u-1].length-3],r[u][1],r[u][2],r[u][3],r[u][4]):new d(a[0],a[1],a[0],a[1],r[u][1],r[u][2],r[u][3],r[u][4]),n+=s.getTotalLength(),a=[r[u][3],r[u][4]],e.push(s)):"s"===r[u][0]?(s=u>0&&["C","c","S","s"].indexOf(r[u-1][0])>-1?new d(a[0],a[1],a[0]+s.d.x-s.c.x,a[1]+s.d.y-s.c.y,a[0]+r[u][1],a[1]+r[u][2],a[0]+r[u][3],a[1]+r[u][4]):new d(a[0],a[1],a[0],a[1],a[0]+r[u][1],a[1]+r[u][2],a[0]+r[u][3],a[1]+r[u][4]),n+=s.getTotalLength(),a=[r[u][3]+a[0],r[u][4]+a[1]],e.push(s)):"Q"===r[u][0]?(s=new d(a[0],a[1],r[u][1],r[u][2],r[u][3],r[u][4]),n+=s.getTotalLength(),e.push(s),a=[r[u][3],r[u][4]],o=[r[u][1],r[u][2]]):"q"===r[u][0]?(s=new d(a[0],a[1],a[0]+r[u][1],a[1]+r[u][2],a[0]+r[u][3],a[1]+r[u][4]),n+=s.getTotalLength(),o=[a[0]+r[u][1],a[1]+r[u][2]],a=[r[u][3]+a[0],r[u][4]+a[1]],e.push(s)):"T"===r[u][0]?(s=u>0&&["Q","q","T","t"].indexOf(r[u-1][0])>-1?new d(a[0],a[1],2*a[0]-o[0],2*a[1]-o[1],r[u][1],r[u][2]):new b(a[0],r[u][1],a[1],r[u][2]),e.push(s),n+=s.getTotalLength(),o=[2*a[0]-o[0],2*a[1]-o[1]],a=[r[u][1],r[u][2]]):"t"===r[u][0]&&(s=u>0&&["Q","q","T","t"].indexOf(r[u-1][0])>-1?new d(a[0],a[1],2*a[0]-o[0],2*a[1]-o[1],a[0]+r[u][1],a[1]+r[u][2]):new b(a[0],a[0]+r[u][1],a[1],a[1]+r[u][2]),n+=s.getTotalLength(),o=[2*a[0]-o[0],2*a[1]-o[1]],a=[r[u][1]+a[0],r[u][2]+a[0]],e.push(s)),i.push(n);return h}var n=0,i=[],e=[];h.getTotalLength=function(){return n},h.getPointAtLength=function(t){var h=s(t);return e[h.i].getPointAtLength(h.fraction)},h.getTangentAtLength=function(t){var h=s(t);return e[h.i].getTangentAtLength(h.fraction)},h.getPropertiesAtLength=function(t){var h=s(t);return e[h.i].getPropertiesAtLength(h.fraction)};var s=function(t){t<0?t=0:t>n&&(t=n);for(var h=i.length-1;i[h]>=t&&i[h]>0;)h--;return h++,{fraction:t-i[h-1],i:h}};return h(t)};t.svgPathProperties=A,t.parse=v,t.Bezier=d,Object.defineProperty(t,"__esModule",{value:!0})});
            </script>
            
            <script >
              !function(){function t(t,a){return{type:"Feature",id:t.id,properties:t.properties,geometry:n(t.geometry,a)}}function n(t,a){if(!t)return null;if("GeometryCollection"===t.type)return{type:"GeometryCollection",geometries:object.geometries.map(function(t){return n(t,a)})};if(!u.hasOwnProperty(t.type))return null;var r=u[t.type];return d3.geo.stream(t,a(r)),r.result()}d3.geo.project=function(t,r){var e=r.stream;if(!e)throw new Error("not yet supported");return(t&&a.hasOwnProperty(t.type)?a[t.type]:n)(t,e)};var a={Feature:t,FeatureCollection:function(n,a){return{type:"FeatureCollection",features:n.features.map(function(n){return t(n,a)})}}},r=[],e=[],o={point:function(t,n){r.push([t,n])},result:function(){var t=r.length?r.length<2?{type:"Point",coordinates:r[0]}:{type:"MultiPoint",coordinates:r}:null;return r=[],t}},i={lineStart:M,point:function(t,n){r.push([t,n])},lineEnd:function(){r.length&&(e.push(r),r=[])},result:function(){var t=e.length?e.length<2?{type:"LineString",coordinates:e[0]}:{type:"MultiLineString",coordinates:e}:null;return e=[],t}},h={polygonStart:M,lineStart:M,point:function(t,n){r.push([t,n])},lineEnd:function(){var t=r.length;if(t){do{r.push(r[0].slice())}while(++t<4);e.push(r),r=[]}},polygonEnd:M,result:function(){if(!e.length)return null;var t=[],n=[];return e.forEach(function(a){!function(t){if((n=t.length)<4)return!1;var n,a=0,r=t[n-1][1]*t[0][0]-t[n-1][0]*t[0][1];for(;++a<n;)r+=t[a-1][1]*t[a][0]-t[a-1][0]*t[a][1];return r<=0}(a)?n.push(a):t.push([a])}),n.forEach(function(n){var a=n[0];t.some(function(t){if(function(t,n){for(var a=n[0],r=n[1],e=!1,o=0,i=t.length,h=i-1;o<i;h=o++){var u=t[o],M=u[0],s=u[1],c=t[h],f=c[0],v=c[1];s>r^v>r&&a<(f-M)*(r-s)/(v-s)+M&&(e=!e)}return e}(t[0],a))return t.push(n),!0})||t.push([n])}),e=[],t.length?t.length>1?{type:"MultiPolygon",coordinates:t}:{type:"Polygon",coordinates:t[0]}:null}},u={Point:o,MultiPoint:o,LineString:i,MultiLineString:i,Polygon:h,MultiPolygon:h,Sphere:h};function M(){}var s=1e-6,c=s*s,f=Math.PI,v=f/2,l=Math.sqrt(f),g=f/180,d=180/f;function b(t){return t>0?1:t<0?-1:0}function p(t){return t>1?v:t<-1?-v:Math.asin(t)}function w(t){return t>1?0:t<-1?f:Math.acos(t)}function q(t){return t>0?Math.sqrt(t):0}var m=d3.geo.projection,y=d3.geo.projectionMutator;function S(t){var n=Math.tan(.5*t),a=2*Math.log(Math.cos(.5*t))/(n*n);function r(t,n){var r=Math.cos(t),e=Math.cos(n),o=Math.sin(n),i=e*r,h=-((1-i?Math.log(.5*(1+i))/(1-i):-.5)+a/(1+i));return[h*e*Math.sin(t),h*o]}return r.invert=function(n,r){var e,o=Math.sqrt(n*n+r*r),i=-.5*t,h=50;if(!o)return[0,0];do{var u=.5*i,M=Math.cos(u),c=Math.sin(u),f=Math.tan(u),v=Math.log(1/M);i-=e=(2/f*v-a*f-o)/(-v/(c*c)+1-a/(2*M*M))}while(Math.abs(e)>s&&--h>0);var l=Math.sin(i);return[Math.atan2(n*l,o*Math.cos(i)),p(r*l/o)]},r}function Q(t,n){var a,r=Math.cos(n),e=(a=w(r*Math.cos(t/=2)))?a/Math.sin(a):1;return[2*r*Math.sin(t)*e,Math.sin(n)*e]}function R(t){var n=Math.sin(t),a=Math.cos(t),r=t>0?1:-1,e=Math.tan(r*t),o=(1+n-a)/2;function i(t,i){var h=Math.cos(i),u=Math.cos(t/=2);return[(1+h)*Math.sin(t),(r*i>-Math.atan2(u,e)-.001?0:10*-r)+o+Math.sin(i)*a-(1+h)*n*u]}return i.invert=function(t,i){var h=0,u=0,M=50;do{var c=Math.cos(h),f=Math.sin(h),v=Math.cos(u),l=Math.sin(u),g=1+v,d=g*f-t,b=o+l*a-g*n*c-i,p=.5*g*c,w=-f*l,q=.5*n*g*f,m=a*v+n*c*l,y=w*q-m*p,S=.5*(b*w-d*m)/y,Q=(d*q-b*p)/y;h-=S,u-=Q}while((Math.abs(S)>s||Math.abs(Q)>s)&&--M>0);return r*u>-Math.atan2(Math.cos(h),e)-.001?[2*h,u]:null},i}function T(t){return.5*(Math.exp(t)-Math.exp(-t))}function x(t){return.5*(Math.exp(t)+Math.exp(-t))}function E(t,n){var a=Math.tan(n/2),r=q(1-a*a),e=1+r*Math.cos(t/=2),o=Math.sin(t)*r/e,i=a/e,h=o*o,u=i*i;return[4/3*o*(3+h-3*u),4/3*i*(3+3*h-u)]}d3.geo.interrupt=function(t){var n,a=[[[[-f,0],[0,v],[f,0]]],[[[-f,0],[0,-v],[f,0]]]];function r(n,r){for(var e=r<0?-1:1,o=a[+(r<0)],i=0,h=o.length-1;i<h&&n>o[i][2][0];++i);var u=t(n-o[i][1][0],r);return u[0]+=t(o[i][1][0],e*r>e*o[i][0][1]?o[i][0][1]:r)[0],u}t.invert&&(r.invert=function(e,o){for(var i=n[+(o<0)],u=a[+(o<0)],M=0,s=i.length;M<s;++M){var c=i[M];if(c[0][0]<=e&&e<c[1][0]&&c[0][1]<=o&&o<c[1][1]){var f=t.invert(e-t(u[M][1][0],0)[0],o);return f[0]+=u[M][1][0],h(r(f[0],f[1]),[e,o])?f:null}}});var e=d3.geo.projection(r),o=e.stream;function i(t,n){for(var a,r,e,o=-1,i=t.length,h=t[0],u=[];++o<i;){r=((a=t[o])[0]-h[0])/n,e=(a[1]-h[1])/n;for(var M=0;M<n;++M)u.push([h[0]+M*r,h[1]+M*e]);h=a}return u.push(a),u}function h(t,n){return Math.abs(t[0]-n[0])<s&&Math.abs(t[1]-n[1])<s}return e.stream=function(t){var n=e.rotate(),r=o(t),h=(e.rotate([0,0]),o(t));return e.rotate(n),r.sphere=function(){d3.geo.stream(function(){for(var t=1e-6,n=[],r=0,e=a[0].length;r<e;++r){var o=a[0][r],h=180*o[0][0]/f,u=180*o[0][1]/f,M=180*o[1][1]/f,s=180*o[2][0]/f,c=180*o[2][1]/f;n.push(i([[h+t,u+t],[h+t,M-t],[s-t,M-t],[s-t,c+t]],30))}for(var r=a[1].length-1;r>=0;--r){var o=a[1][r],h=180*o[0][0]/f,u=180*o[0][1]/f,M=180*o[1][1]/f,s=180*o[2][0]/f,c=180*o[2][1]/f;n.push(i([[s-t,c-t],[s-t,M+t],[h+t,M+t],[h+t,u-t]],30))}return{type:"Polygon",coordinates:[d3.merge(n)]}}(),h)},r},e.lobes=function(r){return arguments.length?(a=r.map(function(t){return t.map(function(t){return[[t[0][0]*f/180,t[0][1]*f/180],[t[1][0]*f/180,t[1][1]*f/180],[t[2][0]*f/180,t[2][1]*f/180]]})}),n=a.map(function(n){return n.map(function(n){var a,r=t(n[0][0],n[0][1])[0],e=t(n[2][0],n[2][1])[0],o=t(n[1][0],n[0][1])[1],i=t(n[1][0],n[1][1])[1];return o>i&&(a=o,o=i,i=a),[[r,o],[e,i]]})}),e):a.map(function(t){return t.map(function(t){return[[180*t[0][0]/f,180*t[0][1]/f],[180*t[1][0]/f,180*t[1][1]/f],[180*t[2][0]/f,180*t[2][1]/f]]})})},e},(d3.geo.airy=function(){var t=v,n=y(S),a=n(t);return a.radius=function(a){return arguments.length?n(t=a*f/180):t/f*180},a}).raw=S,Q.invert=function(t,n){if(!(t*t+4*n*n>f*f+s)){var a=t,r=n,e=25;do{var o,i=Math.sin(a),h=Math.sin(a/2),u=Math.cos(a/2),M=Math.sin(r),c=Math.cos(r),v=Math.sin(2*r),l=M*M,g=c*c,d=h*h,b=1-g*u*u,p=b?w(c*u)*Math.sqrt(o=1/b):o=0,q=2*p*c*h-t,m=p*M-n,y=o*(g*d+p*c*u*l),S=o*(.5*i*v-2*p*M*h),Q=.25*o*(v*h-p*M*g*i),R=o*(l*u+p*d*c),T=S*Q-R*y;if(!T)break;var x=(m*S-q*R)/T,E=(q*Q-m*y)/T;a-=x,r-=E}while((Math.abs(x)>s||Math.abs(E)>s)&&--e>0);return[a,r]}},(d3.geo.aitoff=function(){return m(Q)}).raw=Q,(d3.geo.armadillo=function(){var t=f/9,n=t>0?1:-1,a=Math.tan(n*t),r=y(R),e=r(t),o=e.stream;return e.parallel=function(e){return arguments.length?(a=Math.tan((n=(t=e*f/180)>0?1:-1)*t),r(t)):t/f*180},e.stream=function(r){var i=e.rotate(),h=o(r),u=(e.rotate([0,0]),o(r));return e.rotate(i),h.sphere=function(){u.polygonStart(),u.lineStart();for(var r=-180*n;n*r<180;r+=90*n)u.point(r,90*n);for(;n*(r-=t)>=-180;)u.point(r,n*-Math.atan2(Math.cos(r*g/2),a)*d);u.lineEnd(),u.polygonEnd()},h},e}).raw=R,E.invert=function(t,n){if(n*=3/8,!(t*=3/8)&&Math.abs(n)>1)return null;var a=1+t*t+n*n,r=Math.sqrt(.5*(a-Math.sqrt(a*a-4*n*n))),e=p(r)/3,o=r?function(t){return Math.log(t+q(t*t-1))}(Math.abs(n/r))/3:function(t){return Math.log(t+q(t*t+1))}(Math.abs(t))/3,i=Math.cos(e),h=x(o),u=h*h-i*i;return[2*b(t)*Math.atan2(T(o)*i,.25-u),2*b(n)*Math.atan2(h*Math.sin(e),.25+u)]},(d3.geo.august=function(){return m(E)}).raw=E;var P=Math.log(1+Math.SQRT2);function k(t,n){var a=Math.abs(n);return a<f/4?[t,Math.log(Math.tan(f/4+n/2))]:[t*Math.cos(a)*(2*Math.SQRT2-1/Math.sin(a)),b(n)*(2*Math.SQRT2*(a-f/4)-Math.log(Math.tan(a/2)))]}k.invert=function(t,n){if((r=Math.abs(n))<P)return[t,2*Math.atan(Math.exp(n))-v];var a,r,e=Math.sqrt(8),o=f/4,i=25;do{var h=Math.cos(o/2),u=Math.tan(o/2);o-=a=(e*(o-f/4)-Math.log(u)-r)/(e-.5*h*h/u)}while(Math.abs(a)>c&&--i>0);return[t/(Math.cos(o)*(e-1/Math.sin(o))),b(n)*o]},(d3.geo.baker=function(){return m(k)}).raw=k;var _=d3.geo.azimuthalEquidistant.raw;function z(t){var n=2*f/t;function a(t,a){var r=_(t,a);if(Math.abs(t)>v){var e=Math.atan2(r[1],r[0]),o=Math.sqrt(r[0]*r[0]+r[1]*r[1]),i=n*Math.round((e-v)/n)+v,h=Math.atan2(Math.sin(e-=i),2-Math.cos(e));e=i+p(f/o*Math.sin(h))-h,r[0]=o*Math.cos(e),r[1]=o*Math.sin(e)}return r}return a.invert=function(t,a){var r=Math.sqrt(t*t+a*a);if(r>v){var e=Math.atan2(a,t),o=n*Math.round((e-v)/n)+v,i=e>o?-1:1,h=r*Math.cos(o-e),u=1/Math.tan(i*Math.acos((h-f)/Math.sqrt(f*(f-2*h)+r*r)));e=o+2*Math.atan((u+i*Math.sqrt(u*u-3))/3),t=r*Math.cos(e),a=r*Math.sin(e)}return _.invert(t,a)},a}function B(t){return function(n){var a,r=t*Math.sin(n),e=30;do{n-=a=(n+Math.sin(n)-r)/(1+Math.cos(n))}while(Math.abs(a)>s&&--e>0);return n/2}}function F(t,n,a){var r=B(a);function e(a,e){return[t*a*Math.cos(e=r(e)),n*Math.sin(e)]}return e.invert=function(r,e){var o=p(e/n);return[r/(t*Math.cos(o)),p((2*o+Math.sin(2*o))/a)]},e}(d3.geo.berghaus=function(){var t=5,n=y(z),a=n(t),r=a.stream,e=.01,o=-Math.cos(e*g),i=Math.sin(e*g);return a.lobes=function(a){return arguments.length?n(t=+a):t},a.stream=function(n){var h=a.rotate(),u=r(n),M=(a.rotate([0,0]),r(n));return a.rotate(h),u.sphere=function(){M.polygonStart(),M.lineStart();for(var n=0,a=360/t,r=2*f/t,h=90-180/t,u=v;n<t;++n,h-=a,u-=r)M.point(Math.atan2(i*Math.cos(u),o)*d,p(i*Math.sin(u))*d),h<-90?(M.point(-90,-180-h-e),M.point(-90,-180-h+e)):(M.point(90,h+e),M.point(90,h-e));M.lineEnd(),M.polygonEnd()},u},a}).raw=z;var A=B(f),G=F(Math.SQRT2/v,Math.SQRT2,f);function j(t,n){var a=2.00276,r=A(n);return[a*t/(1/Math.cos(n)+1.11072/Math.cos(r)),(n+Math.SQRT2*Math.sin(r))/a]}function C(t){var n=0,a=y(t),r=a(n);return r.parallel=function(t){return arguments.length?a(n=t*f/180):n/f*180},r}function D(t,n){return[t*Math.cos(n),n]}function L(t){if(!t)return D;var n=1/Math.tan(t);function a(a,r){var e=n+t-r,o=e?a*Math.cos(r)/e:e;return[e*Math.sin(o),n-e*Math.cos(o)]}return a.invert=function(a,r){var e=Math.sqrt(a*a+(r=n-r)*r),o=n+t-e;return[e/Math.cos(o)*Math.atan2(a,r),o]},a}(d3.geo.mollweide=function(){return m(G)}).raw=G,j.invert=function(t,n){var a,r,e=2.00276,o=e*n,i=n<0?-f/4:f/4,h=25;do{r=o-Math.SQRT2*Math.sin(i),i-=a=(Math.sin(2*i)+2*i-f*Math.sin(r))/(2*Math.cos(2*i)+2+f*Math.cos(r)*Math.SQRT2*Math.cos(i))}while(Math.abs(a)>s&&--h>0);return r=o-Math.SQRT2*Math.sin(i),[t*(1/Math.cos(r)+1.11072/Math.cos(i))/e,r]},(d3.geo.boggs=function(){return m(j)}).raw=j,D.invert=function(t,n){return[t/Math.cos(n),n]},(d3.geo.sinusoidal=function(){return m(D)}).raw=D,(d3.geo.bonne=function(){return C(L).parallel(45)}).raw=L;var O=F(1,4/f,f);function H(t){for(var n,a=(t=t.map(function(t){return[t[0],t[1],Math.sin(t[1]),Math.cos(t[1])]}))[2],r=0;r<3;++r,a=n)n=t[r],a.v=I(n[1]-a[1],a[3],a[2],n[3],n[2],n[0]-a[0]),a.point=[0,0];var e=J(t[0].v[0],t[2].v[0],t[1].v[0]),o=J(t[0].v[0],t[1].v[0],t[2].v[0]),i=f-e;t[2].point[1]=0,t[0].point[0]=-(t[1].point[0]=.5*t[0].v[0]);var h=[t[2].point[0]=t[0].point[0]+t[2].v[0]*Math.cos(e),2*(t[0].point[1]=t[1].point[1]=t[2].v[0]*Math.sin(e))];return function(n,a){for(var r=Math.sin(a),e=Math.cos(a),u=new Array(3),M=0;M<3;++M){var s=t[M];if(u[M]=I(a-s[1],s[3],s[2],e,r,n-s[0]),!u[M][0])return s.point;u[M][1]=K(u[M][1]-s.v[1])}var c=h.slice();for(M=0;M<3;++M){var f=2==M?0:M+1,v=J(t[M].v[0],u[M][0],u[f][0]);u[M][1]<0&&(v=-v),M?1==M?(v=o-v,c[0]-=u[M][0]*Math.cos(v),c[1]-=u[M][0]*Math.sin(v)):(v=i-v,c[0]+=u[M][0]*Math.cos(v),c[1]+=u[M][0]*Math.sin(v)):(c[0]+=u[M][0]*Math.cos(v),c[1]-=u[M][0]*Math.sin(v))}return c[0]/=3,c[1]/=3,c}}function I(t,n,a,r,e,o){var i,h=Math.cos(o);if(Math.abs(t)>1||Math.abs(o)>1)i=w(a*e+n*r*h);else{var u=Math.sin(.5*t),M=Math.sin(.5*o);i=2*p(Math.sqrt(u*u+n*r*M*M))}return Math.abs(i)>s?[i,Math.atan2(r*Math.sin(o),n*e-a*r*h)]:[0,0]}function J(t,n,a){return w(.5*(t*t+n*n-a*a)/(t*n))}function K(t){return t-2*f*Math.floor((t+f)/(2*f))}function N(t){return[t[0]*g,t[1]*g]}function U(t,n){var a=q(1-Math.sin(n));return[2/l*t*a,l*(1-a)]}function V(t){var n=Math.tan(t);function a(t,a){return[t,(t?t/Math.sin(t):1)*(Math.sin(a)*Math.cos(t)-n*Math.cos(a))]}return a.invert=n?function(t,a){t&&(a*=Math.sin(t)/t);var r=Math.cos(t);return[t,2*Math.atan2(Math.sqrt(r*r+n*n-a*a)-r,n-a)]}:function(t,n){return[t,p(t?n*Math.tan(t)/t:n)]},a}function W(t,n){var a=Math.sqrt(3);return[a*t*(2*Math.cos(2*n/3)-1)/l,a*l*Math.sin(n/3)]}function X(t){var n=Math.cos(t);function a(t,a){return[t*n,Math.sin(a)/n]}return a.invert=function(t,a){return[t/n,p(a*n)]},a}function Y(t){var n=Math.cos(t);function a(t,a){return[t*n,(1+n)*Math.tan(.5*a)]}return a.invert=function(t,a){return[t/n,2*Math.atan(a/(1+n))]},a}function Z(t,n){var a=Math.sqrt(8/(3*f));return[a*t*(1-Math.abs(n)/f),a*n]}function $(t,n){var a=Math.sqrt(4-3*Math.sin(Math.abs(n)));return[2/Math.sqrt(6*f)*t*a,b(n)*Math.sqrt(2*f/3)*(2-a)]}function tt(t,n){var a=Math.sqrt(f*(4+f));return[2/a*t*(1+Math.sqrt(1-4*n*n/(f*f))),4/a*n]}function nt(t,n){var a=(2+v)*Math.sin(n);n/=2;for(var r=0,e=1/0;r<10&&Math.abs(e)>s;r++){var o=Math.cos(n);n-=e=(n+Math.sin(n)*(o+2)-a)/(2*o*(1+o))}return[2/Math.sqrt(f*(4+f))*t*(1+Math.cos(n)),2*Math.sqrt(f/(4+f))*Math.sin(n)]}function at(t,n){return[t*(1+Math.cos(n))/Math.sqrt(2+f),2*n/Math.sqrt(2+f)]}function rt(t,n){for(var a=(1+v)*Math.sin(n),r=0,e=1/0;r<10&&Math.abs(e)>s;r++)n-=e=(n+Math.sin(n)-a)/(1+Math.cos(n));return a=Math.sqrt(2+f),[t*(1+Math.cos(n))/a,2*n/a]}function et(t,n){var a=Math.sin(t/=2),r=Math.cos(t),e=Math.sqrt(Math.cos(n)),o=Math.cos(n/=2),i=Math.sin(n)/(o+Math.SQRT2*r*e),h=Math.sqrt(2/(1+i*i)),u=Math.sqrt((Math.SQRT2*o+(r+a)*e)/(Math.SQRT2*o+(r-a)*e));return[ot*(h*(u-1/u)-2*Math.log(u)),ot*(h*i*(u+1/u)-2*Math.atan(i))]}(d3.geo.bromley=function(){return m(O)}).raw=O,(d3.geo.chamberlin=function(){var t=[[0,0],[0,0],[0,0]],n=y(H),a=n(t),r=a.rotate;return delete a.rotate,a.points=function(e){if(!arguments.length)return t;t=e;var o=d3.geo.centroid({type:"MultiPoint",coordinates:t}),i=[-o[0],-o[1]];return r.call(a,i),n(t.map(d3.geo.rotation(i)).map(N))},a.points([[-150,55],[-35,55],[-92.5,10]])}).raw=H,U.invert=function(t,n){var a=(a=n/l-1)*a;return[a>0?t*Math.sqrt(f/a)/2:0,p(1-a)]},(d3.geo.collignon=function(){return m(U)}).raw=U,(d3.geo.craig=function(){return C(V)}).raw=V,W.invert=function(t,n){var a=Math.sqrt(3),r=3*p(n/(a*l));return[l*t/(a*(2*Math.cos(2*r/3)-1)),r]},(d3.geo.craster=function(){return m(W)}).raw=W,(d3.geo.cylindricalEqualArea=function(){return C(X)}).raw=X,(d3.geo.cylindricalStereographic=function(){return C(Y)}).raw=Y,Z.invert=function(t,n){var a=Math.sqrt(8/(3*f)),r=n/a;return[t/(a*(1-Math.abs(r)/f)),r]},(d3.geo.eckert1=function(){return m(Z)}).raw=Z,$.invert=function(t,n){var a=2-Math.abs(n)/Math.sqrt(2*f/3);return[t*Math.sqrt(6*f)/(2*a),b(n)*p((4-a*a)/3)]},(d3.geo.eckert2=function(){return m($)}).raw=$,tt.invert=function(t,n){var a=Math.sqrt(f*(4+f))/2;return[t*a/(1+q(1-n*n*(4+f)/(4*f))),n*a/2]},(d3.geo.eckert3=function(){return m(tt)}).raw=tt,nt.invert=function(t,n){var a=.5*n*Math.sqrt((4+f)/f),r=p(a),e=Math.cos(r);return[t/(2/Math.sqrt(f*(4+f))*(1+e)),p((r+a*(e+2))/(2+v))]},(d3.geo.eckert4=function(){return m(nt)}).raw=nt,at.invert=function(t,n){var a=Math.sqrt(2+f),r=n*a/2;return[a*t/(1+Math.cos(r)),r]},(d3.geo.eckert5=function(){return m(at)}).raw=at,rt.invert=function(t,n){var a=1+v,r=Math.sqrt(a/2);return[2*t*r/(1+Math.cos(n*=r)),p((n+Math.sin(n))/a)]},(d3.geo.eckert6=function(){return m(rt)}).raw=rt,et.invert=function(t,n){var a=d3.geo.august.raw.invert(t/1.2,1.065*n);if(!a)return null;var r=a[0],e=a[1],o=20;t/=ot,n/=ot;do{var i=r/2,h=e/2,u=Math.sin(i),M=Math.cos(i),c=Math.sin(h),f=Math.cos(h),l=Math.cos(e),g=Math.sqrt(l),d=c/(f+Math.SQRT2*M*g),b=d*d,p=Math.sqrt(2/(1+b)),w=(Math.SQRT2*f+(M+u)*g)/(Math.SQRT2*f+(M-u)*g),q=Math.sqrt(w),m=q-1/q,y=q+1/q,S=p*m-2*Math.log(q)-t,Q=p*d*y-2*Math.atan(d)-n,R=c&&Math.SQRT1_2*g*u*b/c,T=(Math.SQRT2*M*f+g)/(2*(f+Math.SQRT2*M*g)*(f+Math.SQRT2*M*g)*g),x=-.5*d*p*p*p,E=x*R,P=x*T,k=(k=2*f+Math.SQRT2*g*(M-u))*k*q,_=(Math.SQRT2*M*f*g+l)/k,z=-Math.SQRT2*u*c/(g*k),B=m*E-2*_/q+p*(_+_/w),F=m*P-2*z/q+p*(z+z/w),A=d*y*E-2*R/(1+b)+p*y*R+p*d*(_-_/w),G=d*y*P-2*T/(1+b)+p*y*T+p*d*(z-z/w),j=F*A-G*B;if(!j)break;var C=(Q*F-S*G)/j,D=(S*A-Q*B)/j;r-=C,e=Math.max(-v,Math.min(v,e-D))}while((Math.abs(C)>s||Math.abs(D)>s)&&--o>0);return Math.abs(Math.abs(e)-v)<s?[0,e]:o&&[r,e]};var ot=3+2*Math.SQRT2;function it(t,n){var a=Math.tan(n/2);return[t*ht*q(1-a*a),(1+ht)*a]}(d3.geo.eisenlohr=function(){return m(et)}).raw=et,it.invert=function(t,n){var a=n/(1+ht);return[t?t/(ht*q(1-a*a)):0,2*Math.atan(a)]};var ht=Math.cos(35*g);function ut(t,n){var a=n/2,r=Math.cos(a);return[2*t/l*Math.cos(n)*r*r,l*Math.tan(a)]}function Mt(t,n,a,r,e,o,i,h){function u(u,M){if(!M)return[t*u/f,0];var s=M*M,c=t+s*(n+s*(a+s*r)),v=M*(e-1+s*(o-h+s*i)),l=(c*c+v*v)/(2*v),g=u*Math.asin(c/l)/f;return[l*Math.sin(g),M*(1+s*h)+l*(1-Math.cos(g))]}return arguments.length<8&&(h=0),u.invert=function(u,M){var c,v,l=f*u/t,g=M,d=50;do{var b=g*g,p=t+b*(n+b*(a+b*r)),w=g*(e-1+b*(o-h+b*i)),m=p*p+w*w,y=2*w,S=m/y,Q=S*S,R=Math.asin(p/S)/f,T=l*R;if(xB2=p*p,dxBdφ=(2*n+b*(4*a+6*b*r))*g,dyBdφ=e+b*(3*o+5*b*i),dpdφ=2*(p*dxBdφ+w*(dyBdφ-1)),dqdφ=2*(dyBdφ-1),dmdφ=(dpdφ*y-m*dqdφ)/(y*y),cosα=Math.cos(T),sinα=Math.sin(T),mcosα=S*cosα,msinα=S*sinα,dαdφ=l/f*(1/q(1-xB2/Q))*(dxBdφ*S-p*dmdφ)/Q,fx=msinα-u,fy=g*(1+b*h)+S-mcosα-M,δxδφ=dmdφ*sinα+mcosα*dαdφ,δxδλ=mcosα*R,δyδφ=1+dmdφ-(dmdφ*cosα-msinα*dαdφ),δyδλ=msinα*R,denominator=δxδφ*δyδλ-δyδφ*δxδλ,!denominator)break;l-=c=(fy*δxδφ-fx*δyδφ)/denominator,g-=v=(fx*δyδλ-fy*δxδλ)/denominator}while((Math.abs(c)>s||Math.abs(v)>s)&&--d>0);return[l,g]},u}(d3.geo.fahey=function(){return m(it)}).raw=it,ut.invert=function(t,n){var a=Math.atan(n/l),r=Math.cos(a),e=2*a;return[t*l*.5/(Math.cos(e)*r*r),e]},(d3.geo.foucaut=function(){return m(ut)}).raw=ut,d3.geo.gilbert=function(t){var n=d3.geo.equirectangular().scale(d).translate([0,0]);function a(n){return t([.5*n[0],p(Math.tan(.5*n[1]*g))*d])}return t.invert&&(a.invert=function(n){return(n=t.invert(n))[0]*=2,n[1]=2*Math.atan(Math.sin(n[1]*g))*d,n}),a.stream=function(a){a=t.stream(a);var r=n.stream({point:function(t,n){a.point(.5*t,p(Math.tan(.5*-n*g))*d)},lineStart:function(){a.lineStart()},lineEnd:function(){a.lineEnd()},polygonStart:function(){a.polygonStart()},polygonEnd:function(){a.polygonEnd()}});return r.sphere=function(){a.sphere()},r.valid=!1,r},a};var st=Mt(2.8284,-1.6988,.75432,-.18071,1.76003,-.38914,.042555);(d3.geo.ginzburg4=function(){return m(st)}).raw=st;var ct=Mt(2.583819,-.835827,.170354,-.038094,1.543313,-.411435,.082742);(d3.geo.ginzburg5=function(){return m(ct)}).raw=ct;var ft=Mt(5/6*f,-.62636,-.0344,0,1.3493,-.05524,0,.045);function vt(t,n){var a=t*t,r=n*n;return[t*(1-.162388*r)*(.87-952426e-9*a*a),n*(1+r/12)]}(d3.geo.ginzburg6=function(){return m(ft)}).raw=ft,vt.invert=function(t,n){var a,r=t,e=n,o=50;do{var i=e*e;e-=a=(e*(1+i/12)-n)/(1+i/4)}while(Math.abs(a)>s&&--o>0);o=50,t/=1-.162388*i;do{var h=(h=r*r)*h;r-=a=(r*(.87-952426e-9*h)-t)/(.87-.00476213*h)}while(Math.abs(a)>s&&--o>0);return[r,e]},(d3.geo.ginzburg8=function(){return m(vt)}).raw=vt;var lt=Mt(2.6516,-.76534,.19123,-.047094,1.36289,-.13965,.031762);function gt(t){var n=t(v,0)[0]-t(-v,0)[0];function a(){var t=!1,n=y(r),a=n(t);return a.quincuncial=function(a){return arguments.length?n(t=!!a):t},a}function r(a){var r=a?function(a,r){var e=Math.abs(a)<v,o=t(e?a:a>0?a-f:a+f,r),i=(o[0]-o[1])*Math.SQRT1_2,h=(o[0]+o[1])*Math.SQRT1_2;if(e)return[i,h];var u=n*Math.SQRT1_2,M=i>0^h>0?-1:1;return[M*i-b(h)*u,M*h-b(i)*u]}:function(a,r){var e=a>0?-.5:.5,o=t(a+e*f,r);return o[0]-=e*n,o};return t.invert&&(r.invert=a?function(a,r){var e=(a+r)*Math.SQRT1_2,o=(r-a)*Math.SQRT1_2,i=Math.abs(e)<.5*n&&Math.abs(o)<.5*n;if(!i){var h=n*Math.SQRT1_2,u=e>0^o>0?-1:1,M=-u*(a+(o>0?1:-1)*h),s=-u*(r+(e>0?1:-1)*h);e=(-M-s)*Math.SQRT1_2,o=(M-s)*Math.SQRT1_2}var c=t.invert(e,o);return i||(c[0]+=e>0?f:-f),c}:function(a,r){var e=a>0?-.5:.5,o=t.invert(a+e*n,r),i=o[0]-e*f;return i<-f?i+=2*f:i>f&&(i-=2*f),o[0]=i,o}),r}return a.raw=r,a}function dt(t,n){var a=b(t),r=b(n),e=Math.cos(n),o=Math.cos(t)*e,i=Math.sin(t)*e,h=Math.sin(r*n);t=Math.abs(Math.atan2(i,h)),n=p(o),Math.abs(t-v)>s&&(t%=v);var u=function(t,n){if(n===v)return[0,0];var a=Math.sin(n),r=a*a,e=r*r,o=1+e,i=1+3*e,h=1-e,u=p(1/Math.sqrt(o)),M=h+r*o*u,c=(1-a)/M,l=Math.sqrt(c),g=c*o,d=Math.sqrt(g),b=l*h;if(0===t)return[0,-(b+r*d)];var w=Math.cos(n),m=1/w,y=2*a*w,S=(-M*w-(-3*r+u*i)*y*(1-a))/(M*M),Q=-m*y,R=-m*(r*o*S+c*i*y),T=-2*m*(h*(.5*S/l)-2*r*l*y),x=4*t/f;if(t>.222*f||n<f/4&&t>.175*f){var E=(b+r*q(g*(1+e)-b*b))/(1+e);if(t>f/4)return[E,E];var P=E,k=.5*E,_=50;E=.5*(k+P);do{var z=Math.sqrt(g-E*E),B=E*(T+Q*z)+R*p(E/d)-x;if(!B)break;B<0?k=E:P=E,E=.5*(k+P)}while(Math.abs(P-k)>s&&--_>0)}else{var F,E=s,_=25;do{var A=E*E,z=q(g-A),G=T+Q*z,B=E*G+R*p(E/d)-x,j=G+(R-Q*A)/z;E-=F=z?B/j:0}while(Math.abs(F)>s&&--_>0)}return[E,-b-r*q(g-E*E)]}(t>f/4?v-t:t,n);return t>f/4&&(h=u[0],u[0]=-u[1],u[1]=-h),u[0]*=a,u[1]*=-r,u}function bt(t,n){var a,r,e,o,i,h;if(n<s)return[(o=Math.sin(t))-(a=.25*n*(t-o*(r=Math.cos(t))))*r,r+a*o,1-.5*n*o*o,t-a];if(n>=1-s)return a=.25*(1-n),r=x(t),h=t,e=1/r,[(o=((h=Math.exp(2*h))-1)/(h+1))+a*((i=r*T(t))-t)/(r*r),e-a*o*e*(i-t),e+a*o*e*(i+t),2*Math.atan(Math.exp(t))-v+a*(i-t)/r];var u=[1,0,0,0,0,0,0,0,0],M=[Math.sqrt(n),0,0,0,0,0,0,0,0],c=0;for(r=Math.sqrt(1-n),i=1;Math.abs(M[c]/u[c])>s&&c<8;)a=u[c++],M[c]=.5*(a-r),u[c]=.5*(a+r),r=q(a*r),i*=2;e=i*u[c]*t;do{e=.5*(p(o=M[c]*Math.sin(r=e)/u[c])+e)}while(--c);return[Math.sin(e),o=Math.cos(e),o/Math.cos(e-r),e]}function pt(t,n){if(!n)return t;if(1===n)return Math.log(Math.tan(t/2+f/4));for(var a=1,r=Math.sqrt(1-n),e=Math.sqrt(n),o=0;Math.abs(e)>s;o++){if(t%f){var i=Math.atan(r*Math.tan(t)/a);i<0&&(i+=f),t+=i+~~(t/f)*f}else t+=t;e=(a+r)/2,r=Math.sqrt(a*r),e=((a=e)-r)/2}return t/(Math.pow(2,o)*a)}function wt(t,n){var a=(Math.SQRT2-1)/(Math.SQRT2+1),r=Math.sqrt(1-a*a),e=pt(v,r*r),o=Math.log(Math.tan(f/4+Math.abs(n)/2)),i=Math.exp(-1*o)/Math.sqrt(a),h=function(t,n){var a=t*t,r=n+1,e=1-a-n*n;return[.5*((t>=0?v:-v)-Math.atan2(e,2*t)),-.25*Math.log(e*e+4*a)+.5*Math.log(r*r+a)]}(i*Math.cos(-1*t),i*Math.sin(-1*t)),u=function(t,n,a){var r=Math.abs(t),e=T(Math.abs(n));if(r){var o=1/Math.sin(r),i=1/(Math.tan(r)*Math.tan(r)),h=-(i+a*e*e*o*o-1+a),u=(a-1)*i,M=.5*(-h+Math.sqrt(h*h-4*u));return[pt(Math.atan(1/Math.sqrt(M)),a)*b(t),pt(Math.atan(q((M/i-1)/a)),1-a)*b(n)]}return[0,pt(Math.atan(e),1-a)*b(n)]}(h[0],h[1],r*r);return[-u[1],(n>=0?1:-1)*(.5*e-u[0])]}function qt(t){var n=Math.sin(t),a=Math.cos(t),r=mt(t);function e(t,e){var o=r(t,e);t=o[0],e=o[1];var i=Math.sin(e),h=Math.cos(e),u=Math.cos(t),M=w(n*i+a*h*u),c=Math.sin(M),f=Math.abs(c)>s?M/c:1;return[f*a*Math.sin(t),(Math.abs(t)>v?f:-f)*(n*h-a*i*u)]}return r.invert=mt(-t),e.invert=function(t,a){var e=Math.sqrt(t*t+a*a),o=-Math.sin(e),i=Math.cos(e),h=e*i,u=-a*o,M=e*n,s=q(h*h+u*u-M*M),c=Math.atan2(h*M+u*s,u*M-h*s),f=(e>v?-1:1)*Math.atan2(t*o,e*Math.cos(c)*i+a*Math.sin(c)*o);return r.invert(f,c)},e}function mt(t){var n=Math.sin(t),a=Math.cos(t);return function(t,r){var e=Math.cos(r),o=Math.cos(t)*e,i=Math.sin(t)*e,h=Math.sin(r);return[Math.atan2(i,o*a-h*n),p(h*a+o*n)]}}(d3.geo.ginzburg9=function(){return m(lt)}).raw=lt,dt.invert=function(t,n){var a=b(t),r=b(n),e=-a*t,o=-r*n,i=o/e<1,h=function(t,n){var a=0,r=1,e=.5,o=50;for(;;){var i=e*e,h=Math.sqrt(e),u=Math.asin(1/Math.sqrt(1+i)),M=1-i+e*(1+i)*u,s=(1-h)/M,v=Math.sqrt(s),l=s*(1+i),g=v*(1-i),d=l-t*t,b=Math.sqrt(d),p=n+g+e*b;if(Math.abs(r-a)<c||0==--o||0===p)break;p>0?a=e:r=e,e=.5*(a+r)}if(!o)return null;var w=Math.asin(h),q=Math.cos(w),m=1/q,y=2*h*q,S=(-M*q-(-3*e+u*(1+3*i))*y*(1-h))/(M*M);return[f/4*(t*(-2*m*(.5*S/v*(1-i)-2*e*v*y)+-m*y*b)+-m*(e*(1+i)*S+s*(1+3*i)*y)*Math.asin(t/Math.sqrt(l))),w]}(i?o:e,i?e:o),u=h[0],M=h[1];i&&(u=-v-u);var s=Math.cos(M),l=(t=Math.cos(u)*s,n=Math.sin(u)*s,Math.sin(M));return[a*(Math.atan2(n,-l)+f),r*p(t)]},d3.geo.gringorten=gt(dt),wt.invert=function(t,n){var a,r,e,o=(Math.SQRT2-1)/(Math.SQRT2+1),i=Math.sqrt(1-o*o),h=function(t,n,a){if(!t)return[[0,(e=bt(n,1-a))[0]/e[1]],[1/e[1],0],[e[2]/e[1],0]];var r=bt(t,a);if(!n)return[[r[0],0],[r[1],0],[r[2],0]];var e,o=(e=bt(n,1-a))[1]*e[1]+a*r[0]*r[0]*e[0]*e[0];return[[r[0]*e[2]/o,r[1]*r[2]*e[0]*e[1]/o],[r[1]*e[1]/o,-r[0]*r[2]*e[0]*e[2]/o],[r[2]*e[1]*e[2]/o,-a*r[0]*r[1]*e[0]/o]]}(.5*pt(v,i*i)-n,-t,i*i),u=(a=h[0],r=h[1],e=r[0]*r[0]+r[1]*r[1],[(a[0]*r[0]+a[1]*r[1])/e,(a[1]*r[0]-a[0]*r[1])/e]);return[Math.atan2(u[1],u[0])/-1,2*Math.atan(Math.exp(-.5*Math.log(o*u[0]*u[0]+o*u[1]*u[1])))-v]},d3.geo.guyou=gt(wt),(d3.geo.hammerRetroazimuthal=function(){var t=0,n=y(qt),a=n(t),r=a.rotate,e=a.stream,o=d3.geo.circle();return a.parallel=function(r){if(!arguments.length)return t/f*180;var e=a.rotate();return n(t=r*f/180).rotate(e)},a.rotate=function(n){return arguments.length?(r.call(a,[n[0],n[1]-t/f*180]),o.origin([-n[0],-n[1]]),a):((n=r.call(a))[1]+=t/f*180,n)},a.stream=function(t){return(t=e(t)).sphere=function(){t.polygonStart();var n,a=o.angle(89.99)().coordinates[0],r=a.length-1,e=-1;for(t.lineStart();++e<r;)t.point((n=a[e])[0],n[1]);for(t.lineEnd(),r=(a=o.angle(90.01)().coordinates[0]).length-1,t.lineStart();--e>=0;)t.point((n=a[e])[0],n[1]);t.lineEnd(),t.polygonEnd()},t},a}).raw=qt;var yt=d3.geo.azimuthalEqualArea.raw;function St(t,n){if(arguments.length<2&&(n=t),1===n)return yt;if(n===1/0)return Qt;function a(a,r){var e=yt(a/n,r);return e[0]*=t,e}return a.invert=function(a,r){var e=yt.invert(a/t,r);return e[0]*=n,e},a}function Qt(t,n){return[t*Math.cos(n)/Math.cos(n/=2),2*Math.sin(n)]}function Rt(t,n){for(var a,r=Math.sin(n)*(n<0?2.43763:2.67595),e=0;e<20&&(n-=a=(n+Math.sin(n)-r)/(1+Math.cos(n)),!(Math.abs(a)<s));e++);return[.85*t*Math.cos(n*=.5),Math.sin(n)*(n<0?1.93052:1.75859)]}Qt.invert=function(t,n){var a=2*p(n/2);return[t*Math.cos(a/2)/Math.cos(a),a]},(d3.geo.hammer=function(){var t=2,n=y(St),a=n(t);return a.coefficient=function(a){return arguments.length?n(t=+a):t},a}).raw=St,Rt.invert=function(t,n){var a=Math.abs(a=n*(n<0?.5179951515653813:.5686373742600607))>1-s?a>0?v:-v:p(a);return[1.1764705882352942*t/Math.cos(a),Math.abs(a=((a+=a)+Math.sin(a))*(n<0?.4102345310814193:.3736990601468637))>1-s?a>0?v:-v:p(a)]},(d3.geo.hatano=function(){return m(Rt)}).raw=Rt;var Tt=41+48/36+37/3600;function xt(t){var n=d3.geo.cylindricalEqualArea.raw(0),a=Tt*f/180,r=2*f,e=d3.geo.collignon.raw(f,a)[0]-d3.geo.collignon.raw(-f,a)[0],o=n(0,a)[1],i=d3.geo.collignon.raw(0,a)[1],h=d3.geo.collignon.raw(0,v)[1]-i,u=2*f/t;function M(M,s){var c,v=Math.abs(s);if(v>a){var l=Math.min(t-1,Math.max(0,Math.floor((M+f)/u)));M+=f*(t-1)/t-l*u,(c=d3.geo.collignon.raw(M,v))[0]=c[0]*r/e-r*(t-1)/(2*t)+l*r/t,c[1]=o+4*(c[1]-i)*h/r,s<0&&(c[1]=-c[1])}else c=n(M,s);return c[0]/=2,c}return M.invert=function(a,M){a*=2;var s=Math.abs(M);if(s>o){var c=Math.min(t-1,Math.max(0,Math.floor((a+f)/u)));a=(a+f*(t-1)/t-c*u)*e/r;var v=d3.geo.collignon.raw.invert(a,.25*(s-o)*r/h+i);return v[0]-=f*(t-1)/t-c*u,M<0&&(v[1]=-v[1]),v}return n.invert(a,M)},M}function Et(t){var n,a=1+t,r=p(Math.sin(1/a)),e=2*Math.sqrt(f/(n=f+4*r*a)),o=.5*e*(a+Math.sqrt(t*(2+t))),i=t*t,h=a*a;function u(u,M){var s,l,g=1-Math.sin(M);if(g&&g<2){var d,b=v-M,p=25;do{var w=Math.sin(b),q=Math.cos(b),m=r+Math.atan2(w,a-q),y=1+h-2*a*q;b-=d=(b-i*r-a*w+y*m-.5*g*n)/(2*a*w*m)}while(Math.abs(d)>c&&--p>0);s=e*Math.sqrt(y),l=u*m/f}else s=e*(t+g),l=u*r/f;return[s*Math.sin(l),o-s*Math.cos(l)]}return u.invert=function(t,u){var M=t*t+(u-=o)*u,s=(1+h-M/(e*e))/(2*a),c=w(s),v=Math.sin(c),l=r+Math.atan2(v,a-s);return[p(t/Math.sqrt(M))*f/l,p(1-2*(c-i*r-a*v+(1+h-2*a*s)*l)/n)]},u}(d3.geo.healpix=function(){var t=2,n=y(xt),a=n(t),r=a.stream;return a.lobes=function(a){return arguments.length?n(t=+a):t},a.stream=function(n){var e=a.rotate(),o=r(n),i=(a.rotate([0,0]),r(n));return a.rotate(e),o.sphere=function(){var n;d3.geo.stream((n=180/t,{type:"Polygon",coordinates:[d3.range(-180,180+n/2,n).map(function(t,n){return[t,1&n?90-1e-6:Tt]}).concat(d3.range(180,-180-n/2,-n).map(function(t,n){return[t,1&n?1e-6-90:-Tt]}))]}),i)},o},a}).raw=xt,(d3.geo.hill=function(){var t=1,n=y(Et),a=n(t);return a.ratio=function(a){return arguments.length?n(t=+a):t},a}).raw=Et;var Pt=.7109889596207567,kt=.0528035274542;function _t(t,n){return n>-Pt?((t=G(t,n))[1]+=kt,t):D(t,n)}function zt(t,n){return Math.abs(n)>Pt?((t=G(t,n))[1]-=n>0?kt:-kt,t):D(t,n)}function Bt(t,n){return[3*t/(2*f)*Math.sqrt(f*f/3-n*n),n]}function Ft(t){function n(n,a){if(Math.abs(Math.abs(a)-v)<s)return[0,a<0?-2:2];var r=Math.sin(a),e=Math.pow((1+r)/(1-r),t/2),o=.5*(e+1/e)+Math.cos(n*=t);return[2*Math.sin(n)/o,(e-1/e)/o]}return n.invert=function(n,a){var r=Math.abs(a);if(Math.abs(r-2)<s)return n?null:[0,b(a)*v];if(r>2)return null;var e=(n/=2)*n,o=(a/=2)*a,i=2*a/(1+e+o);return i=Math.pow((1+i)/(1-i),1/t),[Math.atan2(2*n,1-e-o)/t,p((i-1)/(i+1))]},n}function At(t,n){return[t*(1+Math.sqrt(Math.cos(n)))/2,n/(Math.cos(n/2)*Math.cos(t/6))]}function Gt(t,n){var a=t*t,r=n*n;return[t*(.975534+r*(-.0143059*a-.119161+-.0547009*r)),n*(1.00384+a*(.0802894+-.02855*r+199025e-9*a)+r*(.0998909+-.0491032*r))]}function jt(t,n){return[Math.sin(t)/Math.cos(n),Math.tan(n)*Math.cos(t)]}function Ct(t){var n=Math.cos(t),a=Math.tan(f/4+t/2);function r(r,e){var o=e-t,i=Math.abs(o)<s?r*n:Math.abs(i=f/4+e/2)<s||Math.abs(Math.abs(i)-v)<s?0:r*o/Math.log(Math.tan(i)/a);return[i,o]}return r.invert=function(r,e){var o,i=e+t;return[Math.abs(e)<s?r/n:Math.abs(o=f/4+i/2)<s||Math.abs(Math.abs(o)-v)<s?0:r*Math.log(Math.tan(o)/a)/e,i]},r}function Dt(t,n){return[t,1.25*Math.log(Math.tan(f/4+.4*n))]}function Lt(t){var n=t.length-1;function a(a,r){for(var e,o=Math.cos(r),i=2/(1+o*Math.cos(a)),h=i*o*Math.sin(a),u=i*Math.sin(r),M=n,s=t[M],c=s[0],f=s[1];--M>=0;)c=(s=t[M])[0]+h*(e=c)-u*f,f=s[1]+h*f+u*e;return[c=h*(e=c)-u*f,f=h*f+u*e]}return a.invert=function(a,r){var e=20,o=a,i=r;do{for(var h,u=n,M=t[u],c=M[0],f=M[1],v=0,l=0;--u>=0;)v=c+o*(h=v)-i*l,l=f+o*l+i*h,c=(M=t[u])[0]+o*(h=c)-i*f,f=M[1]+o*f+i*h;var g,d,b=(v=c+o*(h=v)-i*l)*v+(l=f+o*l+i*h)*l;o-=g=((c=o*(h=c)-i*f-a)*v+(f=o*f+i*h-r)*l)/b,i-=d=(f*v-c*l)/b}while(Math.abs(g)+Math.abs(d)>s*s&&--e>0);if(e){var w=Math.sqrt(o*o+i*i),q=2*Math.atan(.5*w),m=Math.sin(q);return[Math.atan2(o*m,w*Math.cos(q)),w?p(i*m/w):0]}},a}_t.invert=function(t,n){return n>-Pt?G.invert(t,n-kt):D.invert(t,n)},(d3.geo.sinuMollweide=function(){return m(_t).rotate([-20,-55])}).raw=_t,zt.invert=function(t,n){return Math.abs(n)>Pt?G.invert(t,n+(n>0?kt:-kt)):D.invert(t,n)},(d3.geo.homolosine=function(){return m(zt)}).raw=zt,Bt.invert=function(t,n){return[2/3*f*t/Math.sqrt(f*f/3-n*n),n]},(d3.geo.kavrayskiy7=function(){return m(Bt)}).raw=Bt,(d3.geo.lagrange=function(){var t=.5,n=y(Ft),a=n(t);return a.spacing=function(a){return arguments.length?n(t=+a):t},a}).raw=Ft,At.invert=function(t,n){var a=Math.abs(t),r=Math.abs(n),e=f/Math.SQRT2,o=s,i=v;r<e?i*=r/e:o+=6*w(e/r);for(var h=0;h<25;h++){var u=Math.sin(i),M=q(Math.cos(i)),c=Math.sin(i/2),l=Math.cos(i/2),g=Math.sin(o/6),d=Math.cos(o/6),b=.5*o*(1+M)-a,p=i/(l*d)-r,m=M?-.25*o*u/M:0,y=.5*(1+M),S=(1+.5*i*c/l)/(l*d),Q=i/l*(g/6)/(d*d),R=m*Q-S*y,T=(b*Q-p*y)/R,x=(p*m-b*S)/R;if(i-=T,o-=x,Math.abs(T)<s&&Math.abs(x)<s)break}return[t<0?-o:o,n<0?-i:i]},(d3.geo.larrivee=function(){return m(At)}).raw=At,Gt.invert=function(t,n){var a=b(t)*f,r=n/2,e=50;do{var o=a*a,i=r*r,h=a*r,u=a*(.975534+i*(-.0143059*o-.119161+-.0547009*i))-t,M=r*(1.00384+o*(.0802894+-.02855*i+199025e-9*o)+i*(.0998909+-.0491032*i))-n,c=.975534-i*(.119161+3*o*.0143059+.0547009*i),v=-h*(.238322+.2188036*i+.0286118*o),l=h*(.1605788+7961e-7*o+-.0571*i),g=1.00384+o*(.0802894+199025e-9*o)+i*(3*(.0998909-.02855*o)-.245516*i),d=v*l-g*c,p=(M*v-u*g)/d,w=(u*l-M*c)/d;a-=p,r-=w}while((Math.abs(p)>s||Math.abs(w)>s)&&--e>0);return e&&[a,r]},(d3.geo.laskowski=function(){return m(Gt)}).raw=Gt,jt.invert=function(t,n){var a=t*t,r=n*n,e=r+1,o=t?Math.SQRT1_2*Math.sqrt((e-Math.sqrt(a*a+2*a*(r-1)+e*e))/a+1):1/Math.sqrt(e);return[p(t*o),b(n)*w(o)]},(d3.geo.littrow=function(){return m(jt)}).raw=jt,(d3.geo.loximuthal=function(){return C(Ct).parallel(40)}).raw=Ct,Dt.invert=function(t,n){return[t,2.5*Math.atan(Math.exp(.8*n))-.625*f]},(d3.geo.miller=function(){return m(Dt)}).raw=Dt;var Ot={alaska:[[.9972523,0],[.0052513,-.0041175],[.0074606,.0048125],[-.0153783,-.1968253],[.0636871,-.1408027],[.3660976,-.2937382]],gs48:[[.98879,0],[0,0],[-.050909,0],[0,0],[.075528,0]],gs50:[[.984299,0],[.0211642,.0037608],[-.1036018,-.0575102],[-.0329095,-.0320119],[.0499471,.1223335],[.026046,.0899805],[7388e-7,-.1435792],[.0075848,-.1334108],[-.0216473,.0776645],[-.0225161,.0853673]],miller:[[.9245,0],[0,0],[.01943,0]],lee:[[.721316,0],[0,0],[-.00881625,-.00617325]]};function Ht(t,n){var a=Math.sqrt(6),r=Math.sqrt(7),e=Math.asin(7*Math.sin(n)/(3*a));return[a*t*(2*Math.cos(2*e/3)-1)/r,9*Math.sin(e/3)/r]}function It(t,n){for(var a,r=(1+Math.SQRT1_2)*Math.sin(n),e=n,o=0;o<25&&(e-=a=(Math.sin(e/2)+Math.sin(e)-r)/(.5*Math.cos(e/2)+Math.cos(e)),!(Math.abs(a)<s));o++);return[t*(1+2*Math.cos(e)/Math.cos(e/2))/(3*Math.SQRT2),2*Math.sqrt(3)*Math.sin(e/2)/Math.sqrt(2+Math.SQRT2)]}function Jt(t,n){for(var a,r=Math.sqrt(6/(4+f)),e=(1+f/4)*Math.sin(n),o=n/2,i=0;i<25&&(o-=a=(o/2+Math.sin(o)-e)/(.5+Math.cos(o)),!(Math.abs(a)<s));i++);return[r*(.5+Math.cos(o))*t/1.5,r*o]}function Kt(t,n){var a=n*n,r=a*a;return[t*(.8707-.131979*a+r*(r*(.003971*a-.001529*r)-.013791)),n*(1.007226+a*(.015085+r*(.028874*a-.044475-.005916*r)))]}function Nt(t,n){return[t*(1+Math.cos(n))/2,2*(n-Math.tan(n/2))]}(d3.geo.modifiedStereographic=function(){var t=Ot.miller,n=y(Lt),a=n(t);return a.coefficients=function(a){return arguments.length?n(t="string"==typeof a?Ot[a]:a):t},a}).raw=Lt,Ht.invert=function(t,n){var a=Math.sqrt(6),r=Math.sqrt(7),e=3*p(n*r/9);return[t*r/(a*(2*Math.cos(2*e/3)-1)),p(3*Math.sin(e)*a/7)]},(d3.geo.mtFlatPolarParabolic=function(){return m(Ht)}).raw=Ht,It.invert=function(t,n){var a=n*Math.sqrt(2+Math.SQRT2)/(2*Math.sqrt(3)),r=2*p(a);return[3*Math.SQRT2*t/(1+2*Math.cos(r)/Math.cos(r/2)),p((a+Math.sin(r))/(1+Math.SQRT1_2))]},(d3.geo.mtFlatPolarQuartic=function(){return m(It)}).raw=It,Jt.invert=function(t,n){var a=Math.sqrt(6/(4+f)),r=n/a;return Math.abs(Math.abs(r)-v)<s&&(r=r<0?-v:v),[1.5*t/(a*(.5+Math.cos(r))),p((r/2+Math.sin(r))/(1+f/4))]},(d3.geo.mtFlatPolarSinusoidal=function(){return m(Jt)}).raw=Jt,Kt.invert=function(t,n){var a,r=n,e=25;do{var o=r*r,i=o*o;r-=a=(r*(1.007226+o*(.015085+i*(.028874*o-.044475-.005916*i)))-n)/(1.007226+o*(.045255+i*(.259866*o-.311325-.005916*11*i)))}while(Math.abs(a)>s&&--e>0);return[t/(.8707+(o=r*r)*(o*(o*o*o*(.003971-.001529*o)-.013791)-.131979)),r]},(d3.geo.naturalEarth=function(){return m(Kt)}).raw=Kt,Nt.invert=function(t,n){for(var a=n/2,r=0,e=1/0;r<10&&Math.abs(e)>s;r++){var o=Math.cos(n/2);n-=e=(n-Math.tan(n/2)-a)/(1-.5/(o*o))}return[2*t/(1+Math.cos(n)),n]},(d3.geo.nellHammer=function(){return m(Nt)}).raw=Nt;var Ut=gt(wt);function Vt(t,n){if(Math.abs(n)<s)return[t,0];var a=Math.tan(n),r=t*Math.sin(n);return[Math.sin(r)/a,n+(1-Math.cos(r))/a]}function Wt(t){var n=Math.sin(t);function a(a,r){var e=n?Math.tan(a*n/2)/n:a/2;if(!r)return[2*e,-t];var o=2*Math.atan(e*Math.sin(r)),i=1/Math.tan(r);return[Math.sin(o)*i,r+(1-Math.cos(o))*i-t]}return a.invert=function(a,r){if(Math.abs(r+=t)<s)return[n?2*Math.atan(n*a/2)/n:a,0];var e,o=a*a+r*r,i=0,h=10;do{var u=Math.tan(i),M=1/Math.cos(i),c=o-2*r*i+i*i;i-=e=(u*c+2*(i-r))/(2+c*M*M+2*(i-r)*u)}while(Math.abs(e)>s&&--h>0);var v=a*(u=Math.tan(i)),l=Math.tan(Math.abs(r)<Math.abs(i+1/u)?.5*p(v):.5*w(v)+f/4)/Math.sin(i);return[n?2*Math.atan(n*l)/n:2*l,i]},a}(d3.geo.peirceQuincuncial=function(){return Ut().quincuncial(!0).rotate([-90,-90,45]).clipAngle(180-1e-6)}).raw=Ut.raw,Vt.invert=function(t,n){if(Math.abs(n)<s)return[t,0];var a,r=t*t+n*n,e=.5*n,o=10;do{var i=Math.tan(e),h=1/Math.cos(e),u=r-2*n*e+e*e;e-=a=(i*u+2*(e-n))/(2+u*h*h+2*(e-n)*i)}while(Math.abs(a)>s&&--o>0);return i=Math.tan(e),[(Math.abs(n)<Math.abs(e+1/i)?p(t*i):b(t)*(w(Math.abs(t*i))+v))/Math.sin(e),e]},(d3.geo.polyconic=function(){return m(Vt)}).raw=Vt,(d3.geo.rectangularPolyconic=function(){return C(Wt)}).raw=Wt;var Xt=[[.9986,-.062],[1,0],[.9986,.062],[.9954,.124],[.99,.186],[.9822,.248],[.973,.31],[.96,.372],[.9427,.434],[.9216,.4958],[.8962,.5571],[.8679,.6176],[.835,.6769],[.7986,.7346],[.7597,.7903],[.7186,.8435],[.6732,.8936],[.6213,.9394],[.5722,.9761],[.5322,1]];function Yt(t,n){var a,r=Math.min(18,36*Math.abs(n)/f),e=Math.floor(r),o=r-e,i=(a=Xt[e])[0],h=a[1],u=(a=Xt[++e])[0],M=a[1],s=(a=Xt[Math.min(19,++e)])[0],c=a[1];return[t*(u+o*(s-i)/2+o*o*(s-2*u+i)/2),(n>0?v:-v)*(M+o*(c-h)/2+o*o*(c-2*M+h)/2)]}function Zt(t,n){var a=function(t){function n(n,a){var r=Math.cos(a),e=(t-1)/(t-r*Math.cos(n));return[e*r*Math.sin(n),e*Math.sin(a)]}return n.invert=function(n,a){var r=n*n+a*a,e=Math.sqrt(r),o=(t-Math.sqrt(1-r*(t+1)/(t-1)))/((t-1)/e+e/(t-1));return[Math.atan2(n*o,e*Math.sqrt(1-o*o)),e?p(a*o/e):0]},n}(t);if(!n)return a;var r=Math.cos(n),e=Math.sin(n);function o(n,o){var i=a(n,o),h=i[1],u=h*e/(t-1)+r;return[i[0]*r/u,h/u]}return o.invert=function(n,o){var i=(t-1)/(t-1-o*e);return a.invert(i*n,i*o*r)},o}function $t(t,n){var a=Math.tan(n/2),r=Math.sin(f/4*a);return[t*(.74482-.34588*r*r),1.70711*a]}function tn(t){if(!t)return d3.geo.azimuthalEquidistant.raw;var n=-t/2,a=-n,r=t*t,e=Math.tan(a),o=.5/Math.sin(a);function i(e,o){var i=w(Math.cos(o)*Math.cos(e-n)),h=w(Math.cos(o)*Math.cos(e-a));return[((i*=i)-(h*=h))/(2*t),(o<0?-1:1)*q(4*r*h-(r-i+h)*(r-i+h))/(2*t)]}return i.invert=function(t,r){var i,h,u=r*r,M=Math.cos(Math.sqrt(u+(i=t+n)*i)),s=Math.cos(Math.sqrt(u+(i=t+a)*i));return[Math.atan2(h=M-s,i=(M+s)*e),(r<0?-1:1)*w(Math.sqrt(i*i+h*h)*o)]},i}function nn(t){var n=Math.cos(t);function a(t,a){var r=d3.geo.gnomonic.raw(t,a);return r[0]*=n,r}return a.invert=function(t,a){return d3.geo.gnomonic.raw.invert(t/n,a)},a}function an(t,n){if(Math.abs(n)<s)return[t,0];var a=Math.abs(n/v),r=p(a);if(Math.abs(t)<s||Math.abs(Math.abs(n)-v)<s)return[0,b(n)*f*Math.tan(r/2)];var e=Math.cos(r),o=Math.abs(f/t-t/f)/2,i=o*o,h=e/(a+e-1),u=h*(2/a-1),M=u*u,c=M+i,l=h-M,g=i+h;return[b(t)*f*(o*l+Math.sqrt(i*l*l-c*(h*h-M)))/c,b(n)*f*(u*g-o*Math.sqrt((i+1)*c-g*g))/c]}function rn(t,n){if(Math.abs(n)<s)return[t,0];var a=Math.abs(n/v),r=p(a);if(Math.abs(t)<s||Math.abs(Math.abs(n)-v)<s)return[0,b(n)*f*Math.tan(r/2)];var e=Math.cos(r),o=Math.abs(f/t-t/f)/2,i=o*o,h=e*(Math.sqrt(1+i)-o*e)/(1+i*a*a);return[b(t)*f*h,b(n)*f*q(1-h*(2*o+h))]}function en(t,n){if(Math.abs(n)<s)return[t,0];var a=n/v,r=p(a);if(Math.abs(t)<s||Math.abs(Math.abs(n)-v)<s)return[0,f*Math.tan(r/2)];var e=(f/t-t/f)/2,o=a/(1+Math.cos(r));return[f*(b(t)*q(e*e+1-o*o)-e),f*o]}function on(t,n){if(!n)return[t,0];var a=Math.abs(n);if(!t||a===v)return[0,n];var r=a/v,e=r*r,o=(8*r-e*(e+2)-5)/(2*e*(r-1)),i=o*o,h=r*o,u=e+i+2*h,M=r+3*o,s=t/v,c=s+1/s,f=b(Math.abs(t)-v)*Math.sqrt(c*c-4),l=f*f,g=(f*(u+i-1)+2*q(u*(e+i*l-1)+(1-e)*(e*(M*M+4*i)+12*h*i+4*i*i)))/(4*u+l);return[b(t)*v*g,b(n)*v*q(1+f*Math.abs(g)-g*g)]}Xt.forEach(function(t){t[1]*=1.0144}),Yt.invert=function(t,n){var a=n/v,r=90*a,e=Math.min(18,Math.abs(r/5)),o=Math.max(0,Math.floor(e));do{var i=Xt[o][1],h=Xt[o+1][1],u=Xt[Math.min(19,o+2)][1],M=u-i,s=u-2*h+i,f=2*(Math.abs(a)-h)/M,l=s/M,b=f*(1-l*f*(1-2*l*f));if(b>=0||1===o){r=(n>=0?5:-5)*(b+e);var p,w=50;do{b=(e=Math.min(18,Math.abs(r)/5))-(o=Math.floor(e)),i=Xt[o][1],h=Xt[o+1][1],u=Xt[Math.min(19,o+2)][1],r-=(p=(n>=0?v:-v)*(h+b*(u-i)/2+b*b*(u-2*h+i)/2)-n)*d}while(Math.abs(p)>c&&--w>0);break}}while(--o>=0);var q=Xt[o][0],m=Xt[o+1][0],y=Xt[Math.min(19,o+2)][0];return[t/(m+b*(y-q)/2+b*b*(y-2*m+q)/2),r*g]},(d3.geo.robinson=function(){return m(Yt)}).raw=Yt,(d3.geo.satellite=function(){var t=1.4,n=0,a=y(Zt),r=a(t,n);return r.distance=function(r){return arguments.length?a(t=+r,n):t},r.tilt=function(r){return arguments.length?a(t,n=r*f/180):180*n/f},r}).raw=Zt,$t.invert=function(t,n){var a=n/1.70711,r=Math.sin(f/4*a);return[t/(.74482-.34588*r*r),2*Math.atan(a)]},(d3.geo.times=function(){return m($t)}).raw=$t,(d3.geo.twoPointEquidistant=function(){var t=[[0,0],[0,0]],n=y(tn),a=n(0),r=a.rotate;return delete a.rotate,a.points=function(a){if(!arguments.length)return t;t=a;var e=d3.geo.interpolate(a[0],a[1]),o=e(.5),i=d3.geo.rotation([-o[0],-o[1]])(a[0]),h=.5*e.distance,u=(i[0]<0?-1:1)*i[1]*g,M=p(Math.sin(u)/Math.sin(h));return r.call(i,[-o[0],-o[1],-M*d]),n(2*h)},a}).raw=tn,(d3.geo.twoPointAzimuthal=function(){var t=[[0,0],[0,0]],n=y(nn),a=n(0),r=a.rotate;return delete a.rotate,a.points=function(a){if(!arguments.length)return t;t=a;var e=d3.geo.interpolate(a[0],a[1]),o=e(.5),i=d3.geo.rotation([-o[0],-o[1]])(a[0]),h=.5*e.distance,u=(i[0]<0?-1:1)*i[1]*g,M=p(Math.sin(u)/Math.sin(h));return r.call(i,[-o[0],-o[1],-M*d]),n(h)},a}).raw=nn,an.invert=function(t,n){if(Math.abs(n)<s)return[t,0];if(Math.abs(t)<s)return[0,v*Math.sin(2*Math.atan(n/f))];var a=(t/=f)*t,r=(n/=f)*n,e=a+r,o=e*e,i=-Math.abs(n)*(1+e),h=i-2*r+a,u=-2*i+1+2*r+o,M=r/u+(2*h*h*h/(u*u*u)-9*i*h/(u*u))/27,c=(i-h*h/(3*u))/u,l=2*Math.sqrt(-c/3),g=w(3*M/(c*l))/3;return[f*(e-1+Math.sqrt(1+2*(a-r)+o))/(2*t),b(n)*f*(-l*Math.cos(g+f/3)-h/(3*u))]},(d3.geo.vanDerGrinten=function(){return m(an)}).raw=an,rn.invert=function(t,n){if(!t)return[0,v*Math.sin(2*Math.atan(n/f))];var a=Math.abs(t/f),r=(1-a*a-(n/=f)*n)/(2*a),e=r*r,o=Math.sqrt(e+1);return[b(t)*f*(o-r),b(n)*v*Math.sin(2*Math.atan2(Math.sqrt((1-2*r*a)*(r+o)-a),Math.sqrt(o+r+a)))]},(d3.geo.vanDerGrinten2=function(){return m(rn)}).raw=rn,en.invert=function(t,n){if(!n)return[t,0];var a=n/f,r=(f*f*(1-a*a)-t*t)/(2*f*t);return[t?f*(b(t)*Math.sqrt(r*r+1)-r):0,v*Math.sin(2*Math.atan(a))]},(d3.geo.vanDerGrinten3=function(){return m(en)}).raw=en,on.invert=function(t,n){if(!t||!n)return[t,n];n/=f;var a=b(t)*t/v,r=(a*a-1+4*n*n)/Math.abs(a),e=r*r,o=2*n,i=50;do{var h=o*o,u=(8*o-h*(h+2)-5)/(2*h*(o-1)),M=(3*o-h*o-10)/(2*h*o),c=u*u,l=o*u,g=o+u,d=g*g,p=o+3*u,w=d*(h+c*e-1)+(1-h)*(h*(p*p+4*c)+c*(12*l+4*c)),q=-2*g*(4*l*c+(1-4*h+3*h*h)*(1+M)+c*(14*h-6-e+(8*h-8-2*e)*M)+l*(12*h-8+(10*h-10-e)*M)),m=Math.sqrt(w);o-=δ=(r*(d+c-1)+2*m-a*(4*d+e))/(r*(2*u*M+2*g*(1+M))+q/m-8*g*(r*(-1+c+d)+2*m)*(1+M)/(e+4*d))}while(δ>s&&--i>0);return[b(t)*(Math.sqrt(r*r+4)+r)*f/4,v*o]},(d3.geo.vanDerGrinten4=function(){return m(on)}).raw=on;var hn,un,Mn=(hn=4*f+3*Math.sqrt(3),F((un=2*Math.sqrt(2*f*Math.sqrt(3)/hn))*Math.sqrt(3)/f,un,hn/6));function sn(t,n){return[t*Math.sqrt(1-3*n*n/(f*f)),n]}function cn(t,n){var a=.90631*Math.sin(n),r=Math.sqrt(1-a*a),e=Math.sqrt(2/(1+r*Math.cos(t/=3)));return[2.66723*r*e*Math.sin(t),1.24104*a*e]}function fn(t,n){var a=Math.cos(n),r=Math.cos(t)*a,e=1-r,o=Math.cos(t=Math.atan2(Math.sin(t)*a,-Math.sin(n))),i=Math.sin(t);return[i*(a=q(1-r*r))-o*e,-o*a-i*e]}function vn(t,n){var a=Q(t,n);return[(a[0]+t/v)/2,(a[1]+n)/2]}(d3.geo.wagner4=function(){return m(Mn)}).raw=Mn,sn.invert=function(t,n){return[t/Math.sqrt(1-3*n*n/(f*f)),n]},(d3.geo.wagner6=function(){return m(sn)}).raw=sn,cn.invert=function(t,n){var a=t/2.66723,r=n/1.24104,e=Math.sqrt(a*a+r*r),o=2*p(e/2);return[3*Math.atan2(t*Math.tan(o),2.66723*e),e&&p(n*Math.sin(o)/(1.24104*.90631*e))]},(d3.geo.wagner7=function(){return m(cn)}).raw=cn,fn.invert=function(t,n){var a=-.5*(t*t+n*n),r=Math.sqrt(-a*(2+a)),e=n*a+t*r,o=t*a-n*r,i=Math.sqrt(o*o+e*e);return[Math.atan2(r*e,i*(1+a)),i?-p(r*o/i):0]},(d3.geo.wiechel=function(){return m(fn)}).raw=fn,vn.invert=function(t,n){var a=t,r=n,e=25;do{var o,i=Math.cos(r),h=Math.sin(r),u=Math.sin(2*r),M=h*h,c=i*i,f=Math.sin(a),l=Math.cos(a/2),g=Math.sin(a/2),d=g*g,b=1-c*l*l,p=b?w(i*l)*Math.sqrt(o=1/b):o=0,q=.5*(2*p*i*g+a/v)-t,m=.5*(p*h+r)-n,y=.5*o*(c*d+p*i*l*M)+.5/v,S=o*(f*u/4-p*h*g),Q=.125*o*(u*g-p*h*c*f),R=.5*o*(M*l+p*d*i)+.5,T=S*Q-R*y,x=(m*S-q*R)/T,E=(q*Q-m*y)/T;a-=x,r-=E}while((Math.abs(x)>s||Math.abs(E)>s)&&--e>0);return[a,r]},(d3.geo.winkel3=function(){return m(vn)}).raw=vn}();
            </script>
            <script  >
              (function(){function n(r,t,o){var e,a,i=t.edges,c=i.length,u={type:"MultiPoint",coordinates:t.face},f=t.face.filter(function(n){return 90!==Math.abs(n[1])}),h=d3.geo.bounds({type:"MultiPoint",coordinates:f}),d=!1,s=-1,l=h[1][0]-h[0][0],p=180===l||360===l?[(h[0][0]+h[1][0])/2,(h[0][1]+h[1][1])/2]:d3.geo.centroid(u);if(o)for(;c>++s&&i[s]!==o;);++s;for(var v=0;c>v;++v)a=i[(v+s)%c],Array.isArray(a)?(d||(r.point((e=d3.geo.interpolate(a[0],p)(g))[0],e[1]),d=!0),r.point((e=d3.geo.interpolate(a[1],p)(g))[0],e[1])):(d=!1,a!==o&&n(r,a,t))}function r(n,r){for(var t,o,e=n.length,a=null,i=0;e>i;++i){t=n[i];for(var c=r.length;--c>=0;)if(o=r[c],t[0]===o[0]&&t[1]===o[1]){if(a)return[a,t];a=t}}}function t(n,r){var t=a(n[1],n[0]),o=a(r[1],r[0]),u=c(t,o),f=i(t)/i(o);return e([1,0,n[0][0],0,1,n[0][1]],e([f,0,0,0,f,0],e([Math.cos(u),Math.sin(u),0,-Math.sin(u),Math.cos(u),0],[1,0,-r[0][0],0,1,-r[0][1]])))}function o(n){var r=1/(n[0]*n[4]-n[1]*n[3]);return[r*n[4],-r*n[1],r*(n[1]*n[5]-n[2]*n[4]),-r*n[3],r*n[0],r*(n[2]*n[3]-n[0]*n[5])]}function e(n,r){return[n[0]*r[0]+n[1]*r[3],n[0]*r[1]+n[1]*r[4],n[0]*r[2]+n[1]*r[5]+n[2],n[3]*r[0]+n[4]*r[3],n[3]*r[1]+n[4]*r[4],n[3]*r[2]+n[4]*r[5]+n[5]]}function a(n,r){return[n[0]-r[0],n[1]-r[1]]}function i(n){return Math.sqrt(n[0]*n[0]+n[1]*n[1])}function c(n,r){return Math.atan2(n[0]*r[1]-n[1]*r[0],n[0]*r[0]+n[1]*r[1])}function u(n,r){for(var t=0,o=n.length,e=0;o>t;++t)e+=n[t]*r[t];return e}function f(n,r){return[n[1]*r[2]-n[2]*r[1],n[2]*r[0]-n[0]*r[2],n[0]*r[1]-n[1]*r[0]]}function h(n){return[Math.atan2(n[1],n[0])*m,Math.asin(Math.max(-1,Math.min(1,n[2])))*m]}function d(n){var r=n[0]*M,t=n[1]*M,o=Math.cos(t);return[o*Math.cos(r),o*Math.sin(r),Math.sin(t)]}function s(n,r){return n&&r&&n[0]===r[0]&&n[1]===r[1]}function l(n){for(var r=n.length,t=[],o=n[r-1],e=0;r>e;++e)t.push([o,o=n[e]]);return t}function p(n){return n.project.invert||n.children&&n.children.some(p)}var g=1e-6,v=Math.PI,M=v/180,m=180/v;d3.geo.polyhedron=function(a,i,c){function u(n,o){if(n.edges=l(n.face),o)if(o.face){var a=n.shared=r(n.face,o.face),i=t(a.map(o.project),a.map(n.project));n.transform=o.transform?e(o.transform,i):i;for(var c=o.edges,f=0,h=c.length;h>f;++f)s(a[0],c[f][1])&&s(a[1],c[f][0])&&(c[f]=n),s(a[0],c[f][0])&&s(a[1],c[f][1])&&(c[f]=n);for(var c=n.edges,f=0,h=c.length;h>f;++f)s(a[0],c[f][0])&&s(a[1],c[f][1])&&(c[f]=o),s(a[0],c[f][1])&&s(a[1],c[f][0])&&(c[f]=o)}else n.transform=o.transform;return n.children&&n.children.forEach(function(r){u(r,n)}),n}function f(n,r){var t,o=i(n,r),e=o.project([n*m,r*m]);return(t=o.transform)?[t[0]*e[0]+t[1]*e[1]+t[2],-(t[3]*e[0]+t[4]*e[1]+t[5])]:(e[1]=-e[1],e)}function h(n,r){var t=n.project.invert,e=n.transform,a=r;if(e&&(e=o(e),a=[e[0]*a[0]+e[1]*a[1]+e[2],e[3]*a[0]+e[4]*a[1]+e[5]]),t&&n===d(i=t(a)))return i;for(var i,c=n.children,u=0,f=c&&c.length;f>u;++u)if(i=h(c[u],r))return i}function d(n){return i(n[0]*M,n[1]*M)}c=null==c?-v/6:c,u(a,{transform:[Math.cos(c),Math.sin(c),0,-Math.sin(c),Math.cos(c),0]}),p(a)&&(f.invert=function(n,r){var t=h(a,[n,-r]);return t&&(t[0]*=M,t[1]*=M,t)});var g=d3.geo.projection(f),y=g.stream;return g.stream=function(r){var t=g.rotate(),o=y(r),e=(g.rotate([0,0]),y(r));return g.rotate(t),o.sphere=function(){e.polygonStart(),e.lineStart(),n(e,a),e.lineEnd(),e.polygonEnd()},o},g},d3.geo.polyhedron.butterfly=function(n){n=n||function(n){var r=d3.geo.centroid({type:"MultiPoint",coordinates:n});return d3.geo.gnomonic().scale(1).translate([0,0]).rotate([-r[0],-r[1]])};var r=d3.geo.polyhedron.octahedron.map(function(r){return{face:r,project:n(r)}});return[-1,0,0,1,0,1,4,5].forEach(function(n,t){var o=r[n];o&&(o.children||(o.children=[])).push(r[t])}),d3.geo.polyhedron(r[0],function(n,t){return r[-v/2>n?0>t?6:4:0>n?0>t?2:0:v/2>n?0>t?3:1:0>t?7:5]})},d3.geo.polyhedron.waterman=function(n){function r(n,r){var t=Math.cos(r),o=[t*Math.cos(n),t*Math.sin(n),Math.sin(r)],a=-v/2>n?0>r?6:4:0>n?0>r?2:0:v/2>n?0>r?3:1:0>r?7:5,c=e[a];return i[0>u(c[0],o)?8+3*a:0>u(c[1],o)?8+3*a+1:0>u(c[2],o)?8+3*a+2:a]}n=n||function(n){var r=6===n.length?d3.geo.centroid({type:"MultiPoint",coordinates:n}):n[0];return d3.geo.gnomonic().scale(1).translate([0,0]).rotate([-r[0],-r[1]])};var t=d3.geo.polyhedron.octahedron,o=t.map(function(n){for(var r,t=n.map(d),o=t.length,e=t[o-1],a=[],i=0;o>i;++i)r=t[i],a.push(h([.9486832980505138*e[0]+.31622776601683794*r[0],.9486832980505138*e[1]+.31622776601683794*r[1],.9486832980505138*e[2]+.31622776601683794*r[2]]),h([.9486832980505138*r[0]+.31622776601683794*e[0],.9486832980505138*r[1]+.31622776601683794*e[1],.9486832980505138*r[2]+.31622776601683794*e[2]])),e=r;return a}),e=[],a=[-1,0,0,1,0,1,4,5];o.forEach(function(n,r){for(var i=t[r],c=i.length,u=e[r]=[],h=0;c>h;++h)o.push([i[h],n[(2*h+2)%(2*c)],n[(2*h+1)%(2*c)]]),a.push(r),u.push(f(d(n[(2*h+2)%(2*c)]),d(n[(2*h+1)%(2*c)])))});var i=o.map(function(r){return{project:n(r),face:r}});return a.forEach(function(n,r){var t=i[n];t&&(t.children||(t.children=[])).push(i[r])}),d3.geo.polyhedron(i[0],r).center([0,45])};var y=[[0,90],[-90,0],[0,0],[90,0],[180,0],[0,-90]];d3.geo.polyhedron.octahedron=[[0,2,1],[0,3,2],[5,1,2],[5,2,3],[0,1,4],[0,4,3],[5,4,1],[5,3,4]].map(function(n){return n.map(function(n){return y[n]})});var j=Math.atan(Math.SQRT1_2)*m,E=[[0,j],[90,j],[180,j],[-90,j],[0,-j],[90,-j],[180,-j],[-90,-j]];d3.geo.polyhedron.cube=[[0,3,2,1],[0,1,5,4],[1,2,6,5],[2,3,7,6],[3,0,4,7],[4,5,6,7]].map(function(n){return n.map(function(n){return E[n]})})})();
            </script>
            <script >
/** @license MIT License (c) copyright 2011-2013 original author or authors */

/**
 * A lightweight CommonJS Promises/A and when() implementation
 * when is part of the cujo.js family of libraries (http://cujojs.com/)
 *
 * Licensed under the MIT License at:
 * http://www.opensource.org/licenses/mit-license.php
 *
 * @author Brian Cavalier
 * @author John Hann
 * @version 2.6.0
 *
 * modified by @cambecc to work as-in in the browser
 */
 when = function(define, global) { 'use strict';
 return define(function () {
 
   // Public API
 
   when.promise   = promise;    // Create a pending promise
   when.resolve   = resolve;    // Create a resolved promise
   when.reject    = reject;     // Create a rejected promise
   when.defer     = defer;      // Create a {promise, resolver} pair
 
   when.join      = join;       // Join 2 or more promises
 
   when.all       = all;        // Resolve a list of promises
   when.map       = map;        // Array.map() for promises
   when.reduce    = reduce;     // Array.reduce() for promises
   when.settle    = settle;     // Settle a list of promises
 
   when.any       = any;        // One-winner race
   when.some      = some;       // Multi-winner race
 
   when.isPromise = isPromiseLike;  // DEPRECATED: use isPromiseLike
   when.isPromiseLike = isPromiseLike; // Is something promise-like, aka thenable
 
   /**
    * Register an observer for a promise or immediate value.
    *
    * @param {*} promiseOrValue
    * @param {function?} [onFulfilled] callback to be called when promiseOrValue is
    *   successfully fulfilled.  If promiseOrValue is an immediate value, callback
    *   will be invoked immediately.
    * @param {function?} [onRejected] callback to be called when promiseOrValue is
    *   rejected.
    * @param {function?} [onProgress] callback to be called when progress updates
    *   are issued for promiseOrValue.
    * @returns {Promise} a new {@link Promise} that will complete with the return
    *   value of callback or errback or the completion value of promiseOrValue if
    *   callback and/or errback is not supplied.
    */
   function when(promiseOrValue, onFulfilled, onRejected, onProgress) {
     // Get a trusted promise for the input promiseOrValue, and then
     // register promise handlers
     return cast(promiseOrValue).then(onFulfilled, onRejected, onProgress);
   }
 
   function cast(x) {
     return x instanceof Promise ? x : resolve(x);
   }
 
   /**
    * Trusted Promise constructor.  A Promise created from this constructor is
    * a trusted when.js promise.  Any other duck-typed promise is considered
    * untrusted.
    * @constructor
    * @param {function} sendMessage function to deliver messages to the promise's handler
    * @param {function?} inspect function that reports the promise's state
    * @name Promise
    */
   function Promise(sendMessage, inspect) {
     this._message = sendMessage;
     this.inspect = inspect;
   }
 
   Promise.prototype = {
     /**
      * Register handlers for this promise.
      * @param [onFulfilled] {Function} fulfillment handler
      * @param [onRejected] {Function} rejection handler
      * @param [onProgress] {Function} progress handler
      * @return {Promise} new Promise
      */
     then: function(onFulfilled, onRejected, onProgress) {
       /*jshint unused:false*/
       var args, sendMessage;
 
       args = arguments;
       sendMessage = this._message;
 
       return _promise(function(resolve, reject, notify) {
         sendMessage('when', args, resolve, notify);
       }, this._status && this._status.observed());
     },
 
     /**
      * Register a rejection handler.  Shortcut for .then(undefined, onRejected)
      * @param {function?} onRejected
      * @return {Promise}
      */
     otherwise: function(onRejected) {
       return this.then(undef, onRejected);
     },
 
     /**
      * Ensures that onFulfilledOrRejected will be called regardless of whether
      * this promise is fulfilled or rejected.  onFulfilledOrRejected WILL NOT
      * receive the promises' value or reason.  Any returned value will be disregarded.
      * onFulfilledOrRejected may throw or return a rejected promise to signal
      * an additional error.
      * @param {function} onFulfilledOrRejected handler to be called regardless of
      *  fulfillment or rejection
      * @returns {Promise}
      */
     ensure: function(onFulfilledOrRejected) {
       return typeof onFulfilledOrRejected === 'function'
         ? this.then(injectHandler, injectHandler)['yield'](this)
         : this;
 
       function injectHandler() {
         return resolve(onFulfilledOrRejected());
       }
     },
 
     /**
      * Terminate a promise chain by handling the ultimate fulfillment value or
      * rejection reason, and assuming responsibility for all errors.  if an
      * error propagates out of handleResult or handleFatalError, it will be
      * rethrown to the host, resulting in a loud stack track on most platforms
      * and a crash on some.
      * @param {function?} handleResult
      * @param {function?} handleError
      * @returns {undefined}
      */
     done: function(handleResult, handleError) {
       this.then(handleResult, handleError).otherwise(crash);
     },
 
     /**
      * Shortcut for .then(function() { return value; })
      * @param  {*} value
      * @return {Promise} a promise that:
      *  - is fulfilled if value is not a promise, or
      *  - if value is a promise, will fulfill with its value, or reject
      *    with its reason.
      */
     'yield': function(value) {
       return this.then(function() {
         return value;
       });
     },
 
     /**
      * Runs a side effect when this promise fulfills, without changing the
      * fulfillment value.
      * @param {function} onFulfilledSideEffect
      * @returns {Promise}
      */
     tap: function(onFulfilledSideEffect) {
       return this.then(onFulfilledSideEffect)['yield'](this);
     },
 
     /**
      * Assumes that this promise will fulfill with an array, and arranges
      * for the onFulfilled to be called with the array as its argument list
      * i.e. onFulfilled.apply(undefined, array).
      * @param {function} onFulfilled function to receive spread arguments
      * @return {Promise}
      */
     spread: function(onFulfilled) {
       return this.then(function(array) {
         // array may contain promises, so resolve its contents.
         return all(array, function(array) {
           return onFulfilled.apply(undef, array);
         });
       });
     },
 
     /**
      * Shortcut for .then(onFulfilledOrRejected, onFulfilledOrRejected)
      * @deprecated
      */
     always: function(onFulfilledOrRejected, onProgress) {
       return this.then(onFulfilledOrRejected, onFulfilledOrRejected, onProgress);
     }
   };
 
   /**
    * Returns a resolved promise. The returned promise will be
    *  - fulfilled with promiseOrValue if it is a value, or
    *  - if promiseOrValue is a promise
    *    - fulfilled with promiseOrValue's value after it is fulfilled
    *    - rejected with promiseOrValue's reason after it is rejected
    * @param  {*} value
    * @return {Promise}
    */
   function resolve(value) {
     return promise(function(resolve) {
       resolve(value);
     });
   }
 
   /**
    * Returns a rejected promise for the supplied promiseOrValue.  The returned
    * promise will be rejected with:
    * - promiseOrValue, if it is a value, or
    * - if promiseOrValue is a promise
    *   - promiseOrValue's value after it is fulfilled
    *   - promiseOrValue's reason after it is rejected
    * @param {*} promiseOrValue the rejected value of the returned {@link Promise}
    * @return {Promise} rejected {@link Promise}
    */
   function reject(promiseOrValue) {
     return when(promiseOrValue, rejected);
   }
 
   /**
    * Creates a {promise, resolver} pair, either or both of which
    * may be given out safely to consumers.
    * The resolver has resolve, reject, and progress.  The promise
    * has then plus extended promise API.
    *
    * @return {{
    * promise: Promise,
    * resolve: function:Promise,
    * reject: function:Promise,
    * notify: function:Promise
    * resolver: {
    *	resolve: function:Promise,
    *	reject: function:Promise,
    *	notify: function:Promise
    * }}}
    */
   function defer() {
     var deferred, pending, resolved;
 
     // Optimize object shape
     deferred = {
       promise: undef, resolve: undef, reject: undef, notify: undef,
       resolver: { resolve: undef, reject: undef, notify: undef }
     };
 
     deferred.promise = pending = promise(makeDeferred);
 
     return deferred;
 
     function makeDeferred(resolvePending, rejectPending, notifyPending) {
       deferred.resolve = deferred.resolver.resolve = function(value) {
         if(resolved) {
           return resolve(value);
         }
         resolved = true;
         resolvePending(value);
         return pending;
       };
 
       deferred.reject  = deferred.resolver.reject  = function(reason) {
         if(resolved) {
           return resolve(rejected(reason));
         }
         resolved = true;
         rejectPending(reason);
         return pending;
       };
 
       deferred.notify  = deferred.resolver.notify  = function(update) {
         notifyPending(update);
         return update;
       };
     }
   }
 
   /**
    * Creates a new promise whose fate is determined by resolver.
    * @param {function} resolver function(resolve, reject, notify)
    * @returns {Promise} promise whose fate is determine by resolver
    */
   function promise(resolver) {
     return _promise(resolver, monitorApi.PromiseStatus && monitorApi.PromiseStatus());
   }
 
   /**
    * Creates a new promise, linked to parent, whose fate is determined
    * by resolver.
    * @param {function} resolver function(resolve, reject, notify)
    * @param {Promise?} status promise from which the new promise is begotten
    * @returns {Promise} promise whose fate is determine by resolver
    * @private
    */
   function _promise(resolver, status) {
     var self, value, consumers = [];
 
     self = new Promise(_message, inspect);
     self._status = status;
 
     // Call the provider resolver to seal the promise's fate
     try {
       resolver(promiseResolve, promiseReject, promiseNotify);
     } catch(e) {
       promiseReject(e);
     }
 
     // Return the promise
     return self;
 
     /**
      * Private message delivery. Queues and delivers messages to
      * the promise's ultimate fulfillment value or rejection reason.
      * @private
      * @param {String} type
      * @param {Array} args
      * @param {Function} resolve
      * @param {Function} notify
      */
     function _message(type, args, resolve, notify) {
       consumers ? consumers.push(deliver) : enqueue(function() { deliver(value); });
 
       function deliver(p) {
         p._message(type, args, resolve, notify);
       }
     }
 
     /**
      * Returns a snapshot of the promise's state at the instant inspect()
      * is called. The returned object is not live and will not update as
      * the promise's state changes.
      * @returns {{ state:String, value?:*, reason?:* }} status snapshot
      *  of the promise.
      */
     function inspect() {
       return value ? value.inspect() : toPendingState();
     }
 
     /**
      * Transition from pre-resolution state to post-resolution state, notifying
      * all listeners of the ultimate fulfillment or rejection
      * @param {*|Promise} val resolution value
      */
     function promiseResolve(val) {
       if(!consumers) {
         return;
       }
 
       var queue = consumers;
       consumers = undef;
 
       enqueue(function () {
         value = coerce(self, val);
         if(status) {
           updateStatus(value, status);
         }
         runHandlers(queue, value);
       });
 
     }
 
     /**
      * Reject this promise with the supplied reason, which will be used verbatim.
      * @param {*} reason reason for the rejection
      */
     function promiseReject(reason) {
       promiseResolve(rejected(reason));
     }
 
     /**
      * Issue a progress event, notifying all progress listeners
      * @param {*} update progress event payload to pass to all listeners
      */
     function promiseNotify(update) {
       if(consumers) {
         var queue = consumers;
         enqueue(function () {
           runHandlers(queue, progressed(update));
         });
       }
     }
   }
 
   /**
    * Run a queue of functions as quickly as possible, passing
    * value to each.
    */
   function runHandlers(queue, value) {
     for (var i = 0; i < queue.length; i++) {
       queue[i](value);
     }
   }
 
   /**
    * Creates a fulfilled, local promise as a proxy for a value
    * NOTE: must never be exposed
    * @param {*} value fulfillment value
    * @returns {Promise}
    */
   function fulfilled(value) {
     return near(
       new NearFulfilledProxy(value),
       function() { return toFulfilledState(value); }
     );
   }
 
   /**
    * Creates a rejected, local promise with the supplied reason
    * NOTE: must never be exposed
    * @param {*} reason rejection reason
    * @returns {Promise}
    */
   function rejected(reason) {
     return near(
       new NearRejectedProxy(reason),
       function() { return toRejectedState(reason); }
     );
   }
 
   /**
    * Creates a near promise using the provided proxy
    * NOTE: must never be exposed
    * @param {object} proxy proxy for the promise's ultimate value or reason
    * @param {function} inspect function that returns a snapshot of the
    *  returned near promise's state
    * @returns {Promise}
    */
   function near(proxy, inspect) {
     return new Promise(function (type, args, resolve) {
       try {
         resolve(proxy[type].apply(proxy, args));
       } catch(e) {
         resolve(rejected(e));
       }
     }, inspect);
   }
 
   /**
    * Create a progress promise with the supplied update.
    * @private
    * @param {*} update
    * @return {Promise} progress promise
    */
   function progressed(update) {
     return new Promise(function (type, args, _, notify) {
       var onProgress = args[2];
       try {
         notify(typeof onProgress === 'function' ? onProgress(update) : update);
       } catch(e) {
         notify(e);
       }
     });
   }
 
   /**
    * Coerces x to a trusted Promise
    * @param {*} x thing to coerce
    * @returns {*} Guaranteed to return a trusted Promise.  If x
    *   is trusted, returns x, otherwise, returns a new, trusted, already-resolved
    *   Promise whose resolution value is:
    *   * the resolution value of x if it's a foreign promise, or
    *   * x if it's a value
    */
   function coerce(self, x) {
     if (x === self) {
       return rejected(new TypeError());
     }
 
     if (x instanceof Promise) {
       return x;
     }
 
     try {
       var untrustedThen = x === Object(x) && x.then;
 
       return typeof untrustedThen === 'function'
         ? assimilate(untrustedThen, x)
         : fulfilled(x);
     } catch(e) {
       return rejected(e);
     }
   }
 
   /**
    * Safely assimilates a foreign thenable by wrapping it in a trusted promise
    * @param {function} untrustedThen x's then() method
    * @param {object|function} x thenable
    * @returns {Promise}
    */
   function assimilate(untrustedThen, x) {
     return promise(function (resolve, reject) {
       fcall(untrustedThen, x, resolve, reject);
     });
   }
 
   /**
    * Proxy for a near, fulfilled value
    * @param {*} value
    * @constructor
    */
   function NearFulfilledProxy(value) {
     this.value = value;
   }
 
   NearFulfilledProxy.prototype.when = function(onResult) {
     return typeof onResult === 'function' ? onResult(this.value) : this.value;
   };
 
   /**
    * Proxy for a near rejection
    * @param {*} reason
    * @constructor
    */
   function NearRejectedProxy(reason) {
     this.reason = reason;
   }
 
   NearRejectedProxy.prototype.when = function(_, onError) {
     if(typeof onError === 'function') {
       return onError(this.reason);
     } else {
       throw this.reason;
     }
   };
 
   function updateStatus(value, status) {
     value.then(statusFulfilled, statusRejected);
 
     function statusFulfilled() { status.fulfilled(); }
     function statusRejected(r) { status.rejected(r); }
   }
 
   /**
    * Determines if x is promise-like, i.e. a thenable object
    * NOTE: Will return true for *any thenable object*, and isn't truly
    * safe, since it may attempt to access the `then` property of x (i.e.
    *  clever/malicious getters may do weird things)
    * @param {*} x anything
    * @returns {boolean} true if x is promise-like
    */
   function isPromiseLike(x) {
     return x && typeof x.then === 'function';
   }
 
   /**
    * Initiates a competitive race, returning a promise that will resolve when
    * howMany of the supplied promisesOrValues have resolved, or will reject when
    * it becomes impossible for howMany to resolve, for example, when
    * (promisesOrValues.length - howMany) + 1 input promises reject.
    *
    * @param {Array} promisesOrValues array of anything, may contain a mix
    *      of promises and values
    * @param howMany {number} number of promisesOrValues to resolve
    * @param {function?} [onFulfilled] DEPRECATED, use returnedPromise.then()
    * @param {function?} [onRejected] DEPRECATED, use returnedPromise.then()
    * @param {function?} [onProgress] DEPRECATED, use returnedPromise.then()
    * @returns {Promise} promise that will resolve to an array of howMany values that
    *  resolved first, or will reject with an array of
    *  (promisesOrValues.length - howMany) + 1 rejection reasons.
    */
   function some(promisesOrValues, howMany, onFulfilled, onRejected, onProgress) {
 
     return when(promisesOrValues, function(promisesOrValues) {
 
       return promise(resolveSome).then(onFulfilled, onRejected, onProgress);
 
       function resolveSome(resolve, reject, notify) {
         var toResolve, toReject, values, reasons, fulfillOne, rejectOne, len, i;
 
         len = promisesOrValues.length >>> 0;
 
         toResolve = Math.max(0, Math.min(howMany, len));
         values = [];
 
         toReject = (len - toResolve) + 1;
         reasons = [];
 
         // No items in the input, resolve immediately
         if (!toResolve) {
           resolve(values);
 
         } else {
           rejectOne = function(reason) {
             reasons.push(reason);
             if(!--toReject) {
               fulfillOne = rejectOne = identity;
               reject(reasons);
             }
           };
 
           fulfillOne = function(val) {
             // This orders the values based on promise resolution order
             values.push(val);
             if (!--toResolve) {
               fulfillOne = rejectOne = identity;
               resolve(values);
             }
           };
 
           for(i = 0; i < len; ++i) {
             if(i in promisesOrValues) {
               when(promisesOrValues[i], fulfiller, rejecter, notify);
             }
           }
         }
 
         function rejecter(reason) {
           rejectOne(reason);
         }
 
         function fulfiller(val) {
           fulfillOne(val);
         }
       }
     });
   }
 
   /**
    * Initiates a competitive race, returning a promise that will resolve when
    * any one of the supplied promisesOrValues has resolved or will reject when
    * *all* promisesOrValues have rejected.
    *
    * @param {Array|Promise} promisesOrValues array of anything, may contain a mix
    *      of {@link Promise}s and values
    * @param {function?} [onFulfilled] DEPRECATED, use returnedPromise.then()
    * @param {function?} [onRejected] DEPRECATED, use returnedPromise.then()
    * @param {function?} [onProgress] DEPRECATED, use returnedPromise.then()
    * @returns {Promise} promise that will resolve to the value that resolved first, or
    * will reject with an array of all rejected inputs.
    */
   function any(promisesOrValues, onFulfilled, onRejected, onProgress) {
 
     function unwrapSingleResult(val) {
       return onFulfilled ? onFulfilled(val[0]) : val[0];
     }
 
     return some(promisesOrValues, 1, unwrapSingleResult, onRejected, onProgress);
   }
 
   /**
    * Return a promise that will resolve only once all the supplied promisesOrValues
    * have resolved. The resolution value of the returned promise will be an array
    * containing the resolution values of each of the promisesOrValues.
    * @memberOf when
    *
    * @param {Array|Promise} promisesOrValues array of anything, may contain a mix
    *      of {@link Promise}s and values
    * @param {function?} [onFulfilled] DEPRECATED, use returnedPromise.then()
    * @param {function?} [onRejected] DEPRECATED, use returnedPromise.then()
    * @param {function?} [onProgress] DEPRECATED, use returnedPromise.then()
    * @returns {Promise}
    */
   function all(promisesOrValues, onFulfilled, onRejected, onProgress) {
     return _map(promisesOrValues, identity).then(onFulfilled, onRejected, onProgress);
   }
 
   /**
    * Joins multiple promises into a single returned promise.
    * @return {Promise} a promise that will fulfill when *all* the input promises
    * have fulfilled, or will reject when *any one* of the input promises rejects.
    */
   function join(/* ...promises */) {
     return _map(arguments, identity);
   }
 
   /**
    * Settles all input promises such that they are guaranteed not to
    * be pending once the returned promise fulfills. The returned promise
    * will always fulfill, except in the case where `array` is a promise
    * that rejects.
    * @param {Array|Promise} array or promise for array of promises to settle
    * @returns {Promise} promise that always fulfills with an array of
    *  outcome snapshots for each input promise.
    */
   function settle(array) {
     return _map(array, toFulfilledState, toRejectedState);
   }
 
   /**
    * Promise-aware array map function, similar to `Array.prototype.map()`,
    * but input array may contain promises or values.
    * @param {Array|Promise} array array of anything, may contain promises and values
    * @param {function} mapFunc map function which may return a promise or value
    * @returns {Promise} promise that will fulfill with an array of mapped values
    *  or reject if any input promise rejects.
    */
   function map(array, mapFunc) {
     return _map(array, mapFunc);
   }
 
   /**
    * Internal map that allows a fallback to handle rejections
    * @param {Array|Promise} array array of anything, may contain promises and values
    * @param {function} mapFunc map function which may return a promise or value
    * @param {function?} fallback function to handle rejected promises
    * @returns {Promise} promise that will fulfill with an array of mapped values
    *  or reject if any input promise rejects.
    */
   function _map(array, mapFunc, fallback) {
     return when(array, function(array) {
 
       return _promise(resolveMap);
 
       function resolveMap(resolve, reject, notify) {
         var results, len, toResolve, i;
 
         // Since we know the resulting length, we can preallocate the results
         // array to avoid array expansions.
         toResolve = len = array.length >>> 0;
         results = [];
 
         if(!toResolve) {
           resolve(results);
           return;
         }
 
         // Since mapFunc may be async, get all invocations of it into flight
         for(i = 0; i < len; i++) {
           if(i in array) {
             resolveOne(array[i], i);
           } else {
             --toResolve;
           }
         }
 
         function resolveOne(item, i) {
           when(item, mapFunc, fallback).then(function(mapped) {
             results[i] = mapped;
 
             if(!--toResolve) {
               resolve(results);
             }
           }, reject, notify);
         }
       }
     });
   }
 
   /**
    * Traditional reduce function, similar to `Array.prototype.reduce()`, but
    * input may contain promises and/or values, and reduceFunc
    * may return either a value or a promise, *and* initialValue may
    * be a promise for the starting value.
    *
    * @param {Array|Promise} promise array or promise for an array of anything,
    *      may contain a mix of promises and values.
    * @param {function} reduceFunc reduce function reduce(currentValue, nextValue, index, total),
    *      where total is the total number of items being reduced, and will be the same
    *      in each call to reduceFunc.
    * @returns {Promise} that will resolve to the final reduced value
    */
   function reduce(promise, reduceFunc /*, initialValue */) {
     var args = fcall(slice, arguments, 1);
 
     return when(promise, function(array) {
       var total;
 
       total = array.length;
 
       // Wrap the supplied reduceFunc with one that handles promises and then
       // delegates to the supplied.
       args[0] = function (current, val, i) {
         return when(current, function (c) {
           return when(val, function (value) {
             return reduceFunc(c, value, i, total);
           });
         });
       };
 
       return reduceArray.apply(array, args);
     });
   }
 
   // Snapshot states
 
   /**
    * Creates a fulfilled state snapshot
    * @private
    * @param {*} x any value
    * @returns {{state:'fulfilled',value:*}}
    */
   function toFulfilledState(x) {
     return { state: 'fulfilled', value: x };
   }
 
   /**
    * Creates a rejected state snapshot
    * @private
    * @param {*} x any reason
    * @returns {{state:'rejected',reason:*}}
    */
   function toRejectedState(x) {
     return { state: 'rejected', reason: x };
   }
 
   /**
    * Creates a pending state snapshot
    * @private
    * @returns {{state:'pending'}}
    */
   function toPendingState() {
     return { state: 'pending' };
   }
 
   //
   // Internals, utilities, etc.
   //
 
   var reduceArray, slice, fcall, nextTick, handlerQueue,
     setTimeout, funcProto, call, arrayProto, monitorApi,
     cjsRequire, MutationObserver, undef;
 
 // cambecc:	cjsRequire = require;
 
   //
   // Shared handler queue processing
   //
   // Credit to Twisol (https://github.com/Twisol) for suggesting
   // this type of extensible queue + trampoline approach for
   // next-tick conflation.
 
   handlerQueue = [];
 
   /**
    * Enqueue a task. If the queue is not currently scheduled to be
    * drained, schedule it.
    * @param {function} task
    */
   function enqueue(task) {
     if(handlerQueue.push(task) === 1) {
       nextTick(drainQueue);
     }
   }
 
   /**
    * Drain the handler queue entirely, being careful to allow the
    * queue to be extended while it is being processed, and to continue
    * processing until it is truly empty.
    */
   function drainQueue() {
     runHandlers(handlerQueue);
     handlerQueue = [];
   }
 
   // capture setTimeout to avoid being caught by fake timers
   // used in time based tests
   setTimeout = global.setTimeout;
 
   // Allow attaching the monitor to when() if env has no console
   monitorApi = typeof console !== 'undefined' ? console : when;
 
   // Sniff "best" async scheduling option
   // Prefer process.nextTick or MutationObserver, then check for
   // vertx and finally fall back to setTimeout
   /*global process*/
   if (typeof process === 'object' && process.nextTick) {
     nextTick = process.nextTick;
   } else if(MutationObserver = global.MutationObserver || global.WebKitMutationObserver) {
     nextTick = (function(document, MutationObserver, drainQueue) {
       var el = document.createElement('div');
       new MutationObserver(drainQueue).observe(el, { attributes: true });
 
       return function() {
         el.setAttribute('x', 'x');
       };
     }(document, MutationObserver, drainQueue));
   } else {
 // cambecc:		try {
 // cambecc:			// vert.x 1.x || 2.x
 // cambecc:			nextTick = cjsRequire('vertx').runOnLoop || cjsRequire('vertx').runOnContext;
 // cambecc:		} catch(ignore) {
       nextTick = function(t) { setTimeout(t, 0); };
 // cambecc:		}
   }
 
   //
   // Capture/polyfill function and array utils
   //
 
   // Safe function calls
   funcProto = Function.prototype;
   call = funcProto.call;
   fcall = funcProto.bind
     ? call.bind(call)
     : function(f, context) {
       return f.apply(context, slice.call(arguments, 2));
     };
 
   // Safe array ops
   arrayProto = [];
   slice = arrayProto.slice;
 
   // ES5 reduce implementation if native not available
   // See: http://es5.github.com/#x15.4.4.21 as there are many
   // specifics and edge cases.  ES5 dictates that reduce.length === 1
   // This implementation deviates from ES5 spec in the following ways:
   // 1. It does not check if reduceFunc is a Callable
   reduceArray = arrayProto.reduce ||
     function(reduceFunc /*, initialValue */) {
       /*jshint maxcomplexity: 7*/
       var arr, args, reduced, len, i;
 
       i = 0;
       arr = Object(this);
       len = arr.length >>> 0;
       args = arguments;
 
       // If no initialValue, use first item of array (we know length !== 0 here)
       // and adjust i to start at second item
       if(args.length <= 1) {
         // Skip to the first real element in the array
         for(;;) {
           if(i in arr) {
             reduced = arr[i++];
             break;
           }
 
           // If we reached the end of the array without finding any real
           // elements, it's a TypeError
           if(++i >= len) {
             throw new TypeError();
           }
         }
       } else {
         // If initialValue provided, use it
         reduced = args[1];
       }
 
       // Do the actual reduce
       for(;i < len; ++i) {
         if(i in arr) {
           reduced = reduceFunc(reduced, arr[i], i, arr);
         }
       }
 
       return reduced;
     };
 
   function identity(x) {
     return x;
   }
 
   function crash(fatalError) {
     if(typeof monitorApi.reportUnhandled === 'function') {
       monitorApi.reportUnhandled();
     } else {
       enqueue(function() {
         throw fatalError;
       });
     }
 
     throw fatalError;
   }
 
   return when;
 });
 }(
     function (factory) { return factory(); },
   this
 ); </script>
        
            <script >
              /**
 * micro - a grab bag of somewhat useful utility functions and other stuff that requires unit testing
 *
 * Copyright (c) 2014 Cameron Beccario
 * The MIT License - http://opensource.org/licenses/MIT
 *
 * https://github.com/cambecc/earth
 */
var µ = function() {
  "use strict";

  var τ = 2 * Math.PI;
  var H = 0.0000360;  // 0.0000360°φ ~= 4m
 
  var DEFAULT_CONFIG = "current/wind/surface/level/equirectangular=-277.50,0.00,261";
  
  var TOPOLOGY = "../data/earth-topo.json";

  
  /**
   * @returns {Boolean} true if the specified value is truthy.
   */
  function isTruthy(x) {
      return !!x;
  }

  /**
   * @returns {Boolean} true if the specified value is not null and not undefined.
   */
  function isValue(x) {
      return x !== null && x !== undefined;
  }

  /**
   * @returns {Object} the first argument if not null and not undefined, otherwise the second argument.
   */
  function coalesce(a, b) {
      return isValue(a) ? a : b;
  }

  /**
   * @returns {Number} returns remainder of floored division, i.e., floor(a / n). Useful for consistent modulo
   *          of negative numbers. See http://en.wikipedia.org/wiki/Modulo_operation.
   */
  function floorMod(a, n) {
      var f = a - n * Math.floor(a / n);
      // HACK: when a is extremely close to an n transition, f can be equal to n. This is bad because f must be
      //       within range [0, n). Check for this corner case. Example: a:=-1e-16, n:=10. What is the proper fix?
      return f === n ? 0 : f;
  }

  /**
   * @returns {Number} distance between two points having the form [x, y].
   */
  function distance(a, b) {
      var Δx = b[0] - a[0];
      var Δy = b[1] - a[1];
      return Math.sqrt(Δx * Δx + Δy * Δy);
  }

  /**
   * @returns {Number} the value x clamped to the range [low, high].
   */
  function clamp(x, low, high) {
      return Math.max(low, Math.min(x, high));
  }

  /**
   * @returns {number} the fraction of the bounds [low, high] covered by the value x, after clamping x to the
   *          bounds. For example, given bounds=[10, 20], this method returns 1 for x>=20, 0.5 for x=15 and 0
   *          for x<=10.
   */
  function proportion(x, low, high) {
      return (µ.clamp(x, low, high) - low) / (high - low);
  }

  /**
   * @returns {number} the value p within the range [0, 1], scaled to the range [low, high].
   */
  function spread(p, low, high) {
      return p * (high - low) + low;
  }

  /**
   * Pad number with leading zeros. Does not support fractional or negative numbers.
   */
  function zeroPad(n, width) {
      var s = n.toString();
      var i = Math.max(width - s.length, 0);
      return new Array(i + 1).join("0") + s;
  }

  /**
   * @returns {String} the specified string with the first letter capitalized.
   */
  function capitalize(s) {
      return s.length === 0 ? s : s.charAt(0).toUpperCase() + s.substr(1);
  }

  /**
   * @returns {Boolean} true if agent is probably firefox. Don't really care if this is accurate.
   */
  function isFF() {
      return (/firefox/i).test(navigator.userAgent);
  }

  /**
   * @returns {Boolean} true if agent is probably a mobile device. Don't really care if this is accurate.
   */
  function isMobile() {
      return (/android|blackberry|iemobile|ipad|iphone|ipod|opera mini|webos/i).test(navigator.userAgent);
  }

  function isEmbeddedInIFrame() {
      return window != window.top;
  }

  function toUTCISO(date) {
      return date.getUTCFullYear() + "-" +
          zeroPad(date.getUTCMonth() + 1, 2) + "-" +
          zeroPad(date.getUTCDate(), 2) + " " +
          zeroPad(date.getUTCHours(), 2) + ":00";
  }

  function toLocalISO(date) {
      return date.getFullYear() + "-" +
          zeroPad(date.getMonth() + 1, 2) + "-" +
          zeroPad(date.getDate(), 2) + " " +
          zeroPad(date.getHours(), 2) + ":00";
  }

  /**
   * @returns {String} the string yyyyfmmfdd as yyyytmmtdd, where f and t are the "from" and "to" delimiters. Either
   *          delimiter may be the empty string.
   */
  function ymdRedelimit(ymd, fromDelimiter, toDelimiter) {
      if (!fromDelimiter) {
          return ymd.substr(0, 4) + toDelimiter + ymd.substr(4, 2) + toDelimiter + ymd.substr(6, 2);
      }
      var parts = ymd.substr(0, 10).split(fromDelimiter);
      return [parts[0], parts[1], parts[2]].join(toDelimiter);
  }

  /**
   * @returns {String} the UTC year, month, and day of the specified date in yyyyfmmfdd format, where f is the
   *          delimiter (and may be the empty string).
   */
  function dateToUTCymd(date, delimiter) {
      return ymdRedelimit(date.toISOString(), "-", delimiter || "");
  }

  function dateToConfig(date) {
      return {date: µ.dateToUTCymd(date, "/"), hour: µ.zeroPad(date.getUTCHours(), 2) + "00"};
  }

  /**
   * @returns {Object} an object to perform logging, if/when the browser supports it.
   */
  function log() {
      function format(o) { return o && o.stack ? o + "\n" + o.stack : o; }
      return {
          debug:   function(s) { if (console && console.log) console.log(format(s)); },
          info:    function(s) { if (console && console.info) console.info(format(s)); },
          error:   function(e) { if (console && console.error) console.error(format(e)); },
          time:    function(s) { if (console && console.time) console.time(format(s)); },
          timeEnd: function(s) { if (console && console.timeEnd) console.timeEnd(format(s)); }
      };
  }

  /**
   * @returns {width: (Number), height: (Number)} an object that describes the size of the browser's current view.
   */
  function view() {
      var w = window;
      var d = document && document.documentElement;
      var b = document && document.getElementsByTagName("body")[0];
      var x = w.innerWidth || d.clientWidth || b.clientWidth;
      var y = w.innerHeight || d.clientHeight || b.clientHeight;
      return {width: x, height: y};
  }

  /**
   * Removes all children of the specified DOM element.
   */
  function removeChildren(element) {
      while (element.firstChild) {
          element.removeChild(element.firstChild);
      }
  }

  /**
   * @returns {Object} clears and returns the specified Canvas element's 2d context.
   */
  function clearCanvas(canvas) {
      canvas.getContext("2d").clearRect(0, 0, canvas.width, canvas.height);
      return canvas;
  }

  function colorInterpolator(start, end) {
      var r = start[0], g = start[1], b = start[2];
      var Δr = end[0] - r, Δg = end[1] - g, Δb = end[2] - b;
      return function(i, a) {
          return [Math.floor(r + i * Δr), Math.floor(g + i * Δg), Math.floor(b + i * Δb), a];
      };
  }

  /**
   * Produces a color style in a rainbow-like trefoil color space. Not quite HSV, but produces a nice
   * spectrum. See http://krazydad.com/tutorials/makecolors.php.
   *
   * @param hue the hue rotation in the range [0, 1]
   * @param a the alpha value in the range [0, 255]
   * @returns {Array} [r, g, b, a]
   */
  function sinebowColor(hue, a) {
      // Map hue [0, 1] to radians [0, 5/6τ]. Don't allow a full rotation because that keeps hue == 0 and
      // hue == 1 from mapping to the same color.
      var rad = hue * τ * 5/6;
      rad *= 0.75;  // increase frequency to 2/3 cycle per rad

      var s = Math.sin(rad);
      var c = Math.cos(rad);
      var r = Math.floor(Math.max(0, -c) * 255);
      var g = Math.floor(Math.max(s, 0) * 255);
      var b = Math.floor(Math.max(c, 0, -s) * 255);
      return [r, g, b, a];
  }

  var BOUNDARY = 0.45;
  var fadeToWhite = colorInterpolator(sinebowColor(1.0, 0), [255, 255, 255]);

  /**
   * Interpolates a sinebow color where 0 <= i <= j, then fades to white where j < i <= 1.
   *
   * @param i number in the range [0, 1]
   * @param a alpha value in range [0, 255]
   * @returns {Array} [r, g, b, a]
   */
  function extendedSinebowColor(i, a) {
      return i <= BOUNDARY ?
          sinebowColor(i / BOUNDARY, a) :
          fadeToWhite((i - BOUNDARY) / (1 - BOUNDARY), a);
  }

  function asColorStyle(r, g, b, a) {
      return "rgba(" + r + ", " + g + ", " + b + ", " + a + ")";
  }

  /**
   * @returns {Array} of wind colors and a method, indexFor, that maps wind magnitude to an index on the color scale.
   */
  function windIntensityColorScale(step, maxWind) {
      var result = [];
      for (var j = 85; j <= 255; j += step) {
          result.push(asColorStyle(j, j, j, 1.0));
      }
      result.indexFor = function(m) {  // map wind speed to a style
          return Math.floor(Math.min(m, maxWind) / maxWind * (result.length - 1));
      };
      return result;
  }

  /**
   * Creates a color scale composed of the specified segments. Segments is an array of two-element arrays of the
   * form [value, color], where value is the point along the scale and color is the [r, g, b] color at that point.
   * For example, the following creates a scale that smoothly transitions from red to green to blue along the
   * points 0.5, 1.0, and 3.5:
   *
   *     [ [ 0.5, [255, 0, 0] ],
   *       [ 1.0, [0, 255, 0] ],
   *       [ 3.5, [0, 0, 255] ] ]
   *
   * @param segments array of color segments
   * @returns {Function} a function(point, alpha) that returns the color [r, g, b, alpha] for the given point.
   */
  function segmentedColorScale(segments) {
      var points = [], interpolators = [], ranges = [];
      for (var i = 0; i < segments.length - 1; i++) {
          points.push(segments[i+1][0]);
          interpolators.push(colorInterpolator(segments[i][1], segments[i+1][1]));
          ranges.push([segments[i][0], segments[i+1][0]]);
      }

      return function(point, alpha) {
          var i;
          for (i = 0; i < points.length - 1; i++) {
              if (point <= points[i]) {
                  break;
              }
          }
          var range = ranges[i];
          return interpolators[i](µ.proportion(point, range[0], range[1]), alpha);
      };
  }

  /**
   * Returns a human readable string for the provided coordinates.
   */
  function formatCoordinates(λ, φ) {
      return Math.abs(φ).toFixed(2) + "° " + (φ >= 0 ? "N" : "S") + ", " +
          Math.abs(λ).toFixed(2) + "° " + (λ >= 0 ? "E" : "W");
  }

  /**
   * Returns a human readable string for the provided scalar in the given units.
   */
  function formatScalar(value, units) {
      return units.conversion(value).toFixed(units.precision);
  }

  /**
   * Returns a human readable string for the provided rectangular wind vector in the given units.
   * See http://mst.nerc.ac.uk/wind_vect_convs.html.
   */
  function formatVector(wind, units) {
      var d = Math.atan2(-wind[0], -wind[1]) / τ * 360;  // calculate into-the-wind cardinal degrees
      var wd = Math.round((d + 360) % 360 / 5) * 5;  // shift [-180, 180] to [0, 360], and round to nearest 5.
      return wd.toFixed(0) + "° @ " + formatScalar(wind[2], units);
  }

  /**
   * Returns a promise for a JSON resource (URL) fetched via XHR. If the load fails, the promise rejects with an
   * object describing the reason: {status: http-status-code, message: http-status-text, resource:}.
   */
  function loadJson(resource) {
      var d = when.defer();
      d3.json(resource, function(error, result) {
          return error ?
              !error.status ?
                  d.reject({status: -1, message: "Cannot load resource: " + resource, resource: resource}) :
                  d.reject({status: error.status, message: error.statusText, resource: resource}) :
              d.resolve(result);
      });
      return d.promise;
  }

  /**
   * Returns the distortion introduced by the specified projection at the given point.
   *
   * This method uses finite difference estimates to calculate warping by adding a very small amount (h) to
   * both the longitude and latitude to create two lines. These lines are then projected to pixel space, where
   * they become diagonals of triangles that represent how much the projection warps longitude and latitude at
   * that location.
   *
   * <pre>
   *        (λ, φ+h)                  (xλ, yλ)
   *           .                         .
   *           |               ==>        \
   *           |                           \   __. (xφ, yφ)
   *    (λ, φ) .____. (λ+h, φ)       (x, y) .--
   * </pre>
   *
   * See:
   *     Map Projections: A Working Manual, Snyder, John P: pubs.er.usgs.gov/publication/pp1395
   *     gis.stackexchange.com/questions/5068/how-to-create-an-accurate-tissot-indicatrix
   *     www.jasondavies.com/maps/tissot
   *
   * @returns {Array} array of scaled derivatives [dx/dλ, dy/dλ, dx/dφ, dy/dφ]
   */
  function distortion(projection, λ, φ, x, y) {
      var hλ = λ < 0 ? H : -H;
      var hφ = φ < 0 ? H : -H;
      var pλ = projection([λ + hλ, φ]);
      var pφ = projection([λ, φ + hφ]);

      // Meridian scale factor (see Snyder, equation 4-3), where R = 1. This handles issue where length of 1° λ
      // changes depending on φ. Without this, there is a pinching effect at the poles.
      var k = Math.cos(φ / 360 * τ);

      return [
          (pλ[0] - x) / hλ / k,
          (pλ[1] - y) / hλ / k,
          (pφ[0] - x) / hφ,
          (pφ[1] - y) / hφ
      ];
  }

  /**
   * Returns a new agent. An agent executes tasks and stores the result of the most recently completed task.
   *
   * A task is a value or promise, or a function that returns a value or promise. After submitting a task to
   * an agent using the submit() method, the task is evaluated and its result becomes the agent's value,
   * replacing the previous value. If a task is submitted to an agent while an earlier task is still in
   * progress, the earlier task is cancelled and its result ignored. Evaluation of a task may even be skipped
   * entirely if cancellation occurs early enough.
   *
   * Agents are Backbone.js Event emitters. When a submitted task is accepted for invocation by an agent, a
   * "submit" event is emitted. This event has the agent as its sole argument. When a task finishes and
   * the agent's value changes, an "update" event is emitted, providing (value, agent) as arguments. If a task
   * fails by either throwing an exception or rejecting a promise, a "reject" event having arguments (err, agent)
   * is emitted. If an event handler throws an error, an "error" event having arguments (err, agent) is emitted.
   *
   * The current task can be cancelled by invoking the agent.cancel() method, and the cancel status is available
   * as the Boolean agent.cancel.requested key. Within the task callback, the "this" context is set to the agent,
   * so a task can know to abort execution by checking the this.cancel.requested key. Similarly, a task can cancel
   * itself by invoking this.cancel().
   *
   * Example pseudocode:
   * <pre>
   *     var agent = newAgent();
   *     agent.on("update", function(value) {
   *         console.log("task completed: " + value);  // same as agent.value()
   *     });
   *
   *     function someLongAsynchronousProcess(x) {  // x === "abc"
   *         var d = when.defer();
   *         // some long process that eventually calls: d.resolve(result)
   *         return d.promise;
   *     }
   *
   *     agent.submit(someLongAsynchronousProcess, "abc");
   * </pre>
   *
   * @param [initial] initial value of the agent, if any
   * @returns {Object}
   */
  function newAgent(initial) {

      /**
       * @returns {Function} a cancel function for a task.
       */
      function cancelFactory() {
          return function cancel() {
              cancel.requested = true;
              return agent;
          };
      }

      /**
       * Invokes the specified task.
       * @param cancel the task's cancel function.
       * @param taskAndArguments the [task-function-or-value, arg0, arg1, ...] array.
       */
      function runTask(cancel, taskAndArguments) {

          function run(args) {
              return cancel.requested ? null : _.isFunction(task) ? task.apply(agent, args) : task;
          }

          function accept(result) {
              if (!cancel.requested) {
                  value = result;
                  agent.trigger("update", result, agent);
              }
          }

          function reject(err) {
              if (!cancel.requested) {  // ANNOYANCE: when cancelled, this task's error is silently suppressed
                  agent.trigger("reject", err, agent);
              }
          }

          function fail(err) {
              agent.trigger("fail", err, agent);
          }

          try {
              // When all arguments are resolved, invoke the task then either accept or reject the result.
              var task = taskAndArguments[0];
              when.all(_.rest(taskAndArguments)).then(run).then(accept, reject).done(undefined, fail);
              agent.trigger("submit", agent);
          } catch (err) {
              fail(err);
          }
      }

      var value = initial;
      var runTask_debounced = _.debounce(runTask, 0);  // ignore multiple simultaneous submissions--reduces noise
      var agent = {

          /**
           * @returns {Object} this agent's current value.
           */
          value: function() {
              return value;
          },

          /**
           * Cancels this agent's most recently submitted task.
           */
          cancel: cancelFactory(),

          /**
           * Submit a new task and arguments to invoke the task with. The task may return a promise for
           * asynchronous tasks, and all arguments may be either values or promises. The previously submitted
           * task, if any, is immediately cancelled.
           * @returns this agent.
           */
          submit: function(task, arg0, arg1, and_so_on) {
              // immediately cancel the previous task
              this.cancel();
              // schedule the new task and update the agent with its associated cancel function
              runTask_debounced(this.cancel = cancelFactory(), arguments);
              return this;
          }
      };

      return _.extend(agent, Backbone.Events);
  }

  /**
   * Parses a URL hash fragment:
   *
   * example: "2013/11/14/0900Z/wind/isobaric/1000hPa/orthographic=26.50,-153.00,1430/overlay=off"
   * output: {date: "2013/11/14", hour: "0900", param: "wind", surface: "isobaric", level: "1000hPa",
   *          projection: "orthographic", orientation: "26.50,-153.00,1430", overlayType: "off"}
   *
   * grammar:
   *     hash   := ( "current" | yyyy / mm / dd / hhhh "Z" ) / param / surface / level [ / option [ / option ... ] ]
   *     option := type [ "=" number [ "," number [ ... ] ] ]
   *
   * @param hash the hash fragment.
   * @param projectionNames the set of allowed projections.
   * @param overlayTypes the set of allowed overlays.
   * @returns {Object} the result of the parse.
   */
  function parse(hash, projectionNames, overlayTypes) {
      var option, result = {};
      //             1        2        3          4          5            6      7      8    9
      var tokens = /^(current|(\d{4})\/(\d{1,2})\/(\d{1,2})\/(\d{3,4})Z)\/(\w+)\/(\w+)\/(\w+)([\/].+)?/.exec(hash);
      if (tokens) {
          var date = tokens[1] === "current" ?
              "current" :
              tokens[2] + "/" + zeroPad(tokens[3], 2) + "/" + zeroPad(tokens[4], 2);
          var hour = isValue(tokens[5]) ? zeroPad(tokens[5], 4) : "";
          result = {
              date: date,                  // "current" or "yyyy/mm/dd"
              hour: hour,                  // "hhhh" or ""
              param: tokens[6],            // non-empty alphanumeric _
              surface: tokens[7],          // non-empty alphanumeric _
              level: tokens[8],            // non-empty alphanumeric _
              projection: "orthographic",
              orientation: "",
              topology: TOPOLOGY,
              overlayType: "off",
              showGridPoints: false
          };

        
          coalesce(tokens[9], "").split("/").forEach(function(segment) {
              if ((option = /^(\w+)(=([\d\-.,]*))?$/.exec(segment))) {
                  if (projectionNames.has(option[1])) {
                      result.projection = option[1];                 // non-empty alphanumeric _
                      result.orientation = coalesce(option[3], "");  // comma delimited string of numbers, or ""
                  }
              }
              else if ((option = /^overlay=(\w+)$/.exec(segment))) {
                  if (overlayTypes.has(option[1]) || option[1] === "default") {
                      result.overlayType = option[1];
                  }
              }
              else if ((option = /^grid=(\w+)$/.exec(segment))) {
                  if (option[1] === "on") {
                      result.showGridPoints = true;
                  }
              }
          });
      }
      return result;
  }

  /**
   * A Backbone.js Model that persists its attributes as a human readable URL hash fragment. Loading from and
   * storing to the hash fragment is handled by the sync method.
   */
  var Configuration = Backbone.Model.extend({
      id: 0,
      _ignoreNextHashChangeEvent: false,
      _projectionNames: null,
      _overlayTypes: null,

      /**
       * @returns {String} this configuration converted to a hash fragment.
       */
      toHash: function() {
          var attr = this.attributes;
          var dir = attr.date === "current" ? "current" : attr.date + "/" + attr.hour + "Z";
          var proj = [attr.projection, attr.orientation].filter(isTruthy).join("=");
          var ol = !isValue(attr.overlayType) || attr.overlayType === "default" ? "" : "overlay=" + attr.overlayType;
          var grid = attr.showGridPoints ? "grid=on" : "";
          return [dir, attr.param, attr.surface, attr.level, ol, proj, grid].filter(isTruthy).join("/");
      },

      /**
       * Synchronizes between the configuration model and the hash fragment in the URL bar. Invocations
       * caused by "hashchange" events must have the {trigger: "hashchange"} option specified.
       */
      sync: function(method, model, options) {
          switch (method) {
              case "read":
                  if (options.trigger === "hashchange" && model._ignoreNextHashChangeEvent) {
                      model._ignoreNextHashChangeEvent = false;
                      return;
                  }
                  model.set(parse(
                      window.location.hash.substr(1) || DEFAULT_CONFIG,
                      model._projectionNames,
                      model._overlayTypes));
                  break;
              case "update":
                  // Ugh. Setting the hash fires a hashchange event during the next event loop turn. Ignore it.
                  model._ignoreNextHashChangeEvent = true;
                  window.location.hash = model.toHash();
                  break;
          }
      }
  });

  /**
   * A Backbone.js Model to hold the page's configuration as a set of attributes: date, layer, projection,
   * orientation, etc. Changes to the configuration fire events which the page's components react to. For
   * example, configuration.save({projection: "orthographic"}) fires an event which causes the globe to be
   * re-rendered with an orthographic projection.
   *
   * All configuration attributes are persisted in a human readable form to the page's hash fragment (and
   * vice versa). This allows deep linking and back-button navigation.
   *
   * @returns {Configuration} Model to represent the hash fragment, using the specified set of allowed projections.
   */
  function buildConfiguration(projectionNames, overlayTypes) {
      var result = new Configuration();
      result._projectionNames = projectionNames;
      result._overlayTypes = overlayTypes;
      return result;
  }
//a function to convert a 2D array into csv file
  function convertToCSV(rows){
     
      
      let csvContent = "data:text/csv;charset=utf-8," 
          + rows.map(e => e.join(",")).join("\n");

      var encodedUri = encodeURI(csvContent);
      var link = document.createElement("a");
      link.setAttribute("href", encodedUri);
      link.setAttribute("download", "my_data.csv");
      document.body.appendChild(link); // Required for FF

      link.click();
  }



  return {
      convertToCSV:convertToCSV,
      isTruthy: isTruthy,
      isValue: isValue,
      coalesce: coalesce,
      floorMod: floorMod,
      distance: distance,
      clamp: clamp,
      proportion: proportion,
      spread: spread,
      zeroPad: zeroPad,
      capitalize: capitalize,
      isFF: isFF,
      isMobile: isMobile,
      isEmbeddedInIFrame: isEmbeddedInIFrame,
      toUTCISO: toUTCISO,
      toLocalISO: toLocalISO,
      ymdRedelimit: ymdRedelimit,
      dateToUTCymd: dateToUTCymd,
      dateToConfig: dateToConfig,
      log: log,
      view: view,
      removeChildren: removeChildren,
      clearCanvas: clearCanvas,
      sinebowColor: sinebowColor,
      extendedSinebowColor: extendedSinebowColor,
      windIntensityColorScale: windIntensityColorScale,
      segmentedColorScale: segmentedColorScale,
      formatCoordinates: formatCoordinates,
      formatScalar: formatScalar,
      formatVector: formatVector,
      loadJson: loadJson,
      distortion: distortion,
      newAgent: newAgent,
      parse: parse,
      buildConfiguration: buildConfiguration
  };

}();

            </script>
            <script  >
              /**
 * globes - a set of models of the earth, each having their own kind of projection and onscreen behavior.
 *
 * Copyright (c) 2014 Cameron Beccario
 * The MIT License - http://opensource.org/licenses/MIT
 *
 * https://github.com/cambecc/earth
 */

var current_proj = "o";

var globes = (function () {
  "use strict";

  /**
   * @returns {Array} rotation of globe to current position of the user. Aside from asking for geolocation,
   *          which user may reject, there is not much available except timezone. Better than nothing.
   */
  function currentPosition() {
    var λ = µ.floorMod(new Date().getTimezoneOffset() / 4, 360); // 24 hours * 60 min / 4 === 360 degrees
    return [λ, 0];
  }

  function ensureNumber(num, fallback) {
    return _.isFinite(num) || num === Infinity || num === -Infinity
      ? num
      : fallback;
  }

  /**
   * @param bounds the projection bounds: [[x0, y0], [x1, y1]]
   * @param view the view bounds {width:, height:}
   * @returns {Object} the projection bounds clamped to the specified view.
   */
  function clampedBounds(bounds, view) {
    var upperLeft = bounds[0];
    var lowerRight = bounds[1];
    var x = Math.max(Math.floor(ensureNumber(upperLeft[0], 0)), 0);
    var y = Math.max(Math.floor(ensureNumber(upperLeft[1], 0)), 0);
    var xMax = Math.min(
      Math.ceil(ensureNumber(lowerRight[0], view.width)),
      view.width - 1
    );
    var yMax = Math.min(
      Math.ceil(ensureNumber(lowerRight[1], view.height)),
      view.height - 1
    );
    return {
      x: x,
      y: y,
      xMax: xMax,
      yMax: yMax,
      width: xMax - x + 1,
      height: yMax - y + 1,
    };
  }

  /**
   * Returns a globe object with standard behavior. At least the newProjection method must be overridden to
   * be functional.
   */
  function standardGlobe() {
    return {
      /**
       * This globe's current D3 projection.
       */
      projection: null,

      /**
       * @param view the size of the view as {width:, height:}.
       * @returns {Object} a new D3 projection of this globe appropriate for the specified view port.
       */
      newProjection: function (view) {
        throw new Error("method must be overridden");
      },

      /**
       * @param view the size of the view as {width:, height:}.
       * @returns {{x: Number, y: Number, xMax: Number, yMax: Number, width: Number, height: Number}}
       *          the bounds of the current projection clamped to the specified view.
       */
      bounds: function (view) {
        return clampedBounds(
          d3.geo.path().projection(this.projection).bounds({ type: "Sphere" }),
          view
        );
      },

      /**
       * @param view the size of the view as {width:, height:}.
       * @returns {Number} the projection scale at which the entire globe fits within the specified view.
       */
      fit: function (view) {
        var defaultProjection = this.newProjection(view);
        var bounds = d3.geo
          .path()
          .projection(defaultProjection)
          .bounds({ type: "Sphere" });
        var hScale = (bounds[1][0] - bounds[0][0]) / defaultProjection.scale();
        var vScale = (bounds[1][1] - bounds[0][1]) / defaultProjection.scale();
        return Math.min(view.width / hScale, view.height / vScale) * 0.9;
      },

      /**
       * @param view the size of the view as {width:, height:}.
       * @returns {Array} the projection transform at which the globe is centered within the specified view.
       */
      center: function (view) {
        return [view.width / 2, view.height / 2];
      },

      /**
       * @returns {Array} the range at which this globe can be zoomed.
       */
      scaleExtent: function () {
        return [220, 3000];
      },

      /**
       * Returns the current orientation of this globe as a string. If the arguments are specified,
       * mutates this globe to match the specified orientation string, usually in the form "lat,lon,scale".
       *
       * @param [o] the orientation string
       * @param [view] the size of the view as {width:, height:}.
       */
      orientation: function (o, view) {
        var projection = this.projection,
          rotate = projection.rotate();
        if (µ.isValue(o)) {
          var parts = o.split(","),
            λ = +parts[0],
            φ = +parts[1],
            scale = +parts[2];
          var extent = this.scaleExtent();
          projection.rotate(
            _.isFinite(λ) && _.isFinite(φ)
              ? [-λ, -φ, rotate[2]]
              : this.newProjection(view).rotate()
          );
          projection.scale(
            _.isFinite(scale)
              ? µ.clamp(scale, extent[0], extent[1])
              : this.fit(view)
          );
          projection.translate(this.center(view));
          return this;
        }
        return [
          (-rotate[0]).toFixed(2),
          (-rotate[1]).toFixed(2),
          Math.round(projection.scale()),
        ].join(",");
      },

      /**
       * Returns an object that mutates this globe's current projection during a drag/zoom operation.
       * Each drag/zoom event invokes the move() method, and when the move is complete, the end() method
       * is invoked.
       *
       * @param startMouse starting mouse position.
       * @param startScale starting scale.
       */
      manipulator: function (startMouse, startScale) {
        var projection = this.projection;
        var sensitivity = 60 / startScale; // seems to provide a good drag scaling factor
        var rotation = [
          projection.rotate()[0] / sensitivity,
          -projection.rotate()[1] / sensitivity,
        ];
        var original = projection.precision();

        projection.precision(original * 10);
        return {
          move: function (mouse, scale) {
            if (mouse) {
              var xd = mouse[0] - startMouse[0] + rotation[0];
              var yd = mouse[1] - startMouse[1] + rotation[1];
              if (current_proj == "o") {
                projection.rotate([
                  xd * sensitivity,
                  -yd * sensitivity,
                  projection.rotate()[2],
                ]);
              } else {
                projection.rotate([xd * sensitivity,
                  0,
                projection.rotate()[2]]);
                projection.translate([window.innerWidth / 2, d3.event.translate[1]]);                 
              }
            }
            projection.scale(scale);
          },
          end: function () {
            projection.precision(original);
          },
          proj: this,
        };
      },

      /**
       * @returns {Array} the transform to apply, if any, to orient this globe to the specified coordinates.
       */
      locate: function (coord) {
        return null;
      },

      /**
       * Draws a polygon on the specified context of this globe's boundary.
       * @param context a Canvas element's 2d context.
       * @returns the context
       */
      defineMask: function (context) {
        d3.geo.path().projection(this.projection).context(context)({
          type: "Sphere",
        });
        return context;
      },

      /**
       * Appends the SVG elements that render this globe.
       * @param mapSvg the primary map SVG container.
       * @param foregroundSvg the foreground SVG container.
       */
      defineMap: function (mapSvg, foregroundSvg) {
        var path = d3.geo.path().projection(this.projection);
        var defs = mapSvg.append("defs");
        defs
          .append("path")
          .attr("id", "sphere")
          .datum({ type: "Sphere" })
          .attr("d", path);
        mapSvg
          .append("use")
          .attr("xlink:href", "#sphere")
          .attr("class", "background-sphere");
        mapSvg
          .append("path")
          .attr("class", "graticule")
          .datum(d3.geo.graticule())
          .attr("d", path);
        mapSvg
          .append("path")
          .attr("class", "hemisphere")
          .datum(d3.geo.graticule().minorStep([0, 90]).majorStep([0, 90]))
          .attr("d", path);
        mapSvg.append("path").attr("class", "coastline");
        mapSvg.append("path").attr("class", "lakes");
        foregroundSvg
          .append("use")
          .attr("xlink:href", "#sphere")
          .attr("class", "foreground-sphere");
      },
    };
  }

  function newGlobe(source, view) {
    var result = _.extend(standardGlobe(), source);
    result.projection = result.newProjection(view);
    return result;
  }

  // ============================================================================================

  function atlantis() {
    return newGlobe({
      newProjection: function () {
        return d3.geo.mollweide().rotate([30, -45, 90]).precision(0.1);
      },
    });
  }

  function azimuthalEquidistant() {
    return newGlobe({
      newProjection: function () {
        return d3.geo
          .azimuthalEquidistant()
          .precision(0.1)
          .rotate([0, -90])
          .clipAngle(180 - 0.001);
      },
    });
  }

  function conicEquidistant() {
    return newGlobe({
      newProjection: function () {
        return d3.geo
          .conicEquidistant()
          .rotate(currentPosition())
          .precision(0.1);
      },
      center: function (view) {
        return [view.width / 2, view.height / 2 + view.height * 0.065];
      },
    });
  }

  function equirectangular() {
    return newGlobe({
      newProjection: function () {
        current_proj = "m";
        return d3.geo
          .mercator()
          .center([0, 0])
          .rotate(currentPosition())
          .precision(0.1);
      },
    });
  }

  function orthographic() {
    current_proj = "o";

    return newGlobe({
      newProjection: function () {
        return d3.geo
          .orthographic()
          .rotate(currentPosition())
          .precision(0.1)
          .clipAngle(90);
      },
      defineMap: function (mapSvg, foregroundSvg) {
        var path = d3.geo.path().projection(this.projection);
        var defs = mapSvg.append("defs");
        var gradientFill = defs
          .append("radialGradient")
          .attr("id", "orthographic-fill")
          .attr("gradientUnits", "objectBoundingBox")
          .attr("cx", "50%")
          .attr("cy", "49%")
          .attr("r", "50%");
        gradientFill
          .append("stop")
          .attr("stop-color", "#303030")
          .attr("offset", "69%");
        gradientFill
          .append("stop")
          .attr("stop-color", "#202020")
          .attr("offset", "91%");
        gradientFill
          .append("stop")
          .attr("stop-color", "#000005")
          .attr("offset", "96%");
        defs
          .append("path")
          .attr("id", "sphere")
          .datum({ type: "Sphere" })
          .attr("d", path);
        mapSvg
          .append("use")
          .attr("xlink:href", "#sphere")
          .attr("fill", "url(#orthographic-fill)");
        mapSvg
          .append("path")
          .attr("class", "graticule")
          .datum(d3.geo.graticule())
          .attr("d", path);
        mapSvg
          .append("path")
          .attr("class", "hemisphere")
          .datum(d3.geo.graticule().minorStep([0, 90]).majorStep([0, 90]))
          .attr("d", path);
        mapSvg.append("path").attr("class", "coastline");
        mapSvg.append("path").attr("class", "lakes");
        foregroundSvg
          .append("use")
          .attr("xlink:href", "#sphere")
          .attr("class", "foreground-sphere");
      },
      locate: function (coord) {
        return [-coord[0], -coord[1], this.projection.rotate()[2]];
      },
    });
  }

  function stereographic(view) {
    return newGlobe(
      {
        newProjection: function (view) {
          return d3.geo
            .stereographic()
            .rotate([-43, -20])
            .precision(1.0)
            .clipAngle(180 - 0.0001)
            .clipExtent([
              [0, 0],
              [view.width, view.height],
            ]);
        },
      },
      view
    );
  }

  function waterman() {
    return newGlobe({
      newProjection: function () {
        return d3.geo.polyhedron.waterman().rotate([20, 0]).precision(0.1);
      },
      defineMap: function (mapSvg, foregroundSvg) {
        var path = d3.geo.path().projection(this.projection);
        var defs = mapSvg.append("defs");
        defs
          .append("path")
          .attr("id", "sphere")
          .datum({ type: "Sphere" })
          .attr("d", path);
        defs
          .append("clipPath")
          .attr("id", "clip")
          .append("use")
          .attr("xlink:href", "#sphere");
        mapSvg
          .append("use")
          .attr("xlink:href", "#sphere")
          .attr("class", "background-sphere");
        mapSvg
          .append("path")
          .attr("class", "graticule")
          .attr("clip-path", "url(#clip)")
          .datum(d3.geo.graticule())
          .attr("d", path);
        mapSvg
          .append("path")
          .attr("class", "coastline")
          .attr("clip-path", "url(#clip)");
        mapSvg
          .append("path")
          .attr("class", "lakes")
          .attr("clip-path", "url(#clip)");
        foregroundSvg
          .append("use")
          .attr("xlink:href", "#sphere")
          .attr("class", "foreground-sphere");
      },
    });
  }

  function winkel3() {
    return newGlobe({
      newProjection: function () {
        return d3.geo.winkel3().precision(0.1);
      },
    });
  }

  return d3.map({
    atlantis: atlantis,
    azimuthal_equidistant: azimuthalEquidistant,
    conic_equidistant: conicEquidistant,
    equirectangular: equirectangular,
    orthographic: orthographic,
    stereographic: stereographic,
    waterman: waterman,
    winkel3: winkel3,
  });
})();

            </script>
            <script  >
              /**
 * products - defines the behavior of weather data grids, including grid construction, interpolation, and color scales.
 *
 * Copyright (c) 2014 Cameron Beccario
 * The MIT License - http://opensource.org/licenses/MIT
 *
 * https://github.com/cambecc/earth
 */
var products = function() {
  "use strict";

  var WEATHER_PATH = "./data/weather";
  var OSCAR_PATH = "./data/oscar";
  var height;
  var period;
  var index = 0
  var catalogs = {
      // The OSCAR catalog is an array of file names, sorted and prefixed with yyyyMMdd. Last item is the
      // most recent. For example: [ 20140101-abc.json, 20140106-abc.json, 20140112-abc.json, ... ]
      oscar: µ.loadJson([OSCAR_PATH, "catalog.json"].join("/"))
  };


 
  function buildProduct(overrides) {
      return _.extend({
          description: "",
          paths: [],
          date: null,
          navigate: function(step) {
              return gfsStep(this.date, step);
          },
          load: function(cancel) {
              var me = this;
              return when.map(this.paths, µ.loadJson).then(function(files) {
                  return cancel.requested ? null : _.extend(me, buildGrid(me.builder.apply(me, files)));
              });
          }
      }, overrides);
  }

  /**
   * @param attr
   * @param {String} type
   * @param {String?} surface
   * @param {String?} level
   * @returns {String}
   */
  function gfs1p0degPath(attr, type, surface, level) {
     
         
          var dir = attr.date, stamp = dir === "current" ? "current" : attr.hour;
      
     
      var file = [stamp, type, surface, level, "gfs", "1.0"].filter(µ.isValue).join("-") + ".json";
      return [WEATHER_PATH, dir, file].join("/");
  }

  function gfsDate(attr) {
      if (attr.date === "current") {
          // Construct the date from the current time, rounding down to the nearest three-hour block.
          var now = new Date(Date.now()), hour = Math.floor(now.getUTCHours() / 6);
          return new Date(Date.UTC(now.getUTCFullYear(), now.getUTCMonth(), now.getUTCDate(), hour));
      }
      var parts = attr.date.split("/");
      return new Date(Date.UTC(+parts[0], parts[1] - 1, +parts[2], +attr.hour.substr(0, 2)));
  }

  /**
   * Returns a date for the chronologically next or previous GFS data layer. How far forward or backward in time
   * to jump is determined by the step. Steps of ±1 move in 3-hour jumps, and steps of ±10 move in 24-hour jumps.
   */
  function gfsStep(date, step) {
      var offset = (step > 1 ? 8 : step < -1 ? -8 : step) * 6, adjusted = new Date(date);
      adjusted.setHours(adjusted.getHours() + offset);
      return adjusted;
  }

  function netcdfHeader(time, lat, lon, center) {
      return {
          lo1: lon.sequence.start,
          la1: lat.sequence.start,
          dx: lon.sequence.delta,
          dy: -lat.sequence.delta,
          nx: lon.sequence.size,
          ny: lat.sequence.size,
          refTime: time.data[0],
          forecastTime: 0,
          centerName: center
      };
  }

  function describeSurface(attr) {
      return attr.surface === "surface" ? "Surface" : µ.capitalize(attr.level);
  }

  function describeSurfaceJa(attr) {
      return attr.surface === "surface" ? "地上" : µ.capitalize(attr.level);
  }

  /**
   * Returns a function f(langCode) that, given table:
   *     {foo: {en: "A", ja: "あ"}, bar: {en: "I", ja: "い"}}
   * will return the following when called with "en":
   *     {foo: "A", bar: "I"}
   * or when called with "ja":
   *     {foo: "あ", bar: "い"}
   */
  function localize(table) {
      return function(langCode) {
          var result = {};
          _.each(table, function(value, key) {
              result[key] = value[langCode] || value.en || value;
          });
          return result;
      }
  }

  var FACTORIES = {

      "wind": {
          matches: _.matches({param: "wind", surface: "surface", level: "level", overlayType: "off"}),
          create: function(attr) {
              return buildProduct({
                  field: "vector",
                  type: "wind",
                  description: localize({
                      name: {en: "Wind", ja: "風速"},
                      qualifier: {en: " @ " + describeSurface(attr), ja: " @ " + describeSurfaceJa(attr)}
                  }),
                  
                  //./data/weather/current/dummy.json"
                  paths: [gfs1p0degPath(attr, "wind", attr.surface, attr.level)],
                  date: gfsDate(attr),
                  builder: function(file) {
                      var uData = file[0].data, vData = file[1].data;
                      return {
                          header: file[0].header,
                          interpolate: bilinearInterpolateVector,
                          data: function(i) {  
                              return [uData[i], vData[i]];
                          }
                      }
                  },
                  units: [
                      {label: "km/h", conversion: function(x) { return x * 3.6; },      precision: 0},
                      {label: "m/s",  conversion: function(x) { return x; },            precision: 1},
                      {label: "kn",   conversion: function(x) { return x * 1.943844; }, precision: 0},
                      {label: "mph",  conversion: function(x) { return x * 2.236936; }, precision: 0}
                  ],
                  scale: {
                      bounds: [0, 100],
                      gradient: function(v, a) {
                          return µ.extendedSinebowColor(Math.min(v, 100) / 100, a);
                      }
                  },
                  particles: {velocityScale: 1/60000, maxIntensity: 17}
              });
          }
      },
      
    
      "waves": {
          matches: _.matches({
              param: "ocean",
              surface: "surface",
              level: "waves"
          }),
          create: function (attr) {
              return when(catalogs.oscar).then(function (catalog) {
                  return buildProduct({
                      field: "vector",
                      type: "currents",
                      description: localize({
                          name: { en: "Peak Wave Period", ja: "海流" },
                          qualifier: { en: " ", ja: " @ 地上" }
                      }),
                      paths: ["./data/weather/wave/current-wind-surface-level-gfs-3.0.json"],
                      date: oscarDate(catalog, attr),
                      navigate: function (step) {
                          return oscarStep(catalog, this.date, step);
                      },
                      builder: function (file) {
                          var uData = file[0].data, vData = file[1].data;
                          height = file[2].data;
                          period = file[3].data;
                        var maxi=0;
                          for(var i=0;i<period.length;i++)
                          {  if(!isNaN(period[i]))
                               {
                                  maxi=Math.max(period[i],maxi);
                               }
                             
                          }
                        
                          return {
                              header: file[0].header,
                              interpolate: bilinearInterpolateVector
                              ,
                              data: function (i) {
                                  var u = uData[i], v = vData[i];
                                  return µ.isValue(u) && µ.isValue(v) ? [u, v, height[i], period[i]] : null;
                              }
                          }
                      }
                      ,
                      units: [
                          { label: "m/s", conversion: function (x) {  return x; }, precision: 2 },
                          /*
                          {label: "km/h", conversion: function(x) { return x * 3.6; },      precision: 1},
                          {label: "kn",   conversion: function(x) { return x * 1.943844; }, precision: 1},
                          {label: "mph",  conversion: function(x) { return x * 2.236936; }, precision: 1}
                          */
                      ],
                      scale: {
                          bounds: [0,20],
                          gradient: µ.segmentedColorScale([
                              [0, [0, 1, 1]],
                              [1, [0, 10, 10]],
                              [3, [2, 30, 30]],
                              [5, [4, 51, 51]],
                              [7, [5, 71, 71]],
                              [12, [10, 122, 122]],
                              [14,[11,142,142]],
                              [20,[20,249,249]]
                          ])
                      },
                      particles: { velocityScale: 1 / 440000, maxIntensity: 0.7 }
                  });
              });
      }
      
  },
/* 
      "temp": {
          matches: _.matches({param: "wind", overlayType: "temp"}),
          create: function(attr) {
              return buildProduct({
                  field: "scalar",
                  type: "temp",
                  description: localize({
                      name: {en: "Temp", ja: "気温"},
                      qualifier: {en: " @ " + describeSurface(attr), ja: " @ " + describeSurfaceJa(attr)}
                  }),
                  paths: [gfs1p0degPath(attr, "temp", attr.surface, attr.level)],
                  date: gfsDate(attr),
                  builder: function(file) {
                      var record = file[0], data = record.data;
                      return {
                          header: record.header,
                          interpolate: bilinearInterpolateScalar,
                          data: function(i) {
                              return data[i];
                          }
                      }
                  },
                  units: [
                      {label: "°C", conversion: function(x) { return x - 273.15; },       precision: 1},
                      {label: "°F", conversion: function(x) { return x * 9/5 - 459.67; }, precision: 1},
                      {label: "K",  conversion: function(x) { return x; },                precision: 1}
                  ],
                  scale: {
                      bounds: [193, 328],
                      gradient: µ.segmentedColorScale([
                          [193,     [37, 4, 42]],
                          [206,     [41, 10, 130]],
                          [219,     [81, 40, 40]],
                          [233.15,  [192, 37, 149]],  // -40 C/F
                          [255.372, [70, 215, 215]],  // 0 F
                          [273.15,  [21, 84, 187]],   // 0 C
                          [275.15,  [24, 132, 14]],   // just above 0 C
                          [291,     [247, 251, 59]],
                          [298,     [235, 167, 21]],
                          [311,     [230, 71, 39]],
                          [328,     [88, 27, 67]]
                      ])
                  }
              });
          }
      },

      "relative_humidity": {
          matches: _.matches({param: "wind", overlayType: "relative_humidity"}),
          create: function(attr) {
              return buildProduct({
                  field: "scalar",
                  type: "relative_humidity",
                  description: localize({
                      name: {en: "Relative Humidity", ja: "相対湿度"},
                      qualifier: {en: " @ " + describeSurface(attr), ja: " @ " + describeSurfaceJa(attr)}
                  }),
                  paths: [gfs1p0degPath(attr, "relative_humidity", attr.surface, attr.level)],
                  date: gfsDate(attr),
                  builder: function(file) {
                      var vars = file.variables;
                      var rh = vars.Relative_humidity_isobaric || vars.Relative_humidity_height_above_ground;
                      var data = rh.data;
                      return {
                          header: netcdfHeader(vars.time, vars.lat, vars.lon, file.Originating_or_generating_Center),
                          interpolate: bilinearInterpolateScalar,
                          data: function(i) {
                              return data[i];
                          }
                      };
                  },
                  units: [
                      {label: "%", conversion: function(x) { return x; }, precision: 0}
                  ],
                  scale: {
                      bounds: [0, 100],
                      gradient: function(v, a) {
                          return µ.sinebowColor(Math.min(v, 100) / 100, a);
                      }
                  }
              });
          }
      },

      "air_density": {
          matches: _.matches({param: "wind", overlayType: "air_density"}),
          create: function(attr) {
              return buildProduct({
                  field: "scalar",
                  type: "air_density",
                  description: localize({
                      name: {en: "Air Density", ja: "空気密度"},
                      qualifier: {en: " @ " + describeSurface(attr), ja: " @ " + describeSurfaceJa(attr)}
                  }),
                  paths: [gfs1p0degPath(attr, "air_density", attr.surface, attr.level)],
                  date: gfsDate(attr),
                  builder: function(file) {
                      var vars = file.variables;
                      var air_density = vars.air_density, data = air_density.data;
                      return {
                          header: netcdfHeader(vars.time, vars.lat, vars.lon, file.Originating_or_generating_Center),
                          interpolate: bilinearInterpolateScalar,
                          data: function(i) {
                              return data[i];
                          }
                      };
                  },
                  units: [
                      {label: "kg/m³", conversion: function(x) { return x; }, precision: 2}
                  ],
                  scale: {
                      bounds: [0, 1.5],
                      gradient: function(v, a) {
                          return µ.sinebowColor(Math.min(v, 1.5) / 1.5, a);
                      }
                  }
              });
          }
      },

      "wind_power_density": {
          matches: _.matches({param: "wind", overlayType: "wind_power_density"}),
          create: function(attr) {
              var windProduct = FACTORIES.wind.create(attr);
              var airdensProduct = FACTORIES.air_density.create(attr);
              return buildProduct({
                  field: "scalar",
                  type: "wind_power_density",
                  description: localize({
                      name: {en: "Wind Power Density", ja: "風力エネルギー密度"},
                      qualifier: {en: " @ " + describeSurface(attr), ja: " @ " + describeSurfaceJa(attr)}
                  }),
                  paths: [windProduct.paths[0], airdensProduct.paths[0]],
                  date: gfsDate(attr),
                  builder: function(windFile, airdensFile) {
                      var windBuilder = windProduct.builder(windFile);
                      var airdensBuilder = airdensProduct.builder(airdensFile);
                      var windData = windBuilder.data, windInterpolate = windBuilder.interpolate;
                      var airdensData = airdensBuilder.data, airdensInterpolate = airdensBuilder.interpolate;
                      return {
                          header: _.clone(airdensBuilder.header),
                          interpolate: function(x, y, g00, g10, g01, g11) {
                              var m = windInterpolate(x, y, g00[0], g10[0], g01[0], g11[0])[2];
                              var ρ = airdensInterpolate(x, y, g00[1], g10[1], g01[1], g11[1]);
                              return 0.5 * ρ * m * m * m;
                          },
                          data: function(i) {
                              return [windData(i), airdensData(i)];
                          }
                      };
                  },
                  units: [
                      {label: "kW/m²", conversion: function(x) { return x / 1000; }, precision: 1},
                      {label: "W/m²", conversion: function(x) { return x; }, precision: 0}
                  ],
                  scale: {
                      bounds: [0, 80000],
                      gradient: µ.segmentedColorScale([
                          [0, [15, 4, 96]],
                          [250, [30, 8, 180]],
                          [1000, [121, 102, 2]],
                          [2000, [118, 161, 66]],
                          [4000, [50, 102, 219]],
                          [8000, [19, 131, 193]],
                          [16000, [59, 204, 227]],
                          [64000, [241, 1, 45]],
                          [80000, [243, 0, 241]]
                      ])
                  }
              });
          }
      },

      "total_cloud_water": {
          matches: _.matches({param: "wind", overlayType: "total_cloud_water"}),
          create: function(attr) {
              return buildProduct({
                  field: "scalar",
                  type: "total_cloud_water",
                  description: localize({
                      name: {en: "Total Cloud Water", ja: "雲水量"},
                      qualifier: ""
                  }),
                  paths: [gfs1p0degPath(attr, "total_cloud_water")],
                  date: gfsDate(attr),
                  builder: function(file) {
                      var record = file[0], data = record.data;
                      return {
                          header: record.header,
                          interpolate: bilinearInterpolateScalar,
                          data: function(i) {
                              return data[i];
                          }
                      }
                  },
                  units: [
                      {label: "kg/m²", conversion: function(x) { return x; }, precision: 3}
                  ],
                  scale: {
                      bounds: [0, 1],
                      gradient: µ.segmentedColorScale([
                          [0.0, [5, 5, 89]],
                          [0.2, [170, 170, 230]],
                          [1.0, [255, 255, 255]]
                      ])
                  }
              });
          }
      },

      "total_precipitable_water": {
          matches: _.matches({param: "wind", overlayType: "total_precipitable_water"}),
          create: function(attr) {
              return buildProduct({
                  field: "scalar",
                  type: "total_precipitable_water",
                  description: localize({
                      name: {en: "Total Precipitable Water", ja: "可降水量"},
                      qualifier: ""
                  }),
                  paths: [gfs1p0degPath(attr, "total_precipitable_water")],
                  date: gfsDate(attr),
                  builder: function(file) {
                      var record = file[0], data = record.data;
                      return {
                          header: record.header,
                          interpolate: bilinearInterpolateScalar,
                          data: function(i) {
                              return data[i];
                          }
                      }
                  },
                  units: [
                      {label: "kg/m²", conversion: function(x) { return x; }, precision: 3}
                  ],
                  scale: {
                      bounds: [0, 70],
                      gradient:
                          µ.segmentedColorScale([
                              [0, [230, 165, 30]],
                              [10, [120, 100, 95]],
                              [20, [40, 44, 92]],
                              [30, [21, 13, 193]],
                              [40, [75, 63, 235]],
                              [60, [25, 255, 255]],
                              [70, [150, 255, 255]]
                          ])
                  }
              });
          }
      },

      "mean_sea_level_pressure": {
          matches: _.matches({param: "wind", overlayType: "mean_sea_level_pressure"}),
          create: function(attr) {
              return buildProduct({
                  field: "scalar",
                  type: "mean_sea_level_pressure",
                  description: localize({
                      name: {en: "Mean Sea Level Pressure", ja: "海面更正気圧"},
                      qualifier: ""
                  }),
                  paths: [gfs1p0degPath(attr, "mean_sea_level_pressure")],
                  date: gfsDate(attr),
                  builder: function(file) {
                      var record = file[0], data = record.data;
                      return {
                          header: record.header,
                          interpolate: bilinearInterpolateScalar,
                          data: function(i) {
                              return data[i];
                          }
                      }
                  },
                  units: [
                      {label: "hPa", conversion: function(x) { return x / 100; }, precision: 0},
                      {label: "mmHg", conversion: function(x) { return x / 133.322387415; }, precision: 0},
                      {label: "inHg", conversion: function(x) { return x / 3386.389; }, precision: 1}
                  ],
                  scale: {
                      bounds: [92000, 105000],
                      gradient: µ.segmentedColorScale([
                          [92000, [40, 0, 0]],
                          [95000, [187, 60, 31]],
                          [96500, [137, 32, 30]],
                          [98000, [16, 1, 43]],
                          [100500, [36, 1, 93]],
                          [101300, [241, 254, 18]],
                          [103000, [228, 246, 223]],
                          [105000, [255, 255, 255]]
                      ])
                  }
              });
          }
      },
*/
      "currents": {
          matches: _.matches({param: "ocean", surface: "surface", level: "currents"}),
          create: function(attr) {
              return when(catalogs.oscar).then(function(catalog) {
                  return buildProduct({
                      field: "vector",
                      type: "currents",
                      description: localize({
                          name: {en: "Ocean Currents", ja: "海流"},
                          qualifier: {en: " @ Surface", ja: " @ 地上"}
                      }),
                      paths: [oscar0p33Path(catalog, attr)],
                      date: oscarDate(catalog, attr),
                      navigate: function(step) {
                          return oscarStep(catalog, this.date, step);
                      },
                      builder: function(file) {
                          var uData = file[0].data, vData = file[1].data;
                          return {
                              header: file[0].header,
                              interpolate: bilinearInterpolateVector,
                              data: function(i) {
                                  var u = uData[i], v = vData[i];
                                  return µ.isValue(u) && µ.isValue(v) ? [u, v] : null;
                              }
                          }
                      },
                      units: [
                          {label: "m/s",  conversion: function(x) { return x; },            precision: 2},
                          {label: "km/h", conversion: function(x) { return x * 3.6; },      precision: 1},
                          {label: "kn",   conversion: function(x) { return x * 1.943844; }, precision: 1},
                          {label: "mph",  conversion: function(x) { return x * 2.236936; }, precision: 1}
                      ],
                      scale: {
                          bounds: [0, 1.5],
                          gradient: µ.segmentedColorScale([
                              [0, [10, 25, 68]],
                              [0.15, [10, 25, 250]],
                              [0.4, [24, 255, 93]],
                              [0.65, [255, 233, 102]],
                              [1.0, [255, 233, 15]],
                              [1.5, [255, 15, 15]]
                          ])
                      },
                      particles: {velocityScale: 1/4400, maxIntensity: 0.7}
                  });
              });
          }
      },

      
      "off": {
          matches: _.matches({overlayType: "off"}),
          create: function() {
              return null;
          }
      }
  };

  /**
   * Returns the file name for the most recent OSCAR data layer to the specified date. If offset is non-zero,
   * the file name that many entries from the most recent is returned.
   *
   * The result is undefined if there is no entry for the specified date and offset can be found.
   *
   * UNDONE: the catalog object itself should encapsulate this logic. GFS can also be a "virtual" catalog, and
   *         provide a mechanism for eliminating the need for /data/weather/current/* files.
   *
   * @param {Array} catalog array of file names, sorted and prefixed with yyyyMMdd. Last item is most recent.
   * @param {String} date string with format yyyy/MM/dd or "current"
   * @param {Number?} offset
   * @returns {String} file name
   */
  function lookupOscar(catalog, date, offset) {
      offset = +offset || 0;
      if (date === "current") {
          return catalog[catalog.length - 1 + offset];
      }
      var prefix = µ.ymdRedelimit(date, "/", ""), i = _.sortedIndex(catalog, prefix);
      i = (catalog[i] || "").indexOf(prefix) === 0 ? i : i - 1;
      return catalog[i + offset];
  }

  function oscar0p33Path(catalog, attr) {
      var file = lookupOscar(catalog, attr.date);
      return file ? [OSCAR_PATH, file].join("/") : null;
  }

  function oscarpath(catalognew, attr) {
      var file = lookupOscar(catalognew, attr.date);
      return file ? [OSCAR_PATH, file].join("/") : null;
  }

  function oscarDate(catalog, attr) {
      var file = lookupOscar(catalog, attr.date);
      var parts = file ? µ.ymdRedelimit(file, "", "/").split("/") : null;
      return parts ? new Date(Date.UTC(+parts[0], parts[1] - 1, +parts[2], 0)) : null;
  }

  /**
   * @returns {Date} the chronologically next or previous OSCAR data layer. How far forward or backward in
   * time to jump is determined by the step and the catalog of available layers. A step of ±1 moves to the
   * next/previous entry in the catalog (about 5 days), and a step of ±10 moves to the entry six positions away
   * (about 30 days).
   */
  function oscarStep(catalog, date, step) {
      var file = lookupOscar(catalog, µ.dateToUTCymd(date, "/"), step > 1 ? 6 : step < -1 ? -6 : step);
      var parts = file ? µ.ymdRedelimit(file, "", "/").split("/") : null;
      return parts ? new Date(Date.UTC(+parts[0], parts[1] - 1, +parts[2], 0)) : null;
  }

  function dataSource(header) {
      // noinspection FallthroughInSwitchStatementJS
      switch (header.center || header.centerName) {
          case -3:
              return "OSCAR / Earth & Space Research";
          case 7:
          case "US National Weather Service, National Centres for Environmental Prediction (NCEP)":
              return "GFS / NCEP / US National Weather Service";
          default:
              return header.centerName;
      }
  }

  function bilinearInterpolateScalar(x, y, g00, g10, g01, g11) {
      var rx = (1 - x);
      var ry = (1 - y);
      return g00 * rx * ry + g10 * x * ry + g01 * rx * y + g11 * x * y;
  }

  function bilinearInterpolateVector(x, y, g00, g10, g01, g11) {
      // index++
      
      var rx = (1 - x);
      var ry = (1 - y);
      var a = rx * ry,  b = x * ry,  c = rx * y,  d = x * y;
      var u = g00[0] * a + g10[0] * b + g01[0] * c + g11[0] * d;
      var v = g00[1] * a + g10[1] * b + g01[1] * c + g11[1] * d;
 
      if(height && period){
          return [u, v, Math.sqrt(u * u + v * v), g01[2], g01[3]];
      }
      else{
          return [u, v, Math.sqrt(u * u + v * v)];
      }
  }

  /**
   * Builds an interpolator for the specified data in the form of JSON-ified GRIB files. Example:
   *
   *     [
   *       {
   *         "header": {
   *           "refTime": "2013-11-30T18:00:00.000Z",
   *           "parameterCategory": 2,
   *           "parameterNumber": 2,
   *           "surface1Type": 100,
   *           "surface1Value": 100000.0,
   *           "forecastTime": 6,
   *           "scanMode": 0,
   *           "nx": 360,
   *           "ny": 181,
   *           "lo1": 0,
   *           "la1": 90,
   *           "lo2": 359,
   *           "la2": -90,
   *           "dx": 1,
   *           "dy": 1
   *         },
   *         "data": [3.42, 3.31, 3.19, 3.08, 2.96, 2.84, 2.72, 2.6, 2.47, ...]
   *       }
   *     ]
   *
   */
  function buildGrid(builder) {
      // var builder = createBuilder(data);

      var header = builder.header;
      var λ0 = header.lo1, φ0 = header.la1;  // the grid's origin (e.g., 0.0E, 90.0N)
      var Δλ = header.dx, Δφ = header.dy;    // distance between grid points (e.g., 2.5 deg lon, 2.5 deg lat)
      var ni = header.nx, nj = header.ny;    // number of grid points W-E and N-S (e.g., 144 x 73)
      var date = new Date(header.refTime);
      date.setHours(date.getHours() + header.forecastTime);

      // Scan mode 0 assumed. Longitude increases from λ0, and latitude decreases from φ0.
      // http://www.nco.ncep.noaa.gov/pmb/docs/grib2/grib2_table3-4.shtml
      var grid = [], p = 0;
      var isContinuous = Math.floor(ni * Δλ) >= 360;
      for (var j = 0; j < nj; j++) {
          var row = [];
          for (var i = 0; i < ni; i++, p++) {
              row[i] = builder.data(p);
          }
          if (isContinuous) {
              // For wrapped grids, duplicate first column as last column to simplify interpolation logic
              row.push(row[0]);
          }
          grid[j] = row;
      }   
      

      function interpolate(λ, φ) {
          var i = µ.floorMod(λ - λ0, 360) / Δλ;  // calculate longitude index in wrapped range [0, 360)
          var j = (φ0 - φ) / Δφ;  
                        // calculate latitude index in direction +90 to -90

          //         1      2           After converting λ and φ to fractional grid indexes i and j, we find the
          //        fi  i   ci          four points "G" that enclose point (i, j). These points are at the four
          //         | =1.4 |           corners specified by the floor and ceiling of i and j. For example, given
          //      ---G--|---G--- fj 8   i = 1.4 and j = 8.3, the four surrounding grid points are (1, 8), (2, 8),
          //    j ___|_ .   |           (1, 9) and (2, 9).
          //  =8.3   |      |
          //      ---G------G--- cj 9   Note that for wrapped grids, the first column is duplicated as the last
          //         |      |           column, so the index ci can be used without taking a modulo.

          var fi = Math.floor(i), ci = fi + 1;
          var fj = Math.floor(j), cj = fj + 1;
          var row;
          if ((row = grid[fj])) {
              var g00 = row[fi];
              var g10 = row[ci];
              if (µ.isValue(g00) && µ.isValue(g10) && (row = grid[cj])) {
                  var g01 = row[fi];
                  var g11 = row[ci];
                  if (µ.isValue(g01) && µ.isValue(g11)) {
                      // All four points found, so interpolate the value.
                      return builder.interpolate(i - fi, j - fj, g00, g10, g01, g11);
                  }
              }
          }
          // console.log("cannot interpolate: " + λ + "," + φ + ": " + fi + " " + ci + " " + fj + " " + cj);
          return null;
      }

      return {
          source: dataSource(header),
          date: date,
          interpolate: interpolate,
          forEachPoint: function(cb) {
              for (var j = 0; j < nj; j++) {
                  var row = grid[j] || [];
                  for (var i = 0; i < ni; i++) {
                      cb(µ.floorMod(180 + λ0 + i * Δλ, 360) - 180, φ0 - j * Δφ, row[i]);
                  }
              }
          }
      };
  }

  function productsFor(attributes) {
      var attr = _.clone(attributes), results = [];
      _.values(FACTORIES).forEach(function(factory) {
          if (factory.matches(attr)) {
              results.push(factory.create(attr));
          }
      });
      return results.filter(µ.isValue);
  }

  return {
      overlayTypes: d3.set(_.keys(FACTORIES)),
      productsFor: productsFor
  };

}();

            </script>
  
    <script >

 (function () {
  "use strict";

  var breakpoints = 0;
  var rldis = [];
  var gcdis = [];
  var totalrldis = 0;
  var totalgcdis = 0;
  let velocityarr=[];
  var isocoordinates = [];
  var isoToggle = false;
  var totaltimetaken=0;

  var SECOND = 1000;
  var MINUTE = 60 * SECOND;
  var HOUR = 60 * MINUTE;
  var MAX_TASK_TIME = 100; // amount of time before a task yields control (millis)
  var MIN_SLEEP_TIME = 25; // amount of time a task waits before resuming (millis)
  var MIN_MOVE = 4; // slack before a drag operation beings (pixels)
  var MOVE_END_WAIT = 1000; // time to wait for a move operation to be considered done (millis)

  var OVERLAY_ALPHA = Math.floor(0.4 * 255); // overlay transparency (on scale [0, 255])
  var INTENSITY_SCALE_STEP = 10; // step size of particle intensity color scale
  var MAX_PARTICLE_AGE = 100; // max number of frames a particle is drawn before regeneration
  var PARTICLE_LINE_WIDTH = 1.0; // line width of a drawn particle
  var PARTICLE_MULTIPLIER = 7; // particle count scalar (completely arbitrary--this values looks nice)
  var PARTICLE_REDUCTION = 0.75; // reduce particle count to this much of normal for mobile devices
  var FRAME_RATE = 40; // desired milliseconds per frame

  var NULL_WIND_VECTOR = [NaN, NaN, null]; // singleton for undefined location outside the vector field [u, v, mag]
  var HOLE_VECTOR = [NaN, NaN, null]; // singleton that signifies a hole in the vector field
  var TRANSPARENT_BLACK = [0, 0, 0, 0]; // singleton 0 rgba
  var REMAINING = "▫▫▫▫▫▫▫▫▫▫▫▫▫▫▫▫▫▫▫▫▫▫"; // glyphs for remaining progress bar
  var COMPLETED = "▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪"; // glyphs for completed progress bar

  var loadedPointsCSV = []; //stores points from the uploaded csv

  var view = µ.view();
  var log = µ.log();

  /**
   * An object to display various types of messages to the user.
   */
  var report = (function () {
    var s = d3.select("#status"),
      p = d3.select("#progress"),
      total = REMAINING.length;
    return {
      status: function (msg) {
        return s.classed("bad") ? s : s.text(msg); // errors are sticky until reset
      },
      error: function (err) {
        var msg = err.status ? err.status + " " + err.message : err;
        switch (err.status) {
          case -1:
            msg = "Server Down";
            break;
          case 404:
            msg = "No Data";
            break;
        }
        log.error(err);
        return s.classed("bad", true).text(msg);
      },
      reset: function () {
        return s.classed("bad", false).text("");
      },
      progress: function (amount) {
        // amount of progress to report in the range [0, 1]
        if (0 <= amount && amount < 1) {
          var i = Math.ceil(amount * total);
          var bar = COMPLETED.substr(0, i) + REMAINING.substr(0, total - i);
          return p.classed("invisible", false).text(bar);
        }
        return p.classed("invisible", true).text(""); // progress complete
      },
    };
  })();

  function newAgent() {
    return µ.newAgent().on({ reject: report.error, fail: report.error });
  }

  // Construct the page's main internal components:

  var configuration = µ.buildConfiguration(globes, products.overlayTypes); // holds the page's current configuration settings
  var inputController = buildInputController(); // interprets drag/zoom operations
  var meshAgent = newAgent(); // map data for the earth
  var globeAgent = newAgent(); // the model of the globe
  var gridAgent = newAgent(); // the grid of weather data
  var rendererAgent = newAgent(); // the globe SVG renderer
  var fieldAgent = newAgent(); // the interpolated wind vector field
  var animatorAgent = newAgent(); // the wind animator
  var overlayAgent = newAgent(); // color overlay over the animation

  /**
   * The input controller is an object that translates move operations (drag and/or zoom) into mutations of the
   * current globe's projection, and emits events so other page components can react to these move operations.
   *
   * D3's built-in Zoom behavior is used to bind to the document's drag/zoom events, and the input controller
   * interprets D3's events as move operations on the globe. This method is complicated due to the complex
   * event behavior that occurs during drag and zoom.
   *
   * D3 move operations usually occur as "zoomstart" -> ("zoom")* -> "zoomend" event chain. During "zoom" events
   * the scale and mouse may change, implying a zoom or drag operation accordingly. These operations are quite
   * noisy. What should otherwise be one smooth continuous zoom is usually comprised of several "zoomstart" ->
   * "zoom" -> "zoomend" event chains. A debouncer is used to eliminate the noise by waiting a short period of
   * time to ensure the user has finished the move operation.
   *
   * The "zoom" events may not occur; a simple click operation occurs as: "zoomstart" -> "zoomend". There is
   * additional logic for other corner cases, such as spurious drags which move the globe just a few pixels
   * (most likely unintentional), and the tendency for some touch devices to issue events out of order:
   * "zoom" -> "zoomstart" -> "zoomend".
   *
   * This object emits clean "moveStart" -> ("move")* -> "moveEnd" events for move operations, and "click" events
   * for normal clicks. Spurious moves emit no events.
   */
  function buildInputController() {
    var globe,
      op = null;

    /**
     * @returns {Object} an object to represent the state for one move operation.
     */
    function newOp(startMouse, startScale) {
      return {
        type: "click", // initially assumed to be a click operation
        startMouse: startMouse,
        startScale: startScale,
        manipulator: globe.manipulator(startMouse, startScale),
      };
    }

    //Fullscreen code on button click
    d3.select("#fullscreen_btn").on("click", () => {
      document.documentElement.requestFullscreen().catch((e) => {
        console.log(e.message);
      });
    });

    d3.select('.calculateVelocity').on("click",()=>{
      totaltimetaken=0;
      for(var i=0;i<rldis.length;i++)
      {
        if(document.getElementById("velocity-data-" + i)!=null)
        {
          velocityarr[i]=parseInt(document.getElementById("velocity-data-" + i).value)
        }
      }
      console.log(velocityarr);

      if (checkvelocityarr(velocityarr)){
        alert("please enter valid velocities")
      }
      else if (confirm('Are you sure you want to save velocities')) {
      
        // Save it!
      // totaltimetaken=0;
      // for(var i=0;i<rldis.length;i++)
      // {
      //   velocityarr[i]=parseInt(document.getElementById("velocity-data-" + i).value)
      // }
      
    
      for(var i=0;i<rldis.length;i++)
      {
        
            if(parseInt(velocityarr[i])!=0 )
            {
            
            totaltimetaken=Math.floor(totaltimetaken+(parseInt(rldis[i])*1000)/parseInt(velocityarr[i])/3600);
            }
        

      }
    
      console.log(totaltimetaken);

      
      
      let sliderOne = document.getElementById("slider-1");
      document.getElementById("slider-1").value=0;
      document.getElementById("slider-2").value = totaltimetaken;
        
      } else {
        // Do nothing!
        console.log("do nothing")
      }
    
    })

    var zoom = d3.behavior
      .zoom()
      .on("zoomstart", function () {
        op = op || newOp(d3.mouse(this), zoom.scale()); // a new operation begins
      })
      .on("zoom", function () {
        var currentMouse = d3.mouse(this),
          currentScale = d3.event.scale;

        op = op || newOp(currentMouse, 1); // Fix bug on some browsers where zoomstart fires out of order.
        if (op.type === "click" || op.type === "spurious") {
          var distanceMoved = µ.distance(currentMouse, op.startMouse);
          if (currentScale === op.startScale && distanceMoved < MIN_MOVE) {
            // to reduce annoyance, ignore op if mouse has barely moved and no zoom is occurring
            op.type = distanceMoved > 0 ? "click" : "spurious";
            return;
          }
          dispatch.trigger("moveStart");
          op.type = "drag";
        } else {
        }
        if (currentScale != op.startScale) {
          op.type = "zoom"; // whenever a scale change is detected, (stickily) switch to a zoom operation
        }

        // when zooming, ignore whatever the mouse is doing--really cleans up behavior on touch devices
        op.manipulator.move(
          op.type === "zoom" ? null : currentMouse,
          currentScale
        );
        dispatch.trigger("move");
      })
      .on("zoomend", function () {
        op.manipulator.end();
        // d3.select("#insert_point_blank").style("display", "none");
        // d3.selectAll(".iso-mark-new").remove();

        if (op.type === "click") {
          dispatch.trigger(
            "click",
            op.startMouse,
            globe.projection.invert(op.startMouse) || []
          );
        } else if (op.type !== "spurious") {
          console.log("Actuall zooming");
          signalEnd();
        }
        op = null; // the drag/zoom/click operation is over
      });

    var signalEnd = _.debounce(function () {
      if (!op || (op.type !== "drag" && op.type !== "zoom")) {
        // configuration.save(
        //   { orientation: globe.orientation() },
        //   { source: "moveEnd" }
        // );
        dispatch.trigger("moveEnd");
      }
    }, MOVE_END_WAIT); // wait for a bit to decide if user has stopped moving the globe

    d3.select("#display").call(zoom);
    d3.select("#show-location").on("click", function () {
      if (navigator.geolocation) {
        report.status("Finding current position...");
        navigator.geolocation.getCurrentPosition(function (pos) {
          report.status("");
          var coord = [pos.coords.longitude, pos.coords.latitude],
            rotate = globe.locate(coord);
          if (rotate) {
            globe.projection.rotate(rotate);
            configuration.save({ orientation: globe.orientation() }); // triggers reorientation
          }
          dispatch.trigger("click", globe.projection(coord), coord);
        }, log.error);
      }
    });

    function reorient() {
      var options = arguments[3] || {};
      if (!globe || options.source === "moveEnd") {
        // reorientation occurred because the user just finished a move operation, so globe is already
        // oriented correctly.
        return;
      }
      dispatch.trigger("moveStart");
      globe.orientation(configuration.get("orientation"), view);
      zoom.scale(globe.projection.scale());
      dispatch.trigger("moveEnd");
    }

    var dispatch = _.extend(
      {
        globe: function (_) {
          if (_) {
            globe = _;
            zoom.scaleExtent(globe.scaleExtent());
            reorient();
          }
          return _ ? this : globe;
        },
      },
      Backbone.Events
    );
    return dispatch.listenTo(configuration, "change:orientation", reorient);
  }

  /**
   * @param resource the GeoJSON resource's URL
   * @returns {Object} a promise for GeoJSON topology features: {boundaryLo:, boundaryHi:}
   */
  function buildMesh(resource) {
    var cancel = this.cancel;
    report.status("Downloading...");
    return µ.loadJson(resource).then(function (topo) {
      if (cancel.requested) return null;
      log.time("building meshes");
      var o = topo.objects;
      var coastLo = topojson.feature(
        topo,
        µ.isMobile() ? o.coastline_tiny : o.coastline_110m
      );
      var coastHi = topojson.feature(
        topo,
        µ.isMobile() ? o.coastline_110m : o.coastline_50m
      );
      var lakesLo = topojson.feature(
        topo,
        µ.isMobile() ? o.lakes_tiny : o.lakes_110m
      );
      var lakesHi = topojson.feature(
        topo,
        µ.isMobile() ? o.lakes_110m : o.lakes_50m
      );
      log.timeEnd("building meshes");
      return {
        coastLo: coastLo,
        coastHi: coastHi,
        lakesLo: lakesLo,
        lakesHi: lakesHi,
      };
    });
  }

  /**
   * @param {String} projectionName the desired projection's name.
   * @returns {Object} a promise for a globe object.
   */
  function buildGlobe(projectionName) {
    var builder = globes.get(projectionName);
    if (!builder) {
      return when.reject("Unknown projection: " + projectionName);
    }
    return when(builder(view));
  }

  // Some hacky stuff to ensure only one download can be in progress at a time.
  var downloadsInProgress = 0;

  function buildGrids() {
    report.status("Downloading...");
    log.time("build grids");
    // UNDONE: upon failure to load a product, the unloaded product should still be stored in the agent.
    //         this allows us to use the product for navigation and other state.
    var cancel = this.cancel;
    downloadsInProgress++;
    var loaded = when.map(
      products.productsFor(configuration.attributes),
      function (product) {
        return product.load(cancel);
      }
    );
    return when
      .all(loaded)
      .then(function (products) {
        log.time("build grids");
        return {
          primaryGrid: products[0],
          overlayGrid: products[1] || products[0],
        };
      })
      .ensure(function () {
        downloadsInProgress--;
      });
  }

  /**
   * Modifies the configuration to navigate to the chronologically next or previous data layer.
   */
  function navigate(step) {
    if (downloadsInProgress > 0) {
      log.debug("Download in progress--ignoring nav request.");
      return;
    }
    var next = gridAgent.value().primaryGrid.navigate(step);
    if (next) {
      configuration.save(µ.dateToConfig(next));
    }
  }

  window.addEventListener("load", ()=>{
    setTimeout(()=>{
      document.getElementById("overlay-wind").click()
      window.history.pushState('', 'basic', `/#current/wind/surface/level/overlay=none/${configuration.attributes.projection}=-277.50,0.00,261`)
    }, 1000)
  })

  configuration.on("change:projection", ()=>{
    setTimeout(()=>{
      window.history.pushState('', 'basic', `/#current/wind/surface/level/overlay=none/${configuration.attributes.projection}=-277.50,0.00,261`)
    }, 1000)
  })


  // // JS file to handle double range slider in fuctionality table below
  
  const parseDate = (val)=>{
   
    var date_now = new Date();

    if(val==0)
    {
      return date_now.toLocaleString('en-IN', {  hour12: true })
    }
    else
    {
      var newdate=new Date(Date.now() + val * (60 * 60 * 1000) );
      
      return newdate.toLocaleString('en-IN', { hour12: true })
      
    }
   
    
  }

  document.getElementById('slider-1').oninput = slideOne
  document.getElementById('slider-2').oninput = slideTwo

   
  window.onload = function () {
    slideOne();
    slideTwo();

  }

  let sliderOne = document.getElementById("slider-1");
  let sliderTwo = document.getElementById("slider-2");
  let displayValOne = document.getElementById("range1");
  let displayValTwo = document.getElementById("range2");
  let minGap = totaltimetaken;
  let sliderTrack = document.querySelector(".slider-track");
  let sliderMaxValue = document.getElementById("slider-1").max;

  function slideOne() {
    if (parseInt(sliderTwo.value) - parseInt(sliderOne.value) <= minGap && parseInt(sliderTwo.value) < 480) {
    
      sliderOne.value = parseInt(sliderTwo.value) - minGap;
    }
    
      sliderTwo.value = parseInt(sliderOne.value) + totaltimetaken;

    
    // displayValOne.textContent = sliderOne.value;
    fillColor();
  }
  function slideTwo() {
    if (parseInt(sliderTwo.value) - parseInt(sliderOne.value) <= minGap) {
     
      sliderTwo.value = parseInt(sliderOne.value) + minGap;
    }
    
      sliderOne.value = parseInt(sliderTwo.value) - totaltimetaken;
    
   
    // displayValTwo.textContent = sliderTwo.value;
    fillColor();
  }
  function fillColor() {
    document.getElementById("diff-slid").textContent = Math.floor((sliderTwo.value - sliderOne.value)/24)+"days" + (sliderTwo.value - sliderOne.value)%24+"hrs";
    displayValOne.textContent = parseDate(sliderOne.value)
    displayValTwo.textContent = parseDate(sliderTwo.value )
    let percent1 = (sliderOne.value / sliderMaxValue) * 100;
    let percent2 = (sliderTwo.value / sliderMaxValue) * 100;
    sliderTrack.style.background = `linear-gradient(to right, #dadae5 ${percent1}% , #3264fe ${percent1}% , #3264fe ${percent2}%, #dadae5 ${percent2}%)`;
  }




  function buildRenderer(mesh, globe) {
    if (!mesh || !globe) return null;

    report.status("Rendering Globe...");
    log.time("rendering map");

    // UNDONE: better way to do the following?
    var dispatch = _.clone(Backbone.Events);
    if (rendererAgent._previous) {
      rendererAgent._previous.stopListening();
    }
    rendererAgent._previous = dispatch;

    // First clear map and foreground svg contents.
    µ.removeChildren(d3.select("#map").node());
    µ.removeChildren(d3.select("#foreground").node());
    // Create new map svg elements.
    globe.defineMap(d3.select("#map"), d3.select("#foreground"));

    var path = d3.geo.path().projection(globe.projection).pointRadius(10);
    var isopath = d3.geo.path().projection(globe.projection).pointRadius(0.5);

    var coastline = d3.select(".coastline");
    var lakes = d3.select(".lakes");
    d3.selectAll("path").attr("d", path); // do an initial draw -- fixes issue with safari

    d3.select("#backBtnFunct").on("click", function () {
      if (arr.length != 0) {
        d3.select("#row-" + arr.length).remove();
        d3.select(".location-line-" + arr.length).remove();
        breakpoints--;
        console.log(breakpoints);
      }
      d3.select(`.location-mark-${arr.length}`).remove();
      arr.pop();
    });

    d3.select("#addBtnFunct").on("click", function () {
      addCoorRow();
    });
    function addCoorRow() {
      var row = d3
        .select("#coordinates-table")
        .append("tr")
        .attr("id", "row-" + (breakpoints + 1));
      row
        .append("td")
        .text("Point " + (breakpoints + 1))
        .attr("class", "cell1")
        .attr("id", `cell1-${breakpoints + 1}`);
      row
        .append("td")
        .append("input")
        .attr("id", "break-point-" + breakpoints)
        .attr("type", "text")
        .attr("class", "cell2")
        .property("readonly", true);

      row
        .append("td")
        .append("input")
        .attr("id", "weather-data-" + breakpoints)
        .attr("type", "text")
        .attr("class", "cell3")
        .property("readonly", true);

      breakpoints++;
    }

    configuration.on("change:level", (event) => {
      var time_delay = 300;
      if (configuration.changed.level === "waves") {
        document.getElementById("overlay-currents").innerHTML="Waves";
        console.log("Fetching Wave Data...");
        time_delay = 3000;
      }
      else if(configuration.changed.level === "currents")
      {
        document.getElementById("overlay-currents").innerHTML="Currents";
      }
      setTimeout(() => {
        redrawTable();
        d3.select("#insert_point_blank").style("display", "none");
      }, time_delay);
    });

    d3.select("#dynamic-condition-col").on("click", () => {
      redrawTable();
    });

    function redrawTable() {
      var table = d3.select("#coordinates-table");
      table.selectAll(".disposable").remove();
      d3.select("#condition-column").text(
        `${
          configuration.changed.level === "currents"
            ? "Current Speed"
            : configuration.changed.level === "waves"
            ? "Wave Data"
            : "Wind Speed"
        }`
      );
  
    
     

     

      document.querySelectorAll('.insert_after_class').forEach((elem) => {
        elem.disabled = false
      }) 

      for (let i = 0; i < arr.length; i++) {
        let row = table
          .append("tr")
          .attr("id", "row-" + (i + 1))
          .attr("class", "disposable");

        row
          .append("td")
          .style("background-color", "black")
          .attr("class", "insert_point_between")
          .attr("id", `insert_after_${i + 1}`)
          .style("display", "none")
          .append("button")
          .attr("class", `insert_after_class`)
          .attr("id", `insert_after_${i + 1}btn`)
          .text("+")
          .style("font-size", "20px")
          .on("click", () => {
            insertAfter(i + 1);
            document.querySelectorAll('.insert_after_class').forEach((elem)=>{
              elem.disabled = true
            }) 

          });

        row
          .append("td")
          .style("text-align", "center")
          .style("background-color", "#000005")
          .append("button")
          .text(i + 1)
          .attr("class", "cell1")
          .attr("id", `cell1-${i + 1}`);
        row
          .append("td")
          .append("input")
          .attr("id", "break-point-" + i)
          .attr("type", "text")
          .attr("readonly", true)
          .attr("class", "cell2");
        row
          .append("td")
          .append("input")
          .attr("id", "weather-data-" + i)
          .attr("type", "text")
          .attr("readonly", true)
          .attr("class", "cell3");

        if (d3.select("#break-point-" + i).node() != null) {
          var formattedCoordinates = formatLatitudeAndLongtitude(arr[i]);
          d3.select("#break-point-" + i).node().value =
            formattedCoordinates["latitude"] +
            " , " +
            formattedCoordinates["longitude"];
          var [v1, v2] = getWindAtLocation(arr[i]);
          d3.select("#weather-data-" + i).node().value = `${v1} ${v2}`;
        }

     row.append("td")
        .append("input")
        .attr("id","velocity-data-"+i)
        .attr("type","text")
        .attr("class","cell4")
      
      
          d3.select("#velocity-data-"+(i)).node().value = velocityarr[i];
        
         
         
      }
    }

    function getWindAtLocation(coord) {
      var grids = gridAgent.value(),
        product = grids.primaryGrid;
      var λ = coord[0],
        φ = coord[1];
      var wind = grids.primaryGrid.interpolate(λ, φ);
      if (µ.isValue(wind)) {
        var unitToggle = createUnitToggle("#location-wind-units", product),
          units = unitToggle.value();
        if (wind[3] !== undefined) {
          if (isNaN(wind[3])) {
            return [
              µ.formatVector(wind.slice(0, 3), units).split("@")[0] +
                " @ " +
                "Not",
              "Available",
            ];
          } else {
            return [
              µ.formatVector(wind.slice(0, 3), units).split("@")[0] +
                " @ " +
                wind[3] +
                "m |",
              wind[4] + "s",
            ];
          }
        } else {
          return [µ.formatVector(wind, units), units.label];
        }
      }
      return [];
    }
    function formatLatitudeAndLongtitude(coord) {
      var signLat = coord[1] >= 0 ? "N" : "S";
      var latitude =
        " " + Math.abs(parseFloat(coord[1]).toFixed(2)) + " " + signLat;

      var signLong = coord[0] >= 0 ? "E" : "W";
      var longitude =
        " " + Math.abs(parseFloat(coord[0]).toFixed(2)) + " " + signLong;
      return {
        latitude: latitude,
        longitude: longitude,
      };
    }

    var pointsArr;
    let arr = [];
    let coorarr = [];
    
    var marked = false;
    var clicked = -1;
    var selected_point = null;
    var currentshiplocation = 0;
    var currentmode = "rl";

    var line_hovered = {
      status: false,
      index: null,
    };

    let previous_state = null;

    //Great circle logic added
    if (currentmode == "rl") {
      d3.select("#rl-route").style("color", "#e2b42e");
    }
    d3.select("#gc-route").on("click", function () {
      currentmode = "gc";
      currentmode == "rl"
        ? (document.getElementById("totaldistance").innerHTML =
            totalrldis.toLocaleString("en-IN") + "km")
        : (document.getElementById("totaldistance").innerHTML =
            totalgcdis.toLocaleString("en-IN") + "km");
      d3.select("#gc-route").style("color", "#e2b42e");
      d3.select("#rl-route").style("color", "white");
      d3.selectAll(".line-route").style("visibility", " hidden");
      d3.selectAll(".gc-route").style("visibility", "visible");

      d3.selectAll(".gc-dist").style("visibility", "visible");
      d3.selectAll(".rl-dist").style("visibility", "hidden");
    });

    d3.select("#rl-route").on("click", function () {
      currentmode = "rl";
      currentmode == "rl"
        ? (document.getElementById("totaldistance").innerHTML =
            totalrldis.toLocaleString("en-IN") + "km")
        : (document.getElementById("totaldistance").innerHTML =
            totalgcdis.toLocaleString("en-IN") + "km");
      d3.select("#rl-route").style("color", "#e2b42e");
      d3.select("#gc-route").style("color", "white");
      d3.selectAll(".line-route").style("visibility", "visible");

      d3.selectAll(".gc-route").style("visibility", " hidden");

      d3.selectAll(".gc-dist").style("visibility", "hidden");
      d3.selectAll(".rl-dist").style("visibility", "visible");
    });

    
    

    const msl_display = ()=>{
      console.log("isobar clicked");
      var xhr = new XMLHttpRequest();
      xhr.open("GET", `./data/output1.tif`, true);

      xhr.responseType = "arraybuffer";
      xhr.onload = function () {
        var tiff = GeoTIFF.parse(this.response);
        var image = tiff.getImage();
        var tiffWidth = image.getWidth();
        var tiffHeight = image.getHeight();
        var rasters = image.readRasters();
        var tiepoint = image.getTiePoints()[0];
        var pixelScale = image.getFileDirectory().ModelPixelScale;
        var geoTransform = [
          tiepoint.x,
          pixelScale[0],
          0,
          tiepoint.y,
          0,
          -1 * pixelScale[1],
        ];

        var pressData = new Array(tiffHeight);
        for (var j = 0; j < tiffHeight; j++) {
          pressData[j] = new Array(tiffWidth);
          for (var i = 0; i < tiffWidth; i++) {
            pressData[j][i] = (rasters[0][i + j * tiffWidth] / 100).toFixed(2);
          }
        }
        var intervals = [972, 980, 988, 996, 1004, 1010, 1020, 1028];
        var isobars = rastertools.isolines(pressData, geoTransform, intervals);

        var width = "100%";
        var height = "100%";

        var path1 = d3.geo.path().projection(globe.projection);
        if (isoToggle) {
          d3.select("#msl_isolines").remove();
          isoToggle = !isoToggle;
        } else {
          isoToggle = !isoToggle;
          var svg = d3
            .select("#foreground")
            .append("svg")
            .attr("id", "msl_isolines")
            .attr("width", width)
            .attr("height", height);

          var maskZones = svg
            .append("defs")
            .append("mask")
            .attr("id", "labelsMask")
            .attr("x", 0)
            .attr("y", 0)
            .attr("width", width)
            .attr("height", height);

          maskZones
            .append("rect")
            .attr("x", 0)
            .attr("y", 0)
            .attr("width", width)
            .attr("height", height)
            .attr("fill", "white");

          isobars.features.forEach(function (d, i) {

            var separation = 300;
            var properties = spp.svgPathProperties(path(d));

            var text = d.properties[0].value;
            var textEl = svg
              .append("text")
              .attr("x", 0)
              .attr("y", 0)
              .style("font-family", "Georgia")

              .text(text)
              .style("visibility", "hidden");

            var bbox = textEl.node().getBBox();

            svg
              .insert("path", ".streamline")
              .datum(d)
              .attr("d", path1)
              .attr("mask", "url(#labelsMask)")
              .style("stroke", "#A9A9A9")
              .style("stroke-width", "2px")
              .style("fill", "None");

            for (
              var j = 0;
              j < Math.floor(properties.getTotalLength() / separation);
              j++
            ) {
              var pos = properties.getPropertiesAtLength(75 + separation * j);
              var degrees =
                (180 / Math.PI) * Math.atan(pos.tangentY / pos.tangentX);

              svg.append("text")
                .attr("font-weight", "normal")
                .style("background-color", "white")
                 .attr("fill", "white")
                .attr("x", -bbox.width / 2)
                .attr("y", 7.5)
                .attr("font-family", "Georgia")
                .attr("font-size", "15px")
                .attr("transform", "translate(" + pos.x + ", " + pos.y + ")rotate(" + degrees + ")")
                .text(text);

              maskZones
                .append("rect")
                .attr("x", -2 - bbox.width / 2)
                .attr("y", -8)
                .attr("width", bbox.width + 4)
                .attr("height", bbox.height)
                .attr("fill", "white")
                .attr(
                  "transform",
                  "translate(" +
                    pos.x +
                    ", " +
                    pos.y +
                    ")rotate(" +
                    degrees +
                    ")"
                );
            }
          });
        }
      };
      xhr.send();
    };

    d3.select("#isobar").on("click", msl_display);

    function gcDistance(lat1, lon1, lat2, lon2) {
      lon1 = (lon1 * Math.PI) / 180;
      lon2 = (lon2 * Math.PI) / 180;
      lat1 = (lat1 * Math.PI) / 180;
      lat2 = (lat2 * Math.PI) / 180;

      let dlon = lon2 - lon1;
      let dlat = lat2 - lat1;
      let a =
        Math.pow(Math.sin(dlat / 2), 2) +
        Math.cos(lat1) * Math.cos(lat2) * Math.pow(Math.sin(dlon / 2), 2);

      let c = 2 * Math.asin(Math.sqrt(a));

      let r = 6371;
      gcdis.push(Math.ceil(c * r));
      totalgcdis = gcdis.reduce((a, b) => a + b, 0);

      currentmode == "rl"
        ? (document.getElementById("totaldistance").innerHTML =
            totalrldis.toLocaleString("en-IN") + "km")
        : (document.getElementById("totaldistance").innerHTML =
            totalgcdis.toLocaleString("en-IN") + "km");

      return Math.ceil(c * r);
    }

   
    
    
    function distance(lat1, lon1, lat2, lon2) {
      let R = 6371;

      var φ2 = (Math.PI * lat2) / 180;
      var φ1 = (Math.PI * lat1) / 180;

      var Δφ = φ1 - φ2;
      var Δλ = (Math.PI * (lon1 - lon2)) / 180;
      const Δψ = Math.log(
        Math.tan(Math.PI / 4 + φ2 / 2) / Math.tan(Math.PI / 4 + φ1 / 2)
      );
      const q = Math.abs(Δψ) > 10e-12 ? Δφ / Δψ : Math.cos(φ1); // E-W course becomes ill-conditioned with 0/0

      // if dLon over 180° take shorter rhumb line across the anti-meridian:
      if (Math.abs(Δλ) > Math.PI)
        Δλ = Δλ > 0 ? -(2 * Math.PI - Δλ) : 2 * Math.PI + Δλ;

      const dist = Math.sqrt(Δφ * Δφ + q * q * Δλ * Δλ) * R;
      rldis.push(Math.ceil(dist));

      totalrldis = rldis.reduce((a, b) => a + b, 0);
     
     
      
  
      currentmode == "rl"
        ? (document.getElementById("totaldistance").innerHTML =
            totalrldis.toLocaleString("en-IN") + "km")
        : (document.getElementById("totaldistance").innerHTML =
            totalgcdis.toLocaleString("en-IN") + "km");

      return Math.ceil(dist);
    }
  
    var getMid = (coorarr1) => {
      let m =
        (coorarr1[coorarr1.length - 1][0] - coorarr1[coorarr1.length - 2][0]) /
        (coorarr1[coorarr1.length - 1][1] - coorarr1[coorarr1.length - 2][1]);
      m = 1 / m;

      var angleRad = Math.atan(m);
      var angleDeg = (angleRad * 180) / Math.PI;

      var midx =
        (coorarr1[coorarr1.length - 2][0] + coorarr1[coorarr1.length - 1][0]) /
        2;
      var midy =
        (coorarr1[coorarr1.length - 2][1] + coorarr1[coorarr1.length - 1][1]) /
        2;

      d3.select(`#rl-distance-${coorarr1.length - 1}`).attr(
        "style",
        `transform:rotateZ(${angleDeg}deg);transform-origin:${midx}px ${midy}px`
      );

      d3.select(`#gc-distance-${coorarr1.length - 1}`).attr(
        "style",
        `transform:rotateZ(${angleDeg}deg);transform-origin:${midx}px ${midy}px`
      );

      return [
        (coorarr1[coorarr1.length - 2][0] + coorarr1[coorarr1.length - 1][0]) /
          2 -
          10,
        (coorarr1[coorarr1.length - 2][1] + coorarr1[coorarr1.length - 1][1]) /
          2,
      ];
    };

    var getMidGC = (arr1) => {
      var φ1 = (arr1[arr1.length - 2][1] * Math.PI) / 180;
      var λ1 = (arr1[arr1.length - 2][0] * Math.PI) / 180;
      var φ2 = (arr1[arr1.length - 1][1] * Math.PI) / 180;
      var λ2 = (arr1[arr1.length - 1][0] * Math.PI) / 180;
      const Bx = Math.cos(φ2) * Math.cos(λ2 - λ1);
      const By = Math.cos(φ2) * Math.sin(λ2 - λ1);
      const φ3 = Math.atan2(
        Math.sin(φ1) + Math.sin(φ2),
        Math.sqrt((Math.cos(φ1) + Bx) * (Math.cos(φ1) + Bx) + By * By)
      );
      const λ3 = λ1 + Math.atan2(By, Math.cos(φ1) + Bx);
    };

    var insertDistance = (arr1, coorarr1) => {
      d3
        .select("#line-" + (arr1.length - 1))
        .append("text")
        .attr("id", `rl-distance-${arr1.length - 1}`)
        .attr("class", `rl-dist distance distance-${arr1.length - 1}`)
        .attr("x", getMid(coorarr1)[0] + 10)
        .attr("y", getMid(coorarr1)[1] + 15)
        .style("font-size", "12px")
        .style("visibility", currentmode === "rl" ? "visible" : "hidden")
        .node().innerHTML =
        distance(
          arr1[arr1.length - 2][1],
          arr1[arr1.length - 2][0],
          arr1[arr1.length - 1][1],
          arr1[arr1.length - 1][0]
        ) + "KM";

      d3
        .select("#foreground")
        .insert("text", "#gc-line" + arr1.length)
        .attr("id", `gc-distance-${arr1.length - 1}`)
        .attr("class", `gc-dist distance distance-${arr1.length - 1}`)
        .attr("x", getMid(coorarr1)[0] + 10)
        .attr("y", getMid(coorarr1)[1] + 15)
        .style("font-size", "12px")
        .style("visibility", currentmode === "gc" ? "visible" : "hidden")
        .node().innerHTML =
        gcDistance(
          arr1[arr1.length - 2][1],
          arr1[arr1.length - 2][0],
          arr1[arr1.length - 1][1],
          arr1[arr1.length - 1][0]
        ) + "KM";

      drawFunctionTable();
    };

    var symbolselected=false;
    d3.select("#dangerdot").on("click",()=>{
      console.log("hit");
      symbolselected=true;
    })

  
  var arrstring=localStorage.getItem("arr");
  arrstring = arrstring.replaceAll("[", "");
  arrstring=arrstring.replaceAll("]","");
  arrstring = arrstring.split(',');
  let temparr=[];
  for(var i=0;i<arrstring.length;i+=2)
  {
    temparr.push([parseFloat(arrstring[i]),parseFloat(arrstring[i+1])]);
  }
 

var coorarrstring=localStorage.getItem("coorarr");
  coorarrstring = coorarrstring.replaceAll("[", "");
  coorarrstring=coorarrstring.replaceAll("]","");
  coorarrstring = coorarrstring.split(',');
  let tempcoorarr=[];
  for(var i=0;i<coorarrstring.length;i+=2)
  {
    tempcoorarr.push([parseFloat(coorarrstring[i]),parseFloat(coorarrstring[i+1])]);
  }
  
  
  var click=false;
  
    function drawLocationMark(point, coord) {
      
      if(click==false)
      {
        arr=temparr;
        coorarr=tempcoorarr;
        redrawTable();
        redrawPath();
        click=true;

      }
   
   
      return;

      // show the location on the map if defined
      if (
        fieldAgent.value() &&
        !fieldAgent.value().isInsideBoundary(point[0], point[1])
      ) {
        // UNDONE: Sometimes this is invoked on an old, released field, because new one has not been
        //         built yet, causing the mark to not get drawn.
        return; // outside the field boundary, so ignore.
      }
      if (coord && _.isFinite(coord[0]) && _.isFinite(coord[1])) {

       
        d3.select("#insert_point_blank").style("display", "none");

        let oldpoints = d3.selectAll(".location-mark");
        let crossmarks = d3.selectAll(".cross-mark");
        for (let i = 0; i < crossmarks[0].length; i++) {
          let x = crossmarks[0][i].getBoundingClientRect().left + 7;
          let y = crossmarks[0][i].getBoundingClientRect().top + 7;

          if (
            Math.abs(x - point[0]) <= 5 &&
            Math.abs(y - point[1]) <= 5 &&
            selected_point === null
          ) {
            return;
          }
        }

        if (line_hovered.status) {
          arr.splice(line_hovered.index - 1, 0, coord);
          coorarr.splice(line_hovered.index - 1, 0, point);
          line_hovered = {
            status: false,
            index: null,
          };
          redrawTable();
          redrawPath();
          return;
        }

        
        if (selected_point !== null) {
          arr[clicked] = coord;
          coorarr[clicked] = point;
          d3.select(`.location-mark-${clicked + 1}`)
            .datum({ type: "Point", coordinates: coord })
            .attr("d", path)
            .style("fill", "#D32F2F")
            .style("stroke", "#D32F2F");

          // .attr("fill", "green");
          d3.select(`.text-mark-${clicked + 1}`)
            .attr("x", point[0] - 5)
            .attr("y", point[1] + 6);

          d3.select(`.cross-mark-${clicked + 1}`)
            .attr("x", point[0] + 7)
            .attr("y", point[1] + 7);

          if (currentshiplocation == clicked) {
            d3.select(".ship")
              .datum({
                type: "Point",
                coordinates: [coord[0] - 1.5, coord[1] - 1.5],
              })
              .attr("d", path);
            moveShip();
          }
          if (d3.select("#break-point-" + clicked).node() !== null) {
            var formattedCoordinates = formatLatitudeAndLongtitude(coord);
            d3.select("#break-point-" + clicked).node().value =
              formattedCoordinates["latitude"] +
              " , " +
              formattedCoordinates["longitude"];
            var [val, unit] = getWindAtLocation(coord);
            d3
              .select("#weather-data-" + clicked)
              .node().value = `${val} ${unit}`;
          }

          /* d3.select("#foreground")
            .append("g")
            .attr("id", `div-mark-${clicked + 1}`)
            .append("path")
            .attr("class", `location-mark location-mark-${clicked + 1}`)
            .datum({ type: "Point", coordinates: coord })
            .attr("d", path)
            .attr("fill", "none"); */
          //oldpoints[0][clicked] = d3.select(`.location-mark-${clicked + 1}`);
          if (clicked !== 0 && clicked !== oldpoints[0].length - 1) {
            console.log("CLicked: ", clicked);
            rldis = [];
            gcdis = [];
            totaltimetaken=0;

            let x_previous =
              oldpoints[0][clicked - 1].getBoundingClientRect().left + 7;
            let y_previous =
              oldpoints[0][clicked - 1].getBoundingClientRect().top + 7;
            let x_next =
              oldpoints[0][clicked + 1].getBoundingClientRect().left + 7;
            let y_next =
              oldpoints[0][clicked + 1].getBoundingClientRect().top + 7;
            d3.select("#line-" + clicked)
              .select(`.location-line-${clicked + 1}`)
              .datum({
                type: "Line",
                data: [
                  [x_previous, y_previous],
                  [point[0], point[1]],
                ],
              })
              .attr(
                "d",
                d3.svg.line()([
                  [x_previous, y_previous],
                  [point[0], point[1]],
                ])
              )
              .attr(
                "value",
                d3.svg.line()([
                  [x_previous, y_previous],
                  [point[0], point[1]],
                ])
              );

            d3.selectAll(".gc-dist").remove();
            d3.selectAll(".rl-dist").remove();

            for (let j = 2; j <= arr.length; j++) {
              insertDistance(arr.slice(0, j), coorarr.slice(0, j));
            }

            d3.select(`#line-${clicked + 1}`)
              .select(`.location-line-${clicked + 2}`)
              .datum({
                type: "Line",
                data: [
                  [point[0], point[1]],
                  [x_next, y_next],
                ],
              })
              .attr(
                "d",
                d3.svg.line()([
                  [point[0], point[1]],
                  [x_next, y_next],
                ])
              )
              .attr(
                "value",
                d3.svg.line()([
                  [point[0], point[1]],
                  [x_next, y_next],
                ])
              );
           
          } else if (clicked === 0) {
            d3.selectAll(".gc-dist").remove();
            d3.selectAll(".rl-dist").remove();
            rldis = [];
            gcdis = [];
            totaltimetaken=0;

            for (let j = 2; j <= arr.length; j++) {
              insertDistance(arr.slice(0, j), coorarr.slice(0, j));
            }

            if (arr.length > 1) {
              let x_next =
                oldpoints[0][clicked + 1].getBoundingClientRect().left + 7;
              let y_next =
                oldpoints[0][clicked + 1].getBoundingClientRect().top + 7;
              d3.select(`#line-${clicked + 1}`)
                .select(`.location-line-${clicked + 2}`)
                .datum({
                  type: "Line",
                  data: [
                    [point[0], point[1]],
                    [x_next, y_next],
                  ],
                })
                .attr(
                  "d",
                  d3.svg.line()([
                    [point[0], point[1]],
                    [x_next, y_next],
                  ])
                )
                .attr(
                  "value",
                  d3.svg.line()([
                    [point[0], point[1]],
                    [x_next, y_next],
                  ])
                );

              var link = {
                type: "LineString",
                coordinates: [arr[clicked + 1], coord],
              };
              d3.select("#gc-line" + (clicked + 2)).attr("d", path(link));
            }
            pointsArr = point;
          } else if (clicked === oldpoints[0].length - 1) {
            rldis = [];
            gcdis = [];
            totaltimetaken=0;
            d3.selectAll(".gc-dist").remove();
            d3.selectAll(".rl-dist").remove();
            for (let j = 2; j <= arr.length; j++) {
              insertDistance(arr.slice(0, j), coorarr.slice(0, j));
            }

            let x_previous =
              oldpoints[0][clicked - 1].getBoundingClientRect().left + 7;
            let y_previous =
              oldpoints[0][clicked - 1].getBoundingClientRect().top + 7;
            d3.select("#line-" + clicked)
              .select(`.location-line-${clicked + 1}`)
              .datum({
                type: "Line",
                data: [
                  [x_previous, y_previous],
                  [point[0], point[1]],
                ],
              })
              .attr(
                "d",
                d3.svg.line()([
                  [x_previous, y_previous],
                  [point[0], point[1]],
                ])
              )
              .attr(
                "value",
                d3.svg.line()([
                  [x_previous, y_previous],
                  [point[0], point[1]],
                ])
              );
            pointsArr = point;

            var link = {
              type: "LineString",
              coordinates: [arr[clicked - 1], coord],
            };
            d3.select("#gc-line" + (clicked + 1)).attr("d", path(link));
          }
          selected_point = null;
          clicked = -1;
          drawFunctionTable();
          return;
        }

        arr = [...arr, coord];
        coorarr = [...coorarr, point];
        
          velocityarr=[...velocityarr,0];
        
  
         
          
        

        if (arr.length > 1) {
          d3.select(`#div-mark-${arr.length - 1}`).remove();
          const index = arr.length;
          d3.select("#foreground")
            .append("g")
            .attr("id", "line-" + (arr.length - 1))
            .attr("class", "line-route")
            .append("path")
            .attr("class", `location-line location-line-${arr.length}`)
            .datum({
              type: "Line",
              data: [
                [point[0], point[1]],
                [pointsArr[0], pointsArr[1]],
              ],
            })
            .attr(
              "d",
              d3.svg.line()([
                [point[0], point[1]],
                [pointsArr[0], pointsArr[1]],
              ])
            )
            .attr(
              "value",
              d3.svg.line()([
                [point[0], point[1]],
                [pointsArr[0], pointsArr[1]],
              ])
            )
            .on("click", () => {
              console.log("Line Clicked");
            })
            .on("mouseover", () => {
              d3.select(`.location-line-${index}`).attr(
                "class",
                `location-line location-line-${index} line-hovered`
              );
              line_hovered = {
                status: true,
                index: index,
              };
            })
            .on("mouseout", () => {
              d3.select(`.location-line-${index}`).attr(
                "class",
                `location-line location-line-${index}`
              );
              line_hovered = {
                status: false,
                index: null,
              };
            });

          insertDistance(arr, coorarr);

          var link = {
            type: "LineString",
            coordinates: [arr[arr.length - 2], arr[arr.length - 1]],
          };
          d3.select("#foreground")
            .append("path")
            .attr("id", "gc-line" + arr.length)
            .attr("d", path(link))
            .attr("class", "gc-route")
            .style("fill", "none")
            .style("stroke", "orange")
            .style("stroke-width", 4);

          let mark = d3
            .select("#foreground")
            .append("g")
            .attr("id", `div-mark-${arr.length - 1}`)
            .attr("class", "div-mark")
            .attr("name", `div-mark-${arr.length - 1}`)
            .append("path")
            .attr("class", `location-mark location-mark-${arr.length - 1}`)
            .datum({ type: "Point", coordinates: arr[arr.length - 2] })
            .attr("d", path);
          d3
            .select(`#div-mark-${arr.length - 1}`)
            .append("text")
            .attr("class", `text-mark text-mark-${arr.length - 1}`)
            .attr("x", coorarr[coorarr.length - 2][0] - 5)
            .attr("y", coorarr[coorarr.length - 2][1] + 6)
            .node().innerHTML = arr.length - 1;

          const delete_index = arr.length - 1;
          
          let cross_tg = d3.select(`.cross-mark-${delete_index}`);
          d3.select(`#div-mark-${delete_index}`)
            .on("mouseover", () => {
              cross_tg.style("opacity", 1);
            })
            .on("mouseleave", () => {
              cross_tg.style("opacity", 0);
            });
        }
        if (arr.length == 1) {
          /* d3.select("#foreground")
            .append("g")
            .attr("id", "ship")
            .append("path")
            .attr("class", `ship`)
            .datum({
              type: "Point",
              coordinates: [arr[0][0] - 1.5, arr[0][1] - 1.5],
            })
            .attr("d", path); */
          plotShip(coorarr[0][0], coorarr[0][1]);
        }

        let mark = d3
          .select("#foreground")
          .append("g")
          .attr("id", `div-mark-${arr.length}`)
          .attr("class", "div-mark")
          .attr("name", `div-mark-${arr.length}`)
          .append("path")
          .attr("class", `location-mark location-mark-${arr.length}`)
          .datum({ type: "Point", coordinates: coord })
          .attr("d", path);

        d3
          .select(`#div-mark-${arr.length}`)
          .append("text")
          .attr("class", `text-mark text-mark-${arr.length}`)
          .attr("x", point[0] - 5)
          .attr("y", point[1] + 6)
          .node().innerHTML = arr.length;

        const delete_index = arr.length;

        
        var cross_tg = d3.select(`.cross-mark-${arr.length}`);
        d3.select(`#div-mark-${arr.length}`)
          .on("mouseover", () => {
            cross_tg.style("opacity", 1);
          })
          .on("mouseleave", () => {
            cross_tg.style("opacity", 0);
          });
        redrawTable();

        d3.select(`.nextlocation`).on("click", function () {
          console.log("Next Location");
          if (currentshiplocation < arr.length - 1) {
            currentshiplocation++;
            d3.select(".ship")
              .datum({
                type: "Point",
                coordinates: [
                  arr[currentshiplocation][0] - 1.5,
                  arr[currentshiplocation][1] - 1.5,
                ],
              })
              .attr("d", path);
            moveShip();
          }
        });

        d3.select(`.sourcelocation`).on("click", function () {
          currentshiplocation = 0;
          d3.select(".ship")
            .datum({
              type: "Point",
              coordinates: [
                arr[currentshiplocation][0] - 1.5,
                arr[currentshiplocation][1] - 1.5,
              ],
            })
            .attr("d", path);
          moveShip();
        });

        d3.select(`.destinationlocation`).on("click", function () {
          currentshiplocation = arr.length - 1;
          d3.select(".ship")
            .datum({
              type: "Point",
              coordinates: [
                arr[currentshiplocation][0] - 1.5,
                arr[currentshiplocation][1] - 1.5,
              ],
            })
            .attr("d", path);
          moveShip();
        });

        d3.select(`.previouslocation`).on("click", function () {
          if (currentshiplocation > 0) {
            currentshiplocation--;
            d3.select(".ship")
              .datum({
                type: "Point",
                coordinates: [
                  arr[currentshiplocation][0] - 1.5,
                  arr[currentshiplocation][1] - 1.5,
                ],
              })
              .attr("d", path);
            moveShip();
          }
        });

        pointsArr = point;
        var formattedCoordinates = formatLatitudeAndLongtitude(coord);

        // if (arr.length >= breakpoints) addCoorRow();

        if (d3.select("#break-point-" + (arr.length - 1)).node() != null) {
          d3.select("#break-point-" + (arr.length - 1)).node().value =
            formattedCoordinates["latitude"] +
            " , " +
            formattedCoordinates["longitude"];
          var [val, unit] = getWindAtLocation(coord);
          d3
            .select("#weather-data-" + (arr.length - 1))
            .node().value = `${val} ${unit}`;
        }

        if (currentmode == "gc") {
          d3.selectAll(".line-route").style("visibility", " hidden");

          d3.selectAll(".gc-route").style("visibility", "visible");
        } else {
          d3.selectAll(".line-route").style("visibility", "visible");

          d3.selectAll(".gc-route").style("visibility", " hidden");
        }
        drawFunctionTable();
        return mark;
      }
    }

    
  
    

    

  

 
    const redrawPath = () => {
      console.log("redrawpath called");
      d3.selectAll(".div-mark").remove();
      d3.selectAll(".line-route").remove();
      d3.selectAll(".text-mark").remove();
      d3.selectAll(".cross-mark").remove();
      d3.selectAll(".gc-route").remove();
      d3.selectAll(".gc-dist").remove();
      d3.select("#new_ship").remove();

      for (let i = 0; i < arr.length; i++) {
        if (i > 0) {
          d3.select(`#div-mark-${i}`).remove();

          d3.select("#foreground")
            .append("g")
            .attr("id", "line-" + i)
            .attr("class", "line-route")
            .append("path")
            .attr("class", `location-line location-line-${i + 1}`)
            .datum({
              type: "Line",
              data: [
                [coorarr[i][0], coorarr[i][1]],
                [coorarr[i - 1][0],coorarr[i - 1][1]],
              ],
            })
            .attr(
              "d",
              d3.svg.line()([
                [coorarr[i][0], coorarr[i][1]],
                [coorarr[i - 1][0], coorarr[i - 1][1]],
              ])
            )
            .attr(
              "value",
              d3.svg.line()([
                [coorarr[i][0], coorarr[i][1]],
                [coorarr[i - 1][0], coorarr[i - 1][1]],
              ])
            )
            .on("mouseover", () => {
              d3.select(`.location-line-${i + 1}`).attr(
                "class",
                `location-line location-line-${i + 1} line-hovered`
              );
              line_hovered = {
                status: true,
                index: i + 1,
              };
            })
            .on("mouseout", () => {
              d3.select(`.location-line-${i + 1}`).attr(
                "class",
                `location-line location-line-${i + 1}`
              );
              line_hovered = {
                status: false,
                index: null,
              };
            });
          var link = {
            type: "LineString",
            coordinates: [arr[i - 1], arr[i]],
          };
          d3.select("#foreground")
            .append("path")
            .attr("id", "gc-line" + i)
            .attr("d", path(link))
            .attr("class", "gc-route")
            .style("fill", "none")
            .style("stroke", "orange")
            .style("stroke-width", 4);

          d3.select("#foreground")
            .append("g")
            .attr("id", `div-mark-${i}`)
            .attr("class", "div-mark")
            .attr("name", `div-mark-${i}`)
            .append("path")
            .attr("class", `location-mark location-mark-${i}`)
            .datum({ type: "Point", coordinates: arr[i - 1] })
            .attr("d", path);

          if (i == 0) {
           
            if (currentshiplocation < 0 || currentshiplocation >= arr.length) {
              currentshiplocation = 0;
            }
            plotShip(
              tempcoorarr[currentshiplocation][0],
              tempcoorarr[currentshiplocation][1]
            );
          }

          d3
            .select(`#div-mark-${i}`)
            .append("text")
            .attr("class", `text-mark text-mark-${i}`)
            .attr("x", coorarr[i - 1][0] - 2)
            .attr("y", coorarr[i - 1][1] + 9)
            .node().innerHTML = i;

          

          let cross_tg1 = d3.select(`.cross-mark-${i}`);
          d3.select(`#div-mark-${i}`)
            .on("mouseover", () => {
              cross_tg1.style("opacity", 1);
            })
            .on("mouseleave", () => {
              cross_tg1.style("opacity", 0);
            });
        }
        d3.select("#foreground")
          .append("g")
          .attr("id", `div-mark-${i + 1}`)
          .attr("class", "div-mark")
          .attr("name", `div-mark-${i + 1}`)
          .append("path")
          .attr("class", `location-mark location-mark-${i + 1}`)
          .datum({ type: "Point", coordinates: arr[i] })
          .attr("d", path);

        if (i == 0) {
          /* d3.select("#foreground")
            .append("g")
            .attr("id", "ship")
            .append("path")
            .attr("class", `ship`)
            .datum({
              type: "Point",
              coordinates: [arr[0][0] - 1.5, arr[0][1] - 1.5],
            })
            .attr("d", path); */
          if (currentshiplocation < 0 || currentshiplocation >= arr.length) {
            currentshiplocation = 0;
          }
          plotShip(
            coorarr[currentshiplocation][0],
            coorarr[currentshiplocation][1]
          );
        }

        d3
          .select(`#div-mark-${i + 1}`)
          .append("text")
          .attr("class", `text-mark text-mark-${i + 1}`)
          .attr("x", coorarr[i][0] - 2)
          .attr("y", coorarr[i][1] + 9)
          .node().innerHTML = i + 1;

        

        let cross_tg1 = d3.select(`.cross-mark-${i + 1}`);
        d3.select(`#div-mark-${i + 1}`)
          .on("mouseover", () => {
            cross_tg1.style("opacity", 1);
          })
          .on("mouseleave", () => {
            cross_tg1.style("opacity", 0);
          });
      }
      if (currentmode == "gc") {
        d3.selectAll(".line-route").style("visibility", " hidden");

        d3.selectAll(".gc-route").style("visibility", "visible");
      } else {
        d3.selectAll(".line-route").style("visibility", "visible");

        d3.selectAll(".gc-route").style("visibility", " hidden");
      }
      if (arr.length > 1) {
        for (let j = 2; j <= arr.length; j++) {
          insertDistance(arr.slice(0, j), coorarr.slice(0, j));
        }
      }
      drawFunctionTable();
    };

    const plotShip = (x, y) => {
      let c = d3.select("#foreground").append("g").attr("id", "new_ship");
      c.append("circle")
        .attr("id", "new_circle_ship_0")
        .attr("class", "new_circle_ship blink_ship")
        .attr("r", "5")
        .attr("cx", x)
        .attr("cy", y);
      c.append("circle")
        .attr("id", "new_circle_ship_1")
        .attr("class", "new_circle_ship_rings blink_ship")
        .attr("r", "5")
        .attr("cx", x)
        .attr("cy", y);
      c.append("circle")
        .attr("id", "new_circle_ship_2")
        .attr("class", "new_circle_ship_rings blink_ship")
        .attr("r", "9")
        .attr("cx", x)
        .attr("cy", y);
      c.append("circle")
        .attr("id", "new_circle_ship_3")
        .attr("class", "new_circle_ship_rings blink_ship")
        .attr("r", "13")
        .attr("cx", x)
        .attr("cy", y);
      c.append("circle")
        .attr("id", "new_circle_ship_4")
        .attr("class", "new_circle_ship_rings blink_ship")
        .attr("r", "17")
        .attr("cx", x)
        .attr("cy", y);
      c.append("circle")
        .attr("id", "new_circle_ship_5")
        .attr("class", "new_circle_ship_rings blink_ship")
        .attr("r", "21")
        .attr("cx", x)
        .attr("cy", y);
      c.append("circle")
        .attr("id", "new_circle_ship_6")
        .attr("class", "new_circle_ship_rings blink_ship")
        .attr("r", "25")
        .attr("cx", x)
        .attr("cy", y);
    };

    let px = null,
      py = null;
    let pd = null;

    const moveShip = () => {
      console.log("Moving ship");
      d3.select("#new_circle_ship_1")
        .attr("cx", coorarr[currentshiplocation][0])
        .attr("cy", coorarr[currentshiplocation][1]);
      d3.select("#new_circle_ship_2")
        .attr("cx", coorarr[currentshiplocation][0])
        .attr("cy", coorarr[currentshiplocation][1]);
      d3.select("#new_circle_ship_3")
        .attr("cx", coorarr[currentshiplocation][0])
        .attr("cy", coorarr[currentshiplocation][1]);
      d3.select("#new_circle_ship_4")
        .attr("cx", coorarr[currentshiplocation][0])
        .attr("cy", coorarr[currentshiplocation][1]);
      d3.select("#new_circle_ship_5")
        .attr("cx", coorarr[currentshiplocation][0])
        .attr("cy", coorarr[currentshiplocation][1]);
      d3.select("#new_circle_ship_6")
        .attr("cx", coorarr[currentshiplocation][0])
        .attr("cy", coorarr[currentshiplocation][1]);
      d3.select("#new_circle_ship_0")
        .attr("cx", coorarr[currentshiplocation][0])
        .attr("cy", coorarr[currentshiplocation][1]);
    };
    let inc_arr = [];
    const drawFunctionTable = () => {
      pd = 0;
      d3.select("#myRange").remove();
      d3.selectAll(".distance_marker_table").remove();
      d3.selectAll(".distance_marker_txt_table").remove();
      d3.selectAll("#data_btns_row").remove();
      let max = 0;
      inc_arr = [];
      let temp = 0;

      for (let i = 0; i < rldis.length; i++) {
        max += rldis[i];
        inc_arr.push(temp);
        temp = rldis[i] + inc_arr[inc_arr.length - 1];
      }

      inc_arr.push(temp);

      let divs = max;
      let divider = 500;
      if (max <= 10000) {
        divs = divs / 500;
        divider = 500;
      } else if (max > 10000 && max <= 20000) {
        divs = divs / 1000;
        divider = 1000;
      } else {
        divs = divs / 5000;
        divider = 5000;
      }
      for (let i = 0; i < divs; i++) {
        d3
          .select("#table_distance_marker_meter")
          .append("span")
          .attr("class", "distance_marker_table")
          .node().innerHTML = `<h5>|</h5><h6>${(i * divider).toLocaleString(
          "en-IN"
        )} Km</h6>  `;
      }

      document.getElementById("demo").innerHTML = "0 km";

      d3.select(".functionality_table")
        .append("input")
        .attr("class", "slider_distance")
        .attr("id", "myRange")
        .attr("type", "range")
        .attr("min", 0)
        .attr("max", max);
      document.getElementById("myRange").oninput = () => {
        let d = document.getElementById("myRange").value;
        for (let i = 0; i < inc_arr.length; i++) {
          if (d >= inc_arr[i]) {
            d3.select(`.data_btn-${currentshiplocation}`).attr(
              "class",
              `data_btns data_btn-${currentshiplocation}`
            );
            currentshiplocation = i;
            d3.select(`.data_btn-${currentshiplocation}`).attr(
              "class",
              `data_btns data_btn-${currentshiplocation} data_btn_selected`
            );
            moveShip();
          }
        }
        if (currentshiplocation < (arr.length - 1)) {
          let x1 = coorarr[currentshiplocation][0];
          let y1 = coorarr[currentshiplocation][1];
          let td = Math.sqrt(
            Math.pow(
              coorarr[currentshiplocation + 1][0] -
                coorarr[currentshiplocation][0],
              2
            ) +
              Math.pow(
                coorarr[currentshiplocation + 1][1] -
                  coorarr[currentshiplocation][1],
                2
              )
          );
          let m =
            (coorarr[currentshiplocation + 1][0] -
              coorarr[currentshiplocation][0]) /
            (coorarr[currentshiplocation + 1][1] -
              coorarr[currentshiplocation][1]);
          m = 1 / m; // Important please donot change

          d = d - inc_arr[currentshiplocation];

          let ds = td * (d / rldis[currentshiplocation]);
          if (
            (coorarr[currentshiplocation + 1][0] -
              coorarr[currentshiplocation][0] <
              0 &&
              coorarr[currentshiplocation + 1][1] -
                coorarr[currentshiplocation][1] >
                0) ||
            (coorarr[currentshiplocation + 1][0] -
              coorarr[currentshiplocation][0] <
              0 &&
              coorarr[currentshiplocation + 1][1] -
                coorarr[currentshiplocation][1] <
                0)
          ) {
            ds = -ds;
          }
          let x, y;

          if (m === Infinity) {
            {
              x = x1;
              y = y1 + ds;
            }
          } else {
            {
              x = x1 + ds / Math.sqrt(1 + Math.pow(m, 2));
              y = y1 + m * (x - x1);
            }
          }
          d3.selectAll(".blink_ship").attr("cx", x).attr("cy", y);
        }
        var dis = parseInt(
          document.getElementById("myRange").value
        ).toLocaleString("en-IN");
        document.getElementById("demo").innerHTML = dis + " km";
      };

      d3.select(".functionality_table")
        .append("div")
        .attr("id", "data_btns_row");

      d3.select("#data_btns_row").append("p")
      .attr("id","data_points_text")
      .node().innerHTML ="Data Points: "


      for (let j = 0; j < arr.length; j++) {
        const [a, b] = getWindAtLocation(arr[j]);
        d3
          .select("#data_btns_row")
          .append("button")
          .attr("class", `data_btns data_btn-${j}`)
          .node().innerHTML = `${a}, ${b}`;
      }

      if (arr.length > 0) {
        d3.select(`.data_btn-${0}`).attr(
          "class",
          `data_btns data_btn-${0} data_btn_selected`
        );
      }
    };

    d3.select("#table_btn").on("click", () => {
      drawFunctionTable();

      d3.select(".functionality_table").classed(
        "invisible",
        !d3.select(".functionality_table").classed("invisible")
      );

      d3.select(".time_slider").classed(
        "invisible",
        !d3.select(".time_slider").classed("invisible")
      );


      d3.select("#menu").classed(
        "invisible",
        !d3.select("#menu").classed("invisible")
      );
    });

    const deletePoint = (index) => {
      rldis = [];
      gcdis = [];
      totaltimetaken=0;
      previous_state = {
        operation: "DELETE",
        index: index,
        point: coorarr[index],
        coord: arr[index],
      };
      /* if (currentshiplocation == index && index + 1 < arr.length) {
        d3.select(".ship")
          .datum({
            type: "Point",
            coordinates: [arr[index + 1][0] - 1.5, arr[index + 1][1] - 1.5],
          })
          .attr("d", path);

        currentshiplocation++;
      } else if (currentshiplocation == index && index != 0) {
        d3.select(".ship")
          .datum({
            type: "Point",
            coordinates: [arr[index - 1][0] - 1.5, arr[index - 1][1] - 1.5],
          })
          .attr("d", path);

        currentshiplocation--;
      } else if (currentshiplocation == index && index == 0) {
        d3.select(".ship").remove();
      } */
      let init = currentshiplocation;
      if (currentshiplocation === index) {
        d3.select("#new_ship").remove();
        if (index === arr.length - 1 && arr.length > 1) {
          currentshiplocation = arr.length - 2;
        } else if (index === 0) {
          currentshiplocation = 0;
        } else {
          currentshiplocation = index - 1;
        }
      }

      breakpoints--;
      // addCoorRow()

      if (index === coorarr.length - 1) {
        if (index > 0) {
          pointsArr = coorarr[index - 1];
        } else {
          pointsArr = null;
        }
      }
      arr.splice(index, 1);
      redrawTable();

      coorarr.splice(index, 1);
      d3.selectAll(".div-mark").remove();
      d3.selectAll(".line-route").remove();
      d3.selectAll(".text-mark").remove();
      d3.selectAll(".cross-mark").remove();
      d3.selectAll(".gc-route").remove();
      d3.selectAll(".gc-dist").remove();

      if (init === index) {
        if (arr.length > 1) {
          plotShip(
            coorarr[currentshiplocation][0],
            coorarr[currentshiplocation][1]
          );
        } else {
          currentshiplocation = -1;
        }
      }

      for (let i = 0; i < arr.length; i++) {
        if (i > 0) {
          d3.select(`#div-mark-${i}`).remove();
          d3.select(`#gc-line-${i + 1}`).remove();
          d3.select("#foreground")
            .append("g")
            .attr("id", "line-" + i)
            .attr("class", "line-route")
            .append("path")
            .attr("class", `location-line location-line-${i + 1}`)
            .datum({
              type: "Line",
              data: [
                [coorarr[i][0], coorarr[i][1]],
                [coorarr[i - 1][0], coorarr[i - 1][1]],
              ],
            })
            .attr(
              "d",
              d3.svg.line()([
                [coorarr[i][0], coorarr[i][1]],
                [coorarr[i - 1][0], coorarr[i - 1][1]],
              ])
            )
            .attr(
              "value",
              d3.svg.line()([
                [coorarr[i][0], coorarr[i][1]],
                [coorarr[i - 1][0], coorarr[i - 1][1]],
              ])
            )
            .on("mouseover", () => {
              d3.select(`.location-line-${i + 1}`).attr(
                "class",
                `location-line location-line-${i + 1} line-hovered`
              );
              line_hovered = {
                status: true,
                index: i + 1,
              };
            })
            .on("mouseout", () => {
              d3.select(`.location-line-${i + 1}`).attr(
                "class",
                `location-line location-line-${i + 1}`
              );
              line_hovered = {
                status: false,
                index: null,
              };
            });

          // gc code
          var link = { type: "LineString", coordinates: [arr[i], arr[i - 1]] };
          d3.select("#foreground")
            .append("path")
            .attr("id", "gc-line" + (i + 1))
            .attr("d", path(link))
            .attr("class", "gc-route")
            .style("fill", "none")
            .style("stroke", "orange")
            .style("stroke-width", 4);

          d3.select("#foreground")
            .append("g")
            .attr("id", `div-mark-${i}`)
            .attr("class", "div-mark")
            .attr("name", `div-mark-${i}`)
            .append("path")
            .attr("class", `location-mark location-mark-${i}`)
            .datum({ type: "Point", coordinates: arr[i - 1] })
            .attr("d", path);

          d3
            .select(`#div-mark-${i}`)
            .append("text")
            .attr("class", `text-mark text-mark-${i}`)
            .attr("x", coorarr[i - 1][0] - 2)
            .attr("y", coorarr[i - 1][1] + 8)
            .node().innerHTML = i;

         
          let cross_tg = d3.select(`.cross-mark-${i}`);
          d3.select(`#div-mark-${i}`)
            .on("mouseover", () => {
              cross_tg.style("opacity", 1);
            })
            .on("mouseleave", () => {
              cross_tg.style("opacity", 0);
            });
        }
        d3.select("#foreground")
          .append("g")
          .attr("id", `div-mark-${i + 1}`)
          .attr("class", "div-mark")
          .attr("name", `div-mark-${i + 1}`)
          .append("path")
          .attr("class", `location-mark location-mark-${i + 1}`)
          .datum({ type: "Point", coordinates: arr[i] })
          .attr("d", path);

        d3
          .select(`#div-mark-${i + 1}`)
          .append("text")
          .attr("class", `text-mark text-mark-${i + 1}`)
          .attr("x", coorarr[i][0] - 2)
          .attr("y", coorarr[i][1] + 8)
          .node().innerHTML = i + 1;

        
        let cross_tg = d3.select(`.cross-mark-${i + 1}`);
        d3.select(`#div-mark-${i + 1}`)
          .on("mouseover", () => {
            cross_tg.style("opacity", 1);
          })
          .on("mouseleave", () => {
            cross_tg.style("opacity", 0);
          });

        if (currentmode == "gc") {
          d3.selectAll(".line-route").style("visibility", " hidden");

          d3.selectAll(".gc-route").style("visibility", "visible");
        } else {
          d3.selectAll(".line-route").style("visibility", "visible");

          d3.selectAll(".gc-route").style("visibility", " hidden");
        }
      }

      if (arr.length > 1) {
        for (let j = 2; j <= arr.length; j++) {
          insertDistance(arr.slice(0, j), coorarr.slice(0, j));
        }
      }
    };

    

    var insertAfter = (point) => {
      var table = d3.select("#coordinates-table");
      var row;
      if (point == arr.length) {
        row = table
          .append("tr")
          .attr("id", "temporary_row-" + point)
          .attr("class", "disposable");
      } else {
        row = table
          .insert("tr", `#row-${point} + *`)
          .attr("class", "disposable")
          .attr("id", "temporary_row-" + point);
      }

      row
        .append("td")
        .attr("id", `insert_after_${point}`)
        .append("button")
        .style("opacity", "0");
      row
        .append("td")
        .style("text-align", "center")
        .style("background-color", "#000005")
        .append("button")
        .text("")
        .attr("class", "cell1")
        .attr("id", `temporary_cell${point}`);
      row
        .append("td")
        .append("div")
        .attr("id", "latLong")
        .style("display", "table")
        .attr("placeholder", "Enter Coordinates")
        .attr("type", "text")
        .attr("class", "cell2");

      d3.select("#latLong")
        .append("div")
        .style("display", "table-cell")
        .append("input")
        .attr("placeholder", "lat")
        .style("width", "89px")
        .attr("id", "latTxt");

      d3.select("#latLong")
        .append("div")
        .style("display", "table-cell")
        .append("input")
        .attr("placeholder", "long")
        .style("width", "89px")
        .attr("id", "longTxt");

      row
        .append("td")
        .append("div")
        .attr("id", "cell3-filler")
        .attr("type", "text")
        .attr("class", "cell3");

     row.append("td")
         .append("div")
        .style("display", "table-cell")
        .append("input")
        .attr("placeholder", "Velocity")
        .attr("id","velocity");
       
      

      
    };

    
    
    // Draw the location mark if one is currently visible.
    if (activeLocation.point && activeLocation.coord) {
      drawLocationMark(activeLocation.point, activeLocation.coord);
    }

    // Throttled draw method helps with slow devices that would get overwhelmed by too many redraw events.
    var REDRAW_WAIT = 5; // milliseconds
    var doDraw_throttled = _.throttle(doDraw, REDRAW_WAIT, { leading: false });

    function doDraw() {
      d3.selectAll("path").attr("d", path);
      rendererAgent.trigger("redraw");
      doDraw_throttled = _.throttle(doDraw, REDRAW_WAIT, { leading: false });
    }

    // Attach to map rendering events on input controller.
    dispatch.listenTo(inputController, {
      moveStart: function () {
        coastline.datum(mesh.coastLo);
        lakes.datum(mesh.lakesLo);
        rendererAgent.trigger("start");
      },
      move: function () {
        doDraw_throttled();
      },
      moveEnd: function () {
        coastline.datum(mesh.coastHi);
        lakes.datum(mesh.lakesHi);

        if (arr.length == 0) {
          // d3.selectAll("iso-mark-new").attr("d",isopath);
          d3.selectAll("path").attr("d", path);
          // drawisobar(isocoordinates);
        } else {
          d3.selectAll(".line-route").remove();
          d3.selectAll(".text-mark").remove();
          d3.selectAll(".cross-mark").remove();
          d3.selectAll(".gc-route").remove();
          // d3.selectAll(".iso-mark-new").remove();

          let newpoints = [];
          rldis = [];
          gcdis = [];
          totaltimetaken=0;
          totalrldis = 0;
          totalgcdis = 0;

          d3.selectAll(".location-mark")[0].map((element) => {
            newpoints.push([
              element.getBoundingClientRect().left + 7,
              element.getBoundingClientRect().top + 7,
            ]);
          });

          coorarr = newpoints;
          for (let i = 1; i < newpoints.length; i++) {
            var link = {
              type: "LineString",
              coordinates: [arr[i], arr[i - 1]],
            };
            d3.select("#foreground")
              .append("path")
              .attr("id", "gc-line" + (i + 1))
              .attr("d", path(link))
              .attr("class", "gc-route")
              .style("fill", "none")
              .style("stroke", "orange")
              .style("stroke-width", 4);
          }

          let x = newpoints[newpoints.length - 1][0];
          let y = newpoints[newpoints.length - 1][1];
          pointsArr = [x, y];

          redrawPath();
        }

        rendererAgent.trigger("render");
      },
      click: drawLocationMark,
    });

    // Finally, inject the globe model into the input controller. Do it on the next event turn to ensure
    // renderer is fully set up before events start flowing.
    when(true).then(function () {
      inputController.globe(globe);
    });

    log.timeEnd("rendering map");
    return "ready";
  }

  function createMask(globe) {
    if (!globe) return null;

    log.time("render mask");

    // Create a detached canvas, ask the model to define the mask polygon, then fill with an opaque color.
    var width = view.width,
      height = view.height;
    var canvas = d3
      .select(document.createElement("canvas"))
      .attr("width", width)
      .attr("height", height)
      .node();
    var context = globe.defineMask(canvas.getContext("2d"));
    context.fillStyle = "rgba(255, 0, 0, 1)";
    context.fill();
    // d3.select("#display").node().appendChild(canvas);  // make mask visible for debugging

    var imageData = context.getImageData(0, 0, width, height);
    var data = imageData.data; // layout: [r, g, b, a, r, g, b, a, ...]
    log.timeEnd("render mask");
    return {
      imageData: imageData,
      isVisible: function (x, y) {
        var i = (y * width + x) * 4;
        return data[i + 3] > 0; // non-zero alpha means pixel is visible
      },
      set: function (x, y, rgba) {
        var i = (y * width + x) * 4;
        data[i] = rgba[0];
        data[i + 1] = rgba[1];
        data[i + 2] = rgba[2];
        data[i + 3] = rgba[3];
        return this;
      },
    };
  }

  function createField(columns, bounds, mask) {
    /**
     * @returns {Array} wind vector [u, v, magnitude] at the point (x, y), or [NaN, NaN, null] if wind
     *          is undefined at that point.
     */
    function field(x, y) {
      var column = columns[Math.round(x)];
      return (column && column[Math.round(y)]) || NULL_WIND_VECTOR;
    }

    /**
     * @returns {boolean} true if the field is valid at the point (x, y)
     */
    field.isDefined = function (x, y) {
      return field(x, y)[2] !== null;
    };

    /**
     * @returns {boolean} true if the point (x, y) lies inside the outer boundary of the vector field, even if
     *          the vector field has a hole (is undefined) at that point, such as at an island in a field of
     *          ocean currents.
     */
    field.isInsideBoundary = function (x, y) {
      return field(x, y) !== NULL_WIND_VECTOR;
    };

    // Frees the massive "columns" array for GC. Without this, the array is leaked (in Chrome) each time a new
    // field is interpolated because the field closure's context is leaked, for reasons that defy explanation.
    field.release = function () {
      columns = [];
    };

    field.randomize = function (o) {
      // UNDONE: this method is terrible
      var x, y;
      var safetyNet = 0;
      do {
        x = Math.round(_.random(bounds.x, bounds.xMax));
        y = Math.round(_.random(bounds.y, bounds.yMax));
      } while (!field.isDefined(x, y) && safetyNet++ < 30);
      o.x = x;
      o.y = y;
      return o;
    };

    field.overlay = mask.imageData;

    return field;
  }

  /**
   * Calculate distortion of the wind vector caused by the shape of the projection at point (x, y). The wind
   * vector is modified in place and returned by this function.
   */
  function distort(projection, λ, φ, x, y, scale, wind) {
    var u = wind[0] * scale;
    var v = wind[1] * scale;
    var d = µ.distortion(projection, λ, φ, x, y);

    // Scale distortion vectors by u and v, then add.
    wind[0] = d[0] * u + d[2] * v;
    wind[1] = d[1] * u + d[3] * v;
    return wind;
  }

  function interpolateField(globe, grids) {
    if (!globe || !grids) return null;

    var mask = createMask(globe);
    var primaryGrid = grids.primaryGrid;
    var overlayGrid = grids.overlayGrid;

    log.time("interpolating field");
    var d = when.defer(),
      cancel = this.cancel;

    var projection = globe.projection;
    var bounds = globe.bounds(view);
    // How fast particles move on the screen (arbitrary value chosen for aesthetics).
    var velocityScale = bounds.height * primaryGrid.particles.velocityScale;

    var columns = [];
    var point = [];
    var x = bounds.x;
    var interpolate = primaryGrid.interpolate;
    var overlayInterpolate = overlayGrid.interpolate;
    var hasDistinctOverlay = primaryGrid !== overlayGrid;
    var scale = overlayGrid.scale;

    function interpolateColumn(x) {
      var column = [];
      for (var y = bounds.y; y <= bounds.yMax; y += 2) {
        if (mask.isVisible(x, y)) {
          point[0] = x;
          point[1] = y;
          var coord = projection.invert(point);
          var color = TRANSPARENT_BLACK;
          var wind = null;
          if (coord) {
            var λ = coord[0],
              φ = coord[1];
            if (isFinite(λ)) {
              wind = interpolate(λ, φ);
              var scalar = null;
              if (wind) {
                wind = distort(projection, λ, φ, x, y, velocityScale, wind);
                scalar = wind[2];
              }
              if (hasDistinctOverlay) {
                scalar = overlayInterpolate(λ, φ);
              }
              if (µ.isValue(scalar)) {
                color = scale.gradient(scalar, OVERLAY_ALPHA);
              }
            }
          }
          column[y + 1] = column[y] = wind || HOLE_VECTOR;
          mask
            .set(x, y, color)
            .set(x + 1, y, color)
            .set(x, y + 1, color)
            .set(x + 1, y + 1, color);
        }
      }
      columns[x + 1] = columns[x] = column;
    }

    report.status("");

    (function batchInterpolate() {
      try {
        if (!cancel.requested) {
          var start = Date.now();
          while (x < bounds.xMax) {
            interpolateColumn(x);
            x += 2;
            if (Date.now() - start > MAX_TASK_TIME) {
              // Interpolation is taking too long. Schedule the next batch for later and yield.
              report.progress((x - bounds.x) / (bounds.xMax - bounds.x));
              setTimeout(batchInterpolate, MIN_SLEEP_TIME);
              return;
            }
          }
        }
        d.resolve(createField(columns, bounds, mask));
      } catch (e) {
        d.reject(e);
      }
      report.progress(1); // 100% complete
      log.timeEnd("interpolating field");
    })();

    return d.promise;
  }

  function animate(globe, field, grids) {
    if (!globe || !field || !grids) return;

    var cancel = this.cancel;
    var bounds = globe.bounds(view);
    // maxIntensity is the velocity at which particle color intensity is maximum
    var colorStyles = µ.windIntensityColorScale(
      INTENSITY_SCALE_STEP,
      grids.primaryGrid.particles.maxIntensity
    );
    var buckets = colorStyles.map(function () {
      return [];
    });
    var particleCount = Math.round(bounds.width * PARTICLE_MULTIPLIER);
    if (µ.isMobile()) {
      particleCount *= PARTICLE_REDUCTION;
    }
    var fadeFillStyle = µ.isFF()
      ? "rgba(0, 0, 0, 0.95)"
      : "rgba(0, 0, 0, 0.97)"; // FF Mac alpha behaves oddly

    log.debug("particle count: " + particleCount);
    var particles = [];
    for (var i = 0; i < particleCount; i++) {
      particles.push(field.randomize({ age: _.random(0, MAX_PARTICLE_AGE) }));
    }

    function evolve() {
      buckets.forEach(function (bucket) {
        bucket.length = 0;
      });
      particles.forEach(function (particle) {
        if (particle.age > MAX_PARTICLE_AGE) {
          field.randomize(particle).age = 0;
        }
        var x = particle.x;
        var y = particle.y;
        var v = field(x, y); // vector at current position
        var m = v[2];
        if (m === null) {
          particle.age = MAX_PARTICLE_AGE; // particle has escaped the grid, never to return...
        } else {
          var xt = x + v[0];
          var yt = y + v[1];
          if (field.isDefined(xt, yt)) {
            // Path from (x,y) to (xt,yt) is visible, so add this particle to the appropriate draw bucket.
            particle.xt = xt;
            particle.yt = yt;
            buckets[colorStyles.indexFor(m)].push(particle);
          } else {
            // Particle isn't visible, but it still moves through the field.
            particle.x = xt;
            particle.y = yt;
          }
        }
        particle.age += 1;
      });
    }

    var g = d3.select("#animation").node().getContext("2d");
    g.lineWidth = PARTICLE_LINE_WIDTH;
    g.fillStyle = fadeFillStyle;

    function draw() {
      // Fade existing particle trails.
      var prev = g.globalCompositeOperation;
      g.globalCompositeOperation = "destination-in";
      g.fillRect(bounds.x, bounds.y, bounds.width, bounds.height);
      g.globalCompositeOperation = prev;

      // Draw new particle trails.
      buckets.forEach(function (bucket, i) {
        if (bucket.length > 0) {
          g.beginPath();
          g.strokeStyle = colorStyles[i];
          bucket.forEach(function (particle) {
            g.moveTo(particle.x, particle.y);
            g.lineTo(particle.xt, particle.yt);
            particle.x = particle.xt;
            particle.y = particle.yt;
          });
          g.stroke();
        }
      });
    }

    (function frame() {
      try {
        if (cancel.requested) {
          field.release();
          return;
        }
        evolve();
        draw();
        setTimeout(frame, FRAME_RATE);
      } catch (e) {
        report.error(e);
      }
    })();
  }

  function drawGridPoints(ctx, grid, globe) {
    if (!grid || !globe || !configuration.get("showGridPoints")) return;

    ctx.fillStyle = "rgba(255, 255, 255, 1)";
    // Use the clipping behavior of a projection stream to quickly draw visible points.
    var stream = globe.projection.stream({
      point: function (x, y) {
        ctx.fillRect(Math.round(x), Math.round(y), 1, 1);
      },
    });
    grid.forEachPoint(function (λ, φ, d) {
      if (µ.isValue(d)) {
        stream.point(λ, φ);
      }
    });
  }

  function drawOverlay(field, overlayType) {
    if (!field) return;

    var ctx = d3.select("#overlay").node().getContext("2d"),
      grid = (gridAgent.value() || {}).overlayGrid;

    µ.clearCanvas(d3.select("#overlay").node());
    µ.clearCanvas(d3.select("#scale").node());
    if (overlayType) {
      if (overlayType !== "off") {
        ctx.putImageData(field.overlay, 0, 0);
      }
      drawGridPoints(ctx, grid, globeAgent.value());
    }

    if (grid) {
      // Draw color bar for reference.
      var colorBar = d3.select("#scale"),
        scale = grid.scale,
        bounds = scale.bounds;
      var c = colorBar.node(),
        g = c.getContext("2d"),
        n = c.width - 1;
      for (var i = 0; i <= n; i++) {
        var rgb = scale.gradient(µ.spread(i / n, bounds[0], bounds[1]), 1);
        g.fillStyle = "rgb(" + rgb[0] + "," + rgb[1] + "," + rgb[2] + ")";
        g.fillRect(i, 0, 1, c.height);
      }

      // Show tooltip on hover.
      colorBar.on("mousemove", function () {
        var x = d3.mouse(this)[0];
        var pct = µ.clamp((Math.round(x) - 2) / (n - 2), 0, 1);
        var value = µ.spread(pct, bounds[0], bounds[1]);
        var elementId =
          grid.type === "wind"
            ? "#location-wind-units"
            : "#location-value-units";
        var units = createUnitToggle(elementId, grid).value();
        colorBar.attr(
          "title",
          µ.formatScalar(value, units) + " " + units.label
        );
      });
    }
  }

  /**
   * Extract the date the grids are valid, or the current date if no grid is available.
   * UNDONE: if the grids hold unloaded products, then the date can be extracted from them.
   *         This function would simplify nicely.
   */
  function validityDate(grids) {
    // When the active layer is considered "current", use its time as now, otherwise use current time as
    // now (but rounded down to the nearest three-hour block).
    var THREE_HOURS = 3 * HOUR;
    var now = grids
      ? grids.primaryGrid.date.getTime()
      : Math.floor(Date.now() / THREE_HOURS) * THREE_HOURS;
    var parts = configuration.get("date").split("/"); // yyyy/mm/dd or "current"
    var hhmm = configuration.get("hour");
    return parts.length > 1
      ? Date.UTC(+parts[0], parts[1] - 1, +parts[2], +hhmm.substring(0, 2))
      : parts[0] === "current"
      ? now
      : null;
  }

  /**
   * Display the grid's validity date in the menu. Allow toggling between local and UTC time.
   */
  function showDate(grids) {
    var date = new Date(validityDate(grids)),
      isLocal = d3.select("#data-date").classed("local");
    var formatted = isLocal ? µ.toLocalISO(date) : µ.toUTCISO(date);
    d3.select("#data-date").text(formatted + " " + (isLocal ? "Local" : "UTC"));
    d3.select("#toggle-zone").text("⇄ " + (isLocal ? "UTC" : "Local"));
  }

  /**
   * Display the grids' types in the menu.
   */
  function showGridDetails(grids) {
    showDate(grids);
    var description = "",
      center = "";
    if (grids) {
      var langCode = d3.select("body").attr("data-lang") || "en";
      var pd = grids.primaryGrid.description(langCode),
        od = grids.overlayGrid.description(langCode);
      description = od.name + od.qualifier;
      if (grids.primaryGrid !== grids.overlayGrid) {
        // Combine both grid descriptions together with a " + " if their qualifiers are the same.
        description =
          (pd.qualifier === od.qualifier ? pd.name : pd.name + pd.qualifier) +
          " + " +
          description;
      }
      center = grids.overlayGrid.source;
    }
    d3.select("#data-layer").text(description);
    d3.select("#data-center").text(center);
  }

  /**
   * Constructs a toggler for the specified product's units, storing the toggle state on the element having
   * the specified id. For example, given a product having units ["m/s", "mph"], the object returned by this
   * method sets the element's "data-index" attribute to 0 for m/s and 1 for mph. Calling value() returns the
   * currently active units object. Calling next() increments the index.
   */
  function createUnitToggle(id, product) {
    var units = product.units,
      size = units.length;
    var index = +(d3.select(id).attr("data-index") || 0) % size;
    return {
      value: function () {
        return units[index];
      },
      next: function () {
        d3.select(id).attr("data-index", (index = (index + 1) % size));
      },
    };
  }

  /**
   * Display the specified wind value. Allow toggling between the different types of wind units.
   */
  function showWindAtLocation(wind, product) {
    var unitToggle = createUnitToggle("#location-wind-units", product),
      units = unitToggle.value();
    d3.select("#location-wind").text(µ.formatVector(wind, units));
    d3.select("#location-wind-units")
      .text(configuration.changed.level !== "waves" ? units.label : "m | s")
      .on("click", function () {
        if (configuration.changed.level !== "waves") {
          unitToggle.next();
          showWindAtLocation(wind, product);
        }
      });
  }

  /**
   * Display the specified overlay value. Allow toggling between the different types of supported units.
   */
  // function showOverlayValueAtLocation(value, product) {
  //   var unitToggle = createUnitToggle("#location-value-units", product),
  //     units = unitToggle.value();
  //   d3.select("#location-value").text(µ.formatScalar(value, units));
  //   d3.select("#location-value-units")
  //     .text(units.label)
  //     .on("click", function () {
  //       unitToggle.next();
  //       showOverlayValueAtLocation(value, product);
  //     });
  // }

  // Stores the point and coordinate of the currently visible location. This is used to update the location
  // details when the field changes.
  var activeLocation = {};

  /**
   * Display a local data callout at the given [x, y] point and its corresponding [lon, lat] coordinates.
   * The location may not be valid, in which case no callout is displayed. Display location data for both
   * the primary grid and overlay grid, performing interpolation when necessary.
   */
  function showLocationDetails(point, coord) {
    point = point || [];
    coord = coord || [];
    var grids = gridAgent.value(),
      field = fieldAgent.value(),
      λ = coord[0],
      φ = coord[1];
    if (!field || !field.isInsideBoundary(point[0], point[1])) {
      return;
    }

    clearLocationDetails(false); // clean the slate
    activeLocation = { point: point, coord: coord }; // remember where the current location is

    if (_.isFinite(λ) && _.isFinite(φ)) {
      d3.select("#location-coord").text(µ.formatCoordinates(λ, φ));
      d3.select("#location-close").classed("invisible", false);
    }

    if (field.isDefined(point[0], point[1]) && grids) {
      var wind = grids.primaryGrid.interpolate(λ, φ);
      if (µ.isValue(wind)) {
        showWindAtLocation(wind, grids.primaryGrid);
      }
      if (grids.overlayGrid !== grids.primaryGrid) {
        var value = grids.overlayGrid.interpolate(λ, φ);
        if (µ.isValue(value)) {
          showOverlayValueAtLocation(value, grids.overlayGrid);
        }
      }
    }
  }

  function updateLocationDetails() {
    showLocationDetails(activeLocation.point, activeLocation.coord);
  }

  function clearLocationDetails(clearEverything) {
    d3.select("#location-coord").text("");
    d3.select("#location-close").classed("invisible", true);
    d3.select("#location-wind").text("");
    d3.select("#location-wind-units").text("");
    d3.select("#location-value").text("");
    d3.select("#location-value-units").text("");
    if (clearEverything) {
      activeLocation = {};
      // d3.select(".location-mark").remove();
    }
  }

  function stopCurrentAnimation(alsoClearCanvas) {
    animatorAgent.cancel();
    if (alsoClearCanvas) {
      µ.clearCanvas(d3.select("#animation").node());
    }
  }

  /**
   * Registers a click event handler for the specified DOM element which modifies the configuration to have
   * the attributes represented by newAttr. An event listener is also registered for configuration change events,
   * so when a change occurs the button becomes highlighted (i.e., class ".highlighted" is assigned or removed) if
   * the configuration matches the attributes for this button. The set of attributes used for the matching is taken
   * from newAttr, unless a custom set of keys is provided.
   */
  function bindButtonToConfiguration(elementId, newAttr, keys) {
    keys = keys || _.keys(newAttr);

    d3.select(elementId).on("click", function () {
      if (d3.select(elementId).classed("disabled")) return;
      configuration.save(newAttr);
    });

    configuration.on("change", function (model) {
      var attr = model.attributes;
      d3.select(elementId).classed(
        "highlighted",
        _.isEqual(_.pick(attr, keys), _.pick(newAttr, keys))
      );
    });
  }

  function reportSponsorClick(type) {
    if (ga) {
      ga("send", "event", "sponsor", type);
    }
  }

  /**
   * Registers all event handlers to bind components and page elements together. There must be a cleaner
   * way to accomplish this...
   */
  function init() {
    report.status("Initializing...");

    d3.select("#sponsor-link")
      .attr("target", µ.isEmbeddedInIFrame() ? "_new" : null)
      .on("click", reportSponsorClick.bind(null, "click"))
      .on("contextmenu", reportSponsorClick.bind(null, "right-click"));
    d3.select("#sponsor-hide").on("click", function () {
      sible;

      d3.select("#sponsor").classed("invisible", true);
    });

    d3.selectAll(".fill-screen")
      .attr("width", view.width)
      .attr("height", view.height);
    // Adjust size of the scale canvas to fill the width of the menu to the right of the label.
    var label = d3.select("#scale-label").node();
    d3.select("#scale")
      .attr(
        "width",
        (d3.select("#menu").node().offsetWidth - label.offsetWidth) * 0.97
      )
      .attr("height", label.offsetHeight / 2);

    d3.select("#show-menu").on("click", function () {
      if (µ.isEmbeddedInIFrame()) {
        window.open(
          "http://earth.nullschool.net/" + window.location.hash,
          "_blank"
        );
      } else {
        d3.select("#menu").classed(
          "invisible",
          !d3.select("#menu").classed("invisible")
        );
      }
    });

    if (µ.isFF()) {
      // Workaround FF performance issue of slow click behavior on map having thick coastlines.
      d3.select("#display").classed("firefox", true);
    }

    // Tweak document to distinguish CSS styling between touch and non-touch environments. Hacky hack.
    if ("ontouchstart" in document.documentElement) {
      d3.select(document).on("touchstart", function () {}); // this hack enables :active pseudoclass
    } else {
      d3.select(document.documentElement).classed("no-touch", true); // to filter styles problematic for touch
    }

    // Bind configuration to URL bar changes.
    d3.select(window).on("hashchange", function () {
      log.debug("hashchange");
      configuration.fetch({ trigger: "hashchange" });
    });

    configuration.on("change", report.reset);

    meshAgent.listenTo(
      configuration,
      "change:topology",
      function (context, attr) {
        meshAgent.submit(buildMesh, attr);
      }
    );

    globeAgent.listenTo(
      configuration,
      "change:projection",
      function (source, attr) {
        globeAgent.submit(buildGlobe, attr);
      }
    );

    gridAgent.listenTo(configuration, "change", function () {
      var changed = _.keys(configuration.changedAttributes()),
        rebuildRequired = false;

      // Build a new grid if any layer-related attributes have changed.
      if (
        _.intersection(changed, ["date", "hour", "param", "surface", "level"])
          .length > 0
      ) {
        rebuildRequired = true;
      }
      // Build a new grid if the new overlay type is different from the current one.
      var overlayType = configuration.get("overlayType") || "default";
      if (_.indexOf(changed, "overlayType") >= 0 && overlayType !== "off") {
        var grids = gridAgent.value() || {},
          primary = grids.primaryGrid,
          overlay = grids.overlayGrid;
        if (!overlay) {
          // Do a rebuild if we have no overlay grid.
          rebuildRequired = true;
        } else if (
          overlay.type !== overlayType &&
          !(overlayType === "default" && primary === overlay)
        ) {
          // Do a rebuild if the types are different.
          rebuildRequired = true;
        }
      }

      if (rebuildRequired) {
        gridAgent.submit(buildGrids);
      }
    });
    gridAgent.on("submit", function () {
      showGridDetails(null);
    });
    gridAgent.on("update", function (grids) {
      showGridDetails(grids);
    });
    d3.select("#toggle-zone").on("click", function () {
      d3.select("#data-date").classed(
        "local",
        !d3.select("#data-date").classed("local")
      );
      showDate(gridAgent.cancel.requested ? null : gridAgent.value());
    });

    function startRendering() {
      rendererAgent.submit(
        buildRenderer,
        meshAgent.value(),
        globeAgent.value()
      );
    }
    rendererAgent.listenTo(meshAgent, "update", startRendering);
    rendererAgent.listenTo(globeAgent, "update", startRendering);

    function startInterpolation() {
      fieldAgent.submit(
        interpolateField,
        globeAgent.value(),
        gridAgent.value()
      );
    }

    function cancelInterpolation() {
      fieldAgent.cancel();
    }
    fieldAgent.listenTo(gridAgent, "update", startInterpolation);
    fieldAgent.listenTo(rendererAgent, "render", startInterpolation);
    fieldAgent.listenTo(rendererAgent, "start", cancelInterpolation);
    fieldAgent.listenTo(rendererAgent, "redraw", cancelInterpolation);

    animatorAgent.listenTo(fieldAgent, "update", function (field) {
      animatorAgent.submit(
        animate,
        globeAgent.value(),
        field,
        gridAgent.value()
      );
    });
    animatorAgent.listenTo(
      rendererAgent,
      "start",
      stopCurrentAnimation.bind(null, true)
    );
    animatorAgent.listenTo(
      gridAgent,
      "submit",
      stopCurrentAnimation.bind(null, false)
    );
    animatorAgent.listenTo(
      fieldAgent,
      "submit",
      stopCurrentAnimation.bind(null, false)
    );

    overlayAgent.listenTo(fieldAgent, "update", function () {
      overlayAgent.submit(
        drawOverlay,
        fieldAgent.value(),
        configuration.get("overlayType")
      );
    });
    overlayAgent.listenTo(rendererAgent, "start", function () {
      overlayAgent.submit(drawOverlay, fieldAgent.value(), null);
    });
    overlayAgent.listenTo(configuration, "change", function () {
      var changed = _.keys(configuration.changedAttributes());
      // if only overlay relevant flags have changed...
      if (
        _.intersection(changed, ["overlayType", "showGridPoints"]).length > 0
      ) {
        overlayAgent.submit(
          drawOverlay,
          fieldAgent.value(),
          configuration.get("overlayType")
        );
      }
    });

    // Add event handlers for showing, updating, and removing location details.
    inputController.on("click", showLocationDetails);
    fieldAgent.on("update", updateLocationDetails);
    d3.select("#location-close").on(
      "click",
      _.partial(clearLocationDetails, true)
    );

    // Modify menu depending on what mode we're in.
    configuration.on("change:param", function (context, mode) {
      d3.selectAll(".ocean-mode").classed("invisible", mode !== "ocean");
      d3.selectAll(".wind-mode").classed("invisible", mode !== "wind");
      switch (mode) {
        case "wind":
          d3.select("#nav-backward-more").attr("title", "-1 Day");
          d3.select("#nav-backward").attr("title", "-6 Hours");
          d3.select("#nav-forward").attr("title", "+6 Hours");
          d3.select("#nav-forward-more").attr("title", "+1 Day");
          break;
        case "ocean":
          d3.select("#nav-backward-more").attr("title", "-1 Day");
          d3.select("#nav-backward").attr("title", "-6 Hours");
          d3.select("#nav-forward").attr("title", "+6 Hours");
          d3.select("#nav-forward-more").attr("title", "+1 Day");
          break;
      }
    });

    // Add handlers for mode buttons.
    d3.select("#wind-mode-enable").on("click", function () {
      if (configuration.get("param") !== "wind") {
        configuration.save({
          param: "wind",
          surface: "surface",
          level: "level",
          overlayType: "off",
        });
      }
    });
    configuration.on("change:param", function (x, param) {
      d3.select("#wind-mode-enable").classed("highlighted", param === "wind");
    });
    d3.select("#ocean-mode-enable").on("click", function () {
      if (configuration.get("param") !== "ocean") {
        // When switching between modes, there may be no associated data for the current date. So we need
        // find the closest available according to the catalog. This is not necessary if date is "current".
        // UNDONE: this code is annoying. should be easier to get date for closest ocean product.
        var ocean = {
          param: "ocean",
          surface: "surface",
          level: "currents",
          overlayType: "off",
        };
        var attr = _.clone(configuration.attributes);
        if (attr.date === "current") {
          configuration.save(ocean);
        } else {
          when
            .all(products.productsFor(_.extend(attr, ocean)))
            .spread(function (product) {
              if (product.date) {
                configuration.save(
                  _.extend(ocean, µ.dateToConfig(product.date))
                );
              }
            })
            .otherwise(report.error);
        }
        stopCurrentAnimation(true); // cleanup particle artifacts over continents
      }
    });
    configuration.on("change:param", function (x, param) {
      d3.select("#ocean-mode-enable").classed("highlighted", param === "ocean");
    });

    // Add logic to disable buttons that are incompatible with each other.
    configuration.on("change:overlayType", function (x, ot) {
      d3.select("#surface-level").classed(
        "disabled",
        ot === "air_density" || ot === "wind_power_density"
      );
    });
    configuration.on("change:surface", function (x, s) {
      d3.select("#overlay-air_density").classed("disabled", s === "surface");
      d3.select("#overlay-wind_power_density").classed(
        "disabled",
        s === "surface"
      );
    });

    const change_date = (x) => {
      var date_from_dom = document.getElementById("data-date").textContent;
      var [date, time] = date_from_dom.split(" ");
      var datetime;
      
      if (x==0) {
         var currentdate = new Date();
         var utc = currentdate.getTime() + (currentdate.getTimezoneOffset() * 60000);
         datetime = new Date(utc + (3600000*'-4.5'));
      } else {
         datetime = new Date(date + " " + time);
      }

    
      if (Math.abs(x) === 24) {
        datetime.setDate(datetime.getDate() + Math.sign(x) * 1);
      } else if (datetime.getHours() + x > 24) {
        datetime.setDate(datetime.getDate() + 1);
        datetime.setHours(24 - (datetime.getHours() + x));
      } else if (datetime.getHours() + x < 0) {
        datetime.setDate(datetime.getDate() - 1);
        datetime.setHours(24 + (datetime.getHours() + x));
      } else {
        datetime.setHours(datetime.getHours() + x);
      }

      var d = datetime.getDate().toString();
      var m = (datetime.getMonth() + 1).toString();
      var y = datetime.getFullYear().toString();
      var t = datetime.getHours().toString();
      var min = datetime.getMinutes().toString();

     
       

      var slot = "00";
      if (t  >= 0 && t  <= 5) {
        slot = "00";
      } else if (t  >= 6 && t <= 11) {
        slot = "06";
      } else if (t >= 12 && t  <= 17) {
        slot = "12";
      } else {
        slot = "18";
      }
     
        window.location.href = `http://localhost:3000/?year=${y}&month=${m}&date=${d}&slot=${slot}`
      
     
    };

    // Add event handlers for the time navigation buttons.
    d3.select("#nav-backward-more").on("click", () => {
      change_date(-24);
    });
    // navigate.bind(null, -10));
    d3.select("#nav-forward-more").on("click", () => {
      change_date(+24);
    });
    //  navigate.bind(null, +10));
    d3.select("#nav-backward").on("click",()=>{
      change_date(-6)
    }); 
    // navigate.bind(null, -1));
    d3.select("#nav-forward").on("click", () => {
      change_date(+6);
    }); /* 
    d3.select("#nav-forward").on("click", navigate.bind(null, +1)); */
    d3.select("#nav-now").on("click", function () {
     
      change_date(0);
      configuration.save({ date: "current", hour: "" });
    });

    d3.select("#option-show-grid").on("click", function () {
      configuration.save({
        showGridPoints: !configuration.get("showGridPoints"),
      });
    });
    configuration.on("change:showGridPointFs", function (x, showGridPoints) {
      d3.select("#option-show-grid").classed("highlighted", showGridPoints);
    });

    // Add handlers for all wind level buttons.
    d3.selectAll(".surface").each(function () {
      var id = this.id,
        parts = id.split("-");
      bindButtonToConfiguration("#" + id, {
        param: "wind",
        surface: parts[0],
        level: parts[1],
      });
    });

    // Add handlers for ocean animation types.
    bindButtonToConfiguration("#animate-currents", {
      param: "ocean",
      surface: "surface",
      level: "currents",
    });
    bindButtonToConfiguration("#animate-winds", {
      param: "wind",
      surface: "surface",
      level: "level",
    });
    bindButtonToConfiguration("#animate-waves", {
      param: "ocean",
      surface: "surface",
      level: "waves",
    });

    bindButtonToConfiguration("#animate-currents-back", {
      param: "ocean",
      surface: "surface",
      level: "currents",
    });
    bindButtonToConfiguration("#animate-winds-back", {
      param: "wind",
      surface: "surface",
      level: "level",
    });
    bindButtonToConfiguration("#animate-waves-back", {
      param: "ocean",
      surface: "surface",
      level: "waves",
    });

    // Add handlers for all overlay buttons.
    products.overlayTypes.forEach(function (type) {
      bindButtonToConfiguration("#overlay-" + type, { overlayType: type });
    });
    // bindButtonToConfiguration("#overlay-wind", {param: "wind", overlayType: "default"});
    bindButtonToConfiguration("#overlay-ocean-off", { overlayType: "off" });
    // bindButtonToConfiguration("#overlay-currents", {overlayType: "default"});

    // Add handlers for all projection buttons.
    globes.keys().forEach(function (p) {
      bindButtonToConfiguration("#" + p, { projection: p, orientation: "" }, [
        "projection",
      ]);
    });

    // When touch device changes between portrait and landscape, rebuild globe using the new view size.
    d3.select(window).on("orientationchange", function () {
      view = µ.view();
      globeAgent.submit(buildGlobe, configuration.get("projection"));
    });
  }

  function start() {
    // Everything is now set up, so load configuration from the hash fragment and kick off change events.
    configuration.fetch();
  }

  when(true).then(init).then(start).otherwise(report.error);
})();

    </script>
   


</body>
</html>
